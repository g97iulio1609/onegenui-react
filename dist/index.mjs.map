{"version":3,"sources":["../src/contexts/data.tsx","../src/store/index.ts","../src/store/slices/domain.ts","../src/store/slices/ui.ts","../src/store/slices/selection.ts","../src/store/slices/settings.ts","../src/store/slices/analytics.ts","../src/store/slices/actions.ts","../src/store/slices/validation.ts","../src/store/slices/tool-progress.ts","../src/store/slices/plan-execution.ts","../src/store/slices/deep-research.ts","../src/store/slices/ui-tree.ts","../src/store/slices/workspace.ts","../src/store/slices/canvas.ts","../src/contexts/visibility.tsx","../src/contexts/actions.tsx","../src/utils.ts","../src/contexts/validation.tsx","../src/contexts/selection/context.ts","../src/contexts/selection/provider.tsx","../src/contexts/selection/styles.ts","../src/contexts/selection/utils.ts","../src/contexts/selection/use-selection-state.ts","../src/contexts/selection/use-long-press.ts","../src/utils/dom.ts","../src/contexts/edit-mode.tsx","../src/contexts/selection/hooks.ts","../src/contexts/selection/use-dom-tracking.ts","../src/contexts/selection/SelectableItem.tsx","../src/contexts/markdown/types.ts","../src/contexts/markdown/internal-markdown.tsx","../src/contexts/citation/index.ts","../src/contexts/citation/inline-citation.tsx","../src/contexts/markdown/provider.tsx","../src/contexts/ai-settings.tsx","../src/hooks/types.ts","../src/contexts/ai-settings/types.ts","../src/contexts/ai-settings/storage.ts","../src/contexts/action-tracking/provider.tsx","../src/contexts/action-tracking/types.ts","../src/contexts/action-tracking/utils.ts","../src/contexts/action-tracking/hooks.ts","../src/contexts/autosave.tsx","../src/contexts/tool-progress.tsx","../src/contexts/unified-progress.tsx","../src/components/InteractionTrackingWrapper.tsx","../src/utils/selection.ts","../src/components/ErrorBoundary.tsx","../src/renderer/element-renderer.tsx","../src/components/ResizableWrapper.tsx","../src/hooks/resizable/types.ts","../src/hooks/resizable/utils.ts","../src/hooks/resizable/hook.ts","../src/components/SelectionWrapper.tsx","../src/components/LongPressIndicator.tsx","../src/components/EditableWrapper.tsx","../src/hooks/useUIStream.ts","../src/hooks/patches/structural-sharing.ts","../src/hooks/patches/tree-utils.ts","../src/hooks/patches/types.ts","../src/hooks/patch-utils.ts","../src/hooks/ui-stream/tree-mutations.ts","../src/hooks/ui-stream/use-history.ts","../src/hooks/ui-stream/logger.ts","../src/hooks/ui-stream/plan-handler.ts","../src/hooks/ui-stream/request-builder.ts","../src/hooks/ui-stream/document-index-handler.ts","../src/hooks/ui-stream/use-store-refs.ts","../src/hooks/ui-stream/turn-manager.ts","../src/hooks/ui-stream/question-handler.ts","../src/hooks/ui-stream/stream-parser.ts","../src/hooks/ui-stream/stream-reader.ts","../src/hooks/ui-stream/patch-processor.ts","../src/hooks/useTextSelection.ts","../src/hooks/useIsMobile.ts","../src/hooks/usePreservedSelection.ts","../src/hooks/useLayoutManager.ts","../src/hooks/useHistory.ts","../src/hooks/useDeepResearch.ts","../src/hooks/useRenderEditableText.tsx","../src/components/EditableText.tsx","../src/hooks/flat-to-tree.ts","../src/renderer/provider.tsx","../src/renderer.tsx","../src/renderer/memo-utils.ts","../src/renderer/skeleton-loader.tsx","../src/editable.tsx","../src/components/MarkdownText.tsx","../src/components/TextSelectionBadge.tsx","../src/components/free-grid/canvas.tsx","../src/components/free-grid/styles.ts","../src/components/free-grid/grid-lines.tsx","../src/components/free-grid/grid-cell.tsx","../src/components/free-grid/layout-utils.ts","../src/components/ToolProgressOverlay.tsx","../src/components/tool-progress/icons.tsx","../src/components/tool-progress/progress-item.tsx","../src/components/Canvas/CanvasBlock.tsx","../../../node_modules/.pnpm/dompurify@3.3.1/node_modules/dompurify/src/utils.ts","../../../node_modules/.pnpm/dompurify@3.3.1/node_modules/dompurify/src/tags.ts","../../../node_modules/.pnpm/dompurify@3.3.1/node_modules/dompurify/src/attrs.ts","../../../node_modules/.pnpm/dompurify@3.3.1/node_modules/dompurify/src/regexp.ts","../../../node_modules/.pnpm/dompurify@3.3.1/node_modules/dompurify/src/purify.ts","../src/components/Document/DocumentBlock.tsx","../src/use-cases/selection.use-case.ts"],"sourcesContent":["\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  useEffect,\n  type ReactNode,\n} from \"react\";\nimport { getByPath, type DataModel, type AuthState } from \"@onegenui/core\";\nimport { useStore } from \"../store\";\n\n/**\n * Data context value\n */\nexport interface DataContextValue {\n  /** The current data model */\n  data: DataModel;\n  /** Auth state for visibility evaluation */\n  authState?: AuthState;\n  /** Get a value by path */\n  get: (path: string) => unknown;\n  /** Set a value by path */\n  set: (path: string, value: unknown) => void;\n  /** Update multiple values at once */\n  update: (updates: Record<string, unknown>) => void;\n}\n\nconst DataContext = createContext<DataContextValue | null>(null);\n\n/**\n * Props for DataProvider\n */\nexport interface DataProviderProps {\n  /** Initial data model */\n  initialData?: DataModel;\n  /** Auth state */\n  authState?: AuthState;\n  /** Callback when data changes */\n  onDataChange?: (path: string, value: unknown) => void;\n  children: ReactNode;\n}\n\n/**\n * Provider for data model context\n *\n * Uses Zustand store as backing store for optimal performance.\n * Context API provides stable public interface for package consumers.\n */\nexport function DataProvider({\n  initialData = {},\n  authState,\n  onDataChange,\n  children,\n}: DataProviderProps) {\n  // Use Zustand store for state management\n  const data = useStore((s) => s.dataModel);\n  const storeAuth = useStore((s) => s.auth);\n  const setDataModel = useStore((s) => s.setDataModel);\n  const updateDataModel = useStore((s) => s.updateDataModel);\n  const setAuth = useStore((s) => s.setAuth);\n\n  // Sync initial data to store on mount\n  useEffect(() => {\n    if (Object.keys(initialData).length > 0) {\n      setDataModel(initialData);\n    }\n  }, []); // Only on mount\n\n  // Sync authState prop to store\n  useEffect(() => {\n    if (authState) {\n      setAuth(authState);\n    }\n  }, [authState, setAuth]);\n\n  const get = useCallback((path: string) => getByPath(data, path), [data]);\n\n  const set = useCallback(\n    (path: string, value: unknown) => {\n      updateDataModel(path, value);\n      onDataChange?.(path, value);\n    },\n    [updateDataModel, onDataChange],\n  );\n\n  const update = useCallback(\n    (updates: Record<string, unknown>) => {\n      for (const [path, value] of Object.entries(updates)) {\n        updateDataModel(path, value);\n        onDataChange?.(path, value);\n      }\n    },\n    [updateDataModel, onDataChange],\n  );\n\n  // Use store auth or prop auth\n  const effectiveAuth = authState ?? storeAuth;\n\n  const value = useMemo<DataContextValue>(\n    () => ({\n      data,\n      authState: effectiveAuth,\n      get,\n      set,\n      update,\n    }),\n    [data, effectiveAuth, get, set, update],\n  );\n\n  return <DataContext.Provider value={value}>{children}</DataContext.Provider>;\n}\n\n/**\n * Hook to access the data context\n */\nexport function useData(): DataContextValue {\n  const ctx = useContext(DataContext);\n  if (!ctx) {\n    throw new Error(\"useData must be used within a DataProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to get a value from the data model\n * Optimized: subscribes only to the specific path via Zustand selector\n */\nexport function useDataValue<T>(path: string): T | undefined {\n  // Direct Zustand subscription for granular updates\n  const value = useStore((s) => getByPath(s.dataModel, path));\n  return value as T | undefined;\n}\n\n/**\n * Hook to get and set a value from the data model (like useState)\n */\nexport function useDataBinding<T>(\n  path: string,\n): [T | undefined, (value: T) => void] {\n  const value = useDataValue<T>(path);\n  const updateDataModel = useStore((s) => s.updateDataModel);\n\n  const setValue = useCallback(\n    (newValue: T) => updateDataModel(path, newValue),\n    [path, updateDataModel],\n  );\n\n  return [value, setValue];\n}\n","/**\n * Root Store - Combined Zustand store with all slices\n *\n * Uses the official Zustand slice pattern with immer middleware.\n * See: https://zustand.docs.pmnd.rs/guides/typescript#slices-pattern\n */\nimport { create } from \"zustand\";\nimport { devtools, subscribeWithSelector } from \"zustand/middleware\";\nimport { immer } from \"zustand/middleware/immer\";\nimport { enableMapSet } from \"immer\";\nimport { useShallow } from \"zustand/react/shallow\";\nimport type { StoreApi, UseBoundStore } from \"zustand\";\n\n// Enable Immer MapSet plugin for Set/Map support in store\nenableMapSet();\n\nimport {\n  createDomainSlice,\n  createUISlice,\n  createSelectionSlice,\n  createSettingsSlice,\n  createAnalyticsSlice,\n  createActionsSlice,\n  createValidationSlice,\n  createToolProgressSlice,\n  createPlanExecutionSlice,\n  createDeepResearchSlice,\n  createUITreeSlice,\n  createWorkspaceSlice,\n  createCanvasSlice,\n} from \"./slices\";\n\nimport type { StoreState } from \"./types\";\nexport type { StoreState } from \"./types\";\nexport type { UITreeSlice } from \"./slices/ui-tree\";\nexport type { DeepSelectionInfo, DeepSelectionInput } from \"./slices/selection\";\nexport type {\n  PlanExecutionState,\n  PlanStep,\n  PlanSubtask,\n  PlanStepStatus,\n  ExecutionPlan,\n} from \"./slices/plan-execution\";\nexport type {\n  DeepResearchSlice,\n  DeepResearchEffortLevel,\n  DeepResearchSettings,\n  AuthenticatedSource,\n  ResearchPhase,\n  ResearchSource,\n  ActiveResearch,\n  ResearchResultSummary,\n} from \"./slices/deep-research\";\n\n// =============================================================================\n// Store Type (exported for external use)\n// =============================================================================\n\n/**\n * Public store hook type - hides internal immer types\n */\nexport type OneGenUIStore = UseBoundStore<StoreApi<StoreState>>;\n\n// =============================================================================\n// Store Creation\n// =============================================================================\n\n/**\n * Main store hook. Use this to access the store state and actions.\n *\n * @example\n * ```tsx\n * const theme = useStore((s) => s.theme);\n * const setTheme = useStore((s) => s.setTheme);\n * ```\n */\nexport const useStore: OneGenUIStore = create<StoreState>()(\n  devtools(\n    subscribeWithSelector(\n      immer((...args) => ({\n        ...createDomainSlice(...args),\n        ...createUISlice(...args),\n        ...createSelectionSlice(...args),\n        ...createSettingsSlice(...args),\n        ...createAnalyticsSlice(...args),\n        ...createActionsSlice(...args),\n        ...createValidationSlice(...args),\n        ...createToolProgressSlice(...args),\n        ...createPlanExecutionSlice(...args),\n        ...createDeepResearchSlice(...args),\n        ...createUITreeSlice(...args),\n        ...createWorkspaceSlice(...args),\n        ...createCanvasSlice(...args),\n      })),\n    ),\n    {\n      name: \"onegenui-store\",\n      enabled: process.env.NODE_ENV !== \"production\",\n    },\n  ),\n) as OneGenUIStore;\n\n/**\n * Alias for useStore - alternative name\n */\nexport const useUIStore: OneGenUIStore = useStore;\n\n// =============================================================================\n// Selector Hooks (for optimized re-renders)\n// =============================================================================\n\n// Domain selectors\nexport const useDataModel = () => useStore((s) => s.dataModel);\nexport const useAuth = () => useStore((s) => s.auth);\nexport const useIsLoading = () => useStore((s) => s.isLoading);\n\n// UI selectors - useShallow for collections to prevent re-renders\nexport const useConfirmations = () =>\n  useStore(useShallow((s) => s.confirmations));\nexport const useToolProgress = () =>\n  useStore(useShallow((s) => s.toolProgress));\nexport const useGlobalLoading = () => useStore((s) => s.globalLoading);\nexport const useSidebarOpen = () => useStore((s) => s.sidebarOpen);\n\n// Selection selectors - useShallow for arrays/objects\nexport const useSelectedKey = () => useStore((s) => s.selectedKey);\nexport const useSelectedElement = () =>\n  useStore(useShallow((s) => s.selectedElement));\nexport const useMultiSelectedKeys = () =>\n  useStore(useShallow((s) => s.multiSelectedKeys));\nexport const useHoveredKey = () => useStore((s) => s.hoveredKey);\n\n// Selection selectors - Deep selection (useShallow for array)\nexport const useDeepSelections = () =>\n  useStore(useShallow((s) => s.deepSelections));\nexport const useDeepSelectionActive = () =>\n  useStore((s) => s.deepSelectionActive);\n// Use useShallow for derived objects that are computed on every call\nexport const useGranularSelection = () =>\n  useStore(\n    useShallow((s) => {\n      const result: Record<string, Set<string>> = {};\n      for (const sel of s.deepSelections) {\n        if (sel.itemId) {\n          if (!result[sel.elementKey]) {\n            result[sel.elementKey] = new Set();\n          }\n          result[sel.elementKey]!.add(sel.itemId);\n        }\n      }\n      return result;\n    }),\n  );\n\n// Settings selectors\nexport const useTheme = () => useStore((s) => s.theme);\nexport const useAISettings = () =>\n  useStore(useShallow((s) => s.aiSettings));\nexport const useCompactMode = () => useStore((s) => s.compactMode);\n\n// Analytics selectors - use useShallow for array slicing\nexport const useRecentActions = (count = 10) =>\n  useStore(useShallow((s) => s.actions.slice(0, count)));\n\n// Actions selectors - useShallow for collections\nexport const useLoadingActions = () =>\n  useStore(useShallow((s) => s.loadingActions));\nexport const usePendingConfirmations = () =>\n  useStore(useShallow((s) => s.pendingConfirmations));\nexport const useActionHistory = () =>\n  useStore(useShallow((s) => s.actionHistory));\n\n// Validation selectors - useShallow for Map/Record\nexport const useFieldStates = () =>\n  useStore(useShallow((s) => s.fieldStates));\nexport const useIsValidating = () => useStore((s) => s.isValidating);\n// Use useShallow for derived form state\nexport const useFormState = () =>\n  useStore(\n    useShallow((s) => {\n      const states = Object.values(s.fieldStates);\n      let touchedCount = 0;\n      let errorCount = 0;\n      let isValid = true;\n      let isDirty = false;\n\n      for (const state of states) {\n        if (state.touched) {\n          touchedCount++;\n          isDirty = true;\n        }\n        if (state.validationResult && !state.validationResult.isValid) {\n          isValid = false;\n          errorCount += state.validationResult.errors.length;\n        }\n      }\n\n      return {\n        isValid,\n        isDirty,\n        isValidating: s.isValidating,\n        touchedCount,\n        errorCount,\n      };\n    }),\n  );\n\n// Tool Progress selectors\nexport const useProgressEvents = () => useStore((s) => s.progressEvents);\n// Use useShallow for filtered arrays\nexport const useActiveToolProgress = () =>\n  useStore(\n    useShallow((s) =>\n      s.progressEvents.filter(\n        (e) => e.status === \"starting\" || e.status === \"progress\",\n      ),\n    ),\n  );\n// Boolean primitives are stable, no useShallow needed\nexport const useIsAnyToolRunning = () =>\n  useStore((s) =>\n    s.progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    ),\n  );\n\n// Plan Execution selectors\nexport const selectPlanExecution = (s: StoreState) => s.planExecution;\nexport const usePlanExecution = () => useStore(selectPlanExecution);\nexport const useIsPlanRunning = () =>\n  useStore((s) => s.planExecution.isOrchestrating);\nexport const usePlanProgress = () =>\n  useStore(\n    useShallow((s) => {\n      const plan = s.planExecution.plan;\n      if (!plan) return { completed: 0, total: 0, percentage: 0 };\n      const completed = plan.steps.filter(\n        (st) => st.status === \"complete\",\n      ).length;\n      const total = plan.steps.length;\n      return {\n        completed,\n        total,\n        percentage: total > 0 ? Math.round((completed / total) * 100) : 0,\n      };\n    }),\n  );\nexport const useActiveStep = () =>\n  useStore(\n    (s) =>\n      s.planExecution.plan?.steps.find((st) => st.status === \"running\") ?? null,\n  );\n\n// Deep Research selectors\nexport const useDeepResearchSettings = () =>\n  useStore((s) => s.deepResearchSettings);\nexport const useDeepResearchEnabled = () =>\n  useStore((s) => s.deepResearchSettings.enabled);\nexport const useDeepResearchEffortLevel = () =>\n  useStore((s) => s.deepResearchSettings.effortLevel);\nexport const useActiveResearch = () => useStore((s) => s.activeResearch);\nexport const useAuthenticatedSources = () =>\n  useStore((s) => s.authenticatedSources);\nexport const useResearchHistory = () => useStore((s) => s.researchHistory);\nexport const useIsResearchActive = () =>\n  useStore(\n    (s) =>\n      s.activeResearch !== null &&\n      s.activeResearch.status !== \"complete\" &&\n      s.activeResearch.status !== \"error\" &&\n      s.activeResearch.status !== \"stopped\",\n  );\nexport const useResearchProgress = () =>\n  useStore(\n    useShallow((s) => {\n      const research = s.activeResearch;\n      if (!research)\n        return { progress: 0, phase: \"\", sourcesFound: 0, sourcesTarget: 0 };\n      return {\n        progress: research.progress,\n        phase: research.currentPhase,\n        sourcesFound: research.sources.length,\n        sourcesTarget: research.sourcesTarget,\n      };\n    }),\n  );\n\n// UI Tree selectors\nexport const useUITree = () => useStore((s) => s.uiTree);\nexport const useTreeVersion = () => useStore((s) => s.treeVersion);\nexport const useIsTreeStreaming = () => useStore((s) => s.isTreeStreaming);\nexport const useUITreeActions = () =>\n  useStore(\n    useShallow((s) => ({\n      setUITree: s.setUITree,\n      updateUITree: s.updateUITree,\n      setElement: s.setElement,\n      removeElement: s.removeElement,\n      applyTreePatch: s.applyTreePatch,\n      setTreeStreaming: s.setTreeStreaming,\n      clearUITree: s.clearUITree,\n      bumpTreeVersion: s.bumpTreeVersion,\n    })),\n  );\n\n// Workspace selectors\nexport const useWorkspaceDocuments = () => useStore((s) => s.documents);\nexport const useActiveDocumentId = () => useStore((s) => s.activeDocumentId);\nexport const useWorkspaceLayout = () => useStore((s) => s.workspaceLayout);\nexport const useYoloMode = () => useStore((s) => s.yoloMode);\nexport const usePendingAIEdits = () => useStore((s) => s.pendingEdits);\nexport const useIsWorkspaceOpen = () => useStore((s) => s.isWorkspaceOpen);\nexport const useActiveDocument = () => useStore((s) => s.getActiveDocument());\nexport const useWorkspaceActions = () =>\n  useStore(\n    useShallow((s) => ({\n      createDocument: s.createDocument,\n      openDocument: s.openDocument,\n      closeDocument: s.closeDocument,\n      setActiveDocument: s.setActiveDocument,\n      updateDocumentContent: s.updateDocumentContent,\n      renameDocument: s.renameDocument,\n      markDocumentSaved: s.markDocumentSaved,\n      setWorkspaceLayout: s.setWorkspaceLayout,\n      toggleWorkspace: s.toggleWorkspace,\n      setYoloMode: s.setYoloMode,\n      addPendingEdit: s.addPendingEdit,\n      approvePendingEdit: s.approvePendingEdit,\n      rejectPendingEdit: s.rejectPendingEdit,\n      clearPendingEdits: s.clearPendingEdits,\n    })),\n  );\n\n// Canvas selectors\nexport const useCanvasInstances = () =>\n  useStore(useShallow((s) => Array.from(s.canvasInstances.values())));\nexport const useCanvasInstance = (canvasId: string) =>\n  useStore((s) => s.canvasInstances.get(canvasId));\nexport const useCanvasContent = (canvasId: string) =>\n  useStore((s) => s.canvasInstances.get(canvasId)?.content ?? null);\nexport const useCanvasVersion = (canvasId: string) =>\n  useStore((s) => s.canvasInstances.get(canvasId)?.version ?? 0);\nexport const useCanvasIsStreaming = (canvasId: string) =>\n  useStore((s) => s.canvasInstances.get(canvasId)?.isStreaming ?? false);\nexport const useCanvasActions = () =>\n  useStore(\n    useShallow((s) => ({\n      initCanvas: s.initCanvas,\n      removeCanvas: s.removeCanvas,\n      updateCanvasContent: s.updateCanvasContent,\n      setCanvasStreaming: s.setCanvasStreaming,\n      setCanvasDirty: s.setCanvasDirty,\n      queueCanvasUpdate: s.queueCanvasUpdate,\n      flushCanvasUpdates: s.flushCanvasUpdates,\n      clearCanvasPendingUpdates: s.clearCanvasPendingUpdates,\n    })),\n  );\n\n// =============================================================================\n// Re-export slice creators for direct use\n// =============================================================================\n\nexport {\n  createDomainSlice,\n  createUISlice,\n  createSelectionSlice,\n  createSettingsSlice,\n  createAnalyticsSlice,\n  createActionsSlice,\n  createValidationSlice,\n  createToolProgressSlice,\n  createPlanExecutionSlice,\n  createDeepResearchSlice,\n  createUITreeSlice,\n  createWorkspaceSlice,\n  createCanvasSlice,\n} from \"./slices\";\n\nexport type {\n  WorkspaceSlice,\n  WorkspaceDocument,\n  PendingAIEdit,\n  WorkspaceLayout,\n} from \"./slices/workspace\";\n\nexport type {\n  CanvasSlice,\n  CanvasInstance,\n  CanvasEditorState,\n  CanvasPendingUpdate,\n} from \"./slices/canvas\";\n","/**\n * Domain Slice - Data model, auth state, validation\n */\nimport type { DataModel, AuthState } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\nexport interface DomainSlice {\n  // Data model\n  dataModel: DataModel;\n  setDataModel: (data: DataModel) => void;\n  updateDataModel: (path: string, value: unknown) => void;\n  resetDataModel: () => void;\n\n  // Auth state\n  auth: AuthState;\n  setAuth: (auth: AuthState) => void;\n\n  // Data loading\n  isLoading: boolean;\n  setIsLoading: (loading: boolean) => void;\n}\n\nconst initialDataModel: DataModel = {};\nconst initialAuth: AuthState = {\n  isSignedIn: false,\n  user: undefined,\n};\n\nexport const createDomainSlice: SliceCreator<DomainSlice> = (set) => ({\n  // Data model\n  dataModel: initialDataModel,\n  setDataModel: (data) => set({ dataModel: data }),\n  updateDataModel: (path, value) =>\n    set((state) => {\n      // Support both JSON Pointer (\"/a/b\") and dot notation (\"a.b\")\n      const normalizedPath = path.startsWith(\"/\") ? path.slice(1) : path;\n      const parts = normalizedPath.includes(\"/\")\n        ? normalizedPath.split(\"/\")\n        : normalizedPath.split(\".\");\n\n      if (parts.length === 0 || (parts.length === 1 && parts[0] === \"\")) return;\n\n      const obj = state.dataModel as Record<string, unknown>;\n\n      // Single level path\n      if (parts.length === 1) {\n        obj[parts[0] as string] = value;\n        return;\n      }\n\n      // Multi-level path\n      let current = obj;\n      for (let i = 0; i < parts.length - 1; i++) {\n        const key = parts[i] as string;\n        if (!current[key] || typeof current[key] !== \"object\") {\n          current[key] = {};\n        }\n        current = current[key] as Record<string, unknown>;\n      }\n      const lastKey = parts[parts.length - 1] as string;\n      current[lastKey] = value;\n    }),\n  resetDataModel: () => set({ dataModel: initialDataModel }),\n\n  // Auth\n  auth: initialAuth,\n  setAuth: (auth) => set({ auth }),\n\n  // Loading\n  isLoading: false,\n  setIsLoading: (isLoading) => set({ isLoading }),\n});\n","/**\n * UI Slice - Loading states, progress, confirmations\n */\nimport type { SliceCreator } from \"../types\";\n\nexport interface ConfirmationDialog {\n  id: string;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  onConfirm: () => void;\n  onCancel?: () => void;\n}\n\nexport interface ToolProgress {\n  id: string;\n  name: string;\n  status: \"pending\" | \"running\" | \"complete\" | \"error\";\n  progress?: number;\n  message?: string;\n}\n\nexport interface UISlice {\n  // Confirmations\n  confirmations: ConfirmationDialog[];\n  showConfirmation: (dialog: Omit<ConfirmationDialog, \"id\">) => string;\n  hideConfirmation: (id: string) => void;\n\n  // Tool progress\n  toolProgress: Map<string, ToolProgress>;\n  setToolProgress: (progress: ToolProgress) => void;\n  clearToolProgress: (id: string) => void;\n  clearAllToolProgress: () => void;\n\n  // Global loading\n  globalLoading: boolean;\n  setGlobalLoading: (loading: boolean) => void;\n\n  // Sidebar/panels\n  sidebarOpen: boolean;\n  setSidebarOpen: (open: boolean) => void;\n  toggleSidebar: () => void;\n}\n\nlet confirmationIdCounter = 0;\n\nexport const createUISlice: SliceCreator<UISlice> = (set) => ({\n  // Confirmations\n  confirmations: [],\n  showConfirmation: (dialog) => {\n    const id = `ui_confirm_${++confirmationIdCounter}`;\n    set((state) => {\n      state.confirmations.push({ ...dialog, id });\n    });\n    return id;\n  },\n  hideConfirmation: (id) =>\n    set((state) => {\n      state.confirmations = state.confirmations.filter((c) => c.id !== id);\n    }),\n\n  // Tool progress\n  toolProgress: new Map(),\n  setToolProgress: (progress) =>\n    set((state) => {\n      state.toolProgress.set(progress.id, progress);\n    }),\n  clearToolProgress: (id) =>\n    set((state) => {\n      state.toolProgress.delete(id);\n    }),\n  clearAllToolProgress: () => set({ toolProgress: new Map() }),\n\n  // Global loading\n  globalLoading: false,\n  setGlobalLoading: (globalLoading) => set({ globalLoading }),\n\n  // Sidebar\n  sidebarOpen: true,\n  setSidebarOpen: (sidebarOpen) => set({ sidebarOpen }),\n  toggleSidebar: () =>\n    set((state) => {\n      state.sidebarOpen = !state.sidebarOpen;\n    }),\n});\n","/**\n * Selection Slice - Unified element selection state\n *\n * Supports:\n * - Single element selection (component focus)\n * - Multi-selection\n * - Deep selection (granular sub-element selection)\n * - Hover/focus tracking\n */\nimport type { UIElement } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Deep selection info - represents a selected sub-element (SERIALIZABLE)\n *\n * This is the canonical type for selection data stored in Zustand.\n * It contains ONLY serializable data - no DOM references.\n *\n * For DOM access, use DeepSelectionInfoWithElement from contexts/selection/types.ts\n * which extends this type with an optional `element` property.\n */\nexport interface DeepSelectionInfo {\n  /** Unique ID for this selection (store-generated) */\n  id: string;\n  /** The parent component's element key */\n  elementKey: string;\n  /** CSS path from component root to the selected element */\n  cssPath: string;\n  /** Tag name of the selected element */\n  tagName: string;\n  /** Text content (truncated) for AI context */\n  textContent: string;\n  /** The containing item's data (if selection is within a selectable-item) */\n  containingItem?: Record<string, unknown>;\n  /** The index of the item in the parent array */\n  itemIndex?: number;\n  /** The item's unique ID (from data-item-id attribute) */\n  itemId?: string;\n  /** Type of selection: 'item' for full item, 'granular' for specific text */\n  selectionType: \"item\" | \"granular\";\n  /** Timestamp of selection */\n  timestamp: number;\n}\n\n/**\n * Input type for creating a new selection.\n * id and timestamp are generated by the store.\n */\nexport type DeepSelectionInput = Omit<DeepSelectionInfo, \"id\" | \"timestamp\">;\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface SelectionSlice {\n  // ─────────────────────────────────────────────────────────────────────────\n  // Single selection (component level focus)\n  // ─────────────────────────────────────────────────────────────────────────\n  selectedKey: string | null;\n  selectedElement: UIElement | null;\n  select: (key: string | null, element: UIElement | null) => void;\n  clearSelection: () => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Multi-selection (component level)\n  // ─────────────────────────────────────────────────────────────────────────\n  multiSelectedKeys: Set<string>;\n  addToMultiSelection: (key: string) => void;\n  removeFromMultiSelection: (key: string) => void;\n  toggleMultiSelection: (key: string) => void;\n  clearMultiSelection: () => void;\n  isMultiSelected: (key: string) => boolean;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Deep selection (sub-element level)\n  // ─────────────────────────────────────────────────────────────────────────\n  deepSelections: DeepSelectionInfo[];\n  deepSelectionActive: boolean;\n\n  addDeepSelection: (selection: DeepSelectionInput) => string;\n  removeDeepSelection: (id: string) => void;\n  removeDeepSelectionByElement: (elementKey: string, cssPath: string) => void;\n  clearDeepSelections: () => void;\n  clearDeepSelectionsForElement: (elementKey: string) => void;\n\n  isDeepSelected: (elementKey: string, cssPath: string) => boolean;\n  getDeepSelectionsForElement: (elementKey: string) => DeepSelectionInfo[];\n\n  setDeepSelectionActive: (active: boolean) => void;\n\n  // Derived: flat selection map for component API\n  getGranularSelection: () => Record<string, Set<string>>;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Hover state\n  // ─────────────────────────────────────────────────────────────────────────\n  hoveredKey: string | null;\n  setHoveredKey: (key: string | null) => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Focus state\n  // ─────────────────────────────────────────────────────────────────────────\n  focusedKey: string | null;\n  setFocusedKey: (key: string | null) => void;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nlet selectionIdCounter = 0;\nconst generateSelectionId = () => `sel_${++selectionIdCounter}_${Date.now()}`;\n\nexport const createSelectionSlice: SliceCreator<SelectionSlice> = (\n  set,\n  get,\n) => ({\n  // ─────────────────────────────────────────────────────────────────────────\n  // Single selection\n  // ─────────────────────────────────────────────────────────────────────────\n  selectedKey: null,\n  selectedElement: null,\n  select: (key, element) => set({ selectedKey: key, selectedElement: element }),\n  clearSelection: () => set({ selectedKey: null, selectedElement: null }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Multi-selection\n  // ─────────────────────────────────────────────────────────────────────────\n  multiSelectedKeys: new Set(),\n  addToMultiSelection: (key) =>\n    set((state) => {\n      state.multiSelectedKeys.add(key);\n    }),\n  removeFromMultiSelection: (key) =>\n    set((state) => {\n      state.multiSelectedKeys.delete(key);\n    }),\n  toggleMultiSelection: (key) => {\n    const { multiSelectedKeys } = get();\n    if (multiSelectedKeys.has(key)) {\n      get().removeFromMultiSelection(key);\n    } else {\n      get().addToMultiSelection(key);\n    }\n  },\n  clearMultiSelection: () => set({ multiSelectedKeys: new Set() }),\n  isMultiSelected: (key) => get().multiSelectedKeys.has(key),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Deep selection\n  // ─────────────────────────────────────────────────────────────────────────\n  deepSelections: [],\n  deepSelectionActive: false,\n\n  addDeepSelection: (selection) => {\n    const id = generateSelectionId();\n    set((state) => {\n      state.deepSelections.push({ ...selection, id, timestamp: Date.now() });\n    });\n    return id;\n  },\n\n  removeDeepSelection: (id) =>\n    set((state) => {\n      state.deepSelections = state.deepSelections.filter((s) => s.id !== id);\n    }),\n\n  removeDeepSelectionByElement: (elementKey, cssPath) =>\n    set((state) => {\n      state.deepSelections = state.deepSelections.filter(\n        (s) => !(s.elementKey === elementKey && s.cssPath === cssPath),\n      );\n    }),\n\n  clearDeepSelections: () => set({ deepSelections: [] }),\n\n  clearDeepSelectionsForElement: (elementKey) =>\n    set((state) => {\n      state.deepSelections = state.deepSelections.filter(\n        (s) => s.elementKey !== elementKey,\n      );\n    }),\n\n  isDeepSelected: (elementKey, cssPath) => {\n    return get().deepSelections.some(\n      (s) => s.elementKey === elementKey && s.cssPath === cssPath,\n    );\n  },\n\n  getDeepSelectionsForElement: (elementKey) => {\n    return get().deepSelections.filter((s) => s.elementKey === elementKey);\n  },\n\n  setDeepSelectionActive: (active) => {\n    set({ deepSelectionActive: active });\n    // Auto-reset after 100ms (prevents component-level selection during deep selection)\n    if (active) {\n      setTimeout(() => {\n        set({ deepSelectionActive: false });\n      }, 100);\n    }\n  },\n\n  // Derived state: flat selection map for component API\n  getGranularSelection: () => {\n    const result: Record<string, Set<string>> = {};\n    for (const sel of get().deepSelections) {\n      if (sel.itemId) {\n        if (!result[sel.elementKey]) {\n          result[sel.elementKey] = new Set();\n        }\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        result[sel.elementKey]!.add(sel.itemId);\n      }\n    }\n    return result;\n  },\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Hover\n  // ─────────────────────────────────────────────────────────────────────────\n  hoveredKey: null,\n  setHoveredKey: (hoveredKey) => set({ hoveredKey }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Focus\n  // ─────────────────────────────────────────────────────────────────────────\n  focusedKey: null,\n  setFocusedKey: (focusedKey) => set({ focusedKey }),\n});\n","/**\n * Settings Slice - AI settings, theme, preferences\n * \n * NOTE: Model selection is centralized in @onegenui/providers.\n * Use `createModelForTask()` or `getModelConfig()` from the providers package.\n */\nimport type { SliceCreator } from \"../types\";\n\nexport type ThemeMode = \"light\" | \"dark\" | \"system\";\n\n/** @deprecated Use @onegenui/providers for model management */\nexport type AIModel =\n  | \"gemini-3-flash-preview\"\n  | \"gemini-3-pro-preview\"\n  | \"gpt-5.2\"\n  | \"claude-haiku-4.5\"\n  | \"claude-sonnet-4.5\"\n  | \"claude-opus-4.5\";\n\nexport interface AISettings {\n  model: AIModel;\n  temperature: number;\n  maxTokens: number;\n  streamingEnabled: boolean;\n  autoSuggestions: boolean;\n}\n\nexport interface SettingsSlice {\n  // Theme\n  theme: ThemeMode;\n  setTheme: (theme: ThemeMode) => void;\n\n  // AI settings\n  aiSettings: AISettings;\n  setAISettings: (settings: Partial<AISettings>) => void;\n  resetAISettings: () => void;\n\n  // Preferences\n  compactMode: boolean;\n  setCompactMode: (compact: boolean) => void;\n  animationsEnabled: boolean;\n  setAnimationsEnabled: (enabled: boolean) => void;\n}\n\nconst defaultAISettings: AISettings = {\n  model: \"gemini-3-flash-preview\",\n  temperature: 1,\n  maxTokens: 65000,\n  streamingEnabled: true,\n  autoSuggestions: true,\n};\n\nexport const createSettingsSlice: SliceCreator<SettingsSlice> = (set) => ({\n  // Theme\n  theme: \"system\",\n  setTheme: (theme) => set({ theme }),\n\n  // AI settings\n  aiSettings: defaultAISettings,\n  setAISettings: (settings) =>\n    set((state) => {\n      Object.assign(state.aiSettings, settings);\n    }),\n  resetAISettings: () => set({ aiSettings: defaultAISettings }),\n\n  // Preferences\n  compactMode: false,\n  setCompactMode: (compactMode) => set({ compactMode }),\n  animationsEnabled: true,\n  setAnimationsEnabled: (animationsEnabled) => set({ animationsEnabled }),\n});\n","/**\n * Analytics Slice - Action tracking, metrics\n */\nimport type { SliceCreator } from \"../types\";\n\nexport interface TrackedAction {\n  id: string;\n  type: string;\n  elementKey?: string;\n  elementType?: string;\n  timestamp: number;\n  data?: unknown;\n}\n\nexport interface AnalyticsSlice {\n  // Action history\n  actions: TrackedAction[];\n  trackAction: (action: Omit<TrackedAction, \"id\" | \"timestamp\">) => void;\n  clearActions: () => void;\n\n  // Metrics\n  metrics: {\n    totalActions: number;\n    sessionStart: number;\n    lastActionTime: number;\n  };\n\n  // Get recent actions (for AI context)\n  getRecentActions: (count?: number) => TrackedAction[];\n  getActionsByType: (type: string) => TrackedAction[];\n  getActionsByElement: (elementKey: string) => TrackedAction[];\n}\n\nconst MAX_ACTIONS = 100;\nlet analyticsIdCounter = 0;\n\nexport const createAnalyticsSlice: SliceCreator<AnalyticsSlice> = (\n  set,\n  get,\n) => ({\n  // Actions\n  actions: [],\n  trackAction: (action) => {\n    const tracked: TrackedAction = {\n      ...action,\n      id: `analytics_${++analyticsIdCounter}`,\n      timestamp: Date.now(),\n    };\n\n    set((state) => {\n      state.actions.unshift(tracked);\n      if (state.actions.length > MAX_ACTIONS) {\n        state.actions = state.actions.slice(0, MAX_ACTIONS);\n      }\n      state.metrics.totalActions++;\n      state.metrics.lastActionTime = tracked.timestamp;\n    });\n  },\n  clearActions: () =>\n    set((state) => {\n      state.actions = [];\n      state.metrics.totalActions = 0;\n    }),\n\n  // Metrics\n  metrics: {\n    totalActions: 0,\n    sessionStart: Date.now(),\n    lastActionTime: 0,\n  },\n\n  // Getters\n  getRecentActions: (count = 10) => get().actions.slice(0, count),\n  getActionsByType: (type) => get().actions.filter((a) => a.type === type),\n  getActionsByElement: (elementKey) =>\n    get().actions.filter((a) => a.elementKey === elementKey),\n});\n","/**\n * Actions Slice - Action execution state management\n *\n * Manages:\n * - Loading states per action\n * - Pending confirmations\n * - Action history\n */\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Pending confirmation dialog\n */\nexport interface PendingConfirmation {\n  id: string;\n  actionName: string;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  payload?: unknown;\n  timestamp: number;\n}\n\n/**\n * Action execution record\n */\nexport interface ActionExecution {\n  id: string;\n  actionName: string;\n  status: \"pending\" | \"running\" | \"success\" | \"error\";\n  startTime: number;\n  endTime?: number;\n  error?: string;\n  payload?: unknown;\n  result?: unknown;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ActionsSlice {\n  // ─────────────────────────────────────────────────────────────────────────\n  // Loading states\n  // ─────────────────────────────────────────────────────────────────────────\n  loadingActions: Set<string>;\n  isActionLoading: (actionName: string) => boolean;\n  setActionLoading: (actionName: string, loading: boolean) => void;\n  clearActionLoading: (actionName: string) => void;\n  clearAllLoading: () => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Pending Action Confirmations (different from UISlice confirmations)\n  // ─────────────────────────────────────────────────────────────────────────\n  pendingConfirmations: PendingConfirmation[];\n  addPendingConfirmation: (\n    confirmation: Omit<PendingConfirmation, \"id\" | \"timestamp\">,\n  ) => string;\n  removePendingConfirmation: (id: string) => void;\n  getPendingConfirmation: (id: string) => PendingConfirmation | undefined;\n  clearPendingConfirmations: () => void;\n\n  // Convenience aliases\n  addConfirmation: (\n    confirmation: Omit<PendingConfirmation, \"id\" | \"timestamp\">,\n  ) => string;\n  removeConfirmation: (id: string) => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Action history\n  // ─────────────────────────────────────────────────────────────────────────\n  actionHistory: ActionExecution[];\n  maxHistorySize: number;\n\n  startAction: (actionName: string, payload?: unknown) => string;\n  completeAction: (id: string, result?: unknown) => void;\n  failAction: (id: string, error: string) => void;\n  getActionStatus: (id: string) => ActionExecution | undefined;\n  getRecentActionExecutions: (count?: number) => ActionExecution[];\n  addToHistory: (info: { actionName: string; payload?: unknown }) => void;\n  clearHistory: () => void;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nlet actionIdCounter = 0;\nconst generateActionId = () => `action_${++actionIdCounter}_${Date.now()}`;\n\nlet confirmationIdCounter = 0;\nconst generateConfirmationId = () =>\n  `confirm_${++confirmationIdCounter}_${Date.now()}`;\n\nexport const createActionsSlice: SliceCreator<ActionsSlice> = (set, get) => ({\n  // ─────────────────────────────────────────────────────────────────────────\n  // Loading states\n  // ─────────────────────────────────────────────────────────────────────────\n  loadingActions: new Set(),\n\n  isActionLoading: (actionName) => get().loadingActions.has(actionName),\n\n  setActionLoading: (actionName, loading) =>\n    set((state) => {\n      if (loading) {\n        state.loadingActions.add(actionName);\n      } else {\n        state.loadingActions.delete(actionName);\n      }\n    }),\n\n  clearActionLoading: (actionName) =>\n    set((state) => {\n      state.loadingActions.delete(actionName);\n    }),\n\n  clearAllLoading: () => set({ loadingActions: new Set() }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Pending Action Confirmations\n  // ─────────────────────────────────────────────────────────────────────────\n  pendingConfirmations: [],\n\n  addPendingConfirmation: (confirmation) => {\n    const id = generateConfirmationId();\n    set((state) => {\n      state.pendingConfirmations.push({\n        ...confirmation,\n        id,\n        timestamp: Date.now(),\n      });\n    });\n    return id;\n  },\n\n  removePendingConfirmation: (id) =>\n    set((state) => {\n      state.pendingConfirmations = state.pendingConfirmations.filter(\n        (c) => c.id !== id,\n      );\n    }),\n\n  getPendingConfirmation: (id) => {\n    return get().pendingConfirmations.find((c) => c.id === id);\n  },\n\n  clearPendingConfirmations: () => set({ pendingConfirmations: [] }),\n\n  // Convenience aliases\n  addConfirmation: (confirmation) => {\n    const id = generateConfirmationId();\n    set((state) => {\n      state.pendingConfirmations.push({\n        ...confirmation,\n        id,\n        timestamp: Date.now(),\n      });\n    });\n    return id;\n  },\n\n  removeConfirmation: (id) =>\n    set((state) => {\n      state.pendingConfirmations = state.pendingConfirmations.filter(\n        (c) => c.id !== id,\n      );\n    }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Action history\n  // ─────────────────────────────────────────────────────────────────────────\n  actionHistory: [],\n  maxHistorySize: 100,\n\n  startAction: (actionName, payload) => {\n    const id = generateActionId();\n\n    set((state) => {\n      state.loadingActions.add(actionName);\n      state.actionHistory.push({\n        id,\n        actionName,\n        status: \"running\",\n        startTime: Date.now(),\n        payload,\n      });\n      if (state.actionHistory.length > state.maxHistorySize) {\n        state.actionHistory = state.actionHistory.slice(-state.maxHistorySize);\n      }\n    });\n\n    return id;\n  },\n\n  completeAction: (id, result) =>\n    set((state) => {\n      const execution = state.actionHistory.find((a) => a.id === id);\n      if (execution) {\n        state.loadingActions.delete(execution.actionName);\n        execution.status = \"success\";\n        execution.endTime = Date.now();\n        execution.result = result;\n      }\n    }),\n\n  failAction: (id, error) =>\n    set((state) => {\n      const execution = state.actionHistory.find((a) => a.id === id);\n      if (execution) {\n        state.loadingActions.delete(execution.actionName);\n        execution.status = \"error\";\n        execution.endTime = Date.now();\n        execution.error = error;\n      }\n    }),\n\n  getActionStatus: (id) => {\n    return get().actionHistory.find((a) => a.id === id);\n  },\n\n  getRecentActionExecutions: (count = 10) => {\n    return get().actionHistory.slice(-count);\n  },\n\n  addToHistory: (info) => {\n    const id = generateActionId();\n\n    set((state) => {\n      state.actionHistory.push({\n        id,\n        actionName: info.actionName,\n        status: \"success\",\n        startTime: Date.now(),\n        endTime: Date.now(),\n        payload: info.payload,\n      });\n      if (state.actionHistory.length > state.maxHistorySize) {\n        state.actionHistory = state.actionHistory.slice(-state.maxHistorySize);\n      }\n    });\n  },\n\n  clearHistory: () => set({ actionHistory: [] }),\n});\n","/**\n * Validation Slice - Field validation state management\n *\n * Manages:\n * - Field touched states\n * - Validation results per field\n * - Form-level validation state\n */\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Validation result for a single field\n */\nexport interface FieldValidationResult {\n  isValid: boolean;\n  errors: string[];\n  warnings?: string[];\n}\n\n/**\n * State for a single field\n */\nexport interface FieldState {\n  path: string;\n  touched: boolean;\n  validated: boolean;\n  validationResult: FieldValidationResult | null;\n  lastValidatedAt?: number;\n}\n\n/**\n * Form-level validation state\n */\nexport interface FormValidationState {\n  isValid: boolean;\n  isDirty: boolean;\n  isValidating: boolean;\n  touchedCount: number;\n  errorCount: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ValidationSlice {\n  // Field states (keyed by path)\n  fieldStates: Record<string, FieldState>;\n\n  // Field operations\n  touchField: (path: string) => void;\n  untouchField: (path: string) => void;\n  setFieldValidation: (path: string, result: FieldValidationResult) => void;\n  clearFieldValidation: (path: string) => void;\n\n  // Getters\n  getFieldState: (path: string) => FieldState | undefined;\n  isFieldTouched: (path: string) => boolean;\n  isFieldValid: (path: string) => boolean;\n  getFieldErrors: (path: string) => string[];\n\n  // Form-level operations\n  isValidating: boolean;\n  setIsValidating: (validating: boolean) => void;\n\n  // Form state\n  getFormState: () => FormValidationState;\n  touchAllFields: (paths: string[]) => void;\n  clearAllValidation: () => void;\n\n  // Bulk operations\n  setMultipleFieldValidations: (\n    results: Array<{ path: string; result: FieldValidationResult }>,\n  ) => void;\n\n  getFieldsWithErrors: () => string[];\n  getTouchedFields: () => string[];\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createValidationSlice: SliceCreator<ValidationSlice> = (\n  set,\n  get,\n) => ({\n  fieldStates: {},\n\n  touchField: (path) =>\n    set((state) => {\n      const existing = state.fieldStates[path];\n      state.fieldStates[path] = {\n        path,\n        touched: true,\n        validated: existing?.validated ?? false,\n        validationResult: existing?.validationResult ?? null,\n        lastValidatedAt: existing?.lastValidatedAt,\n      };\n    }),\n\n  untouchField: (path) =>\n    set((state) => {\n      if (state.fieldStates[path]) {\n        state.fieldStates[path].touched = false;\n      }\n    }),\n\n  setFieldValidation: (path, result) =>\n    set((state) => {\n      const existing = state.fieldStates[path];\n      state.fieldStates[path] = {\n        path,\n        touched: existing?.touched ?? false,\n        validated: true,\n        validationResult: result,\n        lastValidatedAt: Date.now(),\n      };\n    }),\n\n  clearFieldValidation: (path) =>\n    set((state) => {\n      if (state.fieldStates[path]) {\n        state.fieldStates[path].validated = false;\n        state.fieldStates[path].validationResult = null;\n        state.fieldStates[path].lastValidatedAt = undefined;\n      }\n    }),\n\n  getFieldState: (path) => {\n    return get().fieldStates[path];\n  },\n\n  isFieldTouched: (path) => {\n    return get().fieldStates[path]?.touched ?? false;\n  },\n\n  isFieldValid: (path) => {\n    const state = get().fieldStates[path];\n    return state?.validationResult?.isValid ?? true;\n  },\n\n  getFieldErrors: (path) => {\n    return get().fieldStates[path]?.validationResult?.errors ?? [];\n  },\n\n  isValidating: false,\n\n  setIsValidating: (validating) => set({ isValidating: validating }),\n\n  getFormState: () => {\n    const { fieldStates, isValidating } = get();\n    let touchedCount = 0;\n    let errorCount = 0;\n    let isValid = true;\n    let isDirty = false;\n\n    for (const state of Object.values(fieldStates)) {\n      if (state.touched) {\n        touchedCount++;\n        isDirty = true;\n      }\n      if (state.validationResult && !state.validationResult.isValid) {\n        isValid = false;\n        errorCount += state.validationResult.errors.length;\n      }\n    }\n\n    return { isValid, isDirty, isValidating, touchedCount, errorCount };\n  },\n\n  touchAllFields: (paths) =>\n    set((state) => {\n      for (const path of paths) {\n        const existing = state.fieldStates[path];\n        state.fieldStates[path] = {\n          path,\n          touched: true,\n          validated: existing?.validated ?? false,\n          validationResult: existing?.validationResult ?? null,\n          lastValidatedAt: existing?.lastValidatedAt,\n        };\n      }\n    }),\n\n  clearAllValidation: () => {\n    set({ fieldStates: {}, isValidating: false });\n  },\n\n  setMultipleFieldValidations: (results) =>\n    set((state) => {\n      for (const { path, result } of results) {\n        const existing = state.fieldStates[path];\n        state.fieldStates[path] = {\n          path,\n          touched: existing?.touched ?? false,\n          validated: true,\n          validationResult: result,\n          lastValidatedAt: Date.now(),\n        };\n      }\n    }),\n\n  getFieldsWithErrors: () => {\n    const result: string[] = [];\n    for (const [path, state] of Object.entries(get().fieldStates)) {\n      if (state.validationResult && !state.validationResult.isValid) {\n        result.push(path);\n      }\n    }\n    return result;\n  },\n\n  getTouchedFields: () => {\n    const result: string[] = [];\n    for (const [path, state] of Object.entries(get().fieldStates)) {\n      if (state.touched) {\n        result.push(path);\n      }\n    }\n    return result;\n  },\n});\n","/**\n * Tool Progress Slice - Tool execution progress tracking\n *\n * Manages:\n * - Active tool progress\n * - Tool execution history\n * - Auto-cleanup of completed tools\n */\nimport type { ToolProgressStatus, ToolProgressEvent } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\n// Re-export types from core for convenience\nexport type { ToolProgressStatus, ToolProgressEvent } from \"@onegenui/core\";\n\n/**\n * Slice-specific progress event (with required timestamp and message history)\n */\nexport interface StoredProgressEvent extends ToolProgressEvent {\n  timestamp: number;\n  /** History of unique messages for this tool execution */\n  messageHistory?: Array<{ message: string; timestamp: number }>;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ToolProgressSlice {\n  // ─────────────────────────────────────────────────────────────────────────\n  // Progress events (stored with required timestamp)\n  // ─────────────────────────────────────────────────────────────────────────\n  progressEvents: StoredProgressEvent[];\n  maxEvents: number;\n\n  // Add/update progress (timestamp added automatically)\n  addProgress: (event: Omit<ToolProgressEvent, \"timestamp\" | \"type\">) => void;\n  addProgressEvent: (\n    event: Omit<ToolProgressEvent, \"timestamp\" | \"type\">,\n  ) => void;\n  updateProgress: (\n    toolCallId: string,\n    updates: Partial<\n      Omit<ToolProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) => void;\n  updateProgressEvent: (\n    toolCallId: string,\n    updates: Partial<\n      Omit<ToolProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) => void;\n\n  // Clear operations\n  clearProgress: () => void;\n  clearProgressEvents: () => void;\n  clearCompletedOlderThan: (ms: number) => void;\n  clearCompletedProgressOlderThan: (ms: number) => void;\n  removeProgress: (toolCallId: string) => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Getters\n  // ─────────────────────────────────────────────────────────────────────────\n  getProgress: (toolCallId: string) => StoredProgressEvent | undefined;\n  getActiveProgress: () => StoredProgressEvent[];\n  getAllProgress: () => StoredProgressEvent[];\n  isToolRunning: () => boolean;\n  isSpecificToolRunning: (toolName: string) => boolean;\n  getProgressByToolName: (toolName: string) => StoredProgressEvent[];\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createToolProgressSlice: SliceCreator<ToolProgressSlice> = (\n  set,\n  get,\n) => {\n  // Shared implementation for add\n  const addProgressImpl = (\n    event: Omit<ToolProgressEvent, \"timestamp\" | \"type\">,\n  ) =>\n    set((state) => {\n      const timestamp = Date.now();\n      const existingIndex = state.progressEvents.findIndex(\n        (p) => p.toolCallId === event.toolCallId,\n      );\n\n      if (existingIndex >= 0) {\n        // Update existing: preserve message history\n        const existing = state.progressEvents[existingIndex];\n        const messageHistory = existing?.messageHistory ?? [];\n        \n        // Add new message to history if unique\n        if (event.message && !messageHistory.some(h => h.message === event.message)) {\n          messageHistory.push({ message: event.message, timestamp });\n        }\n\n        const storedEvent: StoredProgressEvent = {\n          type: \"tool-progress\",\n          ...event,\n          timestamp,\n          messageHistory,\n        };\n        state.progressEvents[existingIndex] = storedEvent;\n      } else {\n        // New event: initialize message history\n        const messageHistory = event.message \n          ? [{ message: event.message, timestamp }]\n          : [];\n        \n        const storedEvent: StoredProgressEvent = {\n          type: \"tool-progress\",\n          ...event,\n          timestamp,\n          messageHistory,\n        };\n        state.progressEvents.push(storedEvent);\n        if (state.progressEvents.length > state.maxEvents) {\n          state.progressEvents = state.progressEvents.slice(-state.maxEvents);\n        }\n      }\n    });\n\n  // Shared implementation for update\n  const updateProgressImpl = (\n    toolCallId: string,\n    updates: Partial<\n      Omit<ToolProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) =>\n    set((state) => {\n      const idx = state.progressEvents.findIndex(\n        (p) => p.toolCallId === toolCallId,\n      );\n      if (idx >= 0) {\n        const existing = state.progressEvents[idx];\n        if (existing) {\n          Object.assign(existing, updates, { timestamp: Date.now() });\n        }\n      }\n    });\n\n  // Shared implementation for clear\n  const clearProgressImpl = () => set({ progressEvents: [] });\n\n  // Shared implementation for clear old\n  const clearCompletedOlderThanImpl = (ms: number) => {\n    const cutoff = Date.now() - ms;\n    set((state) => {\n      state.progressEvents = state.progressEvents.filter(\n        (p) =>\n          (p.status !== \"complete\" && p.status !== \"error\") ||\n          p.timestamp > cutoff,\n      );\n    });\n  };\n\n  return {\n    progressEvents: [],\n    maxEvents: 50,\n\n    addProgress: addProgressImpl,\n    addProgressEvent: addProgressImpl,\n\n    updateProgress: updateProgressImpl,\n    updateProgressEvent: updateProgressImpl,\n\n    clearProgress: clearProgressImpl,\n    clearProgressEvents: clearProgressImpl,\n\n    clearCompletedOlderThan: clearCompletedOlderThanImpl,\n    clearCompletedProgressOlderThan: clearCompletedOlderThanImpl,\n\n    removeProgress: (toolCallId) =>\n      set((state) => {\n        state.progressEvents = state.progressEvents.filter(\n          (p) => p.toolCallId !== toolCallId,\n        );\n      }),\n\n    getProgress: (toolCallId) => {\n      return get().progressEvents.find((p) => p.toolCallId === toolCallId);\n    },\n\n    getActiveProgress: () => {\n      return get().progressEvents.filter(\n        (p) => p.status === \"starting\" || p.status === \"progress\",\n      );\n    },\n\n    getAllProgress: () => {\n      return get().progressEvents;\n    },\n\n    isToolRunning: () => {\n      return get().progressEvents.some(\n        (p) => p.status === \"starting\" || p.status === \"progress\",\n      );\n    },\n\n    isSpecificToolRunning: (toolName) => {\n      return get().progressEvents.some(\n        (p) =>\n          p.toolName === toolName &&\n          (p.status === \"starting\" || p.status === \"progress\"),\n      );\n    },\n\n    getProgressByToolName: (toolName) => {\n      return get().progressEvents.filter((p) => p.toolName === toolName);\n    },\n  };\n};\n","/**\n * Plan Execution Slice - Unified plan and progress tracking\n *\n * Integrates planning with tool progress for native \"generating\" state.\n * Replaces separate usePlanState hook with Zustand-based centralized state.\n */\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type PlanStepStatus = \"pending\" | \"running\" | \"complete\" | \"error\";\n\nexport interface PlanSubtask {\n  id: number;\n  task: string;\n  agent: string;\n  status: PlanStepStatus;\n  startTime?: number;\n  endTime?: number;\n}\n\nexport interface PlanStep {\n  id: number;\n  task: string;\n  agent: string;\n  status: PlanStepStatus;\n  dependencies: number[];\n  parallel?: boolean;\n  subtasks?: PlanSubtask[];\n  startTime?: number;\n  endTime?: number;\n  result?: unknown;\n}\n\nexport interface ExecutionPlan {\n  goal: string;\n  steps: PlanStep[];\n}\n\nexport interface PlanExecutionState {\n  /** Current execution plan */\n  plan: ExecutionPlan | null;\n  /** Whether orchestration is active */\n  isOrchestrating: boolean;\n  /** Current parallel execution level */\n  parallelLevel: number | null;\n  /** Timestamp when orchestration started */\n  orchestrationStartTime: number | null;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface PlanExecutionSlice {\n  // State\n  planExecution: PlanExecutionState;\n\n  // Actions\n  setPlanCreated: (\n    goal: string,\n    steps: Array<{\n      id: number;\n      task: string;\n      agent: string;\n      dependencies?: number[];\n      parallel?: boolean;\n      subtasks?: Array<{ id: number; task: string; agent: string }>;\n    }>,\n  ) => void;\n  setStepStarted: (stepId: number) => void;\n  setStepDone: (stepId: number, result?: unknown) => void;\n  setStepError: (stepId: number, error: string) => void;\n  setSubtaskStarted: (parentId: number, subtaskId: number) => void;\n  setSubtaskDone: (\n    parentId: number,\n    subtaskId: number,\n    result?: unknown,\n  ) => void;\n  setLevelStarted: (level: number) => void;\n  setOrchestrationDone: () => void;\n  resetPlanExecution: () => void;\n\n  // Getters\n  getActiveStep: () => PlanStep | null;\n  getActiveSubtask: () => PlanSubtask | null;\n  getCompletedStepIds: () => number[];\n  getPlanProgress: () => {\n    completed: number;\n    total: number;\n    percentage: number;\n  };\n  isPlanRunning: () => boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Initial State\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst initialPlanState: PlanExecutionState = {\n  plan: null,\n  isOrchestrating: false,\n  parallelLevel: null,\n  orchestrationStartTime: null,\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createPlanExecutionSlice: SliceCreator<PlanExecutionSlice> = (\n  set,\n  get,\n) => ({\n  planExecution: initialPlanState,\n\n  setPlanCreated: (goal, steps) => {\n    set((state) => {\n      state.planExecution = {\n        plan: {\n          goal,\n          steps: steps.map((s) => ({\n            id: s.id,\n            task: s.task,\n            agent: s.agent,\n            dependencies: s.dependencies ?? [],\n            parallel: s.parallel,\n            status: \"pending\" as PlanStepStatus,\n            subtasks: s.subtasks?.map((st) => ({\n              id: st.id,\n              task: st.task,\n              agent: st.agent,\n              status: \"pending\" as PlanStepStatus,\n            })),\n          })),\n        },\n        isOrchestrating: true,\n        parallelLevel: null,\n        orchestrationStartTime: Date.now(),\n      };\n    });\n  },\n\n  setStepStarted: (stepId) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find((s) => s.id === stepId);\n      if (step) {\n        step.status = \"running\";\n        step.startTime = Date.now();\n      }\n    });\n  },\n\n  setStepDone: (stepId, result) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find((s) => s.id === stepId);\n      if (step) {\n        step.status = \"complete\";\n        step.endTime = Date.now();\n        step.result = result;\n      }\n    });\n  },\n\n  setStepError: (stepId, error) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find((s) => s.id === stepId);\n      if (step) {\n        step.status = \"error\";\n        step.endTime = Date.now();\n        step.result = { error };\n      }\n    });\n  },\n\n  setSubtaskStarted: (parentId, subtaskId) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find(\n        (s) => s.id === parentId,\n      );\n      const subtask = step?.subtasks?.find((st) => st.id === subtaskId);\n      if (subtask) {\n        subtask.status = \"running\";\n        subtask.startTime = Date.now();\n      }\n    });\n  },\n\n  setSubtaskDone: (parentId, subtaskId, result) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find(\n        (s) => s.id === parentId,\n      );\n      const subtask = step?.subtasks?.find((st) => st.id === subtaskId);\n      if (subtask) {\n        subtask.status = \"complete\";\n        subtask.endTime = Date.now();\n      }\n    });\n  },\n\n  setLevelStarted: (level) => {\n    set((state) => {\n      state.planExecution.parallelLevel = level;\n    });\n  },\n\n  setOrchestrationDone: () => {\n    set((state) => {\n      state.planExecution.isOrchestrating = false;\n      state.planExecution.parallelLevel = null;\n    });\n  },\n\n  resetPlanExecution: () => {\n    set((state) => {\n      state.planExecution = initialPlanState;\n    });\n  },\n\n  // Getters\n  getActiveStep: () => {\n    const plan = get().planExecution.plan;\n    return plan?.steps.find((s) => s.status === \"running\") ?? null;\n  },\n\n  getActiveSubtask: () => {\n    const plan = get().planExecution.plan;\n    for (const step of plan?.steps ?? []) {\n      const activeSubtask = step.subtasks?.find(\n        (st) => st.status === \"running\",\n      );\n      if (activeSubtask) return activeSubtask;\n    }\n    return null;\n  },\n\n  getCompletedStepIds: () => {\n    const plan = get().planExecution.plan;\n    return (\n      plan?.steps.filter((s) => s.status === \"complete\").map((s) => s.id) ?? []\n    );\n  },\n\n  getPlanProgress: () => {\n    const plan = get().planExecution.plan;\n    if (!plan) return { completed: 0, total: 0, percentage: 0 };\n    const completed = plan.steps.filter((s) => s.status === \"complete\").length;\n    const total = plan.steps.length;\n    return {\n      completed,\n      total,\n      percentage: total > 0 ? Math.round((completed / total) * 100) : 0,\n    };\n  },\n\n  isPlanRunning: () => {\n    return get().planExecution.isOrchestrating;\n  },\n});\n","/**\n * Deep Research Slice - State management for deep research feature\n *\n * Manages research settings, active sessions, and results\n * Uses centralized configuration from @onegenui/deep-research\n */\nimport type { SliceCreator } from \"../types\";\n\n// =============================================================================\n// Types (aligned with @onegenui/deep-research/config)\n// =============================================================================\n\nexport type DeepResearchEffortLevel = \"standard\" | \"deep\" | \"max\";\n\nexport interface DeepResearchSettings {\n  enabled: boolean;\n  effortLevel: DeepResearchEffortLevel;\n  maxSteps: number;\n  parallelRequests: number;\n  autoStopOnQuality: boolean;\n  includeVisualizations: boolean;\n  qualityThreshold: number;\n}\n\nexport interface AuthenticatedSource {\n  platform: string;\n  displayName: string;\n  isConnected: boolean;\n  lastValidated?: Date;\n}\n\nexport interface ResearchPhase {\n  id: string;\n  label: string;\n  status: \"pending\" | \"running\" | \"complete\" | \"error\";\n  progress: number;\n  details?: string;\n  startTime?: number;\n  endTime?: number;\n}\n\nexport interface ResearchSource {\n  id: string;\n  url: string;\n  title: string;\n  domain: string;\n  credibility: number;\n  status: \"fetching\" | \"analyzing\" | \"complete\" | \"error\";\n}\n\nexport interface ActiveResearch {\n  id: string;\n  query: string;\n  effortLevel: DeepResearchEffortLevel;\n  status:\n    | \"initializing\"\n    | \"searching\"\n    | \"analyzing\"\n    | \"synthesizing\"\n    | \"complete\"\n    | \"error\"\n    | \"stopped\";\n  startTime: number;\n  estimatedTimeMs: number;\n  progress: number;\n  currentPhase: string;\n  phases: ResearchPhase[];\n  sources: ResearchSource[];\n  sourcesTarget: number;\n  error?: string;\n}\n\nexport interface ResearchResultSummary {\n  id: string;\n  query: string;\n  completedAt: number;\n  sourcesUsed: number;\n  qualityScore: number;\n  hasVisualizations: boolean;\n}\n\n// =============================================================================\n// Configuration (aligned with @onegenui/deep-research EFFORT_PRESETS)\n// =============================================================================\n\ninterface EffortPreset {\n  maxSteps: number;\n  parallelRequests: number;\n  qualityThreshold: number;\n  estimatedTimeMs: number;\n  sourcesTarget: number;\n}\n\nconst EFFORT_PRESETS: Record<DeepResearchEffortLevel, EffortPreset> = {\n  standard: {\n    maxSteps: 50,\n    parallelRequests: 10,\n    qualityThreshold: 0.75,\n    estimatedTimeMs: 3 * 60 * 1000,\n    sourcesTarget: 25,\n  },\n  deep: {\n    maxSteps: 100,\n    parallelRequests: 15,\n    qualityThreshold: 0.8,\n    estimatedTimeMs: 10 * 60 * 1000,\n    sourcesTarget: 50,\n  },\n  max: {\n    maxSteps: 200,\n    parallelRequests: 20,\n    qualityThreshold: 0.9,\n    estimatedTimeMs: 30 * 60 * 1000,\n    sourcesTarget: 100,\n  },\n};\n\nconst RESEARCH_PHASES: Array<{ id: string; label: string }> = [\n  { id: \"query-decomposition\", label: \"Query Decomposition\" },\n  { id: \"source-discovery\", label: \"Source Discovery\" },\n  { id: \"content-extraction\", label: \"Content Extraction\" },\n  { id: \"analysis\", label: \"Analysis\" },\n  { id: \"synthesis\", label: \"Synthesis\" },\n  { id: \"visualization\", label: \"Visualization\" },\n];\n\nconst createDefaultSettings = (): DeepResearchSettings => ({\n  enabled: false,\n  effortLevel: \"standard\",\n  ...EFFORT_PRESETS.standard,\n  autoStopOnQuality: true,\n  includeVisualizations: true,\n});\n\nconst MAX_HISTORY_SIZE = 20;\n\n// =============================================================================\n// Slice Interface\n// =============================================================================\n\nexport interface DeepResearchSlice {\n  // Settings\n  deepResearchSettings: DeepResearchSettings;\n  setDeepResearchEnabled: (enabled: boolean) => void;\n  setDeepResearchEffortLevel: (level: DeepResearchEffortLevel) => void;\n  setDeepResearchSettings: (settings: Partial<DeepResearchSettings>) => void;\n  resetDeepResearchSettings: () => void;\n\n  // Authenticated sources\n  authenticatedSources: AuthenticatedSource[];\n  setAuthenticatedSources: (sources: AuthenticatedSource[]) => void;\n  updateAuthenticatedSource: (\n    platform: string,\n    updates: Partial<AuthenticatedSource>,\n  ) => void;\n\n  // Active research session\n  activeResearch: ActiveResearch | null;\n  startResearch: (query: string) => void;\n  updateResearchProgress: (updates: Partial<ActiveResearch>) => void;\n  updateResearchPhase: (\n    phaseId: string,\n    updates: Partial<ResearchPhase>,\n  ) => void;\n  addResearchSource: (source: ResearchSource) => void;\n  updateResearchSource: (\n    sourceId: string,\n    updates: Partial<ResearchSource>,\n  ) => void;\n  stopResearch: () => void;\n  completeResearch: (qualityScore: number) => void;\n  failResearch: (error: string) => void;\n  clearActiveResearch: () => void;\n\n  // Research history\n  researchHistory: ResearchResultSummary[];\n  addToResearchHistory: (result: ResearchResultSummary) => void;\n  clearResearchHistory: () => void;\n}\n\n// =============================================================================\n// Slice Creator\n// =============================================================================\n\nexport const createDeepResearchSlice: SliceCreator<DeepResearchSlice> = (\n  set,\n) => ({\n  // Settings\n  deepResearchSettings: createDefaultSettings(),\n\n  setDeepResearchEnabled: (enabled) =>\n    set((state) => {\n      state.deepResearchSettings.enabled = enabled;\n    }),\n\n  setDeepResearchEffortLevel: (level) =>\n    set((state) => {\n      const preset = EFFORT_PRESETS[level];\n      state.deepResearchSettings = {\n        ...state.deepResearchSettings,\n        effortLevel: level,\n        maxSteps: preset.maxSteps,\n        parallelRequests: preset.parallelRequests,\n        qualityThreshold: preset.qualityThreshold,\n      };\n    }),\n\n  setDeepResearchSettings: (settings) =>\n    set((state) => {\n      Object.assign(state.deepResearchSettings, settings);\n    }),\n\n  resetDeepResearchSettings: () =>\n    set((state) => {\n      state.deepResearchSettings = createDefaultSettings();\n    }),\n\n  // Authenticated sources\n  authenticatedSources: [],\n\n  setAuthenticatedSources: (sources) =>\n    set((state) => {\n      state.authenticatedSources = sources;\n    }),\n\n  updateAuthenticatedSource: (platform, updates) =>\n    set((state) => {\n      const index = state.authenticatedSources.findIndex(\n        (s) => s.platform === platform,\n      );\n      if (index >= 0) {\n        Object.assign(state.authenticatedSources[index]!, updates);\n      }\n    }),\n\n  // Active research\n  activeResearch: null,\n\n  startResearch: (query) =>\n    set((state) => {\n      const level = state.deepResearchSettings.effortLevel;\n      const preset = EFFORT_PRESETS[level];\n\n      state.activeResearch = {\n        id: `research-${Date.now()}`,\n        query,\n        effortLevel: level,\n        status: \"initializing\",\n        startTime: Date.now(),\n        estimatedTimeMs: preset.estimatedTimeMs,\n        progress: 0,\n        currentPhase: RESEARCH_PHASES[0]!.label,\n        phases: RESEARCH_PHASES.map((p, i) => ({\n          ...p,\n          status: i === 0 ? \"running\" : \"pending\",\n          progress: 0,\n        })),\n        sources: [],\n        sourcesTarget: preset.sourcesTarget,\n      };\n    }),\n\n  updateResearchProgress: (updates) =>\n    set((state) => {\n      if (state.activeResearch) {\n        Object.assign(state.activeResearch, updates);\n      }\n    }),\n\n  updateResearchPhase: (phaseId, updates) =>\n    set((state) => {\n      if (state.activeResearch) {\n        const phase = state.activeResearch.phases.find((p) => p.id === phaseId);\n        if (phase) {\n          Object.assign(phase, updates);\n        }\n      }\n    }),\n\n  addResearchSource: (source) =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.sources.push(source);\n      }\n    }),\n\n  updateResearchSource: (sourceId, updates) =>\n    set((state) => {\n      if (state.activeResearch) {\n        const source = state.activeResearch.sources.find(\n          (s) => s.id === sourceId,\n        );\n        if (source) {\n          Object.assign(source, updates);\n        }\n      }\n    }),\n\n  stopResearch: () =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.status = \"stopped\";\n      }\n    }),\n\n  completeResearch: (qualityScore) =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.status = \"complete\";\n        state.activeResearch.progress = 100;\n\n        // Add to history\n        state.researchHistory.unshift({\n          id: state.activeResearch.id,\n          query: state.activeResearch.query,\n          completedAt: Date.now(),\n          sourcesUsed: state.activeResearch.sources.filter(\n            (s) => s.status === \"complete\",\n          ).length,\n          qualityScore,\n          hasVisualizations: state.deepResearchSettings.includeVisualizations,\n        });\n\n        // Trim history\n        if (state.researchHistory.length > MAX_HISTORY_SIZE) {\n          state.researchHistory = state.researchHistory.slice(\n            0,\n            MAX_HISTORY_SIZE,\n          );\n        }\n      }\n    }),\n\n  failResearch: (error) =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.status = \"error\";\n        state.activeResearch.error = error;\n      }\n    }),\n\n  clearActiveResearch: () =>\n    set((state) => {\n      state.activeResearch = null;\n    }),\n\n  // History\n  researchHistory: [],\n\n  addToResearchHistory: (result) =>\n    set((state) => {\n      state.researchHistory.unshift(result);\n      if (state.researchHistory.length > MAX_HISTORY_SIZE) {\n        state.researchHistory = state.researchHistory.slice(\n          0,\n          MAX_HISTORY_SIZE,\n        );\n      }\n    }),\n\n  clearResearchHistory: () =>\n    set((state) => {\n      state.researchHistory = [];\n    }),\n});\n","/**\n * UI Tree Slice - Streaming UI state management\n *\n * This slice manages the UI tree state during streaming generation.\n * Using Zustand ensures proper reactivity when the tree is updated\n * from async stream handlers.\n */\nimport type { UITree, UIElement, JsonPatch } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\nexport interface UITreeSlice {\n  // State\n  uiTree: UITree | null;\n  isTreeStreaming: boolean;\n  treeVersion: number; // Force re-renders by incrementing\n\n  // Actions\n  setUITree: (tree: UITree | null) => void;\n  updateUITree: (updater: (tree: UITree) => UITree) => void;\n  setElement: (key: string, element: UIElement) => void;\n  removeElement: (key: string) => void;\n  applyTreePatch: (patch: JsonPatch) => void;\n  setTreeStreaming: (streaming: boolean) => void;\n  clearUITree: () => void;\n  bumpTreeVersion: () => void;\n}\n\nconst initialTree: UITree | null = null;\n\nexport const createUITreeSlice: SliceCreator<UITreeSlice> = (set, get) => ({\n  // State\n  uiTree: initialTree,\n  isTreeStreaming: false,\n  treeVersion: 0,\n\n  // Actions\n  setUITree: (tree) =>\n    set((state) => {\n      state.uiTree = tree;\n      state.treeVersion += 1;\n    }),\n\n  updateUITree: (updater) =>\n    set((state) => {\n      if (state.uiTree) {\n        const updated = updater(state.uiTree);\n        state.uiTree = updated;\n        state.treeVersion += 1;\n      }\n    }),\n\n  setElement: (key, element) =>\n    set((state) => {\n      if (state.uiTree) {\n        state.uiTree.elements[key] = element;\n        state.treeVersion += 1;\n      }\n    }),\n\n  removeElement: (key) =>\n    set((state) => {\n      if (state.uiTree && state.uiTree.elements[key]) {\n        delete state.uiTree.elements[key];\n        state.treeVersion += 1;\n      }\n    }),\n\n  applyTreePatch: (patch) =>\n    set((state) => {\n      if (!state.uiTree) return;\n\n      // Handle add/replace operations for elements\n      if (\n        (patch.op === \"add\" || patch.op === \"replace\") &&\n        patch.path.startsWith(\"/elements/\")\n      ) {\n        const key = patch.path.replace(\"/elements/\", \"\").split(\"/\")[0];\n        if (key && patch.value) {\n          if (patch.path === `/elements/${key}`) {\n            // Full element replacement\n            state.uiTree.elements[key] = patch.value as UIElement;\n          } else {\n            // Nested property update - ensure element exists\n            if (!state.uiTree.elements[key]) {\n              state.uiTree.elements[key] = {\n                type: \"unknown\",\n                props: {},\n              } as UIElement;\n            }\n            // Apply nested update via JSON pointer\n            applyNestedPatch(\n              state.uiTree.elements[key],\n              patch.path.replace(`/elements/${key}`, \"\"),\n              patch.value,\n            );\n          }\n          state.treeVersion += 1;\n        }\n      }\n\n      // Handle root changes\n      if (patch.path === \"/root\" && typeof patch.value === \"string\") {\n        state.uiTree.root = patch.value;\n        state.treeVersion += 1;\n      }\n    }),\n\n  setTreeStreaming: (streaming) => set({ isTreeStreaming: streaming }),\n\n  clearUITree: () =>\n    set((state) => {\n      state.uiTree = null;\n      state.treeVersion = 0;\n      state.isTreeStreaming = false;\n    }),\n\n  bumpTreeVersion: () =>\n    set((state) => {\n      state.treeVersion += 1;\n    }),\n});\n\n/**\n * Apply a nested patch to an object using JSON pointer path\n */\nfunction applyNestedPatch(obj: unknown, path: string, value: unknown): void {\n  if (!path || path === \"/\") {\n    return;\n  }\n\n  const parts = path.slice(1).split(\"/\");\n  let current = obj as Record<string, unknown>;\n\n  for (let i = 0; i < parts.length - 1; i++) {\n    const key = parts[i]!;\n    if (!current[key] || typeof current[key] !== \"object\") {\n      current[key] = {};\n    }\n    current = current[key] as Record<string, unknown>;\n  }\n\n  const lastKey = parts[parts.length - 1]!;\n  current[lastKey] = value;\n}\n","/**\n * Workspace Slice\n *\n * Manages Canvas workspace state:\n * - Open documents (tabs)\n * - Active document\n * - Workspace layout mode\n * - YOLO mode toggle\n * - AI edit approvals\n */\n\nimport type { SliceCreator } from \"../types\";\n\n/**\n * Editor content type - supports both Lexical and Tiptap formats\n * \n * Lexical format has a root node with children\n * Tiptap format has a type and content array\n */\nexport type EditorContent = Record<string, unknown>;\n\n/** @deprecated Use EditorContent instead */\nexport type SerializedEditorState = EditorContent;\n\n/** Document in workspace */\nexport interface WorkspaceDocument {\n  /** Unique document ID */\n  id: string;\n  /** Document title */\n  title: string;\n  /** Editor content (Lexical or Tiptap format) */\n  content: EditorContent | null;\n  /** Last saved timestamp */\n  savedAt: number | null;\n  /** Last modified timestamp */\n  modifiedAt: number;\n  /** Has unsaved changes */\n  isDirty: boolean;\n  /** Document format */\n  format: \"tiptap\" | \"lexical\" | \"markdown\" | \"html\";\n}\n\n/** Pending AI edit requiring approval */\nexport interface PendingAIEdit {\n  /** Edit ID */\n  id: string;\n  /** Target document ID */\n  documentId: string;\n  /** Description of the edit */\n  description: string;\n  /** Preview of changes (diff) */\n  preview: {\n    before: string;\n    after: string;\n  };\n  /** New content if approved */\n  newContent: EditorContent;\n  /** Created timestamp */\n  createdAt: number;\n}\n\n/** Workspace layout mode */\nexport type WorkspaceLayout =\n  | \"chat-only\" // Full chat, no canvas\n  | \"split\" // Chat + Canvas side by side\n  | \"canvas-only\"; // Full canvas, chat minimized\n\nexport interface WorkspaceSlice {\n  // State\n  /** Open documents */\n  documents: WorkspaceDocument[];\n  /** Active document ID */\n  activeDocumentId: string | null;\n  /** Workspace layout mode */\n  workspaceLayout: WorkspaceLayout;\n  /** YOLO mode - auto-apply AI edits */\n  yoloMode: boolean;\n  /** Pending AI edits requiring approval */\n  pendingEdits: PendingAIEdit[];\n  /** Is workspace panel visible */\n  isWorkspaceOpen: boolean;\n\n  // Document actions\n  /** Create new document */\n  createDocument: (title?: string) => WorkspaceDocument;\n  /** Open existing document */\n  openDocument: (doc: WorkspaceDocument) => void;\n  /** Close document by ID */\n  closeDocument: (id: string) => void;\n  /** Set active document */\n  setActiveDocument: (id: string) => void;\n  /** Update document content */\n  updateDocumentContent: (\n    id: string,\n    content: EditorContent | null,\n  ) => void;\n  /** Rename document */\n  renameDocument: (id: string, title: string) => void;\n  /** Mark document as saved */\n  markDocumentSaved: (id: string) => void;\n\n  // Layout actions\n  /** Set workspace layout */\n  setWorkspaceLayout: (layout: WorkspaceLayout) => void;\n  /** Toggle workspace panel */\n  toggleWorkspace: () => void;\n\n  // AI edit actions\n  /** Toggle YOLO mode */\n  setYoloMode: (enabled: boolean) => void;\n  /** Add pending AI edit */\n  addPendingEdit: (edit: Omit<PendingAIEdit, \"id\" | \"createdAt\">) => void;\n  /** Approve pending edit */\n  approvePendingEdit: (editId: string) => void;\n  /** Reject pending edit */\n  rejectPendingEdit: (editId: string) => void;\n  /** Clear all pending edits */\n  clearPendingEdits: () => void;\n\n  // Helpers\n  /** Get active document */\n  getActiveDocument: () => WorkspaceDocument | null;\n  /** Check if document is open */\n  isDocumentOpen: (id: string) => boolean;\n}\n\nexport const createWorkspaceSlice: SliceCreator<WorkspaceSlice> = (\n  set,\n  get,\n) => ({\n  // Initial state\n  documents: [],\n  activeDocumentId: null,\n  workspaceLayout: \"chat-only\",\n  yoloMode: false,\n  pendingEdits: [],\n  isWorkspaceOpen: false,\n\n  // Document actions\n  createDocument: (title) => {\n    const doc: WorkspaceDocument = {\n      id: crypto.randomUUID(),\n      title: title || `Document ${get().documents.length + 1}`,\n      content: null,\n      savedAt: null,\n      modifiedAt: Date.now(),\n      isDirty: false,\n      format: \"tiptap\",\n    };\n    set((state) => ({\n      documents: [...state.documents, doc],\n      activeDocumentId: doc.id,\n      isWorkspaceOpen: true,\n      workspaceLayout:\n        state.workspaceLayout === \"chat-only\" ? \"split\" : state.workspaceLayout,\n    }));\n    return doc;\n  },\n\n  openDocument: (doc) => {\n    set((state) => {\n      const exists = state.documents.some((d) => d.id === doc.id);\n      return {\n        documents: exists ? state.documents : [...state.documents, doc],\n        activeDocumentId: doc.id,\n        isWorkspaceOpen: true,\n        workspaceLayout:\n          state.workspaceLayout === \"chat-only\"\n            ? \"split\"\n            : state.workspaceLayout,\n      };\n    });\n  },\n\n  closeDocument: (id) => {\n    set((state) => {\n      const newDocs = state.documents.filter((d) => d.id !== id);\n      const wasActive = state.activeDocumentId === id;\n      return {\n        documents: newDocs,\n        activeDocumentId: wasActive\n          ? newDocs[newDocs.length - 1]?.id || null\n          : state.activeDocumentId,\n        isWorkspaceOpen: newDocs.length > 0,\n        workspaceLayout:\n          newDocs.length === 0 ? \"chat-only\" : state.workspaceLayout,\n      };\n    });\n  },\n\n  setActiveDocument: (id) => {\n    set({ activeDocumentId: id });\n  },\n\n  updateDocumentContent: (id, content) => {\n    set((state) => ({\n      documents: state.documents.map((doc) =>\n        doc.id === id\n          ? { ...doc, content, modifiedAt: Date.now(), isDirty: true }\n          : doc,\n      ),\n    }));\n  },\n\n  renameDocument: (id, title) => {\n    set((state) => ({\n      documents: state.documents.map((doc) =>\n        doc.id === id ? { ...doc, title, isDirty: true } : doc,\n      ),\n    }));\n  },\n\n  markDocumentSaved: (id) => {\n    set((state) => ({\n      documents: state.documents.map((doc) =>\n        doc.id === id ? { ...doc, savedAt: Date.now(), isDirty: false } : doc,\n      ),\n    }));\n  },\n\n  // Layout actions\n  setWorkspaceLayout: (layout) => {\n    set({\n      workspaceLayout: layout,\n      isWorkspaceOpen: layout !== \"chat-only\",\n    });\n  },\n\n  toggleWorkspace: () => {\n    set((state) => ({\n      isWorkspaceOpen: !state.isWorkspaceOpen,\n      workspaceLayout: state.isWorkspaceOpen ? \"chat-only\" : \"split\",\n    }));\n  },\n\n  // AI edit actions\n  setYoloMode: (enabled) => {\n    set({ yoloMode: enabled });\n  },\n\n  addPendingEdit: (edit) => {\n    const pendingEdit: PendingAIEdit = {\n      ...edit,\n      id: crypto.randomUUID(),\n      createdAt: Date.now(),\n    };\n\n    const { yoloMode } = get();\n\n    if (yoloMode) {\n      // Auto-apply in YOLO mode\n      get().updateDocumentContent(edit.documentId, edit.newContent);\n    } else {\n      set((state) => ({\n        pendingEdits: [...state.pendingEdits, pendingEdit],\n      }));\n    }\n  },\n\n  approvePendingEdit: (editId) => {\n    const edit = get().pendingEdits.find((e) => e.id === editId);\n    if (edit) {\n      get().updateDocumentContent(edit.documentId, edit.newContent);\n    }\n    set((state) => ({\n      pendingEdits: state.pendingEdits.filter((e) => e.id !== editId),\n    }));\n  },\n\n  rejectPendingEdit: (editId) => {\n    set((state) => ({\n      pendingEdits: state.pendingEdits.filter((e) => e.id !== editId),\n    }));\n  },\n\n  clearPendingEdits: () => {\n    set({ pendingEdits: [] });\n  },\n\n  // Helpers\n  getActiveDocument: () => {\n    const { documents, activeDocumentId } = get();\n    return documents.find((d) => d.id === activeDocumentId) || null;\n  },\n\n  isDocumentOpen: (id) => {\n    return get().documents.some((d) => d.id === id);\n  },\n});\n","/**\n * Canvas Slice\n *\n * Manages inline Canvas editor state for GenUI components.\n * Separate from WorkspaceSlice which handles standalone documents.\n *\n * Key features:\n * - Per-canvas state management by canvasId (usually element.key)\n * - Streaming-safe updates without forcing re-mount\n * - Tiptap editor state synchronization\n * - Pending AI edits queue\n */\n\nimport type { SliceCreator } from \"../types\";\n\n// =============================================================================\n// Types\n// =============================================================================\n\n/** Tiptap document format */\nexport type CanvasEditorState = {\n  type: \"doc\";\n  content: unknown[];\n};\n\n/** Canvas instance state */\nexport interface CanvasInstance {\n  /** Unique canvas ID (usually element.key from GenUI tree) */\n  id: string;\n  /** Current editor content (Tiptap format) */\n  content: CanvasEditorState | null;\n  /** Is content being streamed from AI */\n  isStreaming: boolean;\n  /** Content version (increments on each update) */\n  version: number;\n  /** Last update timestamp */\n  updatedAt: number;\n  /** Has unsaved local changes */\n  isDirty: boolean;\n  /** Document title (optional) */\n  title?: string;\n  /** Associated document ID for persistence */\n  documentId?: string;\n}\n\n/** Pending AI content update */\nexport interface CanvasPendingUpdate {\n  /** Canvas ID */\n  canvasId: string;\n  /** New content */\n  content: CanvasEditorState;\n  /** Update timestamp */\n  timestamp: number;\n}\n\n// =============================================================================\n// Slice Interface\n// =============================================================================\n\nexport interface CanvasSlice {\n  // State\n  /** Map of canvas instances by ID */\n  canvasInstances: Map<string, CanvasInstance>;\n  /** Pending updates queue (for batching during streaming) */\n  canvasPendingUpdates: CanvasPendingUpdate[];\n\n  // Instance management\n  /** Initialize or get a canvas instance */\n  initCanvas: (\n    canvasId: string,\n    initialContent?: CanvasEditorState | null,\n    options?: { title?: string; documentId?: string },\n  ) => CanvasInstance;\n  /** Remove a canvas instance */\n  removeCanvas: (canvasId: string) => void;\n  /** Check if canvas exists */\n  hasCanvas: (canvasId: string) => boolean;\n  /** Get canvas instance */\n  getCanvas: (canvasId: string) => CanvasInstance | undefined;\n\n  // Content updates\n  /** Update canvas content (streaming-safe) */\n  updateCanvasContent: (\n    canvasId: string,\n    content: CanvasEditorState | null,\n  ) => void;\n  /** Set streaming state */\n  setCanvasStreaming: (canvasId: string, isStreaming: boolean) => void;\n  /** Mark canvas as dirty (has unsaved changes) */\n  setCanvasDirty: (canvasId: string, isDirty: boolean) => void;\n\n  // Batch updates (for streaming optimization)\n  /** Queue an update for later application */\n  queueCanvasUpdate: (canvasId: string, content: CanvasEditorState) => void;\n  /** Apply all pending updates for a canvas */\n  flushCanvasUpdates: (canvasId: string) => void;\n  /** Clear pending updates without applying */\n  clearCanvasPendingUpdates: (canvasId: string) => void;\n\n  // Selectors\n  /** Get all canvas IDs */\n  getCanvasIds: () => string[];\n  /** Get streaming canvases */\n  getStreamingCanvases: () => CanvasInstance[];\n}\n\n// =============================================================================\n// Slice Implementation\n// =============================================================================\n\nexport const createCanvasSlice: SliceCreator<CanvasSlice> = (set, get) => ({\n  // Initial state\n  canvasInstances: new Map(),\n  canvasPendingUpdates: [],\n\n  // Instance management\n  initCanvas: (canvasId, initialContent = null, options = {}) => {\n    const existing = get().canvasInstances.get(canvasId);\n    if (existing) {\n      return existing;\n    }\n\n    const instance: CanvasInstance = {\n      id: canvasId,\n      content: initialContent,\n      isStreaming: false,\n      version: 0,\n      updatedAt: Date.now(),\n      isDirty: false,\n      title: options.title,\n      documentId: options.documentId,\n    };\n\n    set((state) => {\n      state.canvasInstances.set(canvasId, instance);\n    });\n\n    return instance;\n  },\n\n  removeCanvas: (canvasId) => {\n    set((state) => {\n      state.canvasInstances.delete(canvasId);\n      // Also clear any pending updates\n      state.canvasPendingUpdates = state.canvasPendingUpdates.filter(\n        (u) => u.canvasId !== canvasId,\n      );\n    });\n  },\n\n  hasCanvas: (canvasId) => {\n    return get().canvasInstances.has(canvasId);\n  },\n\n  getCanvas: (canvasId) => {\n    return get().canvasInstances.get(canvasId);\n  },\n\n  // Content updates\n  updateCanvasContent: (canvasId, content) => {\n    set((state) => {\n      const instance = state.canvasInstances.get(canvasId);\n      if (instance) {\n        instance.content = content;\n        instance.version += 1;\n        instance.updatedAt = Date.now();\n        instance.isDirty = true;\n      }\n    });\n  },\n\n  setCanvasStreaming: (canvasId, isStreaming) => {\n    set((state) => {\n      const instance = state.canvasInstances.get(canvasId);\n      if (instance) {\n        instance.isStreaming = isStreaming;\n        // When streaming ends, flush any pending updates\n        if (!isStreaming) {\n          const pendingForCanvas = state.canvasPendingUpdates.filter(\n            (u) => u.canvasId === canvasId,\n          );\n          if (pendingForCanvas.length > 0) {\n            // Apply the latest pending update\n            const latest = pendingForCanvas[pendingForCanvas.length - 1];\n            if (latest) {\n              instance.content = latest.content;\n              instance.version += 1;\n              instance.updatedAt = Date.now();\n            }\n            // Clear pending updates for this canvas\n            state.canvasPendingUpdates = state.canvasPendingUpdates.filter(\n              (u) => u.canvasId !== canvasId,\n            );\n          }\n        }\n      }\n    });\n  },\n\n  setCanvasDirty: (canvasId, isDirty) => {\n    set((state) => {\n      const instance = state.canvasInstances.get(canvasId);\n      if (instance) {\n        instance.isDirty = isDirty;\n      }\n    });\n  },\n\n  // Batch updates\n  queueCanvasUpdate: (canvasId, content) => {\n    set((state) => {\n      state.canvasPendingUpdates.push({\n        canvasId,\n        content,\n        timestamp: Date.now(),\n      });\n    });\n  },\n\n  flushCanvasUpdates: (canvasId) => {\n    set((state) => {\n      const pendingForCanvas = state.canvasPendingUpdates.filter(\n        (u) => u.canvasId === canvasId,\n      );\n      if (pendingForCanvas.length > 0) {\n        const instance = state.canvasInstances.get(canvasId);\n        if (instance) {\n          // Apply the latest pending update\n          const latest = pendingForCanvas[pendingForCanvas.length - 1];\n          if (latest) {\n            instance.content = latest.content;\n            instance.version += 1;\n            instance.updatedAt = Date.now();\n          }\n        }\n        // Clear pending updates for this canvas\n        state.canvasPendingUpdates = state.canvasPendingUpdates.filter(\n          (u) => u.canvasId !== canvasId,\n        );\n      }\n    });\n  },\n\n  clearCanvasPendingUpdates: (canvasId) => {\n    set((state) => {\n      state.canvasPendingUpdates = state.canvasPendingUpdates.filter(\n        (u) => u.canvasId !== canvasId,\n      );\n    });\n  },\n\n  // Selectors\n  getCanvasIds: () => {\n    return Array.from(get().canvasInstances.keys());\n  },\n\n  getStreamingCanvases: () => {\n    return Array.from(get().canvasInstances.values()).filter(\n      (c) => c.isStreaming,\n    );\n  },\n});\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport {\n  evaluateVisibility,\n  type VisibilityCondition,\n  type VisibilityContext as CoreVisibilityContext,\n} from \"@onegenui/core\";\nimport { useData } from \"./data\";\n\n/**\n * Visibility context value\n */\nexport interface VisibilityContextValue {\n  /** Evaluate a visibility condition */\n  isVisible: (condition: VisibilityCondition | undefined) => boolean;\n  /** The underlying visibility context */\n  ctx: CoreVisibilityContext;\n}\n\nconst VisibilityContext = createContext<VisibilityContextValue | null>(null);\n\n/**\n * Props for VisibilityProvider\n */\nexport interface VisibilityProviderProps {\n  children: ReactNode;\n}\n\n/**\n * Provider for visibility evaluation\n */\nexport function VisibilityProvider({ children }: VisibilityProviderProps) {\n  const { data, authState } = useData();\n\n  const ctx: CoreVisibilityContext = useMemo(\n    () => ({\n      dataModel: data,\n      authState,\n    }),\n    [data, authState],\n  );\n\n  const isVisible = useMemo(\n    () => (condition: VisibilityCondition | undefined) =>\n      evaluateVisibility(condition, ctx),\n    [ctx],\n  );\n\n  const value = useMemo<VisibilityContextValue>(\n    () => ({ isVisible, ctx }),\n    [isVisible, ctx],\n  );\n\n  return (\n    <VisibilityContext.Provider value={value}>\n      {children}\n    </VisibilityContext.Provider>\n  );\n}\n\n/**\n * Hook to access visibility evaluation\n */\nexport function useVisibility(): VisibilityContextValue {\n  const ctx = useContext(VisibilityContext);\n  if (!ctx) {\n    throw new Error(\"useVisibility must be used within a VisibilityProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to check if a condition is visible\n */\nexport function useIsVisible(\n  condition: VisibilityCondition | undefined,\n): boolean {\n  const { isVisible } = useVisibility();\n  return isVisible(condition);\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport {\n  resolveAction,\n  executeAction,\n  type Action,\n  type ActionHandler,\n  type ActionConfirm,\n  type ResolvedAction,\n} from \"@onegenui/core\";\nimport { useData } from \"./data\";\nimport { useStore } from \"../store\";\nimport { cn } from \"../utils\";\n\n/**\n * Pending confirmation state\n */\nexport interface PendingConfirmation {\n  /** The resolved action */\n  action: ResolvedAction;\n  /** The action handler */\n  handler: ActionHandler;\n  /** Resolve callback */\n  resolve: () => void;\n  /** Reject callback */\n  reject: () => void;\n}\n\n/**\n * Action tracking callback type\n */\nexport type ActionTrackingCallback = (info: {\n  actionName: string;\n  params: Record<string, unknown>;\n  elementType?: string;\n  context?: Record<string, unknown>;\n}) => void;\n\n/**\n * Action context value\n */\nexport interface ActionContextValue {\n  /** Registered action handlers */\n  handlers: Record<string, ActionHandler>;\n  /** Currently loading action names */\n  loadingActions: Set<string>;\n  /** Pending confirmation dialog */\n  pendingConfirmation: PendingConfirmation | null;\n  /** Execute an action */\n  execute: (action: Action) => Promise<void>;\n  /** Confirm the pending action */\n  confirm: () => void;\n  /** Cancel the pending action */\n  cancel: () => void;\n  /** Register an action handler */\n  registerHandler: (name: string, handler: ActionHandler) => void;\n}\n\nconst ActionContext = createContext<ActionContextValue | null>(null);\n\n/**\n * Props for ActionProvider\n */\nexport interface ActionProviderProps {\n  /** Initial action handlers */\n  handlers?: Record<string, ActionHandler>;\n  /** Navigation function */\n  navigate?: (path: string) => void;\n  /** Optional callback to track executed actions (for proactive AI) */\n  onActionExecuted?: ActionTrackingCallback;\n  children: ReactNode;\n}\n\n/**\n * Provider for action execution - Now uses Zustand for state\n */\nexport function ActionProvider({\n  handlers: initialHandlers = {},\n  navigate,\n  onActionExecuted,\n  children,\n}: ActionProviderProps) {\n  const { data, set } = useData();\n\n  // Bridge to Zustand store\n  const loadingActions = useStore((s) => s.loadingActions);\n  const setActionLoading = useStore((s) => s.setActionLoading);\n  const clearActionLoading = useStore((s) => s.clearActionLoading);\n  const pendingConfirmations = useStore((s) => s.pendingConfirmations);\n  const addConfirmation = useStore((s) => s.addConfirmation);\n  const removeConfirmation = useStore((s) => s.removeConfirmation);\n  const addToHistory = useStore((s) => s.addToHistory);\n\n  // Local handlers state (not in store - these are callback functions)\n  const [handlers, setHandlers] =\n    React.useState<Record<string, ActionHandler>>(initialHandlers);\n\n  // Track current pending confirmation with callbacks (not serializable in store)\n  const [localPendingConfirmation, setLocalPendingConfirmation] =\n    React.useState<PendingConfirmation | null>(null);\n\n  const registerHandler = useCallback(\n    (name: string, handler: ActionHandler) => {\n      setHandlers((prev) => ({ ...prev, [name]: handler }));\n    },\n    [],\n  );\n\n  const execute = useCallback(\n    async (action: Action) => {\n      const resolved = resolveAction(action, data);\n      const handler = handlers[resolved.name];\n\n      if (!handler) {\n        console.warn(`No handler registered for action: ${resolved.name}`);\n        return;\n      }\n\n      // Track the action execution if callback is provided\n      const trackExecution = () => {\n        addToHistory({\n          actionName: resolved.name,\n          payload: resolved.params,\n        });\n        onActionExecuted?.({\n          actionName: resolved.name,\n          params: resolved.params,\n        });\n      };\n\n      // If confirmation is required, show dialog\n      if (resolved.confirm) {\n        const confirmId = addConfirmation({\n          actionName: resolved.name,\n          title: resolved.confirm.title,\n          message: resolved.confirm.message,\n          confirmText: resolved.confirm.confirmLabel,\n          cancelText: resolved.confirm.cancelLabel,\n          payload: resolved.params,\n        });\n\n        return new Promise<void>((resolve, reject) => {\n          setLocalPendingConfirmation({\n            action: resolved,\n            handler,\n            resolve: () => {\n              removeConfirmation(confirmId);\n              setLocalPendingConfirmation(null);\n              resolve();\n            },\n            reject: () => {\n              removeConfirmation(confirmId);\n              setLocalPendingConfirmation(null);\n              reject(new Error(\"Action cancelled\"));\n            },\n          });\n        }).then(async () => {\n          setActionLoading(resolved.name, true);\n          try {\n            await executeAction({\n              action: resolved,\n              handler,\n              setData: set,\n              navigate,\n              executeAction: async (name) => {\n                const subAction: Action = { name };\n                await execute(subAction);\n              },\n            });\n            trackExecution();\n          } finally {\n            clearActionLoading(resolved.name);\n          }\n        });\n      }\n\n      // Execute immediately\n      setActionLoading(resolved.name, true);\n      try {\n        await executeAction({\n          action: resolved,\n          handler,\n          setData: set,\n          navigate,\n          executeAction: async (name) => {\n            const subAction: Action = { name };\n            await execute(subAction);\n          },\n        });\n        trackExecution();\n      } finally {\n        clearActionLoading(resolved.name);\n      }\n    },\n    [\n      data,\n      handlers,\n      set,\n      navigate,\n      onActionExecuted,\n      setActionLoading,\n      clearActionLoading,\n      addConfirmation,\n      removeConfirmation,\n      addToHistory,\n    ],\n  );\n\n  const confirm = useCallback(() => {\n    localPendingConfirmation?.resolve();\n  }, [localPendingConfirmation]);\n\n  const cancel = useCallback(() => {\n    localPendingConfirmation?.reject();\n  }, [localPendingConfirmation]);\n\n  const value = useMemo<ActionContextValue>(\n    () => ({\n      handlers,\n      loadingActions,\n      pendingConfirmation: localPendingConfirmation,\n      execute,\n      confirm,\n      cancel,\n      registerHandler,\n    }),\n    [\n      handlers,\n      loadingActions,\n      localPendingConfirmation,\n      execute,\n      confirm,\n      cancel,\n      registerHandler,\n    ],\n  );\n\n  return (\n    <ActionContext.Provider value={value}>{children}</ActionContext.Provider>\n  );\n}\n\n/**\n * Hook to access action context\n */\nexport function useActions(): ActionContextValue {\n  const ctx = useContext(ActionContext);\n  if (!ctx) {\n    throw new Error(\"useActions must be used within an ActionProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to execute an action\n */\nexport function useAction(action: Action): {\n  execute: () => Promise<void>;\n  isLoading: boolean;\n} {\n  const { execute, loadingActions } = useActions();\n  const isLoading = loadingActions.has(action.name);\n\n  const executeAction = useCallback(() => execute(action), [execute, action]);\n\n  return { execute: executeAction, isLoading };\n}\n\n/**\n * Props for ConfirmDialog component\n */\nexport interface ConfirmDialogProps {\n  /** The confirmation config */\n  confirm: ActionConfirm;\n  /** Called when confirmed */\n  onConfirm: () => void;\n  /** Called when cancelled */\n  onCancel: () => void;\n}\n\n// ... existing code ...\n\n/**\n * Default confirmation dialog component\n */\nexport function ConfirmDialog({\n  confirm,\n  onConfirm,\n  onCancel,\n}: ConfirmDialogProps) {\n  const isDanger = confirm.variant === \"danger\";\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      onClick={onCancel}\n    >\n      <div\n        className=\"bg-white rounded-lg p-6 max-w-[400px] w-full shadow-2xl\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <h3 className=\"m-0 mb-2 text-lg font-semibold\">{confirm.title}</h3>\n        <p className=\"m-0 mb-6 text-gray-500\">{confirm.message}</p>\n        <div className=\"flex gap-3 justify-end\">\n          <button\n            onClick={onCancel}\n            className=\"px-4 py-2 rounded-md border border-gray-300 bg-white cursor-pointer hover:bg-gray-50 transition-colors\"\n          >\n            {confirm.cancelLabel ?? \"Cancel\"}\n          </button>\n          <button\n            onClick={onConfirm}\n            className={cn(\n              \"px-4 py-2 rounded-md border-none text-white cursor-pointer transition-colors\",\n              isDanger\n                ? \"bg-red-600 hover:bg-red-700\"\n                : \"bg-blue-500 hover:bg-blue-600\",\n            )}\n          >\n            {confirm.confirmLabel ?? \"Confirm\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport {\n  runValidation,\n  type ValidationConfig,\n  type ValidationFunction,\n  type ValidationResult,\n} from \"@onegenui/core\";\nimport { useData } from \"./data\";\nimport { useStore } from \"../store\";\n\n/**\n * Field validation state\n */\nexport interface FieldValidationState {\n  /** Whether the field has been touched */\n  touched: boolean;\n  /** Whether the field has been validated */\n  validated: boolean;\n  /** Validation result */\n  result: ValidationResult | null;\n}\n\n/**\n * Validation context value\n */\nexport interface ValidationContextValue {\n  /** Custom validation functions from catalog */\n  customFunctions: Record<string, ValidationFunction>;\n  /** Validation state by field path */\n  fieldStates: Record<string, FieldValidationState>;\n  /** Validate a field */\n  validate: (path: string, config: ValidationConfig) => ValidationResult;\n  /** Mark field as touched */\n  touch: (path: string) => void;\n  /** Clear validation for a field */\n  clear: (path: string) => void;\n  /** Validate all fields */\n  validateAll: () => boolean;\n  /** Register field config */\n  registerField: (path: string, config: ValidationConfig) => void;\n}\n\nconst ValidationContext = createContext<ValidationContextValue | null>(null);\n\n/**\n * Props for ValidationProvider\n */\nexport interface ValidationProviderProps {\n  /** Custom validation functions from catalog */\n  customFunctions?: Record<string, ValidationFunction>;\n  children: ReactNode;\n}\n\n/**\n * Provider for validation - Now uses Zustand for state\n */\nexport function ValidationProvider({\n  customFunctions = {},\n  children,\n}: ValidationProviderProps) {\n  const { data, authState } = useData();\n\n  // Bridge to Zustand store for field states\n  const fieldStates = useStore((s) => s.fieldStates);\n  const touchField = useStore((s) => s.touchField);\n  const setFieldValidation = useStore((s) => s.setFieldValidation);\n  const clearFieldValidation = useStore((s) => s.clearFieldValidation);\n\n  // Local state for field configs (not serializable - contains functions)\n  const [fieldConfigs, setFieldConfigs] = React.useState<\n    Record<string, ValidationConfig>\n  >({});\n\n  const registerField = useCallback(\n    (path: string, config: ValidationConfig) => {\n      setFieldConfigs((prev) => ({ ...prev, [path]: config }));\n    },\n    [],\n  );\n\n  const validate = useCallback(\n    (path: string, config: ValidationConfig): ValidationResult => {\n      const value = data[path.split(\"/\").filter(Boolean).join(\".\")];\n      const result = runValidation(config, {\n        value,\n        dataModel: data,\n        customFunctions,\n        authState,\n      });\n\n      // Store validation result in Zustand\n      setFieldValidation(path, {\n        isValid: result.valid,\n        errors: result.errors,\n        // ValidationResult from core doesn't have warnings, use empty array\n        warnings: [],\n      });\n\n      return result;\n    },\n    [data, customFunctions, authState, setFieldValidation],\n  );\n\n  const touch = useCallback(\n    (path: string) => {\n      touchField(path);\n    },\n    [touchField],\n  );\n\n  const clear = useCallback(\n    (path: string) => {\n      clearFieldValidation(path);\n    },\n    [clearFieldValidation],\n  );\n\n  const validateAll = useCallback(() => {\n    let allValid = true;\n\n    for (const [path, config] of Object.entries(fieldConfigs)) {\n      const result = validate(path, config);\n      if (!result.valid) {\n        allValid = false;\n      }\n    }\n\n    return allValid;\n  }, [fieldConfigs, validate]);\n\n  // Convert Zustand field states to context format\n  const contextFieldStates = useMemo(() => {\n    const result: Record<string, FieldValidationState> = {};\n    for (const [path, state] of Object.entries(fieldStates)) {\n      result[path] = {\n        touched: state.touched,\n        validated: state.validationResult !== null,\n        result: state.validationResult\n          ? {\n              valid: state.validationResult.isValid,\n              errors: state.validationResult.errors,\n              checks: [], // ValidationResult requires checks\n            }\n          : null,\n      };\n    }\n    return result;\n  }, [fieldStates]);\n\n  const value = useMemo<ValidationContextValue>(\n    () => ({\n      customFunctions,\n      fieldStates: contextFieldStates,\n      validate,\n      touch,\n      clear,\n      validateAll,\n      registerField,\n    }),\n    [\n      customFunctions,\n      contextFieldStates,\n      validate,\n      touch,\n      clear,\n      validateAll,\n      registerField,\n    ],\n  );\n\n  return (\n    <ValidationContext.Provider value={value}>\n      {children}\n    </ValidationContext.Provider>\n  );\n}\n\n/**\n * Hook to access validation context\n */\nexport function useValidation(): ValidationContextValue {\n  const ctx = useContext(ValidationContext);\n  if (!ctx) {\n    throw new Error(\"useValidation must be used within a ValidationProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to get validation state for a field\n */\nexport function useFieldValidation(\n  path: string,\n  config?: ValidationConfig,\n): {\n  state: FieldValidationState;\n  validate: () => ValidationResult;\n  touch: () => void;\n  clear: () => void;\n  errors: string[];\n  isValid: boolean;\n} {\n  const {\n    fieldStates,\n    validate: validateField,\n    touch: touchField,\n    clear: clearField,\n    registerField,\n  } = useValidation();\n\n  // Stabilize config reference to avoid infinite loops\n  const configJson = config ? JSON.stringify(config) : null;\n\n  // Register field on mount or when config changes\n  React.useEffect(() => {\n    if (config && configJson) {\n      registerField(path, config);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [path, configJson, registerField]);\n\n  const state = fieldStates[path] ?? {\n    touched: false,\n    validated: false,\n    result: null,\n  };\n\n  const validate = useCallback(\n    () => validateField(path, config ?? { checks: [] }),\n    [path, config, validateField],\n  );\n\n  const touch = useCallback(() => touchField(path), [path, touchField]);\n  const clear = useCallback(() => clearField(path), [path, clearField]);\n\n  return {\n    state,\n    validate,\n    touch,\n    clear,\n    errors: state.result?.errors ?? [],\n    isValid: state.result?.valid ?? true,\n  };\n}\n","\"use client\";\n\nimport { createContext } from \"react\";\nimport type { SelectionContextValue } from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const SelectionContext = createContext<\n  SelectionContextValue | undefined\n>(undefined);\n","\"use client\";\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport { SelectionContext } from \"./context\";\nimport { SELECTION_STYLE_ID, SELECTION_CSS } from \"./styles\";\nimport { getUniqueCSSPath } from \"./utils\";\nimport { useSelectionState } from \"./use-selection-state\";\nimport { useLongPress } from \"./use-long-press\";\nimport { useEditMode } from \"../edit-mode\";\nimport type { SelectionContextValue, SelectionProviderProps } from \"./types\";\n\n/**\n * Provider for granular item selection within components.\n *\n * Architecture:\n * - `deepSelections` is the SINGLE SOURCE OF TRUTH for all selections\n * - `granularSelection` is DERIVED from deepSelections (flat structure for component API)\n * - This ensures visual state and logical state are always in sync\n *\n * Features:\n * - Automatic event delegation: components only need data-* attributes\n * - Global CSS injection for consistent styling\n * - Zero boilerplate in components\n *\n * Components should add these attributes to selectable items:\n * - data-selectable-item: marks the element as selectable\n * - data-element-key: the component's element.key\n * - data-item-id: unique identifier for the item\n */\nexport function SelectionProvider({ children }: SelectionProviderProps) {\n  const selectionState = useSelectionState();\n  const {\n    deepSelections,\n    granularSelection,\n    addSelection,\n    removeSelectionByElement,\n    toggleSelection,\n    clearSelection,\n    isSelected,\n    getSelectedItems,\n    selectedElementsRef,\n    deepSelectionActiveRef,\n    setDeepSelectionActive,\n  } = selectionState;\n\n  // Get edit mode state - disable item selection when editing\n  const { isEditing } = useEditMode();\n\n  // Function to check if deep selection is active\n  const isDeepSelectionActive = useCallback(\n    () => deepSelectionActiveRef.current,\n    [deepSelectionActiveRef],\n  );\n\n  // Clear all deep selections and remove visual feedback\n  const clearDeepSelection = () => {\n    // Clear elements from ref\n    selectedElementsRef.current.forEach((el) => {\n      el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n      el.removeAttribute(\"aria-selected\");\n    });\n    selectedElementsRef.current.clear();\n\n    // Also query DOM directly in case elements were re-rendered\n    if (typeof document !== \"undefined\") {\n      document\n        .querySelectorAll(\".jsonui-deep-selected, .jsonui-item-selected\")\n        .forEach((el) => {\n          el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n          el.removeAttribute(\"aria-selected\");\n        });\n    }\n\n    clearSelection();\n  };\n\n  // Handle long-press selection\n  const handleLongPress = (\n    target: HTMLElement,\n    componentWrapper: HTMLElement,\n  ) => {\n    // In edit mode, don't start long-press selection\n    if (isEditing) {\n      return;\n    }\n\n    const elementKey = componentWrapper.getAttribute(\"data-jsonui-element-key\");\n    if (!elementKey) return;\n\n    // Check if already selected (toggle off)\n    if (selectedElementsRef.current.has(target)) {\n      target.classList.remove(\"jsonui-deep-selected\");\n      target.removeAttribute(\"aria-selected\");\n      removeSelectionByElement(target);\n      return;\n    }\n\n    // Set flag to prevent component-level selection (via context ref, no global pollution)\n    setDeepSelectionActive();\n\n    // Generate CSS path\n    const cssPath = getUniqueCSSPath(target, componentWrapper);\n    const textContent = (target.textContent || \"\").trim().substring(0, 100);\n\n    // Apply visual selection\n    target.classList.add(\"jsonui-deep-selected\");\n    target.setAttribute(\"aria-selected\", \"true\");\n\n    // Haptic feedback on mobile\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    // Find containing selectable-item\n    const selectableItem = target.closest(\n      \"[data-selectable-item]\",\n    ) as HTMLElement | null;\n    const itemId = selectableItem?.getAttribute(\"data-item-id\") || undefined;\n\n    addSelection({\n      elementKey,\n      cssPath,\n      tagName: target.tagName.toLowerCase(),\n      textContent,\n      element: target,\n      selectionType: \"granular\",\n      itemId,\n    });\n  };\n\n  // Handle click selection\n  const handleClick = (target: HTMLElement, _event: MouseEvent) => {\n    // In edit mode, don't intercept clicks on selectable items\n    // This allows normal interaction (editing tables, clicking links, etc.)\n    if (isEditing) {\n      return;\n    }\n\n    // Check for selectable-item click\n    const selectableItem = target.closest(\n      \"[data-selectable-item]\",\n    ) as HTMLElement | null;\n    if (selectableItem) {\n      const componentWrapper = selectableItem.closest(\n        \"[data-jsonui-element-key]\",\n      ) as HTMLElement | null;\n      if (!componentWrapper) return;\n\n      const elementKey = componentWrapper.getAttribute(\n        \"data-jsonui-element-key\",\n      );\n      if (!elementKey) return;\n\n      // Toggle if already selected\n      if (selectedElementsRef.current.has(selectableItem)) {\n        selectableItem.classList.remove(\n          \"jsonui-deep-selected\",\n          \"jsonui-item-selected\",\n        );\n        selectableItem.removeAttribute(\"aria-selected\");\n        removeSelectionByElement(selectableItem);\n        return;\n      }\n\n      const itemId = selectableItem.getAttribute(\"data-item-id\") || undefined;\n      const cssPath = getUniqueCSSPath(selectableItem, componentWrapper);\n      const textContent = (selectableItem.textContent || \"\")\n        .trim()\n        .substring(0, 200);\n\n      // Apply visual selection\n      selectableItem.classList.add(\n        \"jsonui-deep-selected\",\n        \"jsonui-item-selected\",\n      );\n      selectableItem.setAttribute(\"aria-selected\", \"true\");\n\n      addSelection({\n        elementKey,\n        cssPath,\n        tagName: selectableItem.tagName.toLowerCase(),\n        textContent,\n        element: selectableItem,\n        selectionType: \"item\",\n        itemId,\n      });\n      return;\n    }\n\n    // Check for click outside to clear selection\n    const componentWrapper = target.closest(\"[data-jsonui-element-key]\");\n    const isInChatArea =\n      target.closest(\"[data-chat-sidebar]\") ||\n      target.closest(\"input\") ||\n      target.closest(\"textarea\") ||\n      target.closest(\"[data-jsonui-no-clear-selection]\");\n\n    if (\n      !componentWrapper &&\n      !isInChatArea &&\n      selectedElementsRef.current.size > 0\n    ) {\n      clearDeepSelection();\n    }\n  };\n\n  // Use the long-press hook for event handling\n  useLongPress(\n    {\n      onLongPress: handleLongPress,\n      onClick: handleClick,\n    },\n    { debug: false },\n  );\n\n  // Keyboard shortcuts for selection\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Escape - clear all selections\n      if (e.key === \"Escape\" && deepSelections.length > 0) {\n        e.preventDefault();\n        clearDeepSelection();\n        return;\n      }\n\n      // Delete/Backspace - clear selections (alternative to Escape)\n      if (\n        (e.key === \"Delete\" || e.key === \"Backspace\") &&\n        deepSelections.length > 0 &&\n        !document.activeElement?.matches(\"input, textarea, [contenteditable]\")\n      ) {\n        e.preventDefault();\n        clearDeepSelection();\n        return;\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [deepSelections, clearDeepSelection]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      selectedElementsRef.current.forEach((el) => {\n        el.classList.remove(\"jsonui-deep-selected\");\n        el.removeAttribute(\"aria-selected\");\n      });\n    };\n  }, [selectedElementsRef]);\n\n  // CSS Injection\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n    if (document.getElementById(SELECTION_STYLE_ID)) return;\n\n    const style = document.createElement(\"style\");\n    style.id = SELECTION_STYLE_ID;\n    style.textContent = SELECTION_CSS;\n    document.head.appendChild(style);\n\n    return () => {\n      const el = document.getElementById(SELECTION_STYLE_ID);\n      if (el) el.remove();\n    };\n  }, []);\n\n  const value = useMemo<SelectionContextValue>(\n    () => ({\n      granularSelection,\n      toggleSelection,\n      clearSelection,\n      isSelected,\n      getSelectedItems,\n      deepSelections,\n      clearDeepSelection,\n      isDeepSelectionActive,\n    }),\n    [\n      granularSelection,\n      toggleSelection,\n      clearSelection,\n      isSelected,\n      getSelectedItems,\n      deepSelections,\n      isDeepSelectionActive,\n    ],\n  );\n\n  return (\n    <SelectionContext.Provider value={value}>\n      {children}\n    </SelectionContext.Provider>\n  );\n}\n","// ─────────────────────────────────────────────────────────────────────────────\n// Selection CSS Styles\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const SELECTION_STYLE_ID = \"jsonui-selection-styles\";\n\nexport const SELECTION_CSS = `\n@keyframes selection-shimmer {\n  0% {\n    background-position: -200% 0;\n  }\n  100% {\n    background-position: 200% 0;\n  }\n}\n\n@keyframes selection-pulse {\n  0%, 100% {\n    box-shadow: inset 0 0 0 2px var(--primary, #3b82f6), 0 0 0 0 rgba(59, 130, 246, 0.4);\n  }\n  50% {\n    box-shadow: inset 0 0 0 2px var(--primary, #3b82f6), 0 0 12px 2px rgba(59, 130, 246, 0.2);\n  }\n}\n\n/* ─────────────────────────────────────────────────────────────────────────────\n   TEXT SELECTION: Enable native text selection for copy/paste\n   ───────────────────────────────────────────────────────────────────────────── */\n\n/* Enable text selection on all JSON-UI components by default */\n[data-jsonui-element-key] {\n  user-select: text;\n  -webkit-user-select: text;\n}\n\n/* Prevent text selection from being cleared when clicking in chat sidebar */\n[data-chat-sidebar] {\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n/* But allow selection in chat input fields */\n[data-chat-sidebar] input,\n[data-chat-sidebar] textarea {\n  user-select: text;\n  -webkit-user-select: text;\n}\n\n/* Disable text selection on interactive elements to prevent accidental selection */\n[data-interactive],\n[data-jsonui-element-key] button,\n[data-jsonui-element-key] [role=\"button\"],\n[data-jsonui-element-key] input,\n[data-jsonui-element-key] select,\n[data-jsonui-element-key] textarea,\n[data-jsonui-element-key] label,\n[data-jsonui-element-key] [draggable=\"true\"] {\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n/* But allow selection on text content within labels */\n[data-jsonui-element-key] label span,\n[data-jsonui-element-key] label p {\n  user-select: text;\n  -webkit-user-select: text;\n}\n\n/* ─────────────────────────────────────────────────────────────────────────────\n   ITEM SELECTION: Click on data-selectable-item elements\n   ───────────────────────────────────────────────────────────────────────────── */\n\n[data-selectable-item] {\n  cursor: pointer;\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  border-radius: 8px;\n  position: relative;\n}\n\n[data-selectable-item]:hover:not([data-selected=\"true\"]):not(.jsonui-item-selected) {\n  background-color: rgba(255, 255, 255, 0.03);\n  transform: translateY(-1px);\n}\n\n/* Data attribute based selection */\n[data-selectable-item][data-selected=\"true\"] {\n  background: linear-gradient(\n    110deg,\n    #8b5cf6 0%,\n    rgba(139, 92, 246, 0.15) 20%,\n    rgba(196, 181, 253, 0.25) 40%,\n    rgba(139, 92, 246, 0.15) 60%,\n    #8b5cf6 100%\n  ) !important;\n  background-size: 200% 100% !important;\n  animation: selection-shimmer 2.5s ease-in-out infinite !important;\n  box-shadow: \n    inset 0 0 0 2px #8b5cf6,\n    0 0 16px 4px rgba(139, 92, 246, 0.5),\n    0 0 4px 1px rgba(139, 92, 246, 0.8) !important;\n  z-index: 10 !important;\n}\n\n[data-selectable-item][data-selected=\"true\"]::before {\n  content: \"\";\n  position: absolute;\n  inset: 2px;\n  background: #1a1a2e;\n  border-radius: 6px;\n  z-index: 0;\n  opacity: 0.95;\n}\n\n[data-selectable-item][data-selected=\"true\"] > * {\n  position: relative;\n  z-index: 1;\n}\n\n/* ─────────────────────────────────────────────────────────────────────────────\n   DEEP/GRANULAR SELECTION: Long-press on any element - BLUE shimmer\n   ───────────────────────────────────────────────────────────────────────────── */\n\n.jsonui-deep-selected {\n  position: relative !important;\n  border-radius: 8px !important;\n  z-index: 50 !important;\n  padding: 4px 8px !important;\n  margin: -4px -8px !important;\n  /* Shimmer background - blue for granular */\n  background: linear-gradient(\n    110deg,\n    #3b82f6 0%,\n    rgba(59, 130, 246, 0.15) 20%,\n    rgba(147, 197, 253, 0.25) 40%,\n    rgba(59, 130, 246, 0.15) 60%,\n    #3b82f6 100%\n  ) !important;\n  background-size: 200% 100% !important;\n  animation: selection-shimmer 2.5s ease-in-out infinite !important;\n  /* Bold inner border + outer glow */\n  box-shadow: \n    inset 0 0 0 2px #3b82f6,\n    0 0 20px 4px rgba(59, 130, 246, 0.6),\n    0 0 6px 2px rgba(59, 130, 246, 0.8) !important;\n  /* Ensure text stays visible */\n  color: #fff !important;\n}\n\n/* Inner content layer for deep selection */\n.jsonui-deep-selected::before {\n  content: \"\" !important;\n  position: absolute !important;\n  inset: 2px !important;\n  background: #0f172a !important;\n  border-radius: 6px !important;\n  z-index: 0 !important;\n  opacity: 0.92 !important;\n}\n\n/* Text inside deep selection stays visible */\n.jsonui-deep-selected > * {\n  position: relative !important;\n  z-index: 1 !important;\n}\n\n/* Item Selection via click - PURPLE shimmer (overrides deep-selected blue) */\n.jsonui-item-selected {\n  background: linear-gradient(\n    110deg,\n    #8b5cf6 0%,\n    rgba(139, 92, 246, 0.15) 20%,\n    rgba(196, 181, 253, 0.25) 40%,\n    rgba(139, 92, 246, 0.15) 60%,\n    #8b5cf6 100%\n  ) !important;\n  box-shadow: \n    inset 0 0 0 2px #8b5cf6,\n    0 0 20px 4px rgba(139, 92, 246, 0.6),\n    0 0 6px 2px rgba(139, 92, 246, 0.8) !important;\n}\n\n.jsonui-item-selected::before {\n  background: #1a1a2e !important;\n}\n\n@keyframes selection-pulse {\n  0%, 100% {\n    filter: brightness(1);\n  }\n  50% {\n    filter: brightness(1.15);\n  }\n}\n`;\n","// ─────────────────────────────────────────────────────────────────────────────\n// Deep Selection Utilities\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Cache for CSS paths to avoid recomputation\n * Uses WeakMap to automatically clean up when elements are GC'd\n */\nconst cssPathCache = new WeakMap<HTMLElement, Map<HTMLElement, string>>();\n\n/**\n * Generate a unique CSS selector path for an element relative to a root\n * Memoized for performance - same element/root pair returns cached result\n */\nexport function getUniqueCSSPath(\n  element: HTMLElement,\n  root: HTMLElement,\n): string {\n  // Check cache first\n  let elementCache = cssPathCache.get(element);\n  if (elementCache) {\n    const cached = elementCache.get(root);\n    if (cached !== undefined) {\n      return cached;\n    }\n  }\n\n  // Compute path\n  const parts: string[] = [];\n  let current: HTMLElement | null = element;\n\n  while (current && current !== root && current !== document.body) {\n    let selector = current.tagName.toLowerCase();\n\n    // Add nth-child for uniqueness\n    const parent = current.parentElement;\n    if (parent) {\n      const siblings = Array.from(parent.children).filter(\n        (child) => child.tagName === current!.tagName,\n      );\n      if (siblings.length > 1) {\n        const index = siblings.indexOf(current) + 1;\n        selector += `:nth-of-type(${index})`;\n      }\n    }\n\n    parts.unshift(selector);\n    current = current.parentElement;\n  }\n\n  const path = parts.join(\" > \");\n\n  // Store in cache\n  if (!elementCache) {\n    elementCache = new Map();\n    cssPathCache.set(element, elementCache);\n  }\n  elementCache.set(root, path);\n\n  return path;\n}\n\n/**\n * Clear CSS path cache for a specific element (call when element is re-rendered)\n */\nexport function clearCSSPathCache(element: HTMLElement): void {\n  cssPathCache.delete(element);\n}\n\n/**\n * Helper to generate the required data attributes for a selectable item.\n * Use this in components to reduce boilerplate.\n *\n * @example\n * ```tsx\n * {items.map(item => (\n *   <div key={item.id} {...selectableItemProps(element.key, item.id)}>\n *     {item.content}\n *   </div>\n * ))}\n * ```\n */\nexport function selectableItemProps(\n  elementKey: string,\n  itemId: string,\n  isSelected?: boolean,\n): Record<string, string | undefined> {\n  return {\n    \"data-selectable-item\": \"true\",\n    \"data-element-key\": elementKey,\n    \"data-item-id\": itemId,\n    \"data-selected\": isSelected ? \"true\" : undefined,\n  };\n}\n","/**\n * useSelectionState - Selection state management with Zustand\n *\n * This hook bridges the Context API with Zustand for granular subscriptions.\n * The Zustand store is the single source of truth for serializable data.\n * DOM element references are computed on-demand via findElementByCssPath().\n */\n\nimport { useCallback, useMemo, useRef } from \"react\";\nimport {\n  useStore,\n  useDeepSelections,\n  useDeepSelectionActive,\n} from \"../../store\";\nimport type { DeepSelectionInfo, DeepSelectionInput } from \"./types\";\n\nexport interface UseSelectionStateReturn {\n  /** All current deep selections (from Zustand store, with element computed) */\n  deepSelections: DeepSelectionInfo[];\n  /** Derived granular selection map (flat structure for component API) */\n  granularSelection: Record<string, Set<string>>;\n  /** Add a new selection (element is tracked in WeakMap, not stored) */\n  addSelection: (selection: DeepSelectionInput) => void;\n  /** Remove a selection by element reference */\n  removeSelectionByElement: (\n    element: HTMLElement,\n  ) => DeepSelectionInfo | undefined;\n  /** Toggle selection for an item (programmatic) */\n  toggleSelection: (elementKey: string, itemId: string) => void;\n  /** Clear selection for specific element or all */\n  clearSelection: (elementKey?: string) => DeepSelectionInfo[];\n  /** Check if item is selected */\n  isSelected: (elementKey: string, itemId: string) => boolean;\n  /** Get selected items for an element */\n  getSelectedItems: (elementKey: string) => string[];\n  /** Ref to track selected DOM elements (for visual feedback) */\n  selectedElementsRef: React.RefObject<Set<HTMLElement>>;\n  /** Flag indicating deep selection is active */\n  deepSelectionActiveRef: React.RefObject<boolean>;\n  /** Set deep selection active flag with auto-reset */\n  setDeepSelectionActive: () => void;\n}\n\n// WeakMap to track element → cssPath mapping for removal\nconst elementToCssPath = new WeakMap<HTMLElement, string>();\nconst elementToElementKey = new WeakMap<HTMLElement, string>();\n\n/**\n * Hook for managing selection state via Zustand store\n */\nexport function useSelectionState(): UseSelectionStateReturn {\n  // Zustand selectors\n  const storeSelections = useDeepSelections();\n  const isDeepActive = useDeepSelectionActive();\n\n  // Zustand actions\n  const addDeepSelection = useStore((s) => s.addDeepSelection);\n  const removeDeepSelectionByElement = useStore(\n    (s) => s.removeDeepSelectionByElement,\n  );\n  const clearDeepSelections = useStore((s) => s.clearDeepSelections);\n  const clearDeepSelectionsForElement = useStore(\n    (s) => s.clearDeepSelectionsForElement,\n  );\n  const setDeepSelectionActiveStore = useStore((s) => s.setDeepSelectionActive);\n\n  // Refs for DOM elements and active flag\n  const selectedElementsRef = useRef<Set<HTMLElement>>(new Set());\n  const deepSelectionActiveRef = useRef(false);\n\n  // Sync ref with store\n  deepSelectionActiveRef.current = isDeepActive;\n\n  // Convert store selections to context format (add DOM element ref)\n  const deepSelections = useMemo<DeepSelectionInfo[]>(() => {\n    return storeSelections.map((sel) => ({\n      ...sel,\n      element: findElementByCssPath(sel.elementKey, sel.cssPath),\n    }));\n  }, [storeSelections]);\n\n  // Derived state: granularSelection provides flat structure for component API\n  const granularSelection = useMemo(() => {\n    const result: Record<string, Set<string>> = {};\n    for (const sel of storeSelections) {\n      if (sel.itemId) {\n        if (!result[sel.elementKey]) {\n          result[sel.elementKey] = new Set();\n        }\n        result[sel.elementKey]!.add(sel.itemId);\n      }\n    }\n    return result;\n  }, [storeSelections]);\n\n  const addSelection = useCallback(\n    (selection: DeepSelectionInput) => {\n      // Store element mapping for later removal (not in Zustand)\n      if (selection.element) {\n        elementToCssPath.set(selection.element, selection.cssPath);\n        elementToElementKey.set(selection.element, selection.elementKey);\n        selectedElementsRef.current.add(selection.element);\n      }\n\n      // Send only serializable data to the store\n      addDeepSelection({\n        elementKey: selection.elementKey,\n        cssPath: selection.cssPath,\n        tagName: selection.tagName,\n        textContent: selection.textContent,\n        itemId: selection.itemId,\n        selectionType: selection.selectionType,\n      });\n    },\n    [addDeepSelection],\n  );\n\n  const removeSelectionByElement = useCallback(\n    (element: HTMLElement): DeepSelectionInfo | undefined => {\n      const cssPath = elementToCssPath.get(element);\n      const elementKey = elementToElementKey.get(element);\n\n      if (!cssPath || !elementKey) return undefined;\n\n      // Find the selection to return\n      const removed = deepSelections.find(\n        (s) => s.elementKey === elementKey && s.cssPath === cssPath,\n      );\n\n      // Remove from store\n      removeDeepSelectionByElement(elementKey, cssPath);\n      selectedElementsRef.current.delete(element);\n\n      return removed;\n    },\n    [deepSelections, removeDeepSelectionByElement],\n  );\n\n  const toggleSelection = useCallback(\n    (elementKey: string, itemId: string) => {\n      const existing = storeSelections.find(\n        (s) => s.elementKey === elementKey && s.itemId === itemId,\n      );\n\n      if (existing) {\n        // Remove visual feedback\n        const el = findElementByCssPath(elementKey, existing.cssPath);\n        if (el) {\n          el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n          el.removeAttribute(\"aria-selected\");\n          selectedElementsRef.current.delete(el);\n        }\n        removeDeepSelectionByElement(elementKey, existing.cssPath);\n      } else {\n        // Add - but we need the element to get cssPath\n        // This is for programmatic toggle, cssPath will be empty\n        addDeepSelection({\n          elementKey,\n          cssPath: \"\",\n          tagName: \"div\",\n          textContent: \"\",\n          itemId,\n          selectionType: \"item\",\n        });\n      }\n    },\n    [storeSelections, removeDeepSelectionByElement, addDeepSelection],\n  );\n\n  const clearSelection = useCallback(\n    (elementKey?: string): DeepSelectionInfo[] => {\n      // Get selections to return\n      const removed = elementKey\n        ? deepSelections.filter((s) => s.elementKey === elementKey)\n        : deepSelections;\n\n      // Clean up DOM references\n      for (const sel of removed) {\n        if (sel.element) {\n          sel.element.classList.remove(\n            \"jsonui-deep-selected\",\n            \"jsonui-item-selected\",\n          );\n          sel.element.removeAttribute(\"aria-selected\");\n          selectedElementsRef.current.delete(sel.element);\n        }\n      }\n\n      // Clear from store\n      if (elementKey) {\n        clearDeepSelectionsForElement(elementKey);\n      } else {\n        clearDeepSelections();\n      }\n\n      return removed;\n    },\n    [deepSelections, clearDeepSelections, clearDeepSelectionsForElement],\n  );\n\n  const isSelected = useCallback(\n    (elementKey: string, itemId: string) => {\n      return granularSelection[elementKey]?.has(itemId) ?? false;\n    },\n    [granularSelection],\n  );\n\n  const getSelectedItems = useCallback(\n    (elementKey: string) => {\n      return Array.from(granularSelection[elementKey] ?? []);\n    },\n    [granularSelection],\n  );\n\n  const setDeepSelectionActive = useCallback(() => {\n    setDeepSelectionActiveStore(true);\n  }, [setDeepSelectionActiveStore]);\n\n  return {\n    deepSelections,\n    granularSelection,\n    addSelection,\n    removeSelectionByElement,\n    toggleSelection,\n    clearSelection,\n    isSelected,\n    getSelectedItems,\n    selectedElementsRef,\n    deepSelectionActiveRef,\n    setDeepSelectionActive,\n  };\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Helper: Find element by CSS path\n// ─────────────────────────────────────────────────────────────────────────────\n\nfunction findElementByCssPath(\n  elementKey: string,\n  cssPath: string,\n): HTMLElement | null {\n  if (typeof document === \"undefined\" || !cssPath) {\n    return null;\n  }\n\n  const wrapper = document.querySelector(\n    `[data-jsonui-element-key=\"${elementKey}\"]`,\n  );\n  if (!wrapper) return null;\n\n  try {\n    const el = wrapper.querySelector(cssPath);\n    return el as HTMLElement | null;\n  } catch {\n    return null;\n  }\n}\n","/**\n * useLongPress - Long-press detection hook\n * Handles timing, movement tolerance, and cleanup\n */\n\nimport { useRef, useCallback, useEffect } from \"react\";\nimport { isInteractiveElement, shouldNeverSelect } from \"../../utils/dom\";\n\nexport interface LongPressConfig {\n  /** Duration in ms to trigger long-press */\n  duration: number;\n  /** Movement tolerance in px */\n  movementThreshold: number;\n  /** Enable debug logging */\n  debug?: boolean;\n}\n\nexport const DEFAULT_LONG_PRESS_CONFIG: LongPressConfig = {\n  duration: 450,\n  movementThreshold: 10,\n  debug: false,\n};\n\nexport interface LongPressCallbacks {\n  /** Called when long-press triggers */\n  onLongPress: (target: HTMLElement, componentWrapper: HTMLElement) => void;\n  /** Called when click happens (not long-press) */\n  onClick: (target: HTMLElement, event: MouseEvent) => void;\n  /** Called when right-click happens */\n  onContextMenu?: () => void;\n}\n\nexport interface UseLongPressReturn {\n  /** Flag indicating if long-press just completed (to prevent click) */\n  longPressJustCompleted: boolean;\n}\n\n/**\n * Hook for handling long-press detection on document\n * Automatically attaches/detaches event listeners\n */\nexport function useLongPress(\n  callbacks: LongPressCallbacks,\n  config: Partial<LongPressConfig> = {},\n): UseLongPressReturn {\n  const fullConfig = { ...DEFAULT_LONG_PRESS_CONFIG, ...config };\n  const { duration, movementThreshold, debug } = fullConfig;\n\n  const pressTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const pressTargetRef = useRef<HTMLElement | null>(null);\n  const longPressCompletedRef = useRef(false);\n\n  const log = useCallback(\n    (message: string, ...args: unknown[]) => {\n      if (debug) {\n        console.log(`[LongPress] ${message}`, ...args);\n      }\n    },\n    [debug],\n  );\n\n  const cancelPress = useCallback(() => {\n    if (pressTimerRef.current) {\n      clearTimeout(pressTimerRef.current);\n      pressTimerRef.current = null;\n    }\n    pressTargetRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const handlePointerDown = (e: PointerEvent) => {\n      // Only respond to primary button (left-click)\n      if (e.button !== 0) {\n        log(\"pointerdown SKIPPED - not primary button:\", e.button);\n        return;\n      }\n\n      const target = e.target as HTMLElement;\n      log(\"pointerdown on:\", target.tagName, target.className);\n\n      // Reset flag on new press\n      longPressCompletedRef.current = false;\n\n      // Cancel any existing press\n      cancelPress();\n\n      // Skip interactive elements\n      if (isInteractiveElement(target)) {\n        log(\"pointerdown SKIPPED - interactive element:\", target.tagName);\n        return;\n      }\n\n      // Skip elements that should never trigger selection\n      if (shouldNeverSelect(target)) {\n        log(\"pointerdown SKIPPED - shouldNeverSelect:\", target.tagName);\n        return;\n      }\n\n      // Find parent JSON-UI component\n      const componentWrapper = target.closest(\n        \"[data-jsonui-element-key]\",\n      ) as HTMLElement | null;\n      if (!componentWrapper) return;\n\n      // Skip non-meaningful elements\n      const skipTags = new Set([\"SCRIPT\", \"STYLE\", \"META\", \"LINK\", \"BR\", \"HR\"]);\n      if (skipTags.has(target.tagName)) return;\n\n      // Skip if pressing the component wrapper itself\n      if (target === componentWrapper) return;\n\n      // Store target and start timer\n      pressTargetRef.current = target;\n\n      pressTimerRef.current = setTimeout(() => {\n        if (!pressTargetRef.current) return;\n\n        log(\"Long-press triggered on:\", pressTargetRef.current.tagName);\n\n        callbacks.onLongPress(pressTargetRef.current, componentWrapper);\n\n        longPressCompletedRef.current = true;\n        pressTargetRef.current = null;\n      }, duration);\n    };\n\n    const handlePointerUp = () => cancelPress();\n\n    const handlePointerMove = (e: PointerEvent) => {\n      // Cancel if user moves significantly during press\n      if (\n        pressTargetRef.current &&\n        Math.abs(e.movementX) + Math.abs(e.movementY) > movementThreshold\n      ) {\n        cancelPress();\n      }\n    };\n\n    const handlePointerCancel = () => cancelPress();\n\n    const handleClick = (e: MouseEvent) => {\n      // Only respond to primary button\n      if (e.button !== 0) {\n        log(\"click SKIPPED - not primary button:\", e.button);\n        return;\n      }\n\n      const target = e.target as HTMLElement;\n      log(\"click on:\", target.tagName, target.className);\n\n      // Skip if long-press just completed\n      if (longPressCompletedRef.current) {\n        log(\"click SKIPPED - long-press just completed\");\n        longPressCompletedRef.current = false;\n        return;\n      }\n\n      // Skip if user has selected text\n      const textSelection = window.getSelection();\n      if (\n        textSelection &&\n        !textSelection.isCollapsed &&\n        textSelection.toString().trim()\n      ) {\n        log(\"click SKIPPED - text selection active\");\n        return;\n      }\n\n      // Skip interactive elements\n      if (isInteractiveElement(target)) {\n        log(\"click SKIPPED - interactive element:\", target.tagName);\n        return;\n      }\n\n      // Skip elements that should never trigger selection\n      if (shouldNeverSelect(target)) {\n        log(\"click SKIPPED - shouldNeverSelect:\", target.tagName);\n        return;\n      }\n\n      callbacks.onClick(target, e);\n    };\n\n    const handleContextMenu = () => {\n      cancelPress();\n      callbacks.onContextMenu?.();\n    };\n\n    document.addEventListener(\"pointerdown\", handlePointerDown, true);\n    document.addEventListener(\"pointerup\", handlePointerUp, true);\n    document.addEventListener(\"pointermove\", handlePointerMove, true);\n    document.addEventListener(\"pointercancel\", handlePointerCancel, true);\n    document.addEventListener(\"click\", handleClick, true);\n    document.addEventListener(\"contextmenu\", handleContextMenu, true);\n\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown, true);\n      document.removeEventListener(\"pointerup\", handlePointerUp, true);\n      document.removeEventListener(\"pointermove\", handlePointerMove, true);\n      document.removeEventListener(\"pointercancel\", handlePointerCancel, true);\n      document.removeEventListener(\"click\", handleClick, true);\n      document.removeEventListener(\"contextmenu\", handleContextMenu, true);\n      cancelPress();\n    };\n  }, [callbacks, duration, movementThreshold, cancelPress, log]);\n\n  return {\n    get longPressJustCompleted() {\n      return longPressCompletedRef.current;\n    },\n  };\n}\n","/**\n * DOM utility functions for interaction detection\n * Used to properly handle priority between interactive elements and selection\n *\n * ARCHITECTURE:\n * - Interactive elements (buttons, inputs, links) have PRIORITY over selection\n * - When user clicks on interactive element, native behavior happens, selection SKIPPED\n * - This is implemented at CORE level, not per-component\n *\n * KISS/DRY/SOLID:\n * - Single source of truth for what's \"interactive\"\n * - Extensible via data-* attributes for custom components\n * - No component-specific logic needed\n */\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Interactive Elements Detection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * List of natively interactive HTML elements\n * These always take priority over selection\n */\nconst NATIVE_INTERACTIVE_TAGS = new Set([\n  \"input\",\n  \"button\",\n  \"select\",\n  \"textarea\",\n  \"a\",\n  \"label\",\n  \"details\",\n  \"summary\",\n  \"dialog\",\n  \"menu\",\n  \"optgroup\",\n  \"option\",\n  \"datalist\",\n  \"fieldset\",\n  \"legend\",\n  \"progress\",\n  \"meter\",\n  \"output\",\n]);\n\n/**\n * ARIA roles that indicate interactive behavior\n */\nconst INTERACTIVE_ARIA_ROLES = new Set([\n  \"button\",\n  \"checkbox\",\n  \"radio\",\n  \"switch\",\n  \"link\",\n  \"menuitem\",\n  \"menuitemcheckbox\",\n  \"menuitemradio\",\n  \"option\",\n  \"tab\",\n  \"slider\",\n  \"spinbutton\",\n  \"combobox\",\n  \"listbox\",\n  \"searchbox\",\n  \"textbox\",\n  \"scrollbar\",\n  \"grid\",\n  \"gridcell\",\n  \"row\",\n  \"rowheader\",\n  \"columnheader\",\n  \"tree\",\n  \"treeitem\",\n  \"treegrid\",\n  \"tabpanel\",\n  \"toolbar\",\n  \"tooltip\",\n  \"progressbar\",\n  \"alertdialog\",\n]);\n\n/**\n * CSS selector for all known interactive elements\n * Used for parent lookup optimization\n */\nconst INTERACTIVE_SELECTOR = [\n  // Native elements\n  \"button\",\n  \"input\",\n  \"select\",\n  \"textarea\",\n  \"a[href]\",\n  \"label\",\n  \"details\",\n  \"summary\",\n  // ARIA roles (most common)\n  \"[role='button']\",\n  \"[role='checkbox']\",\n  \"[role='radio']\",\n  \"[role='switch']\",\n  \"[role='link']\",\n  \"[role='tab']\",\n  \"[role='slider']\",\n  \"[role='combobox']\",\n  \"[role='listbox']\",\n  \"[role='textbox']\",\n  \"[role='menuitem']\",\n  \"[role='option']\",\n  // Custom markers\n  \"[data-interactive]\",\n  \"[data-interactive-wrapper]\",\n  \"[data-checkbox]\",\n  \"[data-no-select]\",\n  // Elements that look interactive\n  \"[contenteditable='true']\",\n  \"[tabindex]:not([tabindex='-1'])\",\n  // Clickable elements\n  \"[onclick]\",\n  \"[draggable='true']\",\n].join(\", \");\n\n/**\n * Determines if an element is interactive (button, checkbox, input, link, etc.)\n * Used to give priority to interactive elements over selection.\n *\n * When a user clicks on an interactive element inside a selectable item,\n * the native interaction should happen WITHOUT triggering selection.\n *\n * @param target - The element to check\n * @returns true if the element or any ancestor is interactive\n */\nexport function isInteractiveElement(target: HTMLElement): boolean {\n  // Fast path: check tag\n  const tagName = target.tagName.toLowerCase();\n  if (NATIVE_INTERACTIVE_TAGS.has(tagName)) {\n    return true;\n  }\n\n  // Check ARIA role\n  const role = target.getAttribute(\"role\")?.toLowerCase();\n  if (role && INTERACTIVE_ARIA_ROLES.has(role)) {\n    return true;\n  }\n\n  // Check if contenteditable\n  if (target.isContentEditable) {\n    return true;\n  }\n\n  // Check custom data attributes\n  if (\n    target.hasAttribute(\"data-interactive\") ||\n    target.hasAttribute(\"data-interactive-wrapper\") ||\n    target.hasAttribute(\"data-checkbox\") ||\n    target.hasAttribute(\"data-no-select\")\n  ) {\n    return true;\n  }\n\n  // Check if element has explicit click handler (React synthetic events don't show in DOM)\n  if (target.hasAttribute(\"onclick\")) {\n    return true;\n  }\n\n  // Check for draggable elements\n  if (target.getAttribute(\"draggable\") === \"true\") {\n    return true;\n  }\n\n  // Check for focusable elements with positive tabindex\n  const tabindex = target.getAttribute(\"tabindex\");\n  if (tabindex !== null && tabindex !== \"-1\") {\n    // Only consider it interactive if it looks like a control\n    const computedStyle = window.getComputedStyle(target);\n    if (computedStyle.cursor === \"pointer\") {\n      return true;\n    }\n  }\n\n  // Check if inside an interactive parent (for nested elements like icon inside button)\n  // This is crucial for icon buttons and complex interactive components\n  const interactiveParent = target.closest(INTERACTIVE_SELECTOR);\n\n  return interactiveParent !== null;\n}\n\n/**\n * Quick check if element should never trigger selection\n * Used for elements like resize handles, scrollbars, etc.\n */\nexport function shouldNeverSelect(target: HTMLElement): boolean {\n  // Resize handles\n  if (\n    target.hasAttribute(\"data-resize-handle\") ||\n    target.closest(\"[data-resize-handle]\")\n  ) {\n    return true;\n  }\n\n  // Scrollbars and similar\n  if (\n    target.hasAttribute(\"data-no-select\") ||\n    target.closest(\"[data-no-select]\")\n  ) {\n    return true;\n  }\n\n  // Canvas and SVG interactions\n  if (target.tagName === \"CANVAS\" || target.closest(\"canvas\")) {\n    return true;\n  }\n\n  return false;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Selection Interaction Detection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Determines if a click/interaction is related to selection UI (not a business action).\n * Selection interactions should NOT trigger proactive AI.\n *\n * Business actions (toggle, input, submit) → Track for proactive AI\n * Selection actions (select item, deselect) → Do NOT track\n *\n * IMPORTANT: Interactive elements inside selectable-items are BUSINESS ACTIONS.\n * Example: clicking a checkbox inside a todo item is a \"toggle\" action, not selection.\n *\n * @param target - The clicked element\n * @param isDeepSelectionActive - Optional callback to check if deep selection is active (from context)\n */\nexport function isSelectionInteraction(\n  target: HTMLElement,\n  isDeepSelectionActive?: () => boolean,\n): boolean {\n  // Skip if deep selection just activated (check via callback if provided)\n  if (isDeepSelectionActive?.()) {\n    return true;\n  }\n\n  // CRITICAL: Interactive elements are NEVER selection interactions\n  // Even if they're inside a selectable-item, the user is performing a business action\n  // (e.g., toggling a checkbox, typing in an input, clicking a button)\n  if (isInteractiveElement(target)) {\n    return false;\n  }\n\n  // Skip if clicking on selectable items (selection/deselection actions)\n  // This only applies to clicks on NON-interactive parts of the item\n  if (target.closest(\"[data-selectable-item]\")) {\n    return true;\n  }\n\n  // Skip if clicking on already selected elements (deselection)\n  if (target.closest(\".jsonui-deep-selected, .jsonui-item-selected\")) {\n    return true;\n  }\n\n  // Skip if clicking on selection-related UI (selection toolbar, etc.)\n  if (target.closest(\"[data-selection-ui]\")) {\n    return true;\n  }\n\n  return false;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Utility Exports\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Get the interactive element that was clicked (if any)\n * Useful for determining what type of interaction occurred\n */\nexport function getInteractiveElement(target: HTMLElement): HTMLElement | null {\n  if (isInteractiveElement(target)) {\n    // Return the actual interactive element (might be parent)\n    return target.closest(INTERACTIVE_SELECTOR) as HTMLElement | null;\n  }\n  return null;\n}\n","/**\n * Edit Mode Context\n *\n * Provides global edit mode state for inline editing of UI components.\n * When edit mode is enabled, text props become editable via contentEditable.\n *\n * Features:\n * - Auto-save with debounce\n * - Undo/Redo support\n * - Change history tracking\n * - Keyboard shortcuts (Escape to cancel)\n */\n\n\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  useMemo,\n  useRef,\n  useEffect,\n  type ReactNode,\n} from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface SinglePropChange {\n  elementKey: string;\n  propName: string;\n  oldValue: unknown;\n  newValue: unknown;\n}\n\nexport interface ElementChange {\n  key: string;\n  props: Record<string, unknown>;\n  /** Previous values before the change (for undo) */\n  previousProps?: Record<string, unknown>;\n  /** Timestamp of the change */\n  timestamp: number;\n}\n\nexport interface ChangeHistoryItem {\n  changes: SinglePropChange[];\n  timestamp: number;\n}\n\nexport interface EditModeContextValue {\n  /** Whether edit mode is active */\n  isEditing: boolean;\n  /** Enable edit mode */\n  enableEditing: () => void;\n  /** Disable edit mode */\n  disableEditing: () => void;\n  /** Toggle edit mode */\n  toggleEditing: () => void;\n  /** Currently focused element key (for highlighting) */\n  focusedKey: string | null;\n  /** Set focused element */\n  setFocusedKey: (key: string | null) => void;\n  /** Track pending changes before commit */\n  pendingChanges: Map<string, Record<string, unknown>>;\n  /** Record a pending change */\n  recordChange: (\n    elementKey: string,\n    propName: string,\n    newValue: unknown,\n    previousValue?: unknown,\n  ) => void;\n  /** Commit all pending changes (or auto-committed) */\n  commitChanges: () => void;\n  /** Discard all pending changes */\n  discardChanges: () => void;\n  /** Undo last change */\n  undo: () => void;\n  /** Redo last undone change */\n  redo: () => void;\n  /** Whether undo is available */\n  canUndo: boolean;\n  /** Whether redo is available */\n  canRedo: boolean;\n  /** Change history for diff view */\n  history: ChangeHistoryItem[];\n  /** Number of pending changes */\n  pendingCount: number;\n  /** Callback when changes are committed */\n  onCommit?: (changes: Array<ElementChange>) => void;\n}\n\nexport interface EditModeProviderProps {\n  children: ReactNode;\n  /** Initial edit mode state */\n  initialEditing?: boolean;\n  /** Callback when changes are committed */\n  onCommit?: (changes: Array<ElementChange>) => void;\n  /** Auto-save delay in ms (0 to disable, default 1500) */\n  autoSaveDelay?: number;\n  /** Max history items to keep */\n  maxHistoryItems?: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst EditModeContext = createContext<EditModeContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function EditModeProvider({\n  children,\n  initialEditing = false,\n  onCommit,\n  autoSaveDelay = 1500,\n  maxHistoryItems = 50,\n}: EditModeProviderProps) {\n  const [isEditing, setIsEditing] = useState(initialEditing);\n  const [focusedKey, setFocusedKey] = useState<string | null>(null);\n  const [pendingChanges, setPendingChanges] = useState<\n    Map<string, Record<string, unknown>>\n  >(new Map());\n  const [previousValues, setPreviousValues] = useState<\n    Map<string, Record<string, unknown>>\n  >(new Map());\n\n  // History for undo/redo\n  const [history, setHistory] = useState<ChangeHistoryItem[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  // Auto-save debounce timer\n  const autoSaveTimerRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Cleanup timer on unmount\n  useEffect(() => {\n    return () => {\n      if (autoSaveTimerRef.current) {\n        clearTimeout(autoSaveTimerRef.current);\n      }\n    };\n  }, []);\n\n  const enableEditing = useCallback(() => setIsEditing(true), []);\n\n  const disableEditing = useCallback(() => {\n    setIsEditing(false);\n    setFocusedKey(null);\n    // Commit any pending changes when disabling\n    if (pendingChanges.size > 0) {\n      // This will be handled by commitChanges\n    }\n  }, [pendingChanges.size]);\n\n  const toggleEditing = useCallback(() => setIsEditing((prev) => !prev), []);\n\n  const recordChange = useCallback(\n    (\n      elementKey: string,\n      propName: string,\n      newValue: unknown,\n      previousValue?: unknown,\n    ) => {\n      setPendingChanges((prev) => {\n        const next = new Map(prev);\n        const existing = next.get(elementKey) || {};\n        next.set(elementKey, { ...existing, [propName]: newValue });\n        return next;\n      });\n\n      // Track previous value for undo\n      if (previousValue !== undefined) {\n        setPreviousValues((prev) => {\n          const next = new Map(prev);\n          const existing = next.get(elementKey) || {};\n          // Only store the first previous value (before any edits in this session)\n          if (!(propName in existing)) {\n            next.set(elementKey, { ...existing, [propName]: previousValue });\n          }\n          return next;\n        });\n      }\n\n      // Reset auto-save timer\n      if (autoSaveDelay > 0) {\n        if (autoSaveTimerRef.current) {\n          clearTimeout(autoSaveTimerRef.current);\n        }\n        autoSaveTimerRef.current = setTimeout(() => {\n          // Auto-commit will be triggered here\n          commitChangesRef.current?.();\n        }, autoSaveDelay);\n      }\n    },\n    [autoSaveDelay],\n  );\n\n  // Use ref for commitChanges to avoid circular dependency\n  const commitChangesRef = useRef<(() => void) | undefined>(undefined);\n\n  const commitChanges = useCallback(() => {\n    if (pendingChanges.size === 0) return;\n\n    const propChanges: SinglePropChange[] = [];\n    const elementChanges: ElementChange[] = [];\n    const now = Date.now();\n\n    pendingChanges.forEach((props, key) => {\n      const prevProps = previousValues.get(key) || {};\n      \n      // Convert to individual prop changes for history display\n      for (const [propName, newValue] of Object.entries(props)) {\n        propChanges.push({\n          elementKey: key,\n          propName,\n          oldValue: prevProps[propName],\n          newValue,\n        });\n      }\n      \n      // Keep element changes for onCommit callback\n      elementChanges.push({\n        key,\n        props,\n        previousProps: prevProps,\n        timestamp: now,\n      });\n    });\n\n    // Add to history with SinglePropChange format\n    setHistory((prev) => {\n      const newHistory = prev.slice(0, historyIndex + 1);\n      newHistory.push({ changes: propChanges, timestamp: now });\n      // Limit history size\n      if (newHistory.length > maxHistoryItems) {\n        return newHistory.slice(-maxHistoryItems);\n      }\n      return newHistory;\n    });\n    setHistoryIndex((prev) => prev + 1);\n\n    if (onCommit) {\n      onCommit(elementChanges);\n    }\n\n    // Clear pending changes and previous values\n    setPendingChanges(new Map());\n    setPreviousValues(new Map());\n\n    // Clear auto-save timer\n    if (autoSaveTimerRef.current) {\n      clearTimeout(autoSaveTimerRef.current);\n      autoSaveTimerRef.current = null;\n    }\n  }, [pendingChanges, previousValues, historyIndex, maxHistoryItems, onCommit]);\n\n  // Keep ref updated\n  commitChangesRef.current = commitChanges;\n\n  const discardChanges = useCallback(() => {\n    setPendingChanges(new Map());\n    setPreviousValues(new Map());\n    if (autoSaveTimerRef.current) {\n      clearTimeout(autoSaveTimerRef.current);\n      autoSaveTimerRef.current = null;\n    }\n  }, []);\n\n  const undo = useCallback(() => {\n    if (historyIndex < 0) return;\n\n    const item = history[historyIndex];\n    if (!item) return;\n\n    // Reconstruct ElementChange[] from SinglePropChange[] for onCommit\n    const elementMap = new Map<string, { props: Record<string, unknown>; previousProps: Record<string, unknown> }>();\n    \n    for (const change of item.changes) {\n      const existing = elementMap.get(change.elementKey) || { props: {}, previousProps: {} };\n      // Undo: swap old/new - new becomes \"what to restore\", old becomes \"what was there\"\n      existing.props[change.propName] = change.oldValue;\n      existing.previousProps[change.propName] = change.newValue;\n      elementMap.set(change.elementKey, existing);\n    }\n\n    const undoChanges: ElementChange[] = Array.from(elementMap.entries()).map(([key, data]) => ({\n      key,\n      props: data.props,\n      previousProps: data.previousProps,\n      timestamp: Date.now(),\n    }));\n\n    if (onCommit) {\n      onCommit(undoChanges);\n    }\n\n    setHistoryIndex((prev) => prev - 1);\n  }, [history, historyIndex, onCommit]);\n\n  const redo = useCallback(() => {\n    if (historyIndex >= history.length - 1) return;\n\n    const item = history[historyIndex + 1];\n    if (!item) return;\n\n    // Reconstruct ElementChange[] from SinglePropChange[] for onCommit\n    const elementMap = new Map<string, { props: Record<string, unknown>; previousProps: Record<string, unknown> }>();\n    \n    for (const change of item.changes) {\n      const existing = elementMap.get(change.elementKey) || { props: {}, previousProps: {} };\n      // Redo: apply the new values again\n      existing.props[change.propName] = change.newValue;\n      existing.previousProps[change.propName] = change.oldValue;\n      elementMap.set(change.elementKey, existing);\n    }\n\n    const redoChanges: ElementChange[] = Array.from(elementMap.entries()).map(([key, data]) => ({\n      key,\n      props: data.props,\n      previousProps: data.previousProps,\n      timestamp: Date.now(),\n    }));\n\n    if (onCommit) {\n      onCommit(redoChanges);\n    }\n\n    setHistoryIndex((prev) => prev + 1);\n  }, [history, historyIndex, onCommit]);\n\n  const canUndo = historyIndex >= 0;\n  const canRedo = historyIndex < history.length - 1;\n  const pendingCount = pendingChanges.size;\n\n  const value = useMemo(\n    (): EditModeContextValue => ({\n      isEditing,\n      enableEditing,\n      disableEditing,\n      toggleEditing,\n      focusedKey,\n      setFocusedKey,\n      pendingChanges,\n      recordChange,\n      commitChanges,\n      discardChanges,\n      undo,\n      redo,\n      canUndo,\n      canRedo,\n      history,\n      pendingCount,\n      onCommit,\n    }),\n    [\n      isEditing,\n      enableEditing,\n      disableEditing,\n      toggleEditing,\n      focusedKey,\n      setFocusedKey,\n      pendingChanges,\n      recordChange,\n      commitChanges,\n      discardChanges,\n      undo,\n      redo,\n      canUndo,\n      canRedo,\n      history,\n      pendingCount,\n      onCommit,\n    ],\n  );\n\n  return (\n    <EditModeContext.Provider value={value}>\n      {children}\n    </EditModeContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function useEditMode(): EditModeContextValue {\n  const context = useContext(EditModeContext);\n  if (!context) {\n    // Return a no-op context when used outside provider\n    return {\n      isEditing: false,\n      enableEditing: () => {},\n      disableEditing: () => {},\n      toggleEditing: () => {},\n      focusedKey: null,\n      setFocusedKey: () => {},\n      pendingChanges: new Map(),\n      recordChange: () => {},\n      commitChanges: () => {},\n      discardChanges: () => {},\n      undo: () => {},\n      redo: () => {},\n      canUndo: false,\n      canRedo: false,\n      history: [],\n      pendingCount: 0,\n    };\n  }\n  return context;\n}\n\n/**\n * Hook to check if a specific element is being edited\n */\nexport function useIsElementEditing(elementKey: string): boolean {\n  const { isEditing, focusedKey } = useEditMode();\n  return isEditing && focusedKey === elementKey;\n}\n\n/**\n * Hook for element-specific edit functionality\n */\nexport function useElementEdit(elementKey: string) {\n  const { isEditing, recordChange, focusedKey, setFocusedKey } = useEditMode();\n\n  const handleChange = useCallback(\n    (propName: string, newValue: unknown) => {\n      recordChange(elementKey, propName, newValue);\n    },\n    [elementKey, recordChange],\n  );\n\n  const handleFocus = useCallback(() => {\n    setFocusedKey(elementKey);\n  }, [elementKey, setFocusedKey]);\n\n  const handleBlur = useCallback(() => {\n    // Only clear focus if this element is focused\n    // (to prevent race conditions)\n  }, []);\n\n  return {\n    isEditing,\n    isFocused: focusedKey === elementKey,\n    handleChange,\n    handleFocus,\n    handleBlur,\n  };\n}\n","\"use client\";\n\nimport { useContext, useCallback, useMemo } from \"react\";\nimport { SelectionContext } from \"./context\";\nimport type { SelectionContextValue } from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to access granular selection functionality.\n * Must be used within a SelectionProvider.\n */\nexport function useSelection(): SelectionContextValue {\n  const context = useContext(SelectionContext);\n  if (context === undefined) {\n    throw new Error(\"useSelection must be used within a SelectionProvider\");\n  }\n  return context;\n}\n\n/**\n * Simplified hook for components that only need to check selection state.\n * Returns helpers scoped to a specific element.\n */\nexport function useItemSelection(elementKey: string) {\n  const { isSelected, getSelectedItems, granularSelection } = useSelection();\n\n  const isItemSelected = useCallback(\n    (itemId: string) => isSelected(elementKey, itemId),\n    [elementKey, isSelected],\n  );\n\n  const selectedItems = useMemo(\n    () => getSelectedItems(elementKey),\n    [elementKey, getSelectedItems],\n  );\n\n  const hasSelection = useMemo(\n    () => (granularSelection[elementKey]?.size ?? 0) > 0,\n    [elementKey, granularSelection],\n  );\n\n  return {\n    isItemSelected,\n    selectedItems,\n    hasSelection,\n  };\n}\n","/**\n * useDomTracking - DOM tracking and event coordination\n * Handles DOM element references and visual feedback\n */\n\nimport { useCallback } from \"react\";\nimport type { DeepSelectionInput } from \"./types\";\nimport { getUniqueCSSPath } from \"./utils\";\n\nexport interface UseDomTrackingReturn {\n  /** Apply visual selection to an element */\n  applyVisualSelection: (\n    element: HTMLElement,\n    isItemSelection?: boolean,\n  ) => void;\n  /** Remove visual selection from an element */\n  removeVisualSelection: (element: HTMLElement) => void;\n  /** Clear all visual selections from DOM */\n  clearAllVisualSelections: (selectedElementsRef: Set<HTMLElement>) => void;\n  /** Create selection input from a DOM element (id/timestamp added by store) */\n  createSelectionInput: (\n    element: HTMLElement,\n    componentWrapper: HTMLElement,\n    selectionType: \"granular\" | \"item\",\n  ) => DeepSelectionInput;\n  /** Trigger haptic feedback if available */\n  triggerHaptic: () => void;\n}\n\n/**\n * Hook for DOM tracking and visual feedback management\n */\nexport function useDomTracking(): UseDomTrackingReturn {\n  const applyVisualSelection = useCallback(\n    (element: HTMLElement, isItemSelection = false) => {\n      element.classList.add(\"jsonui-deep-selected\");\n      if (isItemSelection) {\n        element.classList.add(\"jsonui-item-selected\");\n      }\n      element.setAttribute(\"aria-selected\", \"true\");\n    },\n    [],\n  );\n\n  const removeVisualSelection = useCallback((element: HTMLElement) => {\n    element.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n    element.removeAttribute(\"aria-selected\");\n  }, []);\n\n  const clearAllVisualSelections = useCallback(\n    (selectedElementsRef: Set<HTMLElement>) => {\n      // Clear from ref\n      selectedElementsRef.forEach((el) => {\n        el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n        el.removeAttribute(\"aria-selected\");\n      });\n      selectedElementsRef.clear();\n\n      // Also query DOM directly in case elements were re-rendered\n      if (typeof document !== \"undefined\") {\n        document\n          .querySelectorAll(\".jsonui-deep-selected, .jsonui-item-selected\")\n          .forEach((el) => {\n            el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n            el.removeAttribute(\"aria-selected\");\n          });\n      }\n    },\n    [],\n  );\n\n  const createSelectionInput = useCallback(\n    (\n      element: HTMLElement,\n      componentWrapper: HTMLElement,\n      selectionType: \"granular\" | \"item\",\n    ): DeepSelectionInput => {\n      const elementKey =\n        componentWrapper.getAttribute(\"data-jsonui-element-key\") || \"\";\n      const cssPath = getUniqueCSSPath(element, componentWrapper);\n      const textContent = (element.textContent || \"\").trim().substring(0, 200);\n\n      // Find containing selectable-item (if any)\n      const selectableItem = element.closest(\n        \"[data-selectable-item]\",\n      ) as HTMLElement | null;\n      const itemId = selectableItem?.getAttribute(\"data-item-id\") || undefined;\n\n      return {\n        elementKey,\n        cssPath,\n        tagName: element.tagName.toLowerCase(),\n        textContent,\n        element,\n        selectionType,\n        itemId,\n      };\n    },\n    [],\n  );\n\n  const triggerHaptic = useCallback(() => {\n    if (typeof navigator !== \"undefined\" && navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n  }, []);\n\n  return {\n    applyVisualSelection,\n    removeVisualSelection,\n    clearAllVisualSelections,\n    createSelectionInput,\n    triggerHaptic,\n  };\n}\n","\"use client\";\n\nimport type { SelectableItemProps } from \"./types\";\nimport { useSelection } from \"./hooks\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// SelectableItem Component - Core wrapper for granular selection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Core wrapper component for making items selectable.\n *\n * This is the recommended way to implement granular selection in components.\n * It automatically handles:\n * - Selection state tracking\n * - Visual feedback (via CSS)\n * - Event delegation integration\n *\n * @example\n * ```tsx\n * import { SelectableItem } from \"@onegenui/react\";\n *\n * // Inside your component:\n * {items.map(item => (\n *   <SelectableItem\n *     key={item.id}\n *     elementKey={element.key}\n *     itemId={item.id}\n *     style={{ padding: 16 }}\n *   >\n *     {item.content}\n *   </SelectableItem>\n * ))}\n * ```\n */\nexport function SelectableItem({\n  elementKey,\n  itemId,\n  children,\n  as: Component = \"div\",\n  className,\n  style,\n  ...rest\n}: SelectableItemProps) {\n  const { isSelected } = useSelection();\n  const selected = isSelected(elementKey, itemId);\n\n  // Filter out our known props from rest to avoid passing them to DOM\n  const {\n    elementKey: _ek,\n    itemId: _id,\n    as: _as,\n    ...domProps\n  } = rest as Record<string, unknown>;\n\n  return (\n    <Component\n      data-selectable-item=\"true\"\n      data-element-key={elementKey}\n      data-item-id={itemId}\n      data-selected={selected ? \"true\" : undefined}\n      className={className}\n      style={style}\n      {...domProps}\n    >\n      {children}\n    </Component>\n  );\n}\n","import type { ReactNode, CSSProperties } from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface MarkdownTheme {\n  /** Code block background color */\n  codeBlockBg: string;\n  /** Code block border color */\n  codeBlockBorder: string;\n  /** Inline code background color */\n  inlineCodeBg: string;\n  /** Link color */\n  linkColor: string;\n  /** Blockquote border color */\n  blockquoteBorder: string;\n  /** Horizontal rule color */\n  hrColor: string;\n}\n\nexport interface MarkdownContextValue {\n  /** Whether markdown rendering is enabled globally */\n  enabled: boolean;\n  /** The theme for markdown rendering */\n  theme: MarkdownTheme;\n  /** Render text with markdown support */\n  renderText: (\n    content: string | null | undefined,\n    options?: RenderTextOptions,\n  ) => ReactNode;\n}\n\nexport interface RenderTextOptions {\n  /** Whether to render inline (no block elements like paragraphs) */\n  inline?: boolean;\n  /** Additional className */\n  className?: string;\n  /** Additional style */\n  style?: CSSProperties;\n}\n\nexport interface MarkdownProviderProps {\n  children: ReactNode;\n  /** Whether markdown rendering is enabled (default: true) */\n  enabled?: boolean;\n  /** Custom theme overrides */\n  theme?: Partial<MarkdownTheme>;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Default Theme\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const defaultTheme: MarkdownTheme = {\n  codeBlockBg: \"rgba(0, 0, 0, 0.3)\",\n  codeBlockBorder: \"rgba(255, 255, 255, 0.08)\",\n  inlineCodeBg: \"rgba(0, 0, 0, 0.25)\",\n  linkColor: \"var(--primary, #3b82f6)\",\n  blockquoteBorder: \"var(--primary, #3b82f6)\",\n  hrColor: \"rgba(255, 255, 255, 0.1)\",\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Styles Factory\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createStyles = (theme: MarkdownTheme) => ({\n  codeBlock: {\n    backgroundColor: theme.codeBlockBg,\n    borderRadius: 8,\n    padding: \"12px 16px\",\n    overflowX: \"auto\" as const,\n    fontSize: 13,\n    fontFamily:\n      \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace\",\n    border: `1px solid ${theme.codeBlockBorder}`,\n    margin: \"8px 0\",\n  },\n  inlineCode: {\n    backgroundColor: theme.inlineCodeBg,\n    borderRadius: 4,\n    padding: \"2px 6px\",\n    fontSize: \"0.9em\",\n    fontFamily:\n      \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace\",\n  },\n  link: {\n    color: theme.linkColor,\n    textDecoration: \"underline\" as const,\n    textUnderlineOffset: 2,\n  },\n  list: {\n    margin: \"8px 0\",\n    paddingLeft: 20,\n    listStylePosition: \"outside\" as const,\n  },\n  listItem: {\n    marginBottom: 4,\n  },\n  headingBase: {\n    fontWeight: 600,\n    marginTop: 12,\n    marginBottom: 8,\n  },\n  paragraph: {\n    margin: \"6px 0\",\n    lineHeight: 1.6,\n  },\n  blockquote: {\n    borderLeft: `3px solid ${theme.blockquoteBorder}`,\n    paddingLeft: 12,\n    margin: \"8px 0\",\n    opacity: 0.9,\n    fontStyle: \"italic\" as const,\n  },\n  hr: {\n    border: \"none\",\n    borderTop: `1px solid ${theme.hrColor}`,\n    margin: \"12px 0\",\n  },\n});\n","\"use client\";\n\nimport React, { useMemo, type ReactNode, type CSSProperties } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport type { MarkdownTheme } from \"./types\";\nimport { createStyles } from \"./types\";\nimport { useCitations } from \"../citation\";\nimport { InlineCitation } from \"../citation/inline-citation\";\n\ninterface InternalMarkdownProps {\n  content: string;\n  inline: boolean;\n  theme: MarkdownTheme;\n  className?: string;\n  style?: CSSProperties;\n}\n\nimport type { Citation } from \"../citation\";\n\n/**\n * Parse text content and replace [N] markers with citation components\n */\nfunction parseCitationMarkers(\n  text: string,\n  getCitation: (id: string) => Citation | undefined,\n): ReactNode[] {\n  const parts = text.split(/(\\[\\d+\\])/g);\n  return parts.map((part, idx) => {\n    const match = part.match(/\\[(\\d+)\\]/);\n    if (match) {\n      const id = match[1]!;\n      const citation = getCitation(id);\n      return <InlineCitation key={`cite-${idx}`} id={id} citation={citation} />;\n    }\n    return part;\n  });\n}\n\nexport function InternalMarkdown({\n  content,\n  inline,\n  theme,\n  className,\n  style,\n}: InternalMarkdownProps) {\n  const styles = useMemo(() => createStyles(theme), [theme]);\n  const { getCitation, citations } = useCitations();\n\n  // Memoize citation parsing capability\n  const hasCitations = citations.length > 0;\n\n  const components = useMemo(\n    () => ({\n      // Images - responsive with high quality\n      img: (props: React.ImgHTMLAttributes<HTMLImageElement>) => (\n        <img\n          {...props}\n          loading=\"lazy\"\n          style={{\n            maxWidth: \"100%\",\n            height: \"auto\",\n            borderRadius: 8,\n            marginTop: 8,\n            marginBottom: 8,\n            objectFit: \"contain\",\n            backgroundColor: \"rgba(0,0,0,0.1)\",\n          }}\n        />\n      ),\n      // Videos - native player with controls\n      video: (props: React.VideoHTMLAttributes<HTMLVideoElement>) => (\n        <video\n          {...props}\n          controls\n          preload=\"metadata\"\n          style={{\n            maxWidth: \"100%\",\n            height: \"auto\",\n            borderRadius: 8,\n            marginTop: 8,\n            marginBottom: 8,\n            backgroundColor: \"#000\",\n          }}\n        />\n      ),\n      // Code blocks\n      pre: ({ children }: { children?: ReactNode }) => (\n        <pre style={styles.codeBlock}>{children}</pre>\n      ),\n      code: ({\n        children,\n        className: codeClassName,\n      }: {\n        children?: ReactNode;\n        className?: string;\n      }) => {\n        const isInline = !codeClassName;\n        if (isInline) {\n          return <code style={styles.inlineCode}>{children}</code>;\n        }\n        return <code>{children}</code>;\n      },\n      // Links\n      a: ({ href, children }: { href?: string; children?: ReactNode }) => (\n        <a\n          href={href}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          style={styles.link}\n        >\n          {children}\n        </a>\n      ),\n      // Lists\n      ul: ({ children }: { children?: ReactNode }) => (\n        <ul style={styles.list}>{children}</ul>\n      ),\n      ol: ({ children }: { children?: ReactNode }) => (\n        <ol\n          style={{\n            ...styles.list,\n            listStyleType: \"decimal\",\n            paddingLeft: 24,\n          }}\n        >\n          {children}\n        </ol>\n      ),\n      li: ({ children }: { children?: ReactNode }) => (\n        <li style={styles.listItem}>{children}</li>\n      ),\n      // Headings\n      h1: ({ children }: { children?: ReactNode }) => (\n        <h1 style={{ ...styles.headingBase, fontSize: 18 }}>{children}</h1>\n      ),\n      h2: ({ children }: { children?: ReactNode }) => (\n        <h2 style={{ ...styles.headingBase, fontSize: 16 }}>{children}</h2>\n      ),\n      h3: ({ children }: { children?: ReactNode }) => (\n        <h3 style={{ ...styles.headingBase, fontSize: 15 }}>{children}</h3>\n      ),\n      h4: ({ children }: { children?: ReactNode }) => (\n        <h4 style={{ ...styles.headingBase, fontSize: 14 }}>{children}</h4>\n      ),\n      h5: ({ children }: { children?: ReactNode }) => (\n        <h5 style={{ ...styles.headingBase, fontSize: 13 }}>{children}</h5>\n      ),\n      h6: ({ children }: { children?: ReactNode }) => (\n        <h6 style={{ ...styles.headingBase, fontSize: 12 }}>{children}</h6>\n      ),\n      // Paragraphs - with citation parsing\n      p: ({ children }: { children?: ReactNode }) => {\n        // Parse citations in text nodes\n        const processedChildren = hasCitations\n          ? React.Children.map(children, (child) => {\n              if (typeof child === \"string\") {\n                return parseCitationMarkers(child, getCitation);\n              }\n              return child;\n            })\n          : children;\n\n        return inline ? (\n          <span>{processedChildren}</span>\n        ) : (\n          <p style={styles.paragraph}>{processedChildren}</p>\n        );\n      },\n      // Blockquotes\n      blockquote: ({ children }: { children?: ReactNode }) => (\n        <blockquote style={styles.blockquote}>{children}</blockquote>\n      ),\n      // Horizontal rules\n      hr: () => <hr style={styles.hr} />,\n      // Strong/Bold - with citation parsing\n      strong: ({ children }: { children?: ReactNode }) => {\n        const processedChildren = hasCitations\n          ? React.Children.map(children, (child) => {\n              if (typeof child === \"string\") {\n                return parseCitationMarkers(child, getCitation);\n              }\n              return child;\n            })\n          : children;\n        return <strong style={{ fontWeight: 600 }}>{processedChildren}</strong>;\n      },\n      // Emphasis/Italic - with citation parsing\n      em: ({ children }: { children?: ReactNode }) => {\n        const processedChildren = hasCitations\n          ? React.Children.map(children, (child) => {\n              if (typeof child === \"string\") {\n                return parseCitationMarkers(child, getCitation);\n              }\n              return child;\n            })\n          : children;\n        return <em style={{ fontStyle: \"italic\" }}>{processedChildren}</em>;\n      },\n    }),\n    [styles, inline, hasCitations, getCitation],\n  );\n\n  const Wrapper = inline ? \"span\" : \"div\";\n\n  return (\n    <Wrapper className={className} style={style}>\n      <ReactMarkdown components={components}>{content}</ReactMarkdown>\n    </Wrapper>\n  );\n}\n","\"use client\";\n\nimport {\n  createContext,\n  useContext,\n  useMemo,\n  type ReactNode,\n  useState,\n  useCallback,\n  useEffect,\n} from \"react\";\nimport { createElement } from \"react\";\n\n/**\n * Citation data structure - supports both web and document citations\n */\nexport interface Citation {\n  id: string;\n  title: string;\n  // Web source fields\n  url?: string | null;\n  domain?: string | null;\n  // Document source fields\n  pageNumber?: number | null;\n  excerpt?: string | null;\n  documentTitle?: string | null;\n  // Common\n  snippet?: string | null;\n}\n\ninterface CitationContextValue {\n  citations: Citation[];\n  setCitations: (citations: Citation[]) => void;\n  addCitation: (citation: Citation) => void;\n  clearCitations: () => void;\n  getCitation: (id: string) => Citation | undefined;\n}\n\nconst CitationContext = createContext<CitationContextValue | null>(null);\n\n/**\n * Provider for citation data that can be displayed inline in markdown.\n */\nexport function CitationProvider({ children }: { children: ReactNode }) {\n  const [citations, setCitationsState] = useState<Citation[]>([]);\n\n  const setCitations = useCallback((newCitations: Citation[]) => {\n    setCitationsState(newCitations);\n  }, []);\n\n  const addCitation = useCallback((citation: Citation) => {\n    setCitationsState((prev) => {\n      // Avoid duplicates\n      if (prev.some((c) => c.id === citation.id)) return prev;\n      return [...prev, citation];\n    });\n  }, []);\n\n  const clearCitations = useCallback(() => {\n    setCitationsState([]);\n  }, []);\n\n  const getCitation = useCallback(\n    (id: string) => citations.find((c) => c.id === id),\n    [citations],\n  );\n\n  // Listen for citations events from useUIStream\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const handleCitations = (event: CustomEvent<{ citations: Citation[] }>) => {\n      const newCitations = event.detail?.citations;\n      if (newCitations && Array.isArray(newCitations)) {\n        setCitationsState(newCitations);\n      }\n    };\n\n    window.addEventListener(\n      \"onegenui:citations\",\n      handleCitations as EventListener,\n    );\n    return () => {\n      window.removeEventListener(\n        \"onegenui:citations\",\n        handleCitations as EventListener,\n      );\n    };\n  }, []);\n\n  const value = useMemo(\n    () => ({\n      citations,\n      setCitations,\n      addCitation,\n      clearCitations,\n      getCitation,\n    }),\n    [citations, setCitations, addCitation, clearCitations, getCitation],\n  );\n\n  return createElement(CitationContext.Provider, { value }, children);\n}\n\n/**\n * Hook to access citation context\n */\nexport function useCitations(): CitationContextValue {\n  const context = useContext(CitationContext);\n  if (!context) {\n    // Fallback for when no provider is present\n    return {\n      citations: [],\n      setCitations: () => {},\n      addCitation: () => {},\n      clearCitations: () => {},\n      getCitation: () => undefined,\n    };\n  }\n  return context;\n}\n\nexport { CitationContext };\n","\"use client\";\n\nimport { memo, useState, useRef, useEffect, useCallback } from \"react\";\nimport type { Citation } from \"./index\";\n\ninterface InlineCitationProps {\n  id: string;\n  citation?: Citation;\n}\n\n/**\n * Inline citation badge with popover for showing source details\n */\nexport const InlineCitation = memo(function InlineCitation({\n  id,\n  citation,\n}: InlineCitationProps) {\n  const [showPopover, setShowPopover] = useState(false);\n  const [popoverPosition, setPopoverPosition] = useState<\"top\" | \"bottom\">(\n    \"bottom\",\n  );\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  // Calculate popover position based on viewport\n  const updatePosition = useCallback(() => {\n    if (!buttonRef.current) return;\n    const rect = buttonRef.current.getBoundingClientRect();\n    const spaceBelow = window.innerHeight - rect.bottom;\n    setPopoverPosition(spaceBelow < 200 ? \"top\" : \"bottom\");\n  }, []);\n\n  // Close on outside click\n  useEffect(() => {\n    if (!showPopover) return;\n    const handleClick = (e: MouseEvent) => {\n      if (\n        popoverRef.current &&\n        !popoverRef.current.contains(e.target as Node) &&\n        buttonRef.current &&\n        !buttonRef.current.contains(e.target as Node)\n      ) {\n        setShowPopover(false);\n      }\n    };\n    document.addEventListener(\"click\", handleClick);\n    return () => document.removeEventListener(\"click\", handleClick);\n  }, [showPopover]);\n\n  if (!citation) {\n    // No citation data - render plain marker\n    return (\n      <span\n        style={{\n          display: \"inline-flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          minWidth: 16,\n          height: 16,\n          padding: \"0 4px\",\n          fontSize: 10,\n          fontWeight: 500,\n          backgroundColor: \"rgba(59, 130, 246, 0.2)\",\n          color: \"rgb(59, 130, 246)\",\n          borderRadius: 4,\n          marginLeft: 2,\n        }}\n      >\n        {id}\n      </span>\n    );\n  }\n\n  const isWebSource = !!citation.url;\n  const hasExcerpt = !!(citation.excerpt || citation.snippet);\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (isWebSource && !hasExcerpt) {\n      // Web source without excerpt - open URL\n      window.open(citation.url!, \"_blank\", \"noopener,noreferrer\");\n    } else {\n      // Document source or has excerpt - show popover\n      updatePosition();\n      setShowPopover(!showPopover);\n    }\n  };\n\n  return (\n    <span style={{ position: \"relative\", display: \"inline-block\" }}>\n      <button\n        ref={buttonRef}\n        onClick={handleClick}\n        title={citation.title}\n        style={{\n          display: \"inline-flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          minWidth: 16,\n          height: 16,\n          padding: \"0 4px\",\n          fontSize: 10,\n          fontWeight: 500,\n          backgroundColor: \"rgba(59, 130, 246, 0.2)\",\n          color: \"rgb(59, 130, 246)\",\n          borderRadius: 4,\n          marginLeft: 2,\n          cursor: \"pointer\",\n          border: \"none\",\n          transition: \"background-color 0.15s\",\n        }}\n        onMouseEnter={(e) => {\n          e.currentTarget.style.backgroundColor = \"rgba(59, 130, 246, 0.3)\";\n        }}\n        onMouseLeave={(e) => {\n          e.currentTarget.style.backgroundColor = \"rgba(59, 130, 246, 0.2)\";\n        }}\n      >\n        {id}\n      </button>\n\n      {showPopover && hasExcerpt && (\n        <div\n          ref={popoverRef}\n          style={{\n            position: \"absolute\",\n            zIndex: 50,\n            width: 288,\n            maxWidth: \"90vw\",\n            padding: 12,\n            borderRadius: 8,\n            border: \"1px solid rgba(255, 255, 255, 0.1)\",\n            backgroundColor: \"rgba(24, 24, 27, 0.95)\",\n            backdropFilter: \"blur(8px)\",\n            boxShadow: \"0 10px 25px rgba(0, 0, 0, 0.3)\",\n            ...(popoverPosition === \"top\"\n              ? { bottom: \"100%\", marginBottom: 8 }\n              : { top: \"100%\", marginTop: 8 }),\n            left: \"50%\",\n            transform: \"translateX(-50%)\",\n          }}\n        >\n          {/* Header */}\n          <div\n            style={{\n              display: \"flex\",\n              alignItems: \"center\",\n              gap: 8,\n              marginBottom: 8,\n              paddingBottom: 8,\n              borderBottom: \"1px solid rgba(255, 255, 255, 0.05)\",\n            }}\n          >\n            {citation.pageNumber && (\n              <span\n                style={{\n                  fontSize: 10,\n                  padding: \"2px 6px\",\n                  borderRadius: 4,\n                  backgroundColor: \"rgba(59, 130, 246, 0.2)\",\n                  color: \"rgb(59, 130, 246)\",\n                  flexShrink: 0,\n                }}\n              >\n                p. {citation.pageNumber}\n              </span>\n            )}\n            <span\n              style={{\n                fontSize: 12,\n                fontWeight: 500,\n                color: \"rgba(255, 255, 255, 0.8)\",\n                overflow: \"hidden\",\n                textOverflow: \"ellipsis\",\n                whiteSpace: \"nowrap\",\n              }}\n            >\n              {citation.title}\n            </span>\n          </div>\n\n          {/* Excerpt */}\n          <p\n            style={{\n              fontSize: 12,\n              color: \"rgba(255, 255, 255, 0.7)\",\n              lineHeight: 1.5,\n              fontStyle: \"italic\",\n              margin: 0,\n            }}\n          >\n            \"{citation.excerpt || citation.snippet}\"\n          </p>\n\n          {/* Footer for web sources */}\n          {isWebSource && (\n            <a\n              href={citation.url!}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              style={{\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: 4,\n                marginTop: 8,\n                paddingTop: 8,\n                borderTop: \"1px solid rgba(255, 255, 255, 0.05)\",\n                fontSize: 10,\n                color: \"rgb(59, 130, 246)\",\n                textDecoration: \"none\",\n              }}\n            >\n              {citation.domain || \"Open source\"} →\n            </a>\n          )}\n        </div>\n      )}\n    </span>\n  );\n});\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport { InternalMarkdown } from \"./internal-markdown\";\nimport type {\n  MarkdownTheme,\n  MarkdownContextValue,\n  MarkdownProviderProps,\n  RenderTextOptions,\n} from \"./types\";\nimport { defaultTheme } from \"./types\";\n\nconst MarkdownContext = createContext<MarkdownContextValue | null>(null);\n\n/**\n * Provider for global markdown rendering configuration.\n *\n * Wrap your app with this provider to enable markdown rendering in all components.\n * Components can use `useRenderText()` to render text with markdown support.\n *\n * @example\n * ```tsx\n * <MarkdownProvider>\n *   <App />\n * </MarkdownProvider>\n * ```\n */\nexport function MarkdownProvider({\n  children,\n  enabled = true,\n  theme: themeOverrides,\n}: MarkdownProviderProps) {\n  const theme = useMemo(\n    () => ({ ...defaultTheme, ...themeOverrides }),\n    [themeOverrides],\n  );\n\n  const renderText = useMemo(() => {\n    return (\n      content: string | null | undefined,\n      options: RenderTextOptions = {},\n    ): ReactNode => {\n      // If no content, return null\n      if (!content) return null;\n\n      // If markdown is disabled, return plain text\n      if (!enabled) {\n        if (options.inline) {\n          return (\n            <span className={options.className} style={options.style}>\n              {content}\n            </span>\n          );\n        }\n        return (\n          <div className={options.className} style={options.style}>\n            {content}\n          </div>\n        );\n      }\n\n      // Render with markdown\n      return (\n        <InternalMarkdown\n          content={content}\n          inline={options.inline ?? false}\n          theme={theme}\n          className={options.className}\n          style={options.style}\n        />\n      );\n    };\n  }, [enabled, theme]);\n\n  const value = useMemo<MarkdownContextValue>(\n    () => ({\n      enabled,\n      theme,\n      renderText,\n    }),\n    [enabled, theme, renderText],\n  );\n\n  return (\n    <MarkdownContext.Provider value={value}>\n      {children}\n    </MarkdownContext.Provider>\n  );\n}\n\n// Stable fallback value - created once and reused to avoid hooks order issues\nconst fallbackRenderText = (\n  content: string | null | undefined,\n  options: RenderTextOptions = {},\n) => {\n  if (!content) return null;\n  if (options.inline) {\n    return (\n      <span className={options.className} style={options.style}>\n        {content}\n      </span>\n    );\n  }\n  return (\n    <div className={options.className} style={options.style}>\n      {content}\n    </div>\n  );\n};\n\nconst fallbackContextValue: MarkdownContextValue = {\n  enabled: false,\n  theme: defaultTheme,\n  renderText: fallbackRenderText,\n};\n\n/**\n * Hook to access the markdown rendering context.\n *\n * Returns `renderText` function that automatically applies markdown formatting.\n * If no provider is found, returns a fallback that renders plain text.\n *\n * @example\n * ```tsx\n * function MyComponent({ description }: { description: string }) {\n *   const { renderText } = useMarkdown();\n *   return <div>{renderText(description)}</div>;\n * }\n * ```\n */\nexport function useMarkdown(): MarkdownContextValue {\n  const context = useContext(MarkdownContext);\n  // Return stable fallback if no provider - avoids hooks order issues\n  return context ?? fallbackContextValue;\n}\n\n/**\n * Convenience hook that returns just the renderText function.\n *\n * @example\n * ```tsx\n * function MyComponent({ description }: { description: string }) {\n *   const renderText = useRenderText();\n *   return <div>{renderText(description)}</div>;\n * }\n * ```\n */\nexport function useRenderText() {\n  const { renderText } = useMarkdown();\n  return renderText;\n}\n","\"use client\";\n\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n  useRef,\n  type ReactNode,\n} from \"react\";\nimport type { ProactivityMode } from \"../hooks/types\";\nimport {\n  DEFAULT_EXTENDED_SETTINGS,\n  type ExtendedAISettings,\n  type AISettingsContextValue,\n} from \"./ai-settings/types\";\nimport {\n  loadSettings,\n  saveSettings,\n  fetchSettingsFromAPI,\n  saveSettingsToAPI,\n} from \"./ai-settings/storage\";\n\n// Re-export types for convenience\nexport type {\n  DocumentSettings,\n  ExtendedAISettings,\n  AISettingsContextValue,\n} from \"./ai-settings/types\";\nexport { DEFAULT_EXTENDED_SETTINGS } from \"./ai-settings/types\";\n\nconst AISettingsContext = createContext<AISettingsContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface AISettingsProviderProps {\n  children: ReactNode;\n  initialSettings?: Partial<ExtendedAISettings>;\n}\n\nexport function AISettingsProvider({\n  children,\n  initialSettings,\n}: AISettingsProviderProps) {\n  const [settings, setSettings] = useState<ExtendedAISettings>(() => {\n    const loaded = loadSettings();\n    if (initialSettings) {\n      return {\n        proactivity: { ...loaded.proactivity, ...initialSettings.proactivity },\n        suggestions: { ...loaded.suggestions, ...initialSettings.suggestions },\n        dataCollection: {\n          ...loaded.dataCollection,\n          ...initialSettings.dataCollection,\n        },\n        onboarding: { ...loaded.onboarding, ...initialSettings.onboarding },\n        documents: { ...loaded.documents, ...initialSettings.documents },\n      };\n    }\n    return loaded;\n  });\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const syncTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    fetchSettingsFromAPI().then((apiSettings) => {\n      if (apiSettings) {\n        setSettings(apiSettings);\n        saveSettings(apiSettings);\n      }\n      setIsLoading(false);\n    });\n  }, []);\n\n  const syncToAPI = useCallback((newSettings: Partial<ExtendedAISettings>) => {\n    if (syncTimeoutRef.current) {\n      clearTimeout(syncTimeoutRef.current);\n    }\n    syncTimeoutRef.current = setTimeout(async () => {\n      setIsSyncing(true);\n      await saveSettingsToAPI(newSettings);\n      setIsSyncing(false);\n    }, 500);\n  }, []);\n\n  const updateAndSync = useCallback(\n    (\n      newSettings: ExtendedAISettings,\n      changedPart: Partial<ExtendedAISettings>,\n    ) => {\n      setSettings(newSettings);\n      saveSettings(newSettings);\n      syncToAPI(changedPart);\n    },\n    [syncToAPI],\n  );\n\n  const updateSettings = useCallback(\n    (partial: Partial<ExtendedAISettings>) => {\n      setSettings((prev) => {\n        const next = {\n          proactivity: { ...prev.proactivity, ...partial.proactivity },\n          suggestions: { ...prev.suggestions, ...partial.suggestions },\n          dataCollection: { ...prev.dataCollection, ...partial.dataCollection },\n          onboarding: { ...prev.onboarding, ...partial.onboarding },\n          documents: { ...prev.documents, ...partial.documents },\n        };\n        saveSettings(next);\n        syncToAPI(partial);\n        return next;\n      });\n    },\n    [syncToAPI],\n  );\n\n  const setProactivityMode = useCallback(\n    (mode: ProactivityMode) => {\n      const change = {\n        proactivity: {\n          enabled: mode !== \"disabled\",\n          mode,\n          debounceMs: settings.proactivity.debounceMs,\n        },\n      };\n      updateAndSync(\n        {\n          ...settings,\n          proactivity: { ...settings.proactivity, ...change.proactivity },\n        },\n        change,\n      );\n    },\n    [settings, updateAndSync],\n  );\n\n  const setProactivityEnabled = useCallback(\n    (enabled: boolean) => {\n      const change = {\n        proactivity: {\n          enabled,\n          mode: enabled ? settings.proactivity.mode : \"disabled\",\n          debounceMs: settings.proactivity.debounceMs,\n        },\n      };\n      updateAndSync(\n        {\n          ...settings,\n          proactivity: { ...settings.proactivity, ...change.proactivity },\n        },\n        change,\n      );\n    },\n    [settings, updateAndSync],\n  );\n\n  const setSuggestionsEnabled = useCallback(\n    (enabled: boolean) => {\n      const change = { suggestions: { ...settings.suggestions, enabled } };\n      updateAndSync({ ...settings, ...change }, change);\n    },\n    [settings, updateAndSync],\n  );\n\n  const setDataCollectionPreferForm = useCallback(\n    (preferForm: boolean) => {\n      const change = {\n        dataCollection: { ...settings.dataCollection, preferForm },\n      };\n      updateAndSync({ ...settings, ...change }, change);\n    },\n    [settings, updateAndSync],\n  );\n\n  const setSmartParsingEnabled = useCallback(\n    (enabled: boolean) => {\n      const change = { documents: { smartParsingEnabled: enabled } };\n      updateAndSync({ ...settings, ...change }, change);\n    },\n    [settings, updateAndSync],\n  );\n\n  const resetSettings = useCallback(() => {\n    setSettings(DEFAULT_EXTENDED_SETTINGS);\n    saveSettings(DEFAULT_EXTENDED_SETTINGS);\n    syncToAPI(DEFAULT_EXTENDED_SETTINGS);\n  }, [syncToAPI]);\n\n  const completeOnboarding = useCallback(() => {\n    const change = { onboarding: { ...settings.onboarding, completed: true } };\n    updateAndSync({ ...settings, ...change }, change);\n  }, [settings, updateAndSync]);\n\n  const value: AISettingsContextValue = {\n    settings,\n    updateSettings,\n    setProactivityMode,\n    setProactivityEnabled,\n    setSuggestionsEnabled,\n    setDataCollectionPreferForm,\n    setSmartParsingEnabled,\n    resetSettings,\n    completeOnboarding,\n    isLoading,\n    isSyncing,\n  };\n\n  return (\n    <AISettingsContext.Provider value={value}>\n      {children}\n    </AISettingsContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function useAISettings(): AISettingsContextValue {\n  const context = useContext(AISettingsContext);\n  if (!context) {\n    throw new Error(\"useAISettings must be used within AISettingsProvider\");\n  }\n  return context;\n}\n\nexport function useAISettingsOptional(): AISettingsContextValue | null {\n  return useContext(AISettingsContext);\n}\n\nexport function useIsProactivityEnabled(): boolean {\n  const context = useContext(AISettingsContext);\n  if (!context) return true;\n  return (\n    context.settings.proactivity.enabled &&\n    context.settings.proactivity.mode !== \"disabled\"\n  );\n}\n\nexport function useAreSuggestionsEnabled(): boolean {\n  const context = useContext(AISettingsContext);\n  if (!context) return true;\n  return context.settings.suggestions.enabled;\n}\n\nexport function useIsSmartParsingEnabled(): boolean {\n  const context = useContext(AISettingsContext);\n  if (!context) return false;\n  return context.settings.documents.smartParsingEnabled;\n}\n","import type {\n  UITree,\n  UIElement,\n  DocumentIndex,\n  DocumentIndexNode,\n} from \"@onegenui/core\";\n\n// Re-export core types for convenience\nexport type { DocumentIndex, DocumentIndexNode };\n\n// ─────────────────────────────────────────────────────────────────────────────\n// AI Interactive Types (Questions, Suggestions)\n// Must be defined before ConversationTurn which uses them\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Form field for dynamic question forms\n */\nexport interface FormField {\n  id: string;\n  label: string;\n  type:\n    | \"text\"\n    | \"number\"\n    | \"select\"\n    | \"checkbox\"\n    | \"date\"\n    | \"textarea\"\n    | \"radio\";\n  options?: { value: string; label: string }[];\n  placeholder?: string;\n  defaultValue?: string | number | boolean;\n  /** Allow user to enter custom value (adds \"Other\" option to select/radio) */\n  allowCustom?: boolean;\n  validation?: {\n    required?: boolean;\n    min?: number;\n    max?: number;\n    minLength?: number;\n    maxLength?: number;\n    pattern?: string;\n  };\n}\n\n/**\n * Quick reply option for simple button choices\n */\nexport interface QuickReplyOption {\n  id: string;\n  label: string;\n  value: string;\n  variant?: \"default\" | \"primary\" | \"success\" | \"danger\";\n}\n\n/**\n * Question payload from AI asking for user input\n * Supports multiple interaction types for better UX\n */\nexport interface QuestionPayload {\n  id: string;\n  text: string;\n  type: \"text\" | \"form\" | \"quick-reply\";\n  /** Form fields (for type: \"form\") */\n  fields?: FormField[];\n  /** Quick reply options (for type: \"quick-reply\") */\n  options?: QuickReplyOption[];\n  /** Allow multiple selection for quick-reply */\n  multiple?: boolean;\n  /** Allow custom text input in addition to options */\n  allowCustom?: boolean;\n  required?: boolean;\n}\n\n/**\n * Suggestion chip for quick actions\n */\nexport interface SuggestionChip {\n  id: string;\n  label: string;\n  prompt: string;\n  icon?: string;\n  variant?: \"default\" | \"primary\" | \"success\" | \"warning\";\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Chat Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Chat message type\n */\nexport interface ChatMessage {\n  role: \"assistant\" | \"user\" | \"system\";\n  content: string;\n}\n\n/**\n * File attachment containing metadata and preview\n */\nexport interface FileAttachment {\n  id: string;\n  type: \"document\" | \"image\" | \"spreadsheet\" | \"presentation\" | \"other\";\n  file: File;\n  preview?: string;\n}\n\n/** Server-cached document attachment (from library) */\nexport interface LibraryAttachment {\n  id: string;\n  documentId: string;\n  fileName: string;\n  mimeType: string;\n  pageCount?: number;\n  type: \"library-document\";\n}\n\nexport type Attachment = FileAttachment | LibraryAttachment;\n\nexport function isLibraryAttachment(a: Attachment): a is LibraryAttachment {\n  return a.type === \"library-document\" && \"documentId\" in a;\n}\n\nexport function isFileAttachment(a: Attachment): a is FileAttachment {\n  return a.type !== \"library-document\" && \"file\" in a && a.file instanceof File;\n}\n\n/**\n * Persisted attachment data (serializable for database storage)\n */\nexport interface PersistedAttachment {\n  id: string;\n  fileName: string;\n  mimeType: string;\n  type: \"document\" | \"image\" | \"spreadsheet\" | \"presentation\" | \"other\";\n  /** Parsed text content of the document */\n  parsedContent?: string;\n  /** Base64 encoded content for images */\n  base64Content?: string;\n  /** Size in bytes */\n  size: number;\n}\n\n/**\n * Tool progress event for granular UI updates\n */\nexport interface ToolProgress {\n  toolName: string;\n  toolCallId: string;\n  status: \"starting\" | \"progress\" | \"complete\" | \"error\";\n  message?: string;\n  data?: unknown;\n}\n\n/**\n * A single turn in the conversation\n */\nexport interface ConversationTurn {\n  id: string;\n  userMessage: string;\n  assistantMessages: ChatMessage[];\n  treeSnapshot: UITree | null;\n  timestamp: number;\n  /** Questions from AI requiring user response */\n  questions?: QuestionPayload[];\n  /** Suggestion chips for quick follow-up actions */\n  suggestions?: SuggestionChip[];\n  /** User's answers to questions */\n  questionAnswers?: Record<string, unknown>;\n  /** Whether this turn was triggered proactively (hides user message in UI) */\n  isProactive?: boolean;\n  /** Files attached to this turn (runtime only, contains File objects) */\n  attachments?: Attachment[];\n  /** Persisted attachment data (serializable, for database storage) */\n  persistedAttachments?: PersistedAttachment[];\n  /** Tool progress events for granular updates */\n  toolProgress?: ToolProgress[];\n  /** Document index from Vectorless (smart parsing) */\n  documentIndex?: DocumentIndex;\n  /** Error message if turn failed */\n  error?: string;\n  /** Whether turn is still loading */\n  isLoading?: boolean;\n  /** Turn completion status for detailed state tracking */\n  status?: \"pending\" | \"streaming\" | \"complete\" | \"failed\" | \"partial\";\n}\n\n/**\n * Minimal message format for AI SDK multi-turn conversations.\n * Used to pass conversation history to backend for native multi-turn support.\n */\nexport interface ConversationMessage {\n  role: \"user\" | \"assistant\";\n  content: string;\n}\n\n/**\n * Converts ConversationTurn[] to ConversationMessage[] for AI SDK.\n * Includes all completed turns - model handles context window.\n */\nexport function buildConversationMessages(\n  turns: ConversationTurn[],\n): ConversationMessage[] {\n  const messages: ConversationMessage[] = [];\n\n  for (const turn of turns) {\n    // Skip proactive turns and incomplete turns\n    if (turn.isProactive || !turn.assistantMessages?.length) continue;\n\n    // Add user message\n    if (turn.userMessage) {\n      messages.push({ role: \"user\", content: turn.userMessage });\n    }\n\n    // Add assistant response\n    const assistantContent = turn.assistantMessages\n      .map((m) => m.content)\n      .filter(Boolean)\n      .join(\"\\n\");\n\n    if (assistantContent) {\n      messages.push({ role: \"assistant\", content: assistantContent });\n    }\n  }\n\n  return messages;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// useUIStream Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Options for useUIStream\n */\nexport interface UseUIStreamOptions {\n  /** API endpoint */\n  api: string;\n  /** Callback when complete */\n  onComplete?: (tree: UITree) => void;\n  /** Callback on error */\n  onError?: (error: Error) => void;\n  /** Function to get dynamic headers (e.g. for auth) */\n  getHeaders?: () => Record<string, string> | Promise<Record<string, string>>;\n  /** Function to get current chat ID - used to bind streams to their originating chat */\n  getChatId?: () => string | undefined;\n  /** Callback when stream completes for a different chat (background completion) */\n  onBackgroundComplete?: (chatId: string, tree: UITree, conversation: ConversationTurn[]) => void;\n}\n\n/**\n * Return type for useUIStream\n */\nexport interface UseUIStreamReturn {\n  /** Current UI tree */\n  tree: UITree | null;\n  /** Full conversation history (user messages + assistant messages + snapshots) */\n  conversation: ConversationTurn[];\n  /** Whether currently streaming */\n  isStreaming: boolean;\n  /** Error if any */\n  error: Error | null;\n  /** Send a prompt to generate UI */\n  send: (\n    prompt: string,\n    context?: Record<string, unknown>,\n    attachments?: Attachment[],\n  ) => Promise<void>;\n  /** Clear the current tree and conversation */\n  clear: () => void;\n  /** Remove an element from the tree */\n  removeElement: (elementKey: string) => void;\n  /** Remove specific sub-items from an element's array prop by index or ID (supports undo) */\n  removeSubItems: (\n    elementKey: string,\n    identifiers: (number | string)[],\n  ) => void;\n  /** Update an element's props in the tree */\n  updateElement: (elementKey: string, updates: Record<string, unknown>) => void;\n  /** Update an element's layout (size, grid, resizable) */\n  updateElementLayout: (\n    elementKey: string,\n    layoutUpdates: {\n      width?: number;\n      height?: number;\n      column?: number;\n      row?: number;\n      columnSpan?: number;\n      rowSpan?: number;\n      resizable?: boolean;\n    },\n  ) => void;\n  /** Delete a turn and rollback to previous state */\n  deleteTurn: (turnId: string) => void;\n  /** Edit a turn message and regenerate */\n  editTurn: (turnId: string, newMessage: string) => Promise<void>;\n  /** Undo last action */\n  undo: () => void;\n  /** Redo last undone action */\n  redo: () => void;\n  /** Whether undo is available */\n  canUndo: boolean;\n  /** Whether redo is available */\n  canRedo: boolean;\n  /** Load a full session state */\n  loadSession: (session: {\n    tree: UITree;\n    conversation: ConversationTurn[];\n  }) => void;\n  /** Answer a question from AI */\n  answerQuestion: (\n    turnId: string,\n    questionId: string,\n    answers: Record<string, unknown>,\n  ) => void;\n  /** Abort the current streaming request */\n  abort: () => void;\n  // Note: Plan state now in Zustand store - use usePlanExecution() hook\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// flatToTree Types (re-export from core for convenience)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type FlatElement = UIElement & { parentKey?: string | null };\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Action Tracking Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Types of user actions that can be tracked\n */\nexport type ActionType =\n  | \"toggle\"\n  | \"input\"\n  | \"select\"\n  | \"click\"\n  | \"complete\"\n  | \"create\"\n  | \"delete\"\n  | \"update\"\n  | \"submit\"\n  | \"expand\"\n  | \"collapse\"\n  | \"drag\"\n  | \"drop\";\n\n/**\n * A tracked user action on a component\n */\nexport interface TrackedAction {\n  id: string;\n  timestamp: number;\n  type: ActionType;\n  elementKey: string;\n  elementType: string;\n  payload?: unknown;\n  context?: {\n    itemId?: string;\n    itemIndex?: number;\n    itemLabel?: string;\n    previousValue?: unknown;\n    newValue?: unknown;\n    parentKey?: string;\n  };\n}\n\n/**\n * Options for action tracker\n *\n * KISS Principle: Only essential options, smart defaults handle the rest.\n * The system automatically detects when user is editing and delays triggers.\n */\nexport interface ActionTrackerOptions {\n  /** Enable/disable action tracking */\n  enabled: boolean;\n  /**\n   * Debounce delay in ms before triggering proactive AI.\n   * Timer only starts when user is NOT focused on an editable element.\n   * Default: 2000 (2 seconds)\n   */\n  debounceMs?: number;\n  /** Maximum number of actions to keep in context for AI. Default: 5 */\n  maxActionsInContext?: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// AI Settings Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Proactivity mode for AI Assistant\n */\nexport type ProactivityMode = \"full\" | \"on-request\" | \"disabled\";\n\n/**\n * AI Assistant settings\n */\nexport interface AIAssistantSettings {\n  proactivity: {\n    enabled: boolean;\n    mode: ProactivityMode;\n    debounceMs: number;\n  };\n  suggestions: {\n    enabled: boolean;\n    maxChips: number;\n  };\n  dataCollection: {\n    preferForm: boolean;\n    autoAsk: boolean;\n  };\n  onboarding: {\n    showOnFirstUse: boolean;\n    completed: boolean;\n  };\n}\n\n/**\n * Default AI Assistant settings\n */\nexport const DEFAULT_AI_SETTINGS: AIAssistantSettings = {\n  proactivity: {\n    enabled: true,\n    mode: \"full\",\n    debounceMs: 2000,\n  },\n  suggestions: {\n    enabled: true,\n    maxChips: 4,\n  },\n  dataCollection: {\n    preferForm: true,\n    autoAsk: true,\n  },\n  onboarding: {\n    showOnFirstUse: true,\n    completed: false,\n  },\n};\n","\"use client\";\n\nimport type { AIAssistantSettings, ProactivityMode } from \"../../hooks/types\";\nimport { DEFAULT_AI_SETTINGS } from \"../../hooks/types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Storage Key\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const STORAGE_KEY = \"json-render-ai-settings\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Extended Settings (includes document processing)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface DocumentSettings {\n  smartParsingEnabled: boolean;\n}\n\nexport interface ExtendedAISettings extends AIAssistantSettings {\n  documents: DocumentSettings;\n}\n\nexport const DEFAULT_EXTENDED_SETTINGS: ExtendedAISettings = {\n  ...DEFAULT_AI_SETTINGS,\n  documents: {\n    smartParsingEnabled: false,\n  },\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface AISettingsContextValue {\n  settings: ExtendedAISettings;\n  updateSettings: (partial: Partial<ExtendedAISettings>) => void;\n  setProactivityMode: (mode: ProactivityMode) => void;\n  setProactivityEnabled: (enabled: boolean) => void;\n  setSuggestionsEnabled: (enabled: boolean) => void;\n  setDataCollectionPreferForm: (preferForm: boolean) => void;\n  setSmartParsingEnabled: (enabled: boolean) => void;\n  resetSettings: () => void;\n  completeOnboarding: () => void;\n  isLoading: boolean;\n  isSyncing: boolean;\n}\n","import {\n  STORAGE_KEY,\n  DEFAULT_EXTENDED_SETTINGS,\n  type ExtendedAISettings,\n} from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Local Storage Helpers\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function loadSettings(): ExtendedAISettings {\n  if (typeof window === \"undefined\") return DEFAULT_EXTENDED_SETTINGS;\n\n  try {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored) {\n      const parsed = JSON.parse(stored) as Partial<ExtendedAISettings>;\n      return {\n        proactivity: {\n          ...DEFAULT_EXTENDED_SETTINGS.proactivity,\n          ...parsed.proactivity,\n        },\n        suggestions: {\n          ...DEFAULT_EXTENDED_SETTINGS.suggestions,\n          ...parsed.suggestions,\n        },\n        dataCollection: {\n          ...DEFAULT_EXTENDED_SETTINGS.dataCollection,\n          ...parsed.dataCollection,\n        },\n        onboarding: {\n          ...DEFAULT_EXTENDED_SETTINGS.onboarding,\n          ...parsed.onboarding,\n        },\n        documents: {\n          ...DEFAULT_EXTENDED_SETTINGS.documents,\n          ...parsed.documents,\n        },\n      };\n    }\n  } catch {\n    // Ignore parse errors\n  }\n  return DEFAULT_EXTENDED_SETTINGS;\n}\n\nexport function saveSettings(settings: ExtendedAISettings): void {\n  if (typeof window === \"undefined\") return;\n\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\n  } catch {\n    // Ignore storage errors\n  }\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// API Helpers\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport async function fetchSettingsFromAPI(): Promise<ExtendedAISettings | null> {\n  try {\n    const res = await fetch(\"/api/settings\");\n    if (!res.ok) return null;\n    const data = await res.json();\n    return {\n      proactivity: data.proactivity ?? DEFAULT_EXTENDED_SETTINGS.proactivity,\n      suggestions: data.suggestions ?? DEFAULT_EXTENDED_SETTINGS.suggestions,\n      dataCollection:\n        data.dataCollection ?? DEFAULT_EXTENDED_SETTINGS.dataCollection,\n      onboarding: {\n        showOnFirstUse: DEFAULT_EXTENDED_SETTINGS.onboarding.showOnFirstUse,\n        completed: data.onboarding?.completed ?? false,\n      },\n      documents: data.documents ?? DEFAULT_EXTENDED_SETTINGS.documents,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport async function saveSettingsToAPI(\n  settings: Partial<ExtendedAISettings>,\n): Promise<boolean> {\n  try {\n    const res = await fetch(\"/api/settings\", {\n      method: \"PUT\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(settings),\n    });\n    return res.ok;\n  } catch {\n    return false;\n  }\n}\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Provider\n// =============================================================================\n\nimport {\n  createContext,\n  useState,\n  useCallback,\n  useRef,\n  useEffect,\n  type ReactNode,\n} from \"react\";\nimport type { TrackedAction, ActionTrackerOptions } from \"../../hooks/types\";\nimport type { ActionContextValue } from \"./types\";\nimport { DEFAULT_OPTIONS } from \"./types\";\nimport { generateId, isUserCurrentlyEditing } from \"./utils\";\n\nexport const ActionContext = createContext<ActionContextValue | null>(null);\n\ninterface ActionProviderProps {\n  children: ReactNode;\n  initialOptions?: Partial<ActionTrackerOptions>;\n}\n\nexport function ActionProvider({\n  children,\n  initialOptions,\n}: ActionProviderProps) {\n  const [options, setOptionsState] = useState<ActionTrackerOptions>(() => ({\n    ...DEFAULT_OPTIONS,\n    ...initialOptions,\n  }));\n\n  const [actions, setActions] = useState<TrackedAction[]>([]);\n  const [lastAction, setLastAction] = useState<TrackedAction | null>(null);\n\n  // Refs for async operations\n  const subscribersRef = useRef<Set<(actions: TrackedAction[]) => void>>(\n    new Set(),\n  );\n  const pendingActionsRef = useRef<TrackedAction[]>([]);\n  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  // Core Logic: Smart Debounce with Focus Awareness\n  const notifySubscribers = useCallback((batch: TrackedAction[]) => {\n    subscribersRef.current.forEach((cb) => {\n      try {\n        cb(batch);\n      } catch (e) {\n        console.error(\"[ActionTracker] Subscriber error:\", e);\n      }\n    });\n  }, []);\n\n  const tryFlush = useCallback(() => {\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = null;\n    }\n\n    if (pendingActionsRef.current.length === 0) return;\n\n    if (isUserCurrentlyEditing()) {\n      timerRef.current = setTimeout(tryFlush, 1000);\n      return;\n    }\n\n    const batch = [...pendingActionsRef.current];\n    pendingActionsRef.current = [];\n    notifySubscribers(batch);\n  }, [notifySubscribers]);\n\n  const scheduleFlush = useCallback(\n    (delayMs: number) => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n      timerRef.current = setTimeout(tryFlush, delayMs);\n    },\n    [tryFlush],\n  );\n\n  // Public API\n  const trackAction = useCallback(\n    (actionData: Omit<TrackedAction, \"id\" | \"timestamp\">) => {\n      if (!options.enabled) return;\n\n      const action: TrackedAction = {\n        ...actionData,\n        id: generateId(),\n        timestamp: Date.now(),\n      };\n\n      setActions((prev) => {\n        const next = [...prev, action];\n        return next.slice(-(options.maxActionsInContext ?? 5));\n      });\n      setLastAction(action);\n\n      pendingActionsRef.current.push(action);\n      scheduleFlush(options.debounceMs ?? 2500);\n    },\n    [\n      options.enabled,\n      options.maxActionsInContext,\n      options.debounceMs,\n      scheduleFlush,\n    ],\n  );\n\n  const clearActions = useCallback(() => {\n    setActions([]);\n    setLastAction(null);\n    pendingActionsRef.current = [];\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = null;\n    }\n  }, []);\n\n  const getActionsForContext = useCallback(() => {\n    return actions.slice(-(options.maxActionsInContext ?? 5));\n  }, [actions, options.maxActionsInContext]);\n\n  const onAction = useCallback(\n    (callback: (actions: TrackedAction[]) => void) => {\n      subscribersRef.current.add(callback);\n      return () => subscribersRef.current.delete(callback);\n    },\n    [],\n  );\n\n  const setOptions = useCallback(\n    (newOptions: Partial<ActionTrackerOptions>) => {\n      setOptionsState((prev) => ({ ...prev, ...newOptions }));\n    },\n    [],\n  );\n\n  // Cleanup\n  useEffect(() => {\n    return () => {\n      if (timerRef.current) clearTimeout(timerRef.current);\n    };\n  }, []);\n\n  // Global focus listener - triggers flush when user leaves any input\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n\n    let focusOutTimeout: ReturnType<typeof setTimeout> | null = null;\n\n    const handleFocusOut = (e: FocusEvent) => {\n      const target = e.target as HTMLElement;\n      const tag = target?.tagName?.toLowerCase();\n      const isEditable =\n        tag === \"input\" ||\n        tag === \"textarea\" ||\n        tag === \"select\" ||\n        target?.isContentEditable;\n\n      if (!isEditable) return;\n\n      focusOutTimeout = setTimeout(() => {\n        if (!isUserCurrentlyEditing() && pendingActionsRef.current.length > 0) {\n          scheduleFlush(options.debounceMs ?? 2500);\n        }\n      }, 100);\n    };\n\n    document.addEventListener(\"focusout\", handleFocusOut, true);\n    return () => {\n      document.removeEventListener(\"focusout\", handleFocusOut, true);\n      if (focusOutTimeout) clearTimeout(focusOutTimeout);\n    };\n  }, [options.debounceMs, scheduleFlush]);\n\n  const value: ActionContextValue = {\n    actions,\n    trackAction,\n    clearActions,\n    getActionsForContext,\n    lastAction,\n    onAction,\n    options,\n    setOptions,\n  };\n\n  return (\n    <ActionContext.Provider value={value}>{children}</ActionContext.Provider>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Types\n// =============================================================================\n\nimport type { TrackedAction, ActionTrackerOptions } from \"../../hooks/types\";\n\nexport interface ActionContextValue {\n  /** Recent actions (limited by maxActionsInContext) */\n  actions: TrackedAction[];\n  /** Track a new user action */\n  trackAction: (action: Omit<TrackedAction, \"id\" | \"timestamp\">) => void;\n  /** Clear all tracked actions */\n  clearActions: () => void;\n  /** Get actions for AI context */\n  getActionsForContext: () => TrackedAction[];\n  /** Last action tracked */\n  lastAction: TrackedAction | null;\n  /** Subscribe to action events (for proactive AI) */\n  onAction: (callback: (actions: TrackedAction[]) => void) => () => void;\n  /** Options */\n  options: ActionTrackerOptions;\n  /** Update options */\n  setOptions: (options: Partial<ActionTrackerOptions>) => void;\n}\n\nexport const DEFAULT_OPTIONS: ActionTrackerOptions = {\n  enabled: true,\n  debounceMs: 2500,\n  maxActionsInContext: 5,\n};\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Utilities\n// =============================================================================\n\nimport type { TrackedAction } from \"../../hooks/types\";\n\nexport const generateId = () =>\n  `action-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n\n/** Check if document has focus on an editable element */\nexport const isUserCurrentlyEditing = (): boolean => {\n  if (typeof document === \"undefined\") return false;\n  const active = document.activeElement;\n  if (!active) return false;\n  const tag = active.tagName.toLowerCase();\n  return (\n    tag === \"input\" ||\n    tag === \"textarea\" ||\n    tag === \"select\" ||\n    (active as HTMLElement).isContentEditable\n  );\n};\n\nexport function formatActionsForPrompt(actions: TrackedAction[]): string {\n  if (actions.length === 0) return \"\";\n\n  const formatted = actions.map((action) => {\n    const parts = [`- ${action.type} on ${action.elementType}`];\n    if (action.context?.itemLabel) {\n      parts.push(`\"${action.context.itemLabel}\"`);\n    }\n    if (\n      action.context?.previousValue !== undefined &&\n      action.context?.newValue !== undefined\n    ) {\n      parts.push(\n        `(${action.context.previousValue} -> ${action.context.newValue})`,\n      );\n    }\n    return parts.join(\" \");\n  });\n\n  return `\nRECENT USER ACTIONS:\n${formatted.join(\"\\n\")}\n\nBased on these actions, you may proactively offer relevant assistance.\n`;\n}\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Hooks\n// =============================================================================\n\nimport { useContext, useCallback, useEffect } from \"react\";\nimport type { TrackedAction, ActionType } from \"../../hooks/types\";\nimport type { ActionContextValue } from \"./types\";\nimport { ActionContext } from \"./provider\";\n\nexport function useActionContext(): ActionContextValue {\n  const context = useContext(ActionContext);\n  if (!context) {\n    throw new Error(\"useActionContext must be used within ActionProvider\");\n  }\n  return context;\n}\n\nexport function useElementActionTracker(\n  elementKey: string,\n  elementType: string,\n) {\n  const { trackAction, options } = useActionContext();\n\n  const track = useCallback(\n    (\n      type: ActionType,\n      context?: TrackedAction[\"context\"],\n      payload?: unknown,\n    ) => {\n      if (!options.enabled) return;\n      trackAction({ type, elementKey, elementType, context, payload });\n    },\n    [trackAction, elementKey, elementType, options.enabled],\n  );\n\n  return { track, isEnabled: options.enabled };\n}\n\nexport function useActionSubscriber(\n  callback: (actions: TrackedAction[]) => void,\n  deps: unknown[] = [],\n) {\n  const { onAction } = useActionContext();\n\n  useEffect(() => {\n    return onAction(callback);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [onAction, ...deps]);\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useRef,\n  useMemo,\n  type ReactNode,\n} from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\ntype DomainType =\n  | \"workout\"\n  | \"workout_plan\"\n  | \"meal\"\n  | \"nutrition_plan\"\n  | \"trip\"\n  | \"flight\"\n  | \"hotel\"\n  | \"project\"\n  | \"task\"\n  | \"schedule\"\n  | \"supplement\"\n  | \"calendar\"\n  | \"diary\";\n\ninterface AutoSavePayload {\n  type: DomainType;\n  chatId: string;\n  elementKey: string;\n  data: Record<string, unknown>;\n}\n\ninterface AutoSaveResult {\n  success: boolean;\n  id?: string;\n  error?: string;\n}\n\ninterface AutoSaveContextValue {\n  /**\n   * Chat ID for the current context (used for source linking)\n   */\n  chatId: string | null;\n\n  /**\n   * Execute auto-save for a domain component\n   */\n  autoSave: (\n    payload: Omit<AutoSavePayload, \"chatId\">,\n  ) => Promise<AutoSaveResult>;\n\n  /**\n   * Debounced auto-save (recommended for use in components)\n   */\n  debouncedAutoSave: (\n    payload: Omit<AutoSavePayload, \"chatId\">,\n    delayMs?: number,\n  ) => void;\n\n  /**\n   * Check if auto-save is enabled for this context\n   */\n  isEnabled: boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst AutoSaveContext = createContext<AutoSaveContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface AutoSaveProviderProps {\n  children: ReactNode;\n  /**\n   * Current chat ID for source linking\n   */\n  chatId: string | null;\n  /**\n   * Enable/disable auto-save (default: true when chatId is provided)\n   */\n  enabled?: boolean;\n  /**\n   * Optional custom save endpoint\n   */\n  saveEndpoint?: string;\n  /**\n   * Callback when save completes\n   */\n  onSaveComplete?: (result: AutoSaveResult) => void;\n  /**\n   * Callback on save error\n   */\n  onSaveError?: (error: Error) => void;\n}\n\nconst DEFAULT_DEBOUNCE_MS = 1500;\n\nexport function AutoSaveProvider({\n  children,\n  chatId,\n  enabled = true,\n  saveEndpoint = \"/api/domain/save\",\n  onSaveComplete,\n  onSaveError,\n}: AutoSaveProviderProps) {\n  const debounceTimersRef = useRef<Map<string, NodeJS.Timeout>>(new Map());\n  const pendingRef = useRef<Map<string, AutoSavePayload>>(new Map());\n\n  const autoSave = useCallback(\n    async (\n      payload: Omit<AutoSavePayload, \"chatId\">,\n    ): Promise<AutoSaveResult> => {\n      if (!chatId || !enabled) {\n        return {\n          success: false,\n          error: \"Auto-save disabled or no chat context\",\n        };\n      }\n\n      try {\n        const fullPayload: AutoSavePayload = {\n          ...payload,\n          chatId,\n        };\n\n        const response = await fetch(saveEndpoint, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(fullPayload),\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          const error = errorData.error || \"Failed to save\";\n          onSaveError?.(new Error(error));\n          return { success: false, error };\n        }\n\n        const result = await response.json();\n        onSaveComplete?.(result);\n        return result;\n      } catch (error) {\n        const msg = error instanceof Error ? error.message : \"Unknown error\";\n        onSaveError?.(error instanceof Error ? error : new Error(msg));\n        return { success: false, error: msg };\n      }\n    },\n    [chatId, enabled, saveEndpoint, onSaveComplete, onSaveError],\n  );\n\n  const debouncedAutoSave = useCallback(\n    (\n      payload: Omit<AutoSavePayload, \"chatId\">,\n      delayMs = DEFAULT_DEBOUNCE_MS,\n    ) => {\n      if (!chatId || !enabled) return;\n\n      const key = `${payload.type}:${payload.elementKey}`;\n\n      // Cancel existing timer for this key\n      const existingTimer = debounceTimersRef.current.get(key);\n      if (existingTimer) {\n        clearTimeout(existingTimer);\n      }\n\n      // Store the latest payload\n      pendingRef.current.set(key, { ...payload, chatId });\n\n      // Set new timer\n      const timer = setTimeout(() => {\n        const pendingPayload = pendingRef.current.get(key);\n        if (pendingPayload) {\n          autoSave(pendingPayload);\n          pendingRef.current.delete(key);\n        }\n        debounceTimersRef.current.delete(key);\n      }, delayMs);\n\n      debounceTimersRef.current.set(key, timer);\n    },\n    [chatId, enabled, autoSave],\n  );\n\n  const value = useMemo<AutoSaveContextValue>(\n    () => ({\n      chatId,\n      autoSave,\n      debouncedAutoSave,\n      isEnabled: Boolean(chatId && enabled),\n    }),\n    [chatId, autoSave, debouncedAutoSave, enabled],\n  );\n\n  return (\n    <AutoSaveContext.Provider value={value}>\n      {children}\n    </AutoSaveContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to access auto-save functionality in domain components\n */\nexport function useAutoSave(): AutoSaveContextValue {\n  const context = useContext(AutoSaveContext);\n  if (!context) {\n    // Return a no-op context if not within a provider\n    return {\n      chatId: null,\n      autoSave: async () => ({ success: false, error: \"No AutoSaveProvider\" }),\n      debouncedAutoSave: () => {},\n      isEnabled: false,\n    };\n  }\n  return context;\n}\n\n/**\n * Hook to auto-save domain data on mount and when data changes\n */\nexport function useDomainAutoSave(\n  type: DomainType,\n  elementKey: string,\n  data: Record<string, unknown> | null,\n  options?: {\n    debounceMs?: number;\n    skipMount?: boolean;\n  },\n) {\n  const { debouncedAutoSave, isEnabled } = useAutoSave();\n  const mountedRef = useRef(false);\n  const lastDataRef = useRef<string | null>(null);\n\n  // Auto-save on mount and data changes\n  React.useEffect(() => {\n    if (!isEnabled || !data || !elementKey) return;\n\n    // Skip mount if requested\n    if (!mountedRef.current) {\n      mountedRef.current = true;\n      if (options?.skipMount) return;\n    }\n\n    // Serialize data for change detection\n    const serialized = JSON.stringify(data);\n    if (serialized === lastDataRef.current) return;\n    lastDataRef.current = serialized;\n\n    debouncedAutoSave({ type, elementKey, data }, options?.debounceMs);\n  }, [\n    type,\n    elementKey,\n    data,\n    isEnabled,\n    debouncedAutoSave,\n    options?.debounceMs,\n    options?.skipMount,\n  ]);\n}\n\nexport type {\n  DomainType,\n  AutoSaveContextValue,\n  AutoSavePayload,\n  AutoSaveResult,\n};\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  useEffect,\n  type ReactNode,\n} from \"react\";\nimport { useStore } from \"../store\";\nimport { useShallow } from \"zustand/react/shallow\";\n\n// Re-export types from store slices (which come from @onegenui/core)\nexport type {\n  ToolProgressStatus,\n  ToolProgressEvent,\n  StoredProgressEvent,\n} from \"../store/slices/tool-progress\";\n\n// Use the stored event type for internal state\nimport type { StoredProgressEvent } from \"../store/slices/tool-progress\";\n\n/**\n * Tool progress context value\n */\nexport interface ToolProgressContextValue {\n  /** All active tool progress events (not yet complete) */\n  activeProgress: StoredProgressEvent[];\n  /** All tool progress events (including complete) */\n  allProgress: StoredProgressEvent[];\n  /** Whether any tool is currently running */\n  isToolRunning: boolean;\n  /** Add a new tool progress event */\n  addProgress: (event: Omit<StoredProgressEvent, \"timestamp\" | \"type\">) => void;\n  /** Update an existing tool progress event */\n  updateProgress: (\n    toolCallId: string,\n    updates: Partial<\n      Omit<StoredProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) => void;\n  /** Clear all progress */\n  clearProgress: () => void;\n  /** Clear completed progress older than X ms */\n  clearCompletedOlderThan: (ms: number) => void;\n}\n\n/**\n * Tool progress provider props\n */\nexport interface ToolProgressProviderProps {\n  children: ReactNode;\n  /** Auto-clear completed progress after X ms (default: 3000) */\n  autoClearCompleteMs?: number;\n  /** Maximum number of progress events to keep (default: 50) */\n  maxEvents?: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst ToolProgressContext = createContext<ToolProgressContextValue | null>(\n  null,\n);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider - Now uses Zustand for state\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * ToolProgressProvider - Global provider for tool execution progress\n *\n * Wrap your app with this provider to enable automatic tool progress tracking.\n * The progress state is managed centrally via Zustand and can be consumed anywhere.\n */\nexport function ToolProgressProvider({\n  children,\n  autoClearCompleteMs = 3000,\n  maxEvents: _maxEvents = 50,\n}: ToolProgressProviderProps) {\n  // Bridge to Zustand store\n  const progressEvents = useStore((s) => s.progressEvents);\n  const addProgressEvent = useStore((s) => s.addProgressEvent);\n  const updateProgressEvent = useStore((s) => s.updateProgressEvent);\n  const clearProgressEvents = useStore((s) => s.clearProgressEvents);\n  const clearCompletedProgressOlderThan = useStore(\n    (s) => s.clearCompletedProgressOlderThan,\n  );\n  const getActiveProgress = useStore((s) => s.getActiveProgress);\n  const isToolRunning = useStore((s) => s.isToolRunning);\n\n  // Add a new progress event (wrapper for Zustand)\n  const addProgress = useCallback(\n    (event: Omit<StoredProgressEvent, \"timestamp\" | \"type\">) => {\n      addProgressEvent({\n        toolCallId: event.toolCallId,\n        toolName: event.toolName,\n        status: event.status,\n        message: event.message,\n        data: event.data,\n        progress: event.progress,\n      });\n    },\n    [addProgressEvent],\n  );\n\n  // Update an existing progress event (wrapper for Zustand)\n  const updateProgress = useCallback(\n    (\n      toolCallId: string,\n      updates: Partial<\n        Omit<StoredProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n      >,\n    ) => {\n      updateProgressEvent(toolCallId, updates);\n    },\n    [updateProgressEvent],\n  );\n\n  // Clear all progress (wrapper for Zustand)\n  const clearProgress = useCallback(() => {\n    clearProgressEvents();\n  }, [clearProgressEvents]);\n\n  // Clear completed progress older than X ms (wrapper for Zustand)\n  const clearCompletedOlderThan = useCallback(\n    (ms: number) => {\n      clearCompletedProgressOlderThan(ms);\n    },\n    [clearCompletedProgressOlderThan],\n  );\n\n  // Auto-clear completed progress\n  useEffect(() => {\n    if (autoClearCompleteMs <= 0) return;\n\n    const interval = setInterval(() => {\n      clearCompletedOlderThan(autoClearCompleteMs);\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [autoClearCompleteMs, clearCompletedOlderThan]);\n\n  // Computed values from Zustand\n  const activeProgress = getActiveProgress();\n  const toolRunning = isToolRunning();\n\n  const value = useMemo<ToolProgressContextValue>(\n    () => ({\n      activeProgress,\n      allProgress: progressEvents,\n      isToolRunning: toolRunning,\n      addProgress,\n      updateProgress,\n      clearProgress,\n      clearCompletedOlderThan,\n    }),\n    [\n      activeProgress,\n      progressEvents,\n      toolRunning,\n      addProgress,\n      updateProgress,\n      clearProgress,\n      clearCompletedOlderThan,\n    ],\n  );\n\n  return (\n    <ToolProgressContext.Provider value={value}>\n      {children}\n    </ToolProgressContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * useToolProgress - Access the tool progress context\n *\n * @throws Error if used outside of ToolProgressProvider\n */\nexport function useToolProgress(): ToolProgressContextValue {\n  const context = useContext(ToolProgressContext);\n  if (!context) {\n    throw new Error(\n      \"useToolProgress must be used within a ToolProgressProvider\",\n    );\n  }\n  return context;\n}\n\n/**\n * useToolProgressOptional - Access the tool progress context (optional)\n *\n * Returns null if used outside of ToolProgressProvider (doesn't throw)\n */\nexport function useToolProgressOptional(): ToolProgressContextValue | null {\n  return useContext(ToolProgressContext);\n}\n\n/**\n * useIsToolRunning - Check if any tool is currently running\n */\nexport function useIsToolRunning(): boolean {\n  // Select progressEvents directly and compute in selector for stability\n  return useStore((s) =>\n    s.progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    ),\n  );\n}\n\n/**\n * useActiveToolProgress - Get only active (running) tool progress\n */\nexport function useActiveToolProgress(): StoredProgressEvent[] {\n  // Use useShallow to prevent infinite loop - getActiveProgress returns new array each time\n  return useStore(\n    useShallow((s) =>\n      s.progressEvents.filter(\n        (e) => e.status === \"starting\" || e.status === \"progress\",\n      ),\n    ),\n  );\n}\n","/**\n * Unified Progress Context - Combines plan execution with tool progress\n *\n * Provides a single \"generating\" state that integrates:\n * - Plan steps (multi-agent orchestration)\n * - Tool progress (individual tool execution)\n *\n * This replaces separate usePlanState and useToolProgress with unified tracking.\n */\n\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useMemo,\n  useCallback,\n  type ReactNode,\n} from \"react\";\nimport { useStore } from \"../store\";\nimport { useShallow } from \"zustand/react/shallow\";\nimport type { PlanStep, PlanSubtask } from \"../store/slices/plan-execution\";\nimport type { StoredProgressEvent } from \"../store/slices/tool-progress\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type UnifiedProgressItemType = \"plan-step\" | \"plan-subtask\" | \"tool\";\nexport type UnifiedProgressStatus =\n  | \"pending\"\n  | \"running\"\n  | \"complete\"\n  | \"error\";\n\nexport interface UnifiedProgressItem {\n  id: string;\n  type: UnifiedProgressItemType;\n  label: string;\n  message?: string;\n  status: UnifiedProgressStatus;\n  progress?: number; // 0-100\n  startTime?: number;\n  endTime?: number;\n  parentId?: string; // For subtasks\n  children?: UnifiedProgressItem[]; // For plan steps with subtasks\n}\n\nexport interface UnifiedProgressState {\n  /** Whether any generation is in progress */\n  isGenerating: boolean;\n  /** Current goal/description of what's being generated */\n  goal: string | null;\n  /** All progress items (plan steps + tools) */\n  items: UnifiedProgressItem[];\n  /** Currently active items */\n  activeItems: UnifiedProgressItem[];\n  /** Overall progress percentage */\n  overallProgress: number;\n  /** Time elapsed since generation started (ms) */\n  elapsedTime: number | null;\n}\n\nexport interface UnifiedProgressContextValue extends UnifiedProgressState {\n  /** Get item by ID */\n  getItem: (id: string) => UnifiedProgressItem | undefined;\n  /** Check if a specific item is running */\n  isItemRunning: (id: string) => boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst UnifiedProgressContext =\n  createContext<UnifiedProgressContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface UnifiedProgressProviderProps {\n  children: ReactNode;\n}\n\nfunction mapPlanStepStatus(status: string): UnifiedProgressStatus {\n  switch (status) {\n    case \"running\":\n      return \"running\";\n    case \"complete\":\n      return \"complete\";\n    case \"error\":\n      return \"error\";\n    default:\n      return \"pending\";\n  }\n}\n\nfunction mapToolStatus(status: string): UnifiedProgressStatus {\n  switch (status) {\n    case \"starting\":\n    case \"progress\":\n      return \"running\";\n    case \"complete\":\n      return \"complete\";\n    case \"error\":\n      return \"error\";\n    default:\n      return \"pending\";\n  }\n}\n\nfunction subtaskToUnified(\n  subtask: PlanSubtask,\n  parentId: string,\n): UnifiedProgressItem {\n  return {\n    id: `subtask-${subtask.id}`,\n    type: \"plan-subtask\",\n    label: subtask.task,\n    status: mapPlanStepStatus(subtask.status),\n    startTime: subtask.startTime,\n    endTime: subtask.endTime,\n    parentId,\n  };\n}\n\nfunction stepToUnified(step: PlanStep): UnifiedProgressItem {\n  const id = `step-${step.id}`;\n  return {\n    id,\n    type: \"plan-step\",\n    label: step.task,\n    status: mapPlanStepStatus(step.status),\n    startTime: step.startTime,\n    endTime: step.endTime,\n    children: step.subtasks?.map((st) => subtaskToUnified(st, id)),\n  };\n}\n\nfunction toolToUnified(tool: StoredProgressEvent): UnifiedProgressItem {\n  return {\n    id: `tool-${tool.toolCallId}`,\n    type: \"tool\",\n    label: tool.toolName,\n    message: tool.message,\n    status: mapToolStatus(tool.status),\n    progress: tool.progress,\n    startTime: tool.timestamp,\n  };\n}\n\nexport function UnifiedProgressProvider({\n  children,\n}: UnifiedProgressProviderProps) {\n  // Get plan execution state\n  const planExecution = useStore((s) => s.planExecution);\n\n  // Get tool progress - use useShallow to prevent infinite loops\n  const progressEvents = useStore(useShallow((s) => s.progressEvents));\n\n  // Build unified items\n  const items = useMemo(() => {\n    const result: UnifiedProgressItem[] = [];\n\n    // Add plan steps\n    if (planExecution.plan) {\n      for (const step of planExecution.plan.steps) {\n        result.push(stepToUnified(step));\n      }\n    }\n\n    // Add tool progress (only if not in plan-based orchestration)\n    // During orchestration, tools are tracked via plan steps\n    if (!planExecution.isOrchestrating) {\n      for (const tool of progressEvents) {\n        result.push(toolToUnified(tool));\n      }\n    }\n\n    return result;\n  }, [planExecution.plan, planExecution.isOrchestrating, progressEvents]);\n\n  // Active items\n  const activeItems = useMemo(\n    () => items.filter((item) => item.status === \"running\"),\n    [items],\n  );\n\n  // Is generating\n  const isGenerating = useMemo(() => {\n    if (planExecution.isOrchestrating) return true;\n    return progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    );\n  }, [planExecution.isOrchestrating, progressEvents]);\n\n  // Goal\n  const goal = planExecution.plan?.goal ?? null;\n\n  // Overall progress\n  const overallProgress = useMemo(() => {\n    if (!planExecution.plan) {\n      // No plan - use tool progress\n      const activeTools = progressEvents.filter(\n        (p) => p.status === \"starting\" || p.status === \"progress\",\n      );\n      if (activeTools.length === 0) return 0;\n      const sum = activeTools.reduce((acc, t) => acc + (t.progress ?? 0), 0);\n      return Math.round(sum / activeTools.length);\n    }\n\n    // Plan-based progress\n    const steps = planExecution.plan.steps;\n    const completed = steps.filter((s) => s.status === \"complete\").length;\n    return steps.length > 0 ? Math.round((completed / steps.length) * 100) : 0;\n  }, [planExecution.plan, progressEvents]);\n\n  // Elapsed time\n  const elapsedTime = useMemo(() => {\n    if (!planExecution.orchestrationStartTime) return null;\n    if (!planExecution.isOrchestrating) return null;\n    return Date.now() - planExecution.orchestrationStartTime;\n  }, [planExecution.orchestrationStartTime, planExecution.isOrchestrating]);\n\n  // Getters\n  const getItem = useCallback(\n    (id: string) => items.find((item) => item.id === id),\n    [items],\n  );\n\n  const isItemRunning = useCallback(\n    (id: string) => {\n      const item = items.find((i) => i.id === id);\n      return item?.status === \"running\";\n    },\n    [items],\n  );\n\n  const value = useMemo<UnifiedProgressContextValue>(\n    () => ({\n      isGenerating,\n      goal,\n      items,\n      activeItems,\n      overallProgress,\n      elapsedTime,\n      getItem,\n      isItemRunning,\n    }),\n    [\n      isGenerating,\n      goal,\n      items,\n      activeItems,\n      overallProgress,\n      elapsedTime,\n      getItem,\n      isItemRunning,\n    ],\n  );\n\n  return (\n    <UnifiedProgressContext.Provider value={value}>\n      {children}\n    </UnifiedProgressContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * useUnifiedProgress - Access the unified progress context\n */\nexport function useUnifiedProgress(): UnifiedProgressContextValue {\n  const context = useContext(UnifiedProgressContext);\n  if (!context) {\n    throw new Error(\n      \"useUnifiedProgress must be used within a UnifiedProgressProvider\",\n    );\n  }\n  return context;\n}\n\n/**\n * useUnifiedProgressOptional - Access unified progress (optional)\n */\nexport function useUnifiedProgressOptional(): UnifiedProgressContextValue | null {\n  return useContext(UnifiedProgressContext);\n}\n\n/**\n * useIsGenerating - Check if any generation is in progress\n */\nexport function useIsGenerating(): boolean {\n  return useStore((s) => {\n    if (s.planExecution.isOrchestrating) return true;\n    return s.progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    );\n  });\n}\n\n/**\n * useGeneratingGoal - Get the current generation goal\n */\nexport function useGeneratingGoal(): string | null {\n  return useStore((s) => s.planExecution.plan?.goal ?? null);\n}\n","\"use client\";\n\nimport {\n  type ReactNode,\n  useEffect,\n  useRef,\n  createContext,\n  useContext,\n} from \"react\";\nimport type { UITree } from \"@onegenui/core\";\nimport type { TrackedAction } from \"../hooks/types\";\nimport { isSelectionInteraction } from \"../utils/dom\";\nimport {\n  getActionTypeFromEvent,\n  extractInteractionContext,\n  findClosestElementKey,\n} from \"../utils/selection\";\nimport { useSelection } from \"../contexts/selection\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type InteractionTrackingCallback = (\n  action: Omit<TrackedAction, \"id\" | \"timestamp\">,\n) => void;\n\nexport const InteractionTrackingContext =\n  createContext<InteractionTrackingCallback | null>(null);\n\nexport function useInteractionTracking(): InteractionTrackingCallback | null {\n  return useContext(InteractionTrackingContext);\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Non-proactive element detection (DRY - single place for this logic)\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Elements that should NOT trigger proactive AI\n * (navigation, media consumption - passive interactions)\n */\nfunction isNonProactiveElement(target: HTMLElement): boolean {\n  const tagName = target.tagName.toLowerCase();\n\n  // Links - navigation\n  if (tagName === \"a\" || target.closest(\"a[href]\")) return true;\n\n  // Media elements\n  if (\n    tagName === \"video\" ||\n    tagName === \"audio\" ||\n    tagName === \"img\" ||\n    target.closest(\"video, audio, img\")\n  ) {\n    return true;\n  }\n\n  // Media controls\n  if (\n    target.closest(\n      '[class*=\"video\"], [class*=\"audio\"], [class*=\"player\"], [class*=\"media\"]',\n    )\n  ) {\n    return true;\n  }\n\n  // Navigation-related\n  if (\n    target.getAttribute(\"role\") === \"link\" ||\n    target.closest('[role=\"link\"]') ||\n    target.hasAttribute(\"data-href\") ||\n    target.hasAttribute(\"data-navigate\")\n  ) {\n    return true;\n  }\n\n  return false;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Wrapper Component (Single Responsibility - only tracks interactions)\n//\n// Focus tracking is now handled globally by ActionProvider\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface InteractionTrackingWrapperProps {\n  children: ReactNode;\n  tree: UITree;\n  onInteraction: InteractionTrackingCallback;\n}\n\nexport function InteractionTrackingWrapper({\n  children,\n  tree,\n  onInteraction,\n}: InteractionTrackingWrapperProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Try to use selection context if available\n  let isDeepSelectionActive: (() => boolean) | undefined;\n  try {\n    const selectionContext = useSelection();\n    isDeepSelectionActive = selectionContext.isDeepSelectionActive;\n  } catch {\n    // Not in a SelectionProvider - isDeepSelectionActive remains undefined\n  }\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    const handleInteraction = (event: Event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) return;\n\n      // Skip selection interactions\n      if (isSelectionInteraction(target, isDeepSelectionActive)) return;\n\n      // Skip non-proactive elements\n      if (isNonProactiveElement(target)) return;\n\n      const elementKey = findClosestElementKey(target);\n      if (!elementKey) return;\n\n      const element = tree.elements[elementKey];\n      if (!element) return;\n\n      const actionType = getActionTypeFromEvent(target, event.type);\n      if (!actionType) return;\n\n      const context = extractInteractionContext(target, elementKey);\n\n      onInteraction({\n        type: actionType,\n        elementKey,\n        elementType: element.type,\n        context,\n      });\n    };\n\n    container.addEventListener(\"click\", handleInteraction, true);\n    container.addEventListener(\"change\", handleInteraction, true);\n\n    return () => {\n      container.removeEventListener(\"click\", handleInteraction, true);\n      container.removeEventListener(\"change\", handleInteraction, true);\n    };\n  }, [tree, onInteraction]);\n\n  return (\n    <InteractionTrackingContext.Provider value={onInteraction}>\n      <div ref={containerRef} style={{ display: \"contents\" }}>\n        {children}\n      </div>\n    </InteractionTrackingContext.Provider>\n  );\n}\n","import type { ActionType, TrackedAction } from \"../hooks/types\";\nimport { isInteractiveElement } from \"./dom\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Constants\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const DEFAULT_SELECTION_DELAY = 350;\nexport const MOVE_TOLERANCE_PX = 10;\nexport const EDGE_ZONE_SIZE = 16;\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Haptic Feedback\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function triggerHaptic(pattern: number | number[] = 50): void {\n  if (typeof navigator !== \"undefined\" && \"vibrate\" in navigator) {\n    try {\n      navigator.vibrate(pattern);\n    } catch {\n      // Ignore errors on unsupported devices\n    }\n  }\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Interactive Target Detection\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function isIgnoredTarget(target: EventTarget | null): boolean {\n  if (!(target instanceof HTMLElement)) return false;\n\n  if (target.closest(\"[data-jsonui-ignore-select]\")) return true;\n\n  // Skip editable elements when in edit mode\n  if (\n    target.closest(\".editable-text-node\") ||\n    target.closest(\"[data-editable='true']\") ||\n    target.closest(\"[contenteditable='true']\")\n  ) {\n    return true;\n  }\n\n  const tagName = target.tagName.toLowerCase();\n  if (\n    tagName === \"input\" ||\n    tagName === \"textarea\" ||\n    tagName === \"select\" ||\n    tagName === \"button\" ||\n    target.closest(\"button\") ||\n    target.isContentEditable ||\n    target.getAttribute(\"role\") === \"button\" ||\n    target.getAttribute(\"role\") === \"slider\" ||\n    target.getAttribute(\"role\") === \"tab\" ||\n    target.getAttribute(\"role\") === \"checkbox\" ||\n    target.getAttribute(\"role\") === \"switch\" ||\n    target.getAttribute(\"role\") === \"menuitem\"\n  ) {\n    return true;\n  }\n\n  if (\n    target.hasAttribute(\"draggable\") ||\n    target.closest(\"[draggable]\") ||\n    target.closest(\".react-draggable\") ||\n    target.closest(\"[data-drag-handle]\") ||\n    target.closest(\"[data-interactive]\")\n  ) {\n    return true;\n  }\n\n  if (tagName === \"a\" || target.closest(\"a\")) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function isInEdgeZone(\n  clientX: number,\n  clientY: number,\n  rect: DOMRect,\n  edgeSize: number = EDGE_ZONE_SIZE,\n): boolean {\n  const inLeftEdge = clientX < rect.left + edgeSize;\n  const inRightEdge = clientX > rect.right - edgeSize;\n  const inTopEdge = clientY < rect.top + edgeSize;\n  const inBottomEdge = clientY > rect.bottom - edgeSize;\n\n  return inLeftEdge || inRightEdge || inTopEdge || inBottomEdge;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Interaction Tracking Utilities\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function getActionTypeFromEvent(\n  target: HTMLElement,\n  eventType: string,\n): ActionType | null {\n  const tagName = target.tagName.toLowerCase();\n  const inputType = target.getAttribute(\"type\")?.toLowerCase();\n  const role = target.getAttribute(\"role\")?.toLowerCase();\n\n  if (\n    (tagName === \"input\" && inputType === \"checkbox\") ||\n    role === \"checkbox\" ||\n    target.hasAttribute(\"data-checkbox\")\n  ) {\n    return \"toggle\";\n  }\n\n  if (\n    tagName === \"select\" ||\n    (tagName === \"input\" && inputType === \"radio\") ||\n    role === \"listbox\" ||\n    role === \"option\"\n  ) {\n    return \"select\";\n  }\n\n  if (\n    tagName === \"input\" ||\n    tagName === \"textarea\" ||\n    role === \"textbox\" ||\n    target.isContentEditable\n  ) {\n    return eventType === \"change\" ? \"input\" : null;\n  }\n\n  if (\n    tagName === \"button\" ||\n    role === \"button\" ||\n    target.hasAttribute(\"data-interactive\")\n  ) {\n    return \"click\";\n  }\n\n  if (eventType === \"click\") {\n    if (isInteractiveElement(target)) {\n      return \"click\";\n    }\n  }\n\n  return null;\n}\n\nexport function extractInteractionContext(\n  target: HTMLElement,\n  _elementKey: string,\n): TrackedAction[\"context\"] {\n  const context: TrackedAction[\"context\"] = {};\n\n  const selectableItem = target.closest(\"[data-selectable-item]\");\n  if (selectableItem instanceof HTMLElement) {\n    const itemId = selectableItem.getAttribute(\"data-item-id\");\n    if (itemId) {\n      context.itemId = itemId;\n    }\n  }\n\n  const textContent =\n    target.textContent?.trim().substring(0, 100) ||\n    target.getAttribute(\"aria-label\") ||\n    target.getAttribute(\"title\");\n\n  if (textContent) {\n    context.itemLabel = textContent;\n  }\n\n  if (target instanceof HTMLInputElement) {\n    if (target.type === \"checkbox\") {\n      context.newValue = target.checked;\n      context.previousValue = !target.checked;\n    } else {\n      context.newValue = target.value;\n    }\n  } else if (target instanceof HTMLSelectElement) {\n    context.newValue = target.value;\n    const selectedOption = target.options[target.selectedIndex];\n    if (selectedOption) {\n      context.itemLabel = selectedOption.text;\n    }\n  } else if (target instanceof HTMLTextAreaElement) {\n    context.newValue = target.value;\n  }\n\n  return context;\n}\n\nexport function findClosestElementKey(target: HTMLElement): string | null {\n  const elementWrapper = target.closest(\"[data-jsonui-element-key]\");\n  if (elementWrapper instanceof HTMLElement) {\n    return elementWrapper.getAttribute(\"data-jsonui-element-key\");\n  }\n  return null;\n}\n","/**\n * ErrorBoundary - React error boundary for graceful error handling\n * \n * Catches JavaScript errors in child component tree, logs them,\n * and displays a fallback UI instead of crashing the whole app.\n * \n * @example\n * <ErrorBoundary fallback={<ErrorFallback />}>\n *   <Renderer tree={tree} />\n * </ErrorBoundary>\n * \n * @example\n * // With error callback\n * <ErrorBoundary \n *   onError={(error, info) => reportToSentry(error, info)}\n *   fallback={<p>Something went wrong</p>}\n * >\n *   <App />\n * </ErrorBoundary>\n */\n\nimport { Component, type ReactNode, type ErrorInfo } from \"react\";\nimport { createLogger } from \"@onegenui/utils\";\n\nconst logger = createLogger({ prefix: \"react:error-boundary\" });\n\nexport interface ErrorBoundaryProps {\n  /** Fallback UI to show when an error occurs */\n  fallback?: ReactNode | ((error: Error, reset: () => void) => ReactNode);\n  /** Callback when an error is caught */\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n  /** Children to render */\n  children: ReactNode;\n  /** Optional name for logging/debugging */\n  name?: string;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n}\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    const { onError, name } = this.props;\n    \n    logger.error(\n      `Error caught${name ? ` in ${name}` : \"\"}:`,\n      error.message,\n      errorInfo.componentStack,\n    );\n    \n    onError?.(error, errorInfo);\n  }\n\n  reset = (): void => {\n    this.setState({ hasError: false, error: null });\n  };\n\n  render(): ReactNode {\n    const { hasError, error } = this.state;\n    const { children, fallback } = this.props;\n\n    if (hasError && error) {\n      if (typeof fallback === \"function\") {\n        return fallback(error, this.reset);\n      }\n      \n      if (fallback) {\n        return fallback;\n      }\n      \n      // Default fallback UI\n      return (\n        <div\n          role=\"alert\"\n          className=\"p-4 rounded-lg bg-destructive/10 border border-destructive/20 text-destructive\"\n        >\n          <h3 className=\"font-semibold mb-2\">Something went wrong</h3>\n          <p className=\"text-sm text-muted-foreground mb-3\">{error.message}</p>\n          <button\n            onClick={this.reset}\n            className=\"px-3 py-1.5 text-sm rounded bg-destructive/20 hover:bg-destructive/30 transition-colors\"\n          >\n            Try again\n          </button>\n        </div>\n      );\n    }\n\n    return children;\n  }\n}\n\n/**\n * Default error fallback component\n */\nexport interface ErrorFallbackProps {\n  error: Error;\n  reset: () => void;\n  title?: string;\n}\n\nexport function ErrorFallback({ \n  error, \n  reset, \n  title = \"Something went wrong\" \n}: ErrorFallbackProps): ReactNode {\n  return (\n    <div\n      role=\"alert\"\n      className=\"p-4 rounded-lg bg-destructive/10 border border-destructive/20 text-destructive\"\n    >\n      <h3 className=\"font-semibold mb-2\">{title}</h3>\n      <p className=\"text-sm text-muted-foreground mb-3\">{error.message}</p>\n      <button\n        onClick={reset}\n        className=\"px-3 py-1.5 text-sm rounded bg-destructive/20 hover:bg-destructive/30 transition-colors\"\n      >\n        Try again\n      </button>\n    </div>\n  );\n}\n\n/**\n * Higher-order component to wrap a component with error boundary\n */\nexport function withErrorBoundary<P extends object>(\n  WrappedComponent: React.ComponentType<P>,\n  options: Omit<ErrorBoundaryProps, \"children\"> = {},\n): React.FC<P> {\n  const displayName = WrappedComponent.displayName || WrappedComponent.name || \"Component\";\n  \n  const WithErrorBoundary: React.FC<P> = (props) => (\n    <ErrorBoundary {...options} name={displayName}>\n      <WrappedComponent {...props} />\n    </ErrorBoundary>\n  );\n  \n  WithErrorBoundary.displayName = `withErrorBoundary(${displayName})`;\n  \n  return WithErrorBoundary;\n}\n","\"use client\";\n\nimport React, { type ReactNode, useMemo } from \"react\";\nimport type { UIElement, UITree } from \"@onegenui/core\";\nimport { useIsVisible } from \"../contexts/visibility\";\nimport { useActions } from \"../contexts/actions\";\nimport { useMarkdown } from \"../contexts/markdown\";\nimport { useEditMode } from \"../contexts/edit-mode\";\nimport { ResizableWrapper } from \"../components/ResizableWrapper\";\nimport { SelectionWrapper } from \"../components/SelectionWrapper\";\nimport { EditableWrapper } from \"../components/EditableWrapper\";\nimport { createRenderEditableText } from \"../hooks/useRenderEditableText\";\nimport type { ComponentRegistry, ComponentRenderer } from \"./types\";\n\ninterface ElementRendererProps {\n  element: UIElement;\n  tree: UITree;\n  registry: ComponentRegistry;\n  loading?: boolean;\n  fallback?: ComponentRenderer;\n  selectable?: boolean;\n  onElementSelect?: (element: UIElement) => void;\n  selectionDelayMs: number;\n  selectedKey?: string | null;\n  onResize?: (\n    elementKey: string,\n    size: { width: number; height: number },\n  ) => void;\n}\n\n/**\n * Recursively checks if any descendant element has changed between two trees.\n * This ensures parent components re-render when deeply nested children update.\n */\nfunction hasDescendantChanged(\n  elementKey: string,\n  prevTree: UITree,\n  nextTree: UITree,\n  visited: Set<string> = new Set(),\n): boolean {\n  // Prevent infinite loops in case of circular references\n  if (visited.has(elementKey)) return false;\n  visited.add(elementKey);\n\n  const prevElement = prevTree.elements[elementKey];\n  const nextElement = nextTree.elements[elementKey];\n\n  // Element itself changed\n  if (prevElement !== nextElement) {\n    return true;\n  }\n\n  // Check all children recursively\n  const children = prevElement?.children;\n  if (children) {\n    for (const childKey of children) {\n      if (hasDescendantChanged(childKey, prevTree, nextTree, visited)) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\n/**\n * Memoization comparator: structural sharing in patch-utils.ts means only\n * modified elements get new references. This enables O(1) equality checks\n * for leaf nodes, with recursive descent for container components.\n */\nfunction elementRendererPropsAreEqual(\n  prevProps: ElementRendererProps,\n  nextProps: ElementRendererProps,\n): boolean {\n  // Element reference check (structural sharing)\n  if (prevProps.element !== nextProps.element) {\n    return false;\n  }\n\n  const wasSelected = prevProps.selectedKey === prevProps.element.key;\n  const isSelected = nextProps.selectedKey === nextProps.element.key;\n  if (wasSelected !== isSelected) {\n    return false;\n  }\n\n  if (prevProps.loading !== nextProps.loading) {\n    return false;\n  }\n\n  // CRITICAL: When tree changes, check if THIS element or ANY descendant changed\n  // This ensures containers re-render when deeply nested children update\n  if (prevProps.tree !== nextProps.tree) {\n    if (hasDescendantChanged(\n      prevProps.element.key,\n      prevProps.tree,\n      nextProps.tree,\n    )) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport const ElementRenderer = React.memo(function ElementRenderer({\n  element,\n  tree,\n  registry,\n  loading,\n  fallback,\n  selectable,\n  onElementSelect,\n  selectionDelayMs,\n  selectedKey,\n  onResize,\n}: ElementRendererProps) {\n  // All hooks MUST be called before any conditional returns (Rules of Hooks)\n  const isVisible = useIsVisible(element.visible);\n  const { execute } = useActions();\n  const { renderText } = useMarkdown();\n  const { isEditing } = useEditMode();\n\n  // Create renderEditableText function for this element (must be before conditionals)\n  const renderEditableText = useMemo(\n    () => createRenderEditableText(element, isEditing),\n    [element, isEditing],\n  );\n\n  if (!isVisible) {\n    return null;\n  }\n\n  if (\n    element.type === \"__placeholder__\" ||\n    (element._meta as any)?.isPlaceholder\n  ) {\n    return (\n      <div\n        key={element.key}\n        className=\"w-full h-16 bg-muted/10 animate-pulse rounded-lg my-2 border border-border/20\"\n        data-placeholder-for={element.key}\n      />\n    );\n  }\n\n  const Component = registry[element.type] ?? fallback;\n\n  if (!Component) {\n    console.warn(`No renderer for component type: ${element.type}`);\n    return null;\n  }\n\n  const children = element.children?.map((childKey, index) => {\n    const childElement = tree.elements[childKey];\n    if (!childElement) {\n      if (loading) {\n        return (\n          <div\n            key={`${childKey}-skeleton`}\n            className=\"w-full h-12 bg-muted/10 animate-pulse rounded-md my-1\"\n          />\n        );\n      }\n      return null;\n    }\n    return (\n      <ElementRenderer\n        key={`${childKey}-${index}`}\n        element={childElement}\n        tree={tree}\n        registry={registry}\n        loading={loading}\n        fallback={fallback}\n        selectable={selectable}\n        onElementSelect={onElementSelect}\n        selectionDelayMs={selectionDelayMs}\n        selectedKey={selectedKey}\n        onResize={onResize}\n      />\n    );\n  });\n\n  const isResizable = element.layout?.resizable !== false;\n  // All elements are editable by default when in edit mode\n  // unless explicitly disabled (editable: false) or locked\n  const isEditable =\n    isEditing && element.editable !== false && !element.locked;\n\n  const content = (\n    <Component\n      element={element}\n      onAction={execute}\n      loading={loading}\n      renderText={renderText}\n      renderEditableText={renderEditableText}\n    >\n      {children}\n    </Component>\n  );\n\n  // Wrap with EditableWrapper if editing is enabled (for automatic text detection)\n  const editableContent = isEditable ? (\n    <EditableWrapper element={element}>{content}</EditableWrapper>\n  ) : (\n    content\n  );\n\n  if (selectable && onElementSelect) {\n    const selectionContent = (\n      <SelectionWrapper\n        element={element}\n        enabled={selectable}\n        onSelect={onElementSelect}\n        delayMs={selectionDelayMs}\n        isSelected={selectedKey === element.key}\n      >\n        {editableContent}\n      </SelectionWrapper>\n    );\n\n    if (isResizable) {\n      return (\n        <ResizableWrapper\n          element={element}\n          onResize={onResize}\n          showHandles={selectedKey === element.key}\n        >\n          {selectionContent}\n        </ResizableWrapper>\n      );\n    }\n\n    return selectionContent;\n  }\n\n  if (isResizable) {\n    return (\n      <ResizableWrapper element={element} onResize={onResize}>\n        {editableContent}\n      </ResizableWrapper>\n    );\n  }\n\n  return editableContent;\n}, elementRendererPropsAreEqual);\n","\"use client\";\n\nimport React, { useRef, useCallback, useMemo } from \"react\";\nimport type { UIElement, ElementLayout } from \"@onegenui/core\";\nimport {\n  useResizable,\n  type ResizeHandle,\n  type ResizeState,\n  getResizeCursor,\n} from \"../hooks/useResizable\";\nimport { cn } from \"../utils\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ResizableWrapperProps {\n  /** The UI element being rendered */\n  element: UIElement;\n  /** Child content to render */\n  children: React.ReactNode;\n  /** Override layout config */\n  layout?: ElementLayout;\n  /** Callback when element is resized */\n  onResize?: (\n    elementKey: string,\n    size: { width: number; height: number },\n  ) => void;\n  /** Custom className */\n  className?: string;\n  /** Whether resize is enabled (overrides element.layout.resizable) */\n  enabled?: boolean;\n  /** Force handles visible (e.g., when element is selected) */\n  showHandles?: boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Handle Component\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface ResizeHandleComponentProps {\n  position: ResizeHandle;\n  onMouseDown: (e: React.MouseEvent) => void;\n  onTouchStart: (e: React.TouchEvent) => void;\n  isResizing: boolean;\n  visible: boolean;\n}\n\nfunction ResizeHandleComponent({\n  position,\n  onMouseDown,\n  onTouchStart,\n  isResizing,\n  visible,\n}: ResizeHandleComponentProps) {\n  const [isHovered, setIsHovered] = React.useState(false);\n  const [isTouching, setIsTouching] = React.useState(false);\n\n  // Position classes map\n  const positionClasses: Record<ResizeHandle, string> = {\n    e: \"right-[-4px] top-0 bottom-0 w-2 cursor-ew-resize\",\n    w: \"left-[-4px] top-0 bottom-0 w-2 cursor-ew-resize\",\n    s: \"bottom-[-4px] left-0 right-0 h-2 cursor-ns-resize\",\n    n: \"top-[-4px] left-0 right-0 h-2 cursor-ns-resize\",\n    se: \"right-[-6px] bottom-[-6px] w-3 h-3 cursor-nwse-resize rounded-full\",\n    sw: \"left-[-6px] bottom-[-6px] w-3 h-3 cursor-nesw-resize rounded-full\",\n    ne: \"right-[-6px] top-[-6px] w-3 h-3 cursor-nesw-resize rounded-full\",\n    nw: \"left-[-6px] top-[-6px] w-3 h-3 cursor-nwse-resize rounded-full\",\n  };\n\n  return (\n    <div\n      className={cn(\n        \"absolute z-10 opacity-0 transition-opacity duration-150 bg-transparent\",\n        positionClasses[position],\n        (visible || isResizing || isTouching) && \"opacity-100\",\n        (isHovered || isResizing) && \"bg-primary\",\n      )}\n      onMouseDown={onMouseDown}\n      onTouchStart={(e) => {\n        setIsTouching(true);\n        onTouchStart(e);\n      }}\n      onTouchEnd={() => setIsTouching(false)}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      role=\"separator\"\n      aria-orientation={\n        position === \"e\" || position === \"w\" ? \"vertical\" : \"horizontal\"\n      }\n      aria-label={`Resize ${position}`}\n      data-resize-handle={position}\n    />\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Main Component\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Wrapper component that adds resize handles to its children.\n *\n * Reads configuration from `element.layout.resizable` or accepts overrides via props.\n * Handles are only shown when the wrapper is hovered.\n *\n * @example\n * ```tsx\n * <ResizableWrapper\n *   element={element}\n *   onResize={(key, size) => console.log(`${key} resized to ${size.width}x${size.height}`)}\n * >\n *   <Card {...cardProps} />\n * </ResizableWrapper>\n * ```\n */\nexport function ResizableWrapper({\n  element,\n  children,\n  layout: overrideLayout,\n  onResize,\n  className,\n  enabled: overrideEnabled,\n  showHandles = false,\n}: ResizableWrapperProps) {\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const [isHovered, setIsHovered] = React.useState(false);\n\n  // Merge layout from element and overrides\n  const layout = overrideLayout ?? element.layout;\n  const resizableConfig = layout?.resizable;\n\n  // Determine if resizing is enabled (default true unless explicitly false)\n  const isEnabled =\n    overrideEnabled !== undefined ? overrideEnabled : resizableConfig !== false;\n\n  // Normalize config to default enabled behavior\n  const normalizedConfig =\n    resizableConfig === undefined ? true : resizableConfig;\n\n  // Callback when resize ends\n  const handleResizeEnd = useCallback(\n    (state: ResizeState) => {\n      if (!onResize) return;\n      onResize(element.key, { width: state.width, height: state.height });\n    },\n    [element.key, onResize],\n  );\n\n  const {\n    state,\n    startResize,\n    resizeConfig,\n    style: resizeStyle,\n  } = useResizable({\n    initialSize: layout?.size,\n    config: normalizedConfig,\n    onResizeEnd: handleResizeEnd,\n    elementRef: wrapperRef,\n  });\n\n  // If not resizable, just render children directly\n  if (!isEnabled) {\n    return <>{children}</>;\n  }\n\n  // Determine which handles to show (memoized for performance)\n  const handles = useMemo((): ResizeHandle[] => {\n    const result: ResizeHandle[] = [];\n    if (resizeConfig.horizontal) {\n      result.push(\"e\", \"w\");\n    }\n    if (resizeConfig.vertical) {\n      result.push(\"s\", \"n\");\n    }\n    if (resizeConfig.horizontal && resizeConfig.vertical) {\n      result.push(\"se\", \"sw\", \"ne\", \"nw\");\n    }\n    return result;\n  }, [resizeConfig.horizontal, resizeConfig.vertical]);\n\n  // Build grid column/row styles properly (avoid conflicts)\n  const gridColumnStyle = (() => {\n    const col = layout?.grid?.column;\n    const span = layout?.grid?.columnSpan;\n    if (col && span && span > 1) {\n      return `${col} / span ${span}`;\n    }\n    if (span && span > 1) {\n      return `span ${span}`;\n    }\n    if (col) {\n      return col;\n    }\n    return undefined;\n  })();\n\n  const gridRowStyle = (() => {\n    const row = layout?.grid?.row;\n    const span = layout?.grid?.rowSpan;\n    if (row && span && span > 1) {\n      return `${row} / span ${span}`;\n    }\n    if (span && span > 1) {\n      return `span ${span}`;\n    }\n    if (row) {\n      return row;\n    }\n    return undefined;\n  })();\n\n  // Combine styles\n  const combinedStyle: React.CSSProperties = {\n    ...resizeStyle,\n    // Apply grid layout if configured (properly merged)\n    ...(gridColumnStyle && { gridColumn: gridColumnStyle }),\n    ...(gridRowStyle && { gridRow: gridRowStyle }),\n  };\n\n  const shouldShowHandles = showHandles || isHovered || state.isResizing;\n\n  return (\n    <div\n      ref={wrapperRef}\n      style={combinedStyle}\n      className={cn(\n        \"relative box-border\",\n        state.isResizing && \"outline-[2px] outline-primary outline-offset-2\",\n        className,\n      )}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      data-resizable=\"true\"\n      data-element-key={element.key}\n    >\n      {children}\n\n      {/* Render resize handles */}\n      {handles.map((handle) => (\n        <ResizeHandleComponent\n          key={handle}\n          position={handle}\n          onMouseDown={(e) => startResize(handle, e)}\n          onTouchStart={(e) => startResize(handle, e)}\n          isResizing={state.isResizing && state.activeHandle === handle}\n          visible={shouldShowHandles}\n        />\n      ))}\n\n      {/* Size indicator during resize */}\n      {state.isResizing && (\n        <div className=\"absolute bottom-2 right-2 px-2 py-1 bg-primary text-white text-[11px] font-medium rounded pointer-events-none z-11\">\n          {Math.round(state.width)} x {Math.round(state.height)}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Re-export types for convenience\nexport type { ResizeHandle, ResizeState };\nexport { getResizeCursor };\n","import type { ElementSize, ElementResizeConfig } from \"@onegenui/core\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type ResizeHandle = \"e\" | \"s\" | \"se\" | \"sw\" | \"n\" | \"w\" | \"ne\" | \"nw\";\n\nexport interface ResizeState {\n  /** Current width in pixels */\n  width: number;\n  /** Current height in pixels */\n  height: number;\n  /** Whether the element is currently being resized */\n  isResizing: boolean;\n  /** The active resize handle */\n  activeHandle: ResizeHandle | null;\n}\n\nexport interface UseResizableOptions {\n  /** Initial size configuration */\n  initialSize?: ElementSize;\n  /** Resize behavior configuration */\n  config?: ElementResizeConfig | boolean;\n  /** Callback when resize starts */\n  onResizeStart?: (state: ResizeState) => void;\n  /** Callback during resize */\n  onResize?: (state: ResizeState) => void;\n  /** Callback when resize ends */\n  onResizeEnd?: (state: ResizeState) => void;\n  /** Element ref to measure initial size */\n  elementRef?: React.RefObject<HTMLElement | null>;\n  /** Constrain resize to container boundaries (default: true) */\n  constrainToContainer?: boolean;\n}\n\nexport interface UseResizableReturn {\n  /** Current resize state */\n  state: ResizeState;\n  /** Start resizing from a handle */\n  startResize: (\n    handle: ResizeHandle,\n    e: React.MouseEvent | React.TouchEvent,\n  ) => void;\n  /** Stop resizing */\n  stopResize: () => void;\n  /** Reset to initial size */\n  reset: () => void;\n  /** Get resize config (normalized from boolean) */\n  resizeConfig: ElementResizeConfig;\n  /** Style object to apply to the element */\n  style: React.CSSProperties;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Constants\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const MOBILE_BREAKPOINT = 768;\n","import type { ElementResizeConfig } from \"@onegenui/core\";\nimport type { ResizeHandle } from \"./types\";\n\n/**\n * Parse size value (number or CSS string) to number\n */\nexport function parseSize(\n  value: number | string | undefined,\n  fallback: number,\n): number {\n  if (value === undefined) return fallback;\n  if (typeof value === \"number\") return value;\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? fallback : parsed;\n}\n\n/**\n * Normalize config (boolean or object) to object\n */\nexport function normalizeConfig(\n  config: ElementResizeConfig | boolean | undefined,\n): ElementResizeConfig {\n  if (config === undefined || config === false) {\n    return { horizontal: false, vertical: false };\n  }\n  if (config === true) {\n    return { horizontal: true, vertical: true };\n  }\n  return config;\n}\n\n/**\n * Snap value to grid\n */\nexport function snapToGrid(\n  value: number,\n  gridSize: number | undefined,\n): number {\n  if (!gridSize || gridSize <= 0) return value;\n  return Math.round(value / gridSize) * gridSize;\n}\n\n/**\n * Find the closest scrollable container to constrain resize bounds\n */\nexport function findScrollableContainer(\n  element: HTMLElement | null,\n): HTMLElement | null {\n  if (!element) return null;\n\n  let parent = element.parentElement;\n  while (parent) {\n    const style = window.getComputedStyle(parent);\n    const overflowY = style.overflowY;\n    const overflowX = style.overflowX;\n\n    if (\n      overflowY === \"auto\" ||\n      overflowY === \"scroll\" ||\n      overflowX === \"auto\" ||\n      overflowX === \"scroll\" ||\n      parent.hasAttribute(\"data-render-container\")\n    ) {\n      return parent;\n    }\n\n    parent = parent.parentElement;\n  }\n\n  return document.body;\n}\n\n/**\n * Calculate max dimensions based on container bounds and element position\n */\nexport function getContainerConstraints(\n  element: HTMLElement,\n  container: HTMLElement,\n  handle: ResizeHandle,\n): { maxWidth: number; maxHeight: number } {\n  const elementRect = element.getBoundingClientRect();\n  const containerRect = container.getBoundingClientRect();\n\n  let maxWidth = Infinity;\n  let maxHeight = Infinity;\n\n  if (handle.includes(\"e\")) {\n    maxWidth = containerRect.right - elementRect.left - 16;\n  }\n  if (handle.includes(\"w\")) {\n    maxWidth = elementRect.right - containerRect.left - 16;\n  }\n  if (handle.includes(\"s\")) {\n    maxHeight = Math.max(containerRect.height * 2, 1000);\n  }\n  if (handle.includes(\"n\")) {\n    maxHeight = elementRect.bottom - containerRect.top - 16;\n  }\n\n  return { maxWidth, maxHeight };\n}\n\n/**\n * Get CSS cursor for a resize handle\n */\nexport function getCursorForHandle(handle: ResizeHandle | null): string {\n  switch (handle) {\n    case \"e\":\n    case \"w\":\n      return \"ew-resize\";\n    case \"n\":\n    case \"s\":\n      return \"ns-resize\";\n    case \"se\":\n    case \"nw\":\n      return \"nwse-resize\";\n    case \"sw\":\n    case \"ne\":\n      return \"nesw-resize\";\n    default:\n      return \"\";\n  }\n}\n\n/**\n * Get the CSS cursor for a resize handle (exported alias)\n */\nexport function getResizeCursor(handle: ResizeHandle): string {\n  return getCursorForHandle(handle);\n}\n","\"use client\";\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\nimport type {\n  ResizeState,\n  ResizeHandle,\n  UseResizableOptions,\n  UseResizableReturn,\n} from \"./types\";\nimport { MOBILE_BREAKPOINT } from \"./types\";\nimport {\n  parseSize,\n  normalizeConfig,\n  snapToGrid,\n  findScrollableContainer,\n  getContainerConstraints,\n  getCursorForHandle,\n} from \"./utils\";\n\n/**\n * Hook to handle element resizing with mouse/touch drag.\n *\n * @example\n * ```tsx\n * function ResizableCard() {\n *   const ref = useRef<HTMLDivElement>(null);\n *   const { state, startResize, style } = useResizable({\n *     initialSize: { width: 300, height: 200 },\n *     config: { horizontal: true, vertical: true },\n *     elementRef: ref,\n *   });\n *\n *   return (\n *     <div ref={ref} style={style}>\n *       <ResizeHandle position=\"se\" onMouseDown={(e) => startResize('se', e)} />\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useResizable({\n  initialSize,\n  config,\n  onResizeStart,\n  onResize,\n  onResizeEnd,\n  elementRef,\n  constrainToContainer = true,\n}: UseResizableOptions = {}): UseResizableReturn {\n  const resizeConfig = normalizeConfig(config);\n\n  const initialWidth = parseSize(initialSize?.width, 0);\n  const initialHeight = parseSize(initialSize?.height, 0);\n  const hasExplicitSize = initialWidth > 0 || initialHeight > 0;\n\n  const [state, setState] = useState<ResizeState>({\n    width: initialWidth,\n    height: initialHeight,\n    isResizing: false,\n    activeHandle: null,\n  });\n\n  const [hasResized, setHasResized] = useState(hasExplicitSize);\n  const dragStart = useRef({ x: 0, y: 0, width: 0, height: 0 });\n  const containerRef = useRef<HTMLElement | null>(null);\n  const lastBreakpointRef = useRef<\"mobile\" | \"desktop\" | null>(null);\n\n  // Reset resize on breakpoint change\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const checkBreakpoint = () => {\n      const currentBreakpoint =\n        window.innerWidth <= MOBILE_BREAKPOINT ? \"mobile\" : \"desktop\";\n\n      if (\n        lastBreakpointRef.current !== null &&\n        lastBreakpointRef.current !== currentBreakpoint\n      ) {\n        setHasResized(false);\n        setState({\n          width: initialWidth,\n          height: initialHeight,\n          isResizing: false,\n          activeHandle: null,\n        });\n      }\n\n      lastBreakpointRef.current = currentBreakpoint;\n    };\n\n    checkBreakpoint();\n\n    const mediaQuery = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT}px)`);\n    mediaQuery.addEventListener(\"change\", checkBreakpoint);\n\n    return () => {\n      mediaQuery.removeEventListener(\"change\", checkBreakpoint);\n    };\n  }, [initialWidth, initialHeight]);\n\n  const startResize = useCallback(\n    (handle: ResizeHandle, e: React.MouseEvent | React.TouchEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const clientX = \"touches\" in e ? (e.touches[0]?.clientX ?? 0) : e.clientX;\n      const clientY = \"touches\" in e ? (e.touches[0]?.clientY ?? 0) : e.clientY;\n\n      let currentWidth = state.width;\n      let currentHeight = state.height;\n\n      if (elementRef?.current) {\n        const rect = elementRef.current.getBoundingClientRect();\n        currentWidth = rect.width;\n        currentHeight = rect.height;\n\n        if (constrainToContainer) {\n          containerRef.current = findScrollableContainer(elementRef.current);\n        }\n      }\n\n      dragStart.current = {\n        x: clientX,\n        y: clientY,\n        width: currentWidth,\n        height: currentHeight,\n      };\n\n      const newState: ResizeState = {\n        width: currentWidth,\n        height: currentHeight,\n        isResizing: true,\n        activeHandle: handle,\n      };\n\n      setState(newState);\n      onResizeStart?.(newState);\n    },\n    [\n      state.width,\n      state.height,\n      elementRef,\n      onResizeStart,\n      constrainToContainer,\n    ],\n  );\n\n  const stopResize = useCallback(() => {\n    setState((prev) => {\n      if (!prev.isResizing) return prev;\n\n      const finalState: ResizeState = {\n        ...prev,\n        isResizing: false,\n        activeHandle: null,\n      };\n\n      setHasResized(true);\n\n      if (onResizeEnd) {\n        queueMicrotask(() => {\n          onResizeEnd(finalState);\n        });\n      }\n\n      return finalState;\n    });\n\n    containerRef.current = null;\n  }, [onResizeEnd]);\n\n  const reset = useCallback(() => {\n    setState({\n      width: initialWidth,\n      height: initialHeight,\n      isResizing: false,\n      activeHandle: null,\n    });\n    setHasResized(hasExplicitSize);\n  }, [initialWidth, initialHeight, hasExplicitSize]);\n\n  // Handle mouse/touch move during resize\n  useEffect(() => {\n    if (!state.isResizing || !state.activeHandle) return;\n\n    const handleMove = (e: MouseEvent | TouchEvent) => {\n      const clientX = \"touches\" in e ? (e.touches[0]?.clientX ?? 0) : e.clientX;\n      const clientY = \"touches\" in e ? (e.touches[0]?.clientY ?? 0) : e.clientY;\n\n      const deltaX = clientX - dragStart.current.x;\n      const deltaY = clientY - dragStart.current.y;\n\n      let newWidth = dragStart.current.width;\n      let newHeight = dragStart.current.height;\n\n      const handle = state.activeHandle!;\n\n      if (handle.includes(\"e\") && resizeConfig.horizontal) {\n        newWidth = dragStart.current.width + deltaX;\n      }\n      if (handle.includes(\"w\") && resizeConfig.horizontal) {\n        newWidth = dragStart.current.width - deltaX;\n      }\n      if (handle.includes(\"s\") && resizeConfig.vertical) {\n        newHeight = dragStart.current.height + deltaY;\n      }\n      if (handle.includes(\"n\") && resizeConfig.vertical) {\n        newHeight = dragStart.current.height - deltaY;\n      }\n\n      let minWidth = initialSize?.minWidth ?? 50;\n      let maxWidth = initialSize?.maxWidth ?? Infinity;\n      let minHeight = initialSize?.minHeight ?? 50;\n      let maxHeight = initialSize?.maxHeight ?? Infinity;\n\n      if (constrainToContainer && containerRef.current && elementRef?.current) {\n        const containerConstraints = getContainerConstraints(\n          elementRef.current,\n          containerRef.current,\n          handle,\n        );\n        maxWidth = Math.min(maxWidth, containerConstraints.maxWidth);\n        maxHeight = Math.min(maxHeight, containerConstraints.maxHeight);\n      }\n\n      newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));\n      newHeight = Math.max(minHeight, Math.min(maxHeight, newHeight));\n\n      newWidth = snapToGrid(newWidth, resizeConfig.snapToGrid);\n      newHeight = snapToGrid(newHeight, resizeConfig.snapToGrid);\n\n      if (resizeConfig.preserveAspectRatio && dragStart.current.width > 0) {\n        const aspectRatio = dragStart.current.height / dragStart.current.width;\n        if (Math.abs(deltaX) > Math.abs(deltaY)) {\n          newHeight = newWidth * aspectRatio;\n        } else {\n          newWidth = newHeight / aspectRatio;\n        }\n      }\n\n      const newState: ResizeState = {\n        width: newWidth,\n        height: newHeight,\n        isResizing: true,\n        activeHandle: state.activeHandle,\n      };\n\n      setState(newState);\n      onResize?.(newState);\n    };\n\n    const handleEnd = () => {\n      stopResize();\n    };\n\n    window.addEventListener(\"mousemove\", handleMove);\n    window.addEventListener(\"mouseup\", handleEnd);\n    window.addEventListener(\"touchmove\", handleMove);\n    window.addEventListener(\"touchend\", handleEnd);\n\n    document.body.style.userSelect = \"none\";\n    document.body.style.cursor = getCursorForHandle(state.activeHandle);\n\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMove);\n      window.removeEventListener(\"mouseup\", handleEnd);\n      window.removeEventListener(\"touchmove\", handleMove);\n      window.removeEventListener(\"touchend\", handleEnd);\n      document.body.style.userSelect = \"\";\n      document.body.style.cursor = \"\";\n    };\n  }, [\n    state.isResizing,\n    state.activeHandle,\n    resizeConfig,\n    initialSize,\n    onResize,\n    stopResize,\n    constrainToContainer,\n    elementRef,\n  ]);\n\n  // Generate style object\n  const style: React.CSSProperties = {};\n\n  if (hasResized) {\n    if (state.width > 0) {\n      style.width = \"100%\";\n      style.maxWidth = state.width;\n      style.minWidth = Math.min(200, state.width * 0.5);\n    }\n    if (state.height > 0) {\n      style.height = state.height;\n      style.minHeight = Math.min(100, state.height * 0.5);\n    }\n  }\n\n  return {\n    state,\n    startResize,\n    stopResize,\n    reset,\n    resizeConfig,\n    style,\n  };\n}\n","\"use client\";\n\nimport {\n  type ReactNode,\n  useCallback,\n  useState,\n  useRef,\n  useEffect,\n} from \"react\";\nimport type { UIElement } from \"@onegenui/core\";\nimport { LongPressIndicator } from \"./LongPressIndicator\";\nimport {\n  triggerHaptic,\n  isIgnoredTarget,\n  isInEdgeZone,\n  MOVE_TOLERANCE_PX,\n} from \"../utils/selection\";\nimport { useSelection } from \"../contexts/selection\";\nimport { useEditMode } from \"../contexts/edit-mode\";\n\nexport interface SelectionWrapperProps {\n  element: UIElement;\n  enabled: boolean;\n  onSelect?: (element: UIElement) => void;\n  delayMs: number;\n  isSelected: boolean;\n  children: ReactNode;\n}\n\nexport function SelectionWrapper({\n  element,\n  enabled,\n  onSelect,\n  delayMs,\n  isSelected,\n  children,\n}: SelectionWrapperProps) {\n  const [pressing, setPressing] = useState(false);\n  const [pressPosition, setPressPosition] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n  const startPositionRef = useRef<{ x: number; y: number } | null>(null);\n  const longPressCompletedRef = useRef(false);\n  const onSelectableItemRef = useRef(false);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n\n  // Get edit mode state\n  const { isEditing } = useEditMode();\n\n  // Use context hook if available, with fallback for standalone usage\n  let isDeepSelectionActive: () => boolean;\n  try {\n    const selectionContext = useSelection();\n    isDeepSelectionActive = selectionContext.isDeepSelectionActive;\n  } catch {\n    // Fallback when used outside SelectionProvider\n    isDeepSelectionActive = () =>\n      typeof document !== \"undefined\" &&\n      (document as unknown as { __jsonuiDeepSelectionActive?: boolean })\n        .__jsonuiDeepSelectionActive === true;\n  }\n\n  const handleComplete = useCallback(() => {\n    if (isDeepSelectionActive()) {\n      setPressing(false);\n      setPressPosition(null);\n      return;\n    }\n\n    if (onSelect && enabled) {\n      triggerHaptic(50);\n      onSelect(element);\n    }\n    longPressCompletedRef.current = true;\n    setPressing(false);\n    setPressPosition(null);\n  }, [element, enabled, onSelect, isDeepSelectionActive]);\n\n  const handleCancel = useCallback(() => {\n    setPressing(false);\n    setPressPosition(null);\n    startPositionRef.current = null;\n  }, []);\n\n  const handlePointerDown = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      if (!enabled || !onSelect) return;\n      if (isIgnoredTarget(event.target)) return;\n\n      // In edit mode, check if the target is an editable text node\n      // If so, don't start selection - let the edit interaction handle it\n      if (isEditing) {\n        const target = event.target as HTMLElement;\n        const isEditableTarget =\n          target.closest(\".editable-text-node\") ||\n          target.closest(\"[data-editable='true']\") ||\n          target.hasAttribute(\"contenteditable\");\n        if (isEditableTarget) {\n          return; // Let EditableWrapper handle this interaction\n        }\n      }\n\n      const wrapper = wrapperRef.current;\n      if (!wrapper) return;\n\n      const firstChild = wrapper.querySelector(\":scope > *\") as HTMLElement;\n      const targetElement = firstChild || wrapper;\n      const rect = targetElement.getBoundingClientRect();\n\n      if (rect.width === 0 && rect.height === 0) return;\n\n      const isOnEdge = isInEdgeZone(event.clientX, event.clientY, rect);\n\n      if (!isOnEdge && !isSelected) {\n        return;\n      }\n\n      const target = event.target as HTMLElement;\n      onSelectableItemRef.current = !!target.closest(\"[data-selectable-item]\");\n\n      longPressCompletedRef.current = false;\n      startPositionRef.current = { x: event.clientX, y: event.clientY };\n      setPressPosition({ x: event.clientX, y: event.clientY });\n      setPressing(true);\n\n      if (typeof document !== \"undefined\") {\n        document.body.classList.add(\"select-none\");\n      }\n    },\n    [enabled, onSelect, isSelected, isEditing],\n  );\n\n  const handlePointerUp = useCallback(\n    (_event?: React.PointerEvent<HTMLDivElement>) => {\n      if (typeof document !== \"undefined\") {\n        document.body.classList.remove(\"select-none\");\n      }\n      handleCancel();\n    },\n    [handleCancel],\n  );\n\n  const handlePointerMove = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      if (!pressing || !startPositionRef.current) return;\n\n      const dx = event.clientX - startPositionRef.current.x;\n      const dy = event.clientY - startPositionRef.current.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n\n      if (distance > MOVE_TOLERANCE_PX) {\n        handleCancel();\n      }\n    },\n    [pressing, handleCancel],\n  );\n\n  const handleClickCapture = useCallback(\n    (event: React.MouseEvent<HTMLDivElement>) => {\n      if (longPressCompletedRef.current) {\n        longPressCompletedRef.current = false;\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    },\n    [],\n  );\n\n  useEffect(() => {\n    return () => {\n      if (typeof document !== \"undefined\") {\n        document.body.style.userSelect = \"\";\n        (document.body.style as any).webkitUserSelect = \"\";\n      }\n      setPressing(false);\n      setPressPosition(null);\n    };\n  }, []);\n\n  return (\n    <div\n      ref={wrapperRef}\n      style={{ display: \"contents\" }}\n      onPointerDown={handlePointerDown}\n      onPointerUp={handlePointerUp}\n      onPointerCancel={handlePointerUp}\n      onPointerLeave={handlePointerUp}\n      onPointerMove={handlePointerMove}\n      onClickCapture={handleClickCapture}\n      data-jsonui-selected={isSelected ? \"true\" : undefined}\n      data-jsonui-element-key={element.key}\n    >\n      {children}\n      {pressing && pressPosition && (\n        <LongPressIndicator\n          x={pressPosition.x}\n          y={pressPosition.y}\n          durationMs={delayMs}\n          onComplete={handleComplete}\n        />\n      )}\n    </div>\n  );\n}\n","\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { createPortal } from \"react-dom\";\n\n// Constants\nexport const RING_SIZE = 48;\nconst STROKE_WIDTH = 3;\nconst RADIUS = (RING_SIZE - STROKE_WIDTH) / 2;\nconst CIRCUMFERENCE = 2 * Math.PI * RADIUS;\n\nexport interface LongPressIndicatorProps {\n  x: number;\n  y: number;\n  durationMs: number;\n  onComplete: () => void;\n}\n\nexport function LongPressIndicator({\n  x,\n  y,\n  durationMs,\n  onComplete,\n}: LongPressIndicatorProps) {\n  const [mounted, setMounted] = useState(false);\n  const timerRef = useRef<number | null>(null);\n  const startTimeRef = useRef<number>(0);\n  const animationFrameRef = useRef<number | null>(null);\n  const circleRef = useRef<SVGCircleElement>(null);\n\n  useEffect(() => {\n    setMounted(true);\n    startTimeRef.current = performance.now();\n\n    const animate = () => {\n      const elapsed = performance.now() - startTimeRef.current;\n      const progress = Math.min(elapsed / durationMs, 1);\n\n      if (circleRef.current) {\n        const offset = CIRCUMFERENCE * (1 - progress);\n        circleRef.current.style.strokeDashoffset = `${offset}`;\n      }\n\n      if (progress < 1) {\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n\n    animationFrameRef.current = requestAnimationFrame(animate);\n\n    timerRef.current = window.setTimeout(() => {\n      onComplete();\n    }, durationMs);\n\n    return () => {\n      if (timerRef.current) clearTimeout(timerRef.current);\n      if (animationFrameRef.current)\n        cancelAnimationFrame(animationFrameRef.current);\n    };\n  }, [durationMs, onComplete]);\n\n  if (!mounted || typeof document === \"undefined\") return null;\n\n  return createPortal(\n    <div\n      style={{\n        position: \"fixed\",\n        left: x - RING_SIZE / 2,\n        top: y - RING_SIZE / 2,\n        width: RING_SIZE,\n        height: RING_SIZE,\n        pointerEvents: \"none\",\n        zIndex: 9999,\n        opacity: 1,\n        transition: \"opacity 150ms ease-out\",\n      }}\n      data-long-press-indicator\n    >\n      <svg\n        width={RING_SIZE}\n        height={RING_SIZE}\n        style={{ transform: \"rotate(-90deg)\" }}\n      >\n        <circle\n          cx={RING_SIZE / 2}\n          cy={RING_SIZE / 2}\n          r={RADIUS}\n          fill=\"none\"\n          stroke=\"rgba(255, 255, 255, 0.15)\"\n          strokeWidth={STROKE_WIDTH}\n        />\n        <circle\n          ref={circleRef}\n          cx={RING_SIZE / 2}\n          cy={RING_SIZE / 2}\n          r={RADIUS}\n          fill=\"none\"\n          stroke=\"var(--foreground, #fff)\"\n          strokeWidth={STROKE_WIDTH}\n          strokeLinecap=\"round\"\n          strokeDasharray={CIRCUMFERENCE}\n          strokeDashoffset={CIRCUMFERENCE}\n          style={{\n            filter: \"drop-shadow(0 0 6px rgba(255, 255, 255, 0.5))\",\n          }}\n        />\n      </svg>\n    </div>,\n    document.body,\n  );\n}\n","/**\n * EditableWrapper Component\n *\n * Intelligent wrapper that enables inline editing with platform-aware interaction:\n * - Desktop: Click anywhere on text to start editing immediately\n * - Mobile: First tap to select, second tap or explicit action to edit\n *\n * Works with UIElement.editable property from @onegenui/core\n */\n\n\"use client\";\n\nimport React, {\n  memo,\n  useCallback,\n  useRef,\n  useState,\n  useEffect,\n  type ReactNode,\n  type MouseEvent,\n  type TouchEvent,\n} from \"react\";\nimport type { UIElement } from \"@onegenui/core\";\nimport { useEditMode } from \"../contexts/edit-mode\";\nimport { useIsMobile } from \"../hooks\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface EditableWrapperProps {\n  element: UIElement;\n  children: ReactNode;\n  /** Callback when text content changes */\n  onTextChange?: (propName: string, newValue: string) => void;\n  /** Force enable/disable editing regardless of element.editable */\n  forceEditable?: boolean;\n  /** Custom class name */\n  className?: string;\n}\n\ninterface EditableTextNodeProps {\n  elementKey: string;\n  propName: string;\n  value: string;\n  isMobile: boolean;\n  onTextChange?: (propName: string, newValue: string) => void;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// EditableTextNode - Handles individual text fields\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst EditableTextNode = memo(function EditableTextNode({\n  elementKey,\n  propName,\n  value,\n  isMobile,\n  onTextChange,\n}: EditableTextNodeProps) {\n  const ref = useRef<HTMLSpanElement>(null);\n  const { isEditing, recordChange, focusedKey, setFocusedKey } = useEditMode();\n  const [localValue, setLocalValue] = useState(value);\n  const [isActive, setIsActive] = useState(false);\n\n  // On mobile, require explicit activation (selection first)\n  // On desktop, activate on hover + click\n  const canEdit = isEditing && (isMobile ? focusedKey === elementKey : true);\n\n  useEffect(() => {\n    setLocalValue(value);\n  }, [value]);\n\n  const handleClick = useCallback(\n    (e: MouseEvent) => {\n      if (!isEditing) return;\n\n      e.stopPropagation();\n\n      if (isMobile) {\n        // Mobile: set focus to this element (selection mode)\n        setFocusedKey(elementKey);\n      } else {\n        // Desktop: start editing immediately\n        setIsActive(true);\n        setFocusedKey(elementKey);\n        // Focus the element after render\n        setTimeout(() => {\n          if (ref.current) {\n            ref.current.focus();\n            // Select all text for easier editing\n            const range = document.createRange();\n            range.selectNodeContents(ref.current);\n            const sel = window.getSelection();\n            sel?.removeAllRanges();\n            sel?.addRange(range);\n          }\n        }, 0);\n      }\n    },\n    [isEditing, isMobile, elementKey, setFocusedKey],\n  );\n\n  const handleDoubleClick = useCallback(\n    (e: MouseEvent) => {\n      if (!isEditing || !isMobile) return;\n\n      e.stopPropagation();\n      // Mobile: double tap starts editing\n      setIsActive(true);\n      setTimeout(() => {\n        if (ref.current) {\n          ref.current.focus();\n        }\n      }, 0);\n    },\n    [isEditing, isMobile],\n  );\n\n  const handleInput = useCallback(() => {\n    if (ref.current) {\n      const newValue = ref.current.textContent || \"\";\n      setLocalValue(newValue);\n      recordChange(elementKey, propName, newValue);\n      onTextChange?.(propName, newValue);\n    }\n  }, [elementKey, propName, recordChange, onTextChange]);\n\n  const handleBlur = useCallback(() => {\n    setIsActive(false);\n    // Keep focus key for mobile UX\n    if (!isMobile) {\n      setFocusedKey(null);\n    }\n  }, [isMobile, setFocusedKey]);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        setLocalValue(value);\n        if (ref.current) {\n          ref.current.textContent = value;\n        }\n        ref.current?.blur();\n      } else if (e.key === \"Enter\" && !e.shiftKey) {\n        e.preventDefault();\n        ref.current?.blur();\n      }\n    },\n    [value],\n  );\n\n  const isFocused = focusedKey === elementKey;\n\n  return (\n    <span\n      ref={ref}\n      contentEditable={canEdit && isActive}\n      suppressContentEditableWarning\n      onClick={handleClick}\n      onDoubleClick={handleDoubleClick}\n      onInput={handleInput}\n      onBlur={handleBlur}\n      onKeyDown={handleKeyDown}\n      data-editable={isEditing}\n      data-active={isActive}\n      data-focused={isFocused}\n      data-prop={propName}\n      className={`\n        editable-text-node\n        ${isEditing ? \"editable-text-node--edit-mode\" : \"\"}\n        ${isActive ? \"editable-text-node--active\" : \"\"}\n        ${isFocused ? \"editable-text-node--focused\" : \"\"}\n      `}\n      style={{\n        cursor: isEditing ? \"text\" : \"inherit\",\n        outline: \"none\",\n        position: \"relative\",\n        display: \"inline\",\n        borderRadius: \"2px\",\n        transition: \"background-color 0.15s, box-shadow 0.15s\",\n      }}\n    >\n      {localValue}\n    </span>\n  );\n});\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Text detection utilities\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst TEXT_PROP_NAMES = [\n  \"text\",\n  \"title\",\n  \"subtitle\",\n  \"label\",\n  \"description\",\n  \"content\",\n  \"heading\",\n  \"caption\",\n  \"placeholder\",\n  \"value\",\n  \"name\",\n  \"message\",\n];\n\nfunction isTextProp(key: string, value: unknown): boolean {\n  if (typeof value !== \"string\") return false;\n  if (value.length === 0) return false;\n  // Check if key is a known text prop\n  return TEXT_PROP_NAMES.some(\n    (name) => key.toLowerCase().includes(name.toLowerCase()),\n  );\n}\n\nfunction getEditableProps(\n  element: UIElement,\n): Array<{ key: string; value: string }> {\n  const editable = element.editable;\n  const props: Array<{ key: string; value: string }> = [];\n\n  // If editable is explicitly false, return empty\n  if (editable === false) return [];\n\n  // If editable is not specified or true, auto-detect text props\n  if (editable === undefined || editable === true) {\n    for (const [key, value] of Object.entries(element.props || {})) {\n      if (isTextProp(key, value)) {\n        props.push({ key, value: value as string });\n      }\n    }\n  } else if (Array.isArray(editable)) {\n    // Only specified props are editable\n    for (const propName of editable) {\n      const value = element.props?.[propName];\n      if (typeof value === \"string\") {\n        props.push({ key: propName, value });\n      }\n    }\n  }\n\n  return props;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Main Component\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const EditableWrapper = memo(function EditableWrapper({\n  element,\n  children,\n  onTextChange,\n  forceEditable,\n  className = \"\",\n}: EditableWrapperProps) {\n  const isMobile = useIsMobile();\n  const { isEditing, focusedKey, setFocusedKey, recordChange } = useEditMode();\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [isActiveEditing, setIsActiveEditing] = useState(false);\n\n  // Determine if this element is editable\n  // Default: all elements are editable unless explicitly disabled\n  const isElementEditable =\n    forceEditable !== undefined ? forceEditable : element.editable !== false;\n\n  // Don't wrap if not in edit mode or element is not editable\n  if (!isEditing || !isElementEditable || element.locked) {\n    return <>{children}</>;\n  }\n\n  const isFocused = focusedKey === element.key;\n\n  // For mobile: show selection indicator\n  const handleContainerClick = useCallback(\n    (e: MouseEvent) => {\n      e.stopPropagation();\n      setFocusedKey(element.key);\n\n      if (!isMobile) {\n        // Desktop: start editing immediately\n        setIsActiveEditing(true);\n      }\n    },\n    [isMobile, element.key, setFocusedKey],\n  );\n\n  const handleDoubleClick = useCallback(\n    (e: MouseEvent) => {\n      e.stopPropagation();\n      // On mobile, double-click activates editing\n      if (isMobile) {\n        setIsActiveEditing(true);\n      }\n    },\n    [isMobile],\n  );\n\n  const handleBlur = useCallback(() => {\n    setIsActiveEditing(false);\n    // Capture the text content and record as change\n    if (containerRef.current) {\n      const textContent = containerRef.current.textContent || \"\";\n      // Try to determine which prop was edited (use \"text\" as default)\n      const propName = element.props?.title\n        ? \"title\"\n        : element.props?.text\n          ? \"text\"\n          : element.props?.label\n            ? \"label\"\n            : element.props?.description\n              ? \"description\"\n              : \"content\";\n      recordChange(element.key, propName, textContent);\n      onTextChange?.(propName, textContent);\n    }\n  }, [element.key, element.props, recordChange, onTextChange]);\n\n  const handleKeyDown = useCallback(\n    (e: React.KeyboardEvent) => {\n      if (e.key === \"Escape\") {\n        e.preventDefault();\n        setIsActiveEditing(false);\n        containerRef.current?.blur();\n      }\n    },\n    [],\n  );\n\n  return (\n    <div\n      ref={containerRef}\n      className={`editable-wrapper ${isFocused ? \"editable-wrapper--focused\" : \"\"} ${isActiveEditing ? \"editable-wrapper--active\" : \"\"} ${className}`}\n      onClick={handleContainerClick}\n      onDoubleClick={handleDoubleClick}\n      onBlur={handleBlur}\n      onKeyDown={handleKeyDown}\n      contentEditable={isActiveEditing}\n      suppressContentEditableWarning\n      data-element-key={element.key}\n      data-editable=\"true\"\n      style={{\n        position: \"relative\",\n        outline: isActiveEditing ? \"none\" : undefined,\n        cursor: isEditing ? \"text\" : undefined,\n      }}\n    >\n      {/* Show edit indicator on mobile when focused but not editing */}\n      {isMobile && isFocused && !isActiveEditing && (\n        <div\n          className=\"editable-indicator\"\n          style={{\n            position: \"absolute\",\n            top: -4,\n            right: -4,\n            width: 20,\n            height: 20,\n            borderRadius: \"50%\",\n            background: \"linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%)\",\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            zIndex: 10,\n            boxShadow: \"0 2px 8px rgba(14, 165, 233, 0.3)\",\n          }}\n        >\n          <svg\n            width=\"12\"\n            height=\"12\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"white\"\n            strokeWidth=\"2\"\n          >\n            <path d=\"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z\" />\n          </svg>\n        </div>\n      )}\n\n      {/* Render children normally - contentEditable on the wrapper handles editing */}\n      {children}\n    </div>\n  );\n});\n\n/**\n * Process React children to find and replace text nodes with editable versions\n * This is a deep traversal that preserves the component tree structure\n */\nfunction processChildForEditing(\n  child: ReactNode,\n  elementKey: string,\n  editableProps: Array<{ key: string; value: string }>,\n  isMobile: boolean,\n  onTextChange?: (propName: string, newValue: string) => void,\n): ReactNode {\n  if (!React.isValidElement(child)) {\n    // Check if this is a string that matches any editable prop\n    if (typeof child === \"string\") {\n      const matchingProp = editableProps.find((p) => p.value === child);\n      if (matchingProp) {\n        return (\n          <EditableTextNode\n            key={`${elementKey}-${matchingProp.key}`}\n            elementKey={elementKey}\n            propName={matchingProp.key}\n            value={matchingProp.value}\n            isMobile={isMobile}\n            onTextChange={onTextChange}\n          />\n        );\n      }\n    }\n    return child;\n  }\n\n  // Recurse into element children\n  const childProps = child.props as Record<string, unknown>;\n  const elementChildren = childProps.children;\n  const restProps = { ...childProps };\n  delete restProps.children;\n\n  if (!elementChildren) {\n    return child;\n  }\n\n  const processedChildren = React.Children.map(\n    elementChildren as ReactNode,\n    (grandchild) =>\n      processChildForEditing(\n        grandchild,\n        elementKey,\n        editableProps,\n        isMobile,\n        onTextChange,\n      ),\n  );\n\n  return React.cloneElement(child, restProps, processedChildren);\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// CSS Styles (to be included globally)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const editableWrapperStyles = `\n/* Editable wrapper styles */\n.editable-wrapper {\n  transition: box-shadow 0.15s;\n}\n\n.editable-wrapper--focused {\n  box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);\n  border-radius: 4px;\n}\n\n/* Editable text node styles */\n.editable-text-node {\n  border-radius: 2px;\n}\n\n.editable-text-node--edit-mode {\n  cursor: text;\n}\n\n.editable-text-node--edit-mode:hover {\n  background-color: rgba(14, 165, 233, 0.08);\n}\n\n.editable-text-node--focused {\n  background-color: rgba(14, 165, 233, 0.1);\n}\n\n.editable-text-node--active {\n  background-color: rgba(14, 165, 233, 0.15);\n  box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);\n}\n\n.editable-text-node--active:focus {\n  outline: none;\n}\n\n/* Edit mode indicator */\n.editable-indicator {\n  animation: pulse-edit 2s infinite;\n}\n\n@keyframes pulse-edit {\n  0%, 100% { transform: scale(1); opacity: 1; }\n  50% { transform: scale(1.1); opacity: 0.8; }\n}\n\n/* Mobile-specific styles */\n@media (pointer: coarse) {\n  .editable-text-node--edit-mode {\n    /* Larger touch target on mobile */\n    padding: 2px 4px;\n    margin: -2px -4px;\n  }\n}\n`;\n","\"use client\";\n\nimport { useState, useCallback, useRef, useEffect, useMemo } from \"react\";\nimport { useShallow } from \"zustand/shallow\";\nimport type { UITree, JsonPatch } from \"@onegenui/core\";\nimport { applyPatchesBatch } from \"./patch-utils\";\nimport type {\n  UseUIStreamOptions,\n  UseUIStreamReturn,\n  ConversationTurn,\n  ChatMessage,\n  QuestionPayload,\n  SuggestionChip,\n  ToolProgress,\n  PersistedAttachment,\n  Attachment,\n} from \"./types\";\nimport type { DocumentIndex } from \"@onegenui/core\";\nimport { useStore } from \"../store\";\nimport {\n  removeElementFromTree,\n  removeSubItemsFromTree,\n  updateElementInTree,\n  updateElementLayoutInTree,\n  type LayoutUpdates,\n} from \"./ui-stream/tree-mutations\";\nimport { useHistory } from \"./ui-stream/use-history\";\nimport { streamLog } from \"./ui-stream/logger\";\nimport { processPlanEvent } from \"./ui-stream/plan-handler\";\nimport { buildRequest, isFileAttachment } from \"./ui-stream/request-builder\";\nimport { processDocumentIndex } from \"./ui-stream/document-index-handler\";\nimport { useStoreRefs } from \"./ui-stream/use-store-refs\";\nimport {\n  createPendingTurn,\n  finalizeTurn,\n  markTurnFailed,\n  removeTurn,\n  rollbackToTurn,\n} from \"./ui-stream/turn-manager\";\nimport {\n  collectPreviousAnswers,\n  buildQuestionResponsePrompt,\n  buildQuestionResponseContext,\n  addQuestionAnswer,\n} from \"./ui-stream/question-handler\";\nimport { readStreamWithTimeout } from \"./ui-stream/stream-reader\";\nimport {\n  saveSelection,\n  restoreSelection,\n  PATCH_FLUSH_INTERVAL_MS,\n} from \"./ui-stream/patch-processor\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// useUIStream Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook for streaming UI generation\n */\nexport function useUIStream({\n  api,\n  onComplete,\n  onError,\n  getHeaders,\n  getChatId,\n  onBackgroundComplete,\n}: UseUIStreamOptions): UseUIStreamReturn {\n  // Use Zustand store for tree state with shallow comparison\n  const { storeTree, treeVersion } = useStore(\n    useShallow((s) => ({\n      storeTree: s.uiTree,\n      treeVersion: s.treeVersion,\n    }))\n  );\n  \n  // Get store refs from extracted hook\n  const { storeRef, planStoreRef, addProgressRef, storeSetUITreeRef, resetPlanExecution } = useStoreRefs();\n  \n  // CRITICAL: Create new tree reference when version changes to force re-renders\n  const tree = useMemo(() => {\n    if (!storeTree) return null;\n    return { ...storeTree, elements: { ...storeTree.elements } };\n  }, [storeTree, treeVersion]);\n  \n  // Conversation state and tree ref\n  const [conversation, setConversation] = useState<ConversationTurn[]>([]);\n  const treeRef = useRef<UITree | null>(null);\n  \n  // Sync treeRef when store changes\n  useEffect(() => {\n    treeRef.current = tree;\n  }, [tree, treeVersion]);\n  \n  // Update store (treeRef syncs automatically via effect)\n  const setTree = useCallback((newTree: UITree | null | ((prev: UITree | null) => UITree | null)) => {\n    if (typeof newTree === \"function\") {\n      const updatedTree = newTree(treeRef.current);\n      treeRef.current = updatedTree;\n      storeSetUITreeRef.current(updatedTree);\n    } else {\n      treeRef.current = newTree;\n      storeSetUITreeRef.current(newTree);\n    }\n  }, [storeSetUITreeRef]);\n\n  // History management\n  const {\n    pushHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    setHistory,\n    setHistoryIndex,\n  } = useHistory(tree, conversation, setTree, setConversation, treeRef);\n\n  // Keep ref in sync\n  useEffect(() => {\n    treeRef.current = tree;\n  }, [tree]);\n\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const abortControllersRef = useRef<Map<string, AbortController>>(new Map());\n  const sendingRef = useRef(false);\n  const patchFlushTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  const clear = useCallback(() => {\n    setTree(null);\n    setConversation([]);\n    treeRef.current = null;\n    setError(null);\n    resetPlanExecution();\n    storeRef.current.clearUITree();\n  }, [resetPlanExecution, setTree, storeRef]);\n\n  const loadSession = useCallback(\n    (session: { tree: UITree; conversation: ConversationTurn[] }) => {\n      setTree(session.tree);\n      treeRef.current = session.tree;\n      setConversation(session.conversation);\n      setHistory([]);\n      setHistoryIndex(-1);\n    },\n    [setTree, setHistory, setHistoryIndex],\n  );\n\n  const removeElement = useCallback(\n    (key: string) => {\n      pushHistory();\n      setTree((prev) => (prev ? removeElementFromTree(prev, key) : null));\n    },\n    [pushHistory, setTree],\n  );\n\n  const removeSubItems = useCallback(\n    (elementKey: string, identifiers: (number | string)[]) => {\n      if (identifiers.length === 0) return;\n      pushHistory();\n      setTree((prev) =>\n        prev ? removeSubItemsFromTree(prev, elementKey, identifiers) : null,\n      );\n    },\n    [pushHistory, setTree],\n  );\n\n  const updateElement = useCallback(\n    (elementKey: string, updates: Record<string, unknown>) => {\n      setTree((prev) =>\n        prev ? updateElementInTree(prev, elementKey, updates) : null,\n      );\n    },\n    [setTree],\n  );\n\n  const updateElementLayout = useCallback(\n    (elementKey: string, layoutUpdates: LayoutUpdates) => {\n      pushHistory();\n      setTree((prev) =>\n        prev\n          ? updateElementLayoutInTree(prev, elementKey, layoutUpdates)\n          : null,\n      );\n    },\n    [pushHistory, setTree],\n  );\n\n  const send = useCallback(\n    async (\n      prompt: string,\n      context?: Record<string, unknown>,\n      attachments?: any[],\n    ) => {\n      // Get chatId from context (set by handleChatSend)\n      const chatId = (context?.chatId as string | undefined) ?? getChatId?.();\n      \n      // Prevent concurrent sends\n      if (sendingRef.current) {\n        streamLog.warn(\"Ignoring concurrent send\", { \n          prompt: prompt.slice(0, 100),\n        });\n        return;\n      }\n      sendingRef.current = true;\n      \n      streamLog.info(\"Starting send\", { \n        promptLength: prompt.length, \n        hasContext: !!context,\n        attachmentCount: attachments?.length ?? 0,\n        chatId,\n      });\n\n      // Abort any existing request\n      if (abortControllersRef.current.size > 0) {\n        abortControllersRef.current.forEach((controller) => controller.abort());\n        abortControllersRef.current.clear();\n      }\n      const abortController = new AbortController();\n      const abortKey = chatId ?? \"default\";\n      abortControllersRef.current.set(abortKey, abortController);\n      const signal = abortController.signal;\n\n      setIsStreaming(true);\n      setError(null);\n\n      // Start with existing tree or empty\n      let currentTree: UITree = treeRef.current\n        ? JSON.parse(JSON.stringify(treeRef.current))\n        : { root: \"\", elements: {} };\n\n      // If no tree existed, initialize it and sync ref immediately\n      if (!treeRef.current) {\n        streamLog.debug(\"Initializing empty tree\");\n        setTree(currentTree);\n        treeRef.current = currentTree;\n      }\n\n      // Create pending turn using turn manager\n      const isProactive = context?.hideUserMessage === true;\n      const pendingTurn = createPendingTurn(prompt, { isProactive, attachments });\n      const turnId = pendingTurn.id;\n      streamLog.debug(\"Creating turn\", { turnId, isProactive, userMessage: prompt.slice(0, 50) });\n      \n      // Add turn to conversation\n      setConversation((prev) => {\n        const updated = [...prev, pendingTurn];\n        streamLog.debug(\"Conversation updated\", { \n          prevLength: prev.length, \n          newLength: updated.length,\n          pendingTurnId: pendingTurn.id,\n          userMessage: pendingTurn.userMessage?.slice(0, 50),\n        });\n        return updated;\n      });\n\n      // Batch processing variables\n      let patchBuffer: JsonPatch[] = [];\n      \n      // Clear any existing timer\n      if (patchFlushTimerRef.current) {\n        clearTimeout(patchFlushTimerRef.current);\n        patchFlushTimerRef.current = null;\n      }\n\n      try {\n        // Build request body and headers\n        const fileAttachments = attachments?.filter(isFileAttachment) ?? [];\n        if (fileAttachments.length > 0) {\n          streamLog.debug(\"Uploading attachments\", {\n            count: fileAttachments.length,\n            files: fileAttachments.map((att) => ({\n              name: att.file.name,\n              type: att.file.type,\n              size: att.file.size,\n            })),\n          });\n        }\n\n        const { body, headers } = buildRequest({\n          prompt,\n          context,\n          currentTree,\n          conversation,\n          attachments,\n        });\n\n        // Add dynamic headers (e.g. auth)\n        if (getHeaders) {\n          const dynamicHeaders = await getHeaders();\n          Object.assign(headers, dynamicHeaders);\n        }\n\n        streamLog.info(\"Sending request to API\", { api, hasAuth: !!getHeaders });\n\n        const response = await fetch(api, {\n          method: \"POST\",\n          headers,\n          body,\n          signal,\n        });\n\n        streamLog.debug(\"Response received\", { status: response.status, ok: response.ok });\n\n        if (!response.ok) {\n          throw new Error(`HTTP error: ${response.status}`);\n        }\n\n        if (!response.body) {\n          throw new Error(\"No response body\");\n        }\n\n        const reader = response.body.getReader();\n\n        const currentMessages: ChatMessage[] = [];\n        const currentQuestions: QuestionPayload[] = [];\n        const currentSuggestions: SuggestionChip[] = [];\n        const currentToolProgress: ToolProgress[] = [];\n        const currentPersistedAttachments: PersistedAttachment[] = [];\n        let currentDocumentIndex: DocumentIndex | undefined = undefined;\n        let patchCount = 0;\n        let messageCount = 0;\n\n        // Update status to streaming\n        setConversation((prev) =>\n          prev.map((t) =>\n            t.id === turnId ? { ...t, status: \"streaming\" as const } : t,\n          ),\n        );\n\n        // Helper to update the pending turn\n        const updateTurnData = () => {\n          setConversation((prev) =>\n            prev.map((t) =>\n              t.id === turnId\n                ? ({\n                    ...t,\n                    assistantMessages: [...currentMessages],\n                    questions: [...currentQuestions],\n                    suggestions: [...currentSuggestions],\n                    toolProgress: [...currentToolProgress],\n                    persistedAttachments:\n                      currentPersistedAttachments.length > 0\n                        ? [...currentPersistedAttachments]\n                        : t.persistedAttachments,\n                    documentIndex: currentDocumentIndex ?? t.documentIndex,\n                  } as ConversationTurn)\n                : t,\n            ),\n          );\n        };\n\n        streamLog.debug(\"Starting stream processing\");\n\n        // Process stream events using async iterator\n        for await (const event of readStreamWithTimeout(reader)) {\n          try {\n            if (event.type === \"done\" || event.type === \"text-delta\") {\n              continue;\n            }\n            \n            if (event.type === \"message\") {\n              messageCount++;\n              streamLog.debug(\"Message received\", { messageCount, contentLength: event.message.content?.length ?? 0 });\n              currentMessages.push(event.message);\n              updateTurnData();\n            } else if (event.type === \"question\") {\n              currentQuestions.push(event.question);\n              updateTurnData();\n            } else if (event.type === \"suggestion\") {\n              currentSuggestions.push(...event.suggestions);\n              updateTurnData();\n            } else if (event.type === \"tool-progress\") {\n              currentToolProgress.push(event.progress);\n              updateTurnData();\n              addProgressRef.current({\n                toolCallId: event.progress.toolCallId,\n                toolName: event.progress.toolName,\n                status: event.progress.status,\n                message: event.progress.message,\n                data: event.progress.data,\n              });\n            } else if (event.type === \"patch\") {\n              patchCount++;\n              patchBuffer.push(event.patch);\n\n              // Schedule batch application with short delay\n              if (!patchFlushTimerRef.current) {\n                patchFlushTimerRef.current = setTimeout(() => {\n                  patchFlushTimerRef.current = null;\n                  if (patchBuffer.length > 0) {\n                    streamLog.debug(\"Flushing patches\", { count: patchBuffer.length });\n                    \n                    const baseTree = treeRef.current ?? currentTree;\n                    const protectedTypes =\n                      context?.forceCanvasMode === true ? [\"Canvas\"] : [];\n                    \n                    const updatedTree = applyPatchesBatch(\n                      baseTree,\n                      patchBuffer,\n                      { turnId, protectedTypes },\n                    );\n                    patchBuffer = [];\n                    \n                    // Update local tracking state and UI store\n                    treeRef.current = updatedTree;\n                    currentTree = updatedTree;\n                    \n                    // Save selection before DOM changes\n                    const savedSel = saveSelection();\n                    \n                    const store = storeRef.current;\n                    store.setUITree({\n                      root: updatedTree.root,\n                      elements: { ...updatedTree.elements },\n                    });\n                    store.bumpTreeVersion();\n                    \n                    // Restore selection after DOM update\n                    if (savedSel) {\n                      requestAnimationFrame(() => restoreSelection(savedSel));\n                    }\n                    \n                    streamLog.debug(\"Tree updated\", { \n                      elementCount: Object.keys(updatedTree.elements).length \n                    });\n                  }\n                }, PATCH_FLUSH_INTERVAL_MS);\n              }\n            } else if (event.type === \"plan-created\" || event.type === \"step-started\" ||\n                       event.type === \"step-done\" || event.type === \"subtask-started\" ||\n                       event.type === \"subtask-done\" || event.type === \"level-started\" ||\n                       event.type === \"level-completed\" || event.type === \"orchestration-done\") {\n              processPlanEvent(event as unknown as Record<string, unknown>, planStoreRef.current);\n            } else if (event.type === \"persisted-attachments\") {\n              currentPersistedAttachments.push(...(event.attachments as PersistedAttachment[]));\n              updateTurnData();\n            } else if (event.type === \"document-index-ui\") {\n              const uiComponent = event.uiComponent as { type: string; props: DocumentIndex };\n              const updated = processDocumentIndex(uiComponent, currentDocumentIndex);\n              if (updated) {\n                currentDocumentIndex = updated;\n                updateTurnData();\n              }\n            } else if (event.type === \"citations\") {\n              if (Array.isArray(event.citations) && typeof window !== \"undefined\") {\n                window.dispatchEvent(\n                  new CustomEvent(\"onegenui:citations\", {\n                    detail: { citations: event.citations },\n                  }),\n                );\n              }\n            }\n          } catch (e) {\n            streamLog.warn(\"Event processing error\", { \n              error: e instanceof Error ? e.message : String(e),\n              eventType: event.type \n            });\n          }\n        }\n\n        // Final setTree with fresh reference and sync ref\n        streamLog.info(\"Stream completed\", { \n          totalPatches: patchCount, \n          totalMessages: messageCount,\n          treeElementCount: Object.keys(currentTree.elements).length \n        });\n        treeRef.current = currentTree;\n        \n        // Create a shallow copy with new elements reference to ensure React detects change\n        setTree({\n          root: currentTree.root,\n          elements: { ...currentTree.elements },\n        });\n\n        // Clear flush timer if pending\n        if (patchFlushTimerRef.current) {\n          clearTimeout(patchFlushTimerRef.current);\n          patchFlushTimerRef.current = null;\n        }\n\n        // Flush any remaining patches before finalization\n        if (patchBuffer.length > 0) {\n          streamLog.debug(\"Final patch flush\", { count: patchBuffer.length });\n          // Use treeRef for consistency\n          const baseTree = treeRef.current ?? currentTree;\n          \n          // Protect Canvas from removal when forceCanvasMode is enabled\n          const protectedTypes =\n            context?.forceCanvasMode === true ? [\"Canvas\"] : [];\n          \n          currentTree = applyPatchesBatch(baseTree, patchBuffer, { turnId, protectedTypes });\n          patchBuffer = [];\n          treeRef.current = currentTree;\n          \n          const store = storeRef.current;\n          store.setUITree({\n            root: currentTree.root,\n            elements: { ...currentTree.elements },\n          });\n          store.bumpTreeVersion();\n          \n          streamLog.debug(\"Final tree state\", { \n            elementCount: Object.keys(currentTree.elements).length,\n          });\n        }\n\n        // Check abort before final state updates\n        if (signal.aborted) {\n          streamLog.warn(\"Request aborted before finalization\");\n          return;\n        }\n\n        // Finalize turn using turn manager\n        streamLog.debug(\"Finalizing turn\", { turnId });\n        setConversation((prev) =>\n          finalizeTurn(prev, turnId, {\n            messages: currentMessages,\n            questions: currentQuestions,\n            suggestions: currentSuggestions,\n            treeSnapshot: currentTree,\n            documentIndex: currentDocumentIndex,\n          }),\n        );\n\n        onComplete?.(currentTree);\n      } catch (err) {\n        // Clear buffer and timer on any error\n        if (patchFlushTimerRef.current) {\n          clearTimeout(patchFlushTimerRef.current);\n          patchFlushTimerRef.current = null;\n        }\n        patchBuffer = [];\n\n        if ((err as Error).name === \"AbortError\") {\n          streamLog.info(\"Request aborted\", { turnId });\n          setConversation((prev) => removeTurn(prev, turnId));\n          return;\n        }\n        const error = err instanceof Error ? err : new Error(String(err));\n        streamLog.error(\"Stream error\", { error: error.message, turnId });\n        setError(error);\n        onError?.(error);\n        // Mark turn as failed using turn manager\n        setConversation((prev) => markTurnFailed(prev, turnId, error.message));\n      } finally {\n        // Cleanup\n        sendingRef.current = false;\n        abortControllersRef.current.clear();\n        setIsStreaming(false);\n        streamLog.debug(\"Send completed\");\n      }\n    },\n    [api, onComplete, onError, setTree, getChatId],\n  );\n\n  const answerQuestion = useCallback(\n    (turnId: string, questionId: string, answers: Record<string, unknown>) => {\n      const turn = conversation.find((t) => t.id === turnId);\n      const question = turn?.questions?.find((q) => q.id === questionId);\n\n      // Collect all previous answers using extracted helper\n      const allPreviousAnswers = collectPreviousAnswers(conversation, turnId);\n\n      // Update conversation with answer\n      setConversation((prev) => addQuestionAnswer(prev, turnId, questionId, answers));\n\n      // Send question response if question found\n      if (question) {\n        const prompt = buildQuestionResponsePrompt(question.text, answers);\n        const context = buildQuestionResponseContext(\n          question,\n          turnId,\n          answers,\n          allPreviousAnswers,\n        );\n        send(prompt, context);\n      }\n    },\n    [conversation, send],\n  );\n\n  // Cleanup on unmount - abort all active streams and clear timers\n  useEffect(() => {\n    return () => {\n      // Clear any pending patch flush timer\n      if (patchFlushTimerRef.current) {\n        clearTimeout(patchFlushTimerRef.current);\n        patchFlushTimerRef.current = null;\n      }\n      // Abort all active streams\n      for (const controller of abortControllersRef.current.values()) {\n        controller.abort();\n      }\n      abortControllersRef.current.clear();\n    };\n  }, []);\n\n  // Delete a turn and rollback to previous state\n  const deleteTurn = useCallback(\n    (turnId: string) => {\n      pushHistory();\n      const result = rollbackToTurn(conversation, turnId);\n      if (!result) return;\n      \n      // Use restored tree or empty tree if first turn deleted\n      const treeToRestore = result.restoredTree ?? { root: \"\", elements: {} };\n      setTree(treeToRestore);\n      treeRef.current = treeToRestore;\n      setConversation(result.newConversation);\n    },\n    [conversation, pushHistory, setTree],\n  );\n\n  // Edit a turn message and regenerate\n  const editTurn = useCallback(\n    async (turnId: string, newMessage: string) => {\n      pushHistory();\n      const result = rollbackToTurn(conversation, turnId);\n      if (!result) return;\n      \n      setTree(result.restoredTree);\n      treeRef.current = result.restoredTree;\n      setConversation(result.newConversation);\n\n      await send(newMessage, result.restoredTree ? { tree: result.restoredTree } : undefined);\n    },\n    [conversation, send, pushHistory, setTree],\n  );\n\n  // Abort the current streaming request\n  const abort = useCallback(() => {\n    abortControllersRef.current.forEach((controller) => controller.abort());\n    abortControllersRef.current.clear();\n    sendingRef.current = false;\n    setIsStreaming(false);\n  }, []);\n\n  return {\n    tree,\n    conversation,\n    isStreaming,\n    error,\n    send,\n    clear,\n    loadSession,\n    removeElement,\n    removeSubItems,\n    updateElement,\n    updateElementLayout,\n    deleteTurn,\n    editTurn,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    answerQuestion,\n    abort,\n  };\n}\n","/**\n * Structural sharing utilities for immutable updates\n */\n\n/**\n * Set a value by JSON Pointer path with structural sharing.\n * Only clones objects along the modified path.\n * IMPORTANT: Never mutates - always creates new references for changed paths.\n */\nexport function setByPathWithStructuralSharing<\n  T extends Record<string, unknown>,\n>(obj: T, path: string, value: unknown): T {\n  const segments = path.startsWith(\"/\")\n    ? path.slice(1).split(\"/\")\n    : path.split(\"/\");\n  if (segments.length === 0 || (segments.length === 1 && segments[0] === \"\")) {\n    return value as T;\n  }\n\n  const result = { ...obj } as T;\n  let current: Record<string, unknown> = result;\n  let parent: Record<string, unknown> | null = null;\n  let parentKey: string | null = null;\n\n  for (let i = 0; i < segments.length - 1; i++) {\n    const segment = segments[i]!;\n    const nextValue = current[segment];\n\n    if (Array.isArray(nextValue)) {\n      current[segment] = [...nextValue];\n    } else if (nextValue && typeof nextValue === \"object\") {\n      current[segment] = { ...nextValue };\n    } else {\n      current[segment] = {};\n    }\n    parent = current;\n    parentKey = segment;\n    current = current[segment] as Record<string, unknown>;\n  }\n\n  const lastSegment = segments[segments.length - 1]!;\n\n  // Handle JSON Pointer \"-\" suffix for array append (RFC 6901)\n  // CRITICAL: Create new array reference, never mutate with push()\n  if (lastSegment === \"-\" && Array.isArray(current)) {\n    // current IS the array (already cloned in the loop above)\n    // We need to append to it, but we MUST create a new reference\n    // by replacing the array in the parent\n    if (parent && parentKey) {\n      parent[parentKey] = [...(current as unknown[]), value];\n    }\n  } else if (Array.isArray(current)) {\n    const index = parseInt(lastSegment, 10);\n    if (!isNaN(index)) {\n      // current is already cloned, direct assignment is fine\n      (current as unknown[])[index] = value;\n    }\n  } else if (lastSegment === \"-\") {\n    // Path like /foo/bar/- where bar is a property name containing an array\n    if (segments.length >= 2) {\n      const arrayPropertyName = segments[segments.length - 2]!;\n      const arrayProperty = current[arrayPropertyName];\n      if (Array.isArray(arrayProperty)) {\n        // Create NEW array with appended value (immutable)\n        current[arrayPropertyName] = [...arrayProperty, value];\n      } else if (!arrayProperty) {\n        current[arrayPropertyName] = [value];\n      }\n    }\n  } else {\n    current[lastSegment] = value;\n  }\n\n  return result;\n}\n\n/**\n * Remove a value from an object/array by JSON Pointer path with structural sharing.\n * Clones objects along the path to avoid mutating frozen/immutable data.\n */\nexport function removeByPath(\n  target: Record<string, unknown> | unknown[],\n  path: string,\n): void {\n  const segments = path.startsWith(\"/\")\n    ? path.slice(1).split(\"/\")\n    : path.split(\"/\");\n\n  if (segments.length === 0) return;\n\n  let current: Record<string, unknown> | unknown[] = target;\n\n  // Clone each level along the path to ensure mutability\n  for (let i = 0; i < segments.length - 1; i++) {\n    const segment = segments[i]!;\n\n    if (Array.isArray(current)) {\n      const index = Number(segment);\n      if (!Number.isInteger(index) || index < 0 || index >= current.length)\n        return;\n      // Clone the array element if it's an object/array\n      const nextValue = current[index];\n      if (Array.isArray(nextValue)) {\n        current[index] = [...nextValue];\n        current = current[index] as unknown[];\n      } else if (nextValue && typeof nextValue === \"object\") {\n        current[index] = { ...nextValue };\n        current = current[index] as Record<string, unknown>;\n      } else {\n        return;\n      }\n    } else {\n      const nextValue = current[segment];\n      if (Array.isArray(nextValue)) {\n        current[segment] = [...nextValue];\n        current = current[segment] as unknown[];\n      } else if (nextValue && typeof nextValue === \"object\") {\n        current[segment] = { ...nextValue };\n        current = current[segment] as Record<string, unknown>;\n      } else {\n        return;\n      }\n    }\n  }\n\n  const lastSegment = segments[segments.length - 1]!;\n\n  if (Array.isArray(current)) {\n    const index = Number(lastSegment);\n    if (!Number.isInteger(index) || index < 0 || index >= current.length)\n      return;\n    current.splice(index, 1);\n    return;\n  }\n\n  delete current[lastSegment];\n}\n","/**\n * UITree manipulation utilities\n */\n\nimport type { UITree, UIElement } from \"@onegenui/core\";\n\n/**\n * Remove a node and its descendants from the tree\n */\nexport function removeNodeFromTree(tree: UITree, key: string): void {\n  const element = tree.elements[key];\n  if (!element) return;\n\n  // Remove from parent\n  if (element.parentKey) {\n    const parent = tree.elements[element.parentKey];\n    if (parent && parent.children) {\n      parent.children = parent.children.filter((k) => k !== key);\n    }\n  } else if (tree.root === key) {\n    tree.root = \"\";\n  }\n\n  // Recursive removal using stack (avoids deep recursion)\n  const stack = [key];\n  while (stack.length > 0) {\n    const currentKey = stack.pop()!;\n    const current = tree.elements[currentKey];\n    delete tree.elements[currentKey];\n\n    if (current && current.children) {\n      stack.push(...current.children);\n    }\n  }\n}\n\n/**\n * Ensure all children references have corresponding elements in the tree.\n * Creates placeholder elements for any missing children.\n */\nexport function ensureChildrenExist(\n  elements: Record<string, UIElement>,\n  children: string[] | undefined,\n  createPlaceholder: (key: string, turnId?: string) => UIElement,\n  turnId?: string,\n): void {\n  if (!children) return;\n  for (const childKey of children) {\n    if (!elements[childKey]) {\n      elements[childKey] = createPlaceholder(childKey, turnId);\n    }\n  }\n}\n\n/**\n * Get the root element from a tree\n */\nexport function getRootElement(tree: UITree): UIElement | null {\n  if (!tree.root) return null;\n  return tree.elements[tree.root] || null;\n}\n\n/**\n * Get all descendant keys of an element\n */\nexport function getDescendantKeys(tree: UITree, key: string): string[] {\n  const result: string[] = [];\n  const stack = [key];\n\n  while (stack.length > 0) {\n    const currentKey = stack.pop()!;\n    const element = tree.elements[currentKey];\n\n    if (element && currentKey !== key) {\n      result.push(currentKey);\n    }\n\n    if (element?.children) {\n      stack.push(...element.children);\n    }\n  }\n\n  return result;\n}\n","/**\n * Patch module types\n * Types for UITree patch operations\n */\n\nimport type { JsonPatch, UIElement } from \"@onegenui/core\";\n\n/**\n * Placeholder element type for forward-referenced children\n */\nexport const PLACEHOLDER_TYPE = \"__placeholder__\";\n\n/**\n * Placeholder element metadata\n */\nexport interface PlaceholderMeta {\n  turnId?: string;\n  createdAt: number;\n  isPlaceholder: true;\n}\n\n/**\n * Create a placeholder element for a forward-referenced child\n */\nexport function createPlaceholder(key: string, turnId?: string): UIElement {\n  return {\n    key,\n    type: PLACEHOLDER_TYPE,\n    props: {},\n    children: [],\n    _meta: {\n      turnId,\n      createdAt: Date.now(),\n      isPlaceholder: true,\n    },\n  } as UIElement;\n}\n\n/**\n * Check if an element is a placeholder\n */\nexport function isPlaceholder(element: UIElement): boolean {\n  return (\n    element.type === PLACEHOLDER_TYPE ||\n    (element._meta as any)?.isPlaceholder === true\n  );\n}\n\n/**\n * Patch classification by type\n */\nexport interface ClassifiedPatches {\n  rootPatches: JsonPatch[];\n  elementPatches: JsonPatch[];\n  propPatches: JsonPatch[];\n  otherPatches: JsonPatch[];\n}\n\n/**\n * Classify patches by their type for ordered processing\n */\nexport function classifyPatches(patches: JsonPatch[]): ClassifiedPatches {\n  const rootPatches: JsonPatch[] = [];\n  const elementPatches: JsonPatch[] = [];\n  const propPatches: JsonPatch[] = [];\n  const otherPatches: JsonPatch[] = [];\n\n  for (const patch of patches) {\n    if (patch.path === \"/root\") {\n      rootPatches.push(patch);\n    } else if (patch.path.startsWith(\"/elements/\")) {\n      const depth = getPatchDepth(patch);\n      if (depth === 1) {\n        elementPatches.push(patch);\n      } else {\n        propPatches.push(patch);\n      }\n    } else {\n      otherPatches.push(patch);\n    }\n  }\n\n  return { rootPatches, elementPatches, propPatches, otherPatches };\n}\n\n/**\n * Get path depth for sorting\n */\nexport function getPatchDepth(patch: JsonPatch): number {\n  if (!patch.path.startsWith(\"/elements/\")) return 0;\n  const parts = patch.path.slice(\"/elements/\".length).split(\"/\");\n  return parts.length;\n}\n\n/**\n * Sort patches for deterministic processing order\n */\nexport function sortPatchesByPath(patches: JsonPatch[]): JsonPatch[] {\n  return [...patches].sort((a, b) => a.path.localeCompare(b.path));\n}\n","import type { UITree, UIElement, JsonPatch } from \"@onegenui/core\";\nimport {\n  setByPathWithStructuralSharing,\n  removeByPath as removeByPathSharing,\n} from \"./patches/structural-sharing\";\nimport {\n  ensureChildrenExist,\n  removeNodeFromTree as removeNode,\n} from \"./patches/tree-utils\";\nimport {\n  createPlaceholder,\n  isPlaceholder,\n  getPatchDepth,\n} from \"./patches/types\";\n\n// Re-exports from modular files\nexport { isPlaceholder };\nexport { removeNode as removeNodeFromTree };\nexport { removeByPathSharing as removeByPath };\n\n/**\n * Parse a single JSON patch line\n */\nexport function parsePatchLine(line: string): JsonPatch | null {\n  try {\n    const trimmed = line.trim();\n    if (!trimmed || trimmed.startsWith(\"//\")) {\n      return null;\n    }\n    return JSON.parse(trimmed) as JsonPatch;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Options for applying patches\n */\nexport interface ApplyPatchOptions {\n  /** Turn ID for tracking which turn modified elements */\n  turnId?: string;\n  /** Element types that should not be removed by AI (e.g., [\"Canvas\"]) */\n  protectedTypes?: string[];\n}\n\n/**\n * Apply a JSON patch to the current tree\n */\nexport function applyPatch(\n  tree: UITree,\n  patch: JsonPatch,\n  options: ApplyPatchOptions = {},\n): UITree {\n  const { turnId, protectedTypes = [] } = options;\n\n  const newTree = { ...tree, elements: { ...tree.elements } };\n\n  switch (patch.op) {\n    case \"set\":\n    case \"add\":\n    case \"replace\": {\n      if (patch.path === \"/root\") {\n        newTree.root = patch.value as string;\n        return newTree;\n      }\n\n      if (patch.path.startsWith(\"/elements/\")) {\n        const pathParts = patch.path.slice(\"/elements/\".length).split(\"/\");\n        const elementKey = pathParts[0];\n\n        if (!elementKey) return newTree;\n\n        if (pathParts.length === 1) {\n          const element = patch.value as UIElement;\n          const newElement = turnId\n            ? {\n                ...element,\n                _meta: { ...element._meta, turnId, createdAt: Date.now() },\n              }\n            : element;\n\n          ensureChildrenExist(\n            newTree.elements,\n            newElement.children,\n            createPlaceholder,\n            turnId,\n          );\n          newTree.elements[elementKey] = newElement;\n        } else {\n          let element = newTree.elements[elementKey];\n\n          if (!element) {\n            const isChildrenOperation = pathParts.some((p) => p === \"children\");\n            if (isChildrenOperation) {\n              element = {\n                key: elementKey,\n                type: \"Stack\",\n                props: { gap: \"md\" },\n                children: [],\n                _meta: { turnId, createdAt: Date.now(), autoCreated: true },\n              } as UIElement;\n            } else {\n              element = createPlaceholder(elementKey, turnId);\n            }\n            newTree.elements[elementKey] = element;\n          }\n\n          const propPath = \"/\" + pathParts.slice(1).join(\"/\");\n          const newElement = setByPathWithStructuralSharing(\n            element as unknown as Record<string, unknown>,\n            propPath,\n            patch.value,\n          ) as unknown as UIElement;\n\n          if (\n            propPath.startsWith(\"/children\") &&\n            typeof patch.value === \"string\"\n          ) {\n            const childKey = patch.value;\n            if (!newTree.elements[childKey]) {\n              newTree.elements[childKey] = createPlaceholder(childKey, turnId);\n            }\n            const childElement = newTree.elements[childKey];\n            if (childElement && childElement.parentKey !== elementKey) {\n              newTree.elements[childKey] = {\n                ...childElement,\n                parentKey: elementKey,\n              };\n            }\n          }\n\n          // Update _meta.turnId when element is modified (not just created)\n          // This enables tracking which turn last modified each element\n          const updatedElement = turnId\n            ? {\n                ...newElement,\n                _meta: {\n                  ...newElement._meta,\n                  turnId,\n                  lastModifiedAt: Date.now(),\n                },\n              }\n            : newElement;\n\n          newTree.elements[elementKey] = updatedElement;\n        }\n      }\n      break;\n    }\n    case \"remove\": {\n      if (patch.path === \"/root\") {\n        newTree.root = \"\";\n        return newTree;\n      }\n\n      if (patch.path.startsWith(\"/elements/\")) {\n        const pathParts = patch.path.slice(\"/elements/\".length).split(\"/\");\n        const elementKey = pathParts[0];\n\n        if (!elementKey) return newTree;\n\n        // Check if element is protected from removal\n        if (pathParts.length === 1) {\n          const element = newTree.elements[elementKey];\n          if (element && protectedTypes.includes(element.type)) {\n            // Skip removal of protected element types\n            console.debug(\n              `[applyPatch] Blocked removal of protected element: ${element.type}`,\n            );\n            return newTree;\n          }\n          const { [elementKey]: _, ...rest } = newTree.elements;\n          newTree.elements = rest;\n        } else {\n          const element = newTree.elements[elementKey];\n          if (element) {\n            const propPath = \"/\" + pathParts.slice(1).join(\"/\");\n            const newElement = { ...element };\n            removeByPathSharing(\n              newElement as unknown as Record<string, unknown>,\n              propPath,\n            );\n            newTree.elements[elementKey] = newElement;\n          }\n        }\n      }\n      break;\n    }\n    case \"ensure\": {\n      if (patch.path.startsWith(\"/elements/\")) {\n        const pathParts = patch.path.slice(\"/elements/\".length).split(\"/\");\n        const elementKey = pathParts[0];\n\n        if (!elementKey) return newTree;\n\n        if (pathParts.length === 1 && !newTree.elements[elementKey]) {\n          const newElement = patch.value as UIElement;\n          if (turnId && newElement._meta) {\n            newElement._meta.turnId = turnId;\n          } else if (turnId) {\n            (newElement as any)._meta = { turnId };\n          }\n          ensureChildrenExist(\n            newTree.elements,\n            newElement.children,\n            createPlaceholder,\n            turnId,\n          );\n          newTree.elements[elementKey] = newElement;\n        }\n      }\n      break;\n    }\n  }\n\n  return newTree;\n}\n\n/**\n * Apply multiple patches in dependency order (ORDER-INDEPENDENT).\n */\nexport function applyPatchesBatch(\n  tree: UITree,\n  patches: JsonPatch[],\n  options: ApplyPatchOptions = {},\n): UITree {\n  if (patches.length === 0) return tree;\n\n  const rootPatches: JsonPatch[] = [];\n  const elementPatches: JsonPatch[] = [];\n  const propPatches: JsonPatch[] = [];\n  const otherPatches: JsonPatch[] = [];\n\n  for (const patch of patches) {\n    if (patch.path === \"/root\") {\n      rootPatches.push(patch);\n    } else if (patch.path.startsWith(\"/elements/\")) {\n      const depth = getPatchDepth(patch);\n      if (depth === 1) {\n        elementPatches.push(patch);\n      } else {\n        propPatches.push(patch);\n      }\n    } else {\n      otherPatches.push(patch);\n    }\n  }\n\n  elementPatches.sort((a, b) => a.path.localeCompare(b.path));\n  propPatches.sort((a, b) => a.path.localeCompare(b.path));\n\n  let newTree = { ...tree, elements: { ...tree.elements } };\n\n  for (const patch of rootPatches) {\n    newTree = applyPatch(newTree, patch, options);\n  }\n  for (const patch of elementPatches) {\n    newTree = applyPatch(newTree, patch, options);\n  }\n  for (const patch of propPatches) {\n    newTree = applyPatch(newTree, patch, options);\n  }\n  for (const patch of otherPatches) {\n    newTree = applyPatch(newTree, patch, options);\n  }\n\n  return newTree;\n}\n","import type { UITree } from \"@onegenui/core\";\nimport { removeNodeFromTree } from \"../patch-utils\";\n\n/**\n * Array prop names commonly used for sub-items\n */\nconst ARRAY_PROP_NAMES = [\n  \"items\",\n  \"rows\",\n  \"entries\",\n  \"cards\",\n  \"events\",\n  \"steps\",\n  \"tasks\",\n  \"options\",\n  \"data\",\n  \"children\",\n  \"nodes\",\n  \"sections\",\n  \"flights\",\n  \"exercises\",\n  \"meals\",\n  \"messages\",\n  \"emails\",\n  \"columns\",\n];\n\n/**\n * Remove an element from the tree by key\n */\nexport function removeElementFromTree(tree: UITree, key: string): UITree {\n  const newTree = JSON.parse(JSON.stringify(tree));\n  removeNodeFromTree(newTree, key);\n  return newTree;\n}\n\n/**\n * Find array indices from mixed identifiers (numbers or string IDs)\n */\nfunction findIndicesFromIdentifiers(\n  prop: unknown[],\n  identifiers: (number | string)[],\n): number[] {\n  const indices: number[] = [];\n\n  for (const id of identifiers) {\n    if (typeof id === \"number\") {\n      if (id >= 0 && id < prop.length) {\n        indices.push(id);\n      }\n    } else {\n      // String ID - try exact match on id/key\n      let idx = prop.findIndex(\n        (item: unknown) =>\n          (item as Record<string, unknown>)?.id === id ||\n          (item as Record<string, unknown>)?.key === id,\n      );\n\n      // Try item-{depth}-{index} format\n      if (idx === -1) {\n        const depthMatch = id.match(/^item-(\\d+)-(\\d+)$/);\n        if (depthMatch?.[2]) {\n          const parsedIndex = parseInt(depthMatch[2], 10);\n          if (parsedIndex >= 0 && parsedIndex < prop.length) {\n            idx = parsedIndex;\n          }\n        }\n      }\n\n      // Try simpler {prefix}-{index} format\n      if (idx === -1) {\n        const simpleMatch = id.match(/^[a-z]+-(\\d+)$/i);\n        if (simpleMatch?.[1]) {\n          const parsedIndex = parseInt(simpleMatch[1], 10);\n          if (parsedIndex >= 0 && parsedIndex < prop.length) {\n            idx = parsedIndex;\n          }\n        }\n      }\n\n      if (idx !== -1) {\n        indices.push(idx);\n      }\n    }\n  }\n\n  return indices;\n}\n\n/**\n * Remove sub-items from an element's array prop\n */\nexport function removeSubItemsFromTree(\n  tree: UITree,\n  elementKey: string,\n  identifiers: (number | string)[],\n): UITree {\n  if (identifiers.length === 0) return tree;\n\n  const element = tree.elements[elementKey];\n  if (!element) return tree;\n\n  const newTree = JSON.parse(JSON.stringify(tree));\n  const newElement = newTree.elements[elementKey];\n\n  for (const propName of ARRAY_PROP_NAMES) {\n    const prop = newElement.props?.[propName];\n    if (Array.isArray(prop) && prop.length > 0) {\n      const indicesToRemove = findIndicesFromIdentifiers(prop, identifiers);\n\n      // Sort descending to remove from end first\n      const uniqueSorted = [...new Set(indicesToRemove)].sort((a, b) => b - a);\n\n      for (const idx of uniqueSorted) {\n        if (idx >= 0 && idx < prop.length) {\n          prop.splice(idx, 1);\n        }\n      }\n      break;\n    }\n  }\n\n  return newTree;\n}\n\n/**\n * Update element props in the tree\n */\nexport function updateElementInTree(\n  tree: UITree,\n  elementKey: string,\n  updates: Record<string, unknown>,\n): UITree {\n  const newTree = JSON.parse(JSON.stringify(tree));\n  const element = newTree.elements[elementKey];\n  if (element) {\n    element.props = { ...element.props, ...updates };\n  }\n  return newTree;\n}\n\n/**\n * Layout update options\n */\nexport interface LayoutUpdates {\n  width?: number;\n  height?: number;\n  column?: number;\n  row?: number;\n  columnSpan?: number;\n  rowSpan?: number;\n  resizable?: boolean;\n}\n\n/**\n * Update element layout in the tree\n */\nexport function updateElementLayoutInTree(\n  tree: UITree,\n  elementKey: string,\n  layoutUpdates: LayoutUpdates,\n): UITree {\n  const element = tree.elements[elementKey];\n  if (!element) return tree;\n\n  const newTree = JSON.parse(JSON.stringify(tree));\n  const newElement = newTree.elements[elementKey];\n\n  if (!newElement.layout) {\n    newElement.layout = {};\n  }\n\n  // Update size\n  if (layoutUpdates.width !== undefined || layoutUpdates.height !== undefined) {\n    if (!newElement.layout.size) {\n      newElement.layout.size = {};\n    }\n    if (layoutUpdates.width !== undefined) {\n      newElement.layout.size.width = layoutUpdates.width;\n    }\n    if (layoutUpdates.height !== undefined) {\n      newElement.layout.size.height = layoutUpdates.height;\n    }\n  }\n\n  // Update grid\n  if (\n    layoutUpdates.column !== undefined ||\n    layoutUpdates.row !== undefined ||\n    layoutUpdates.columnSpan !== undefined ||\n    layoutUpdates.rowSpan !== undefined\n  ) {\n    if (!newElement.layout.grid) {\n      newElement.layout.grid = {};\n    }\n    if (layoutUpdates.column !== undefined) {\n      newElement.layout.grid.column = layoutUpdates.column;\n    }\n    if (layoutUpdates.row !== undefined) {\n      newElement.layout.grid.row = layoutUpdates.row;\n    }\n    if (layoutUpdates.columnSpan !== undefined) {\n      newElement.layout.grid.columnSpan = layoutUpdates.columnSpan;\n    }\n    if (layoutUpdates.rowSpan !== undefined) {\n      newElement.layout.grid.rowSpan = layoutUpdates.rowSpan;\n    }\n  }\n\n  // Update resizable\n  if (layoutUpdates.resizable !== undefined) {\n    newElement.layout.resizable = layoutUpdates.resizable;\n  }\n\n  return newTree;\n}\n","import { useState, useCallback, useRef } from \"react\";\nimport type { UITree } from \"@onegenui/core\";\nimport type { ConversationTurn } from \"../types\";\n\nexport interface HistorySnapshot {\n  tree: UITree | null;\n  conversation: ConversationTurn[];\n}\n\nexport interface UseHistoryReturn {\n  history: HistorySnapshot[];\n  historyIndex: number;\n  pushHistory: () => void;\n  undo: () => void;\n  redo: () => void;\n  canUndo: boolean;\n  canRedo: boolean;\n  setHistory: React.Dispatch<React.SetStateAction<HistorySnapshot[]>>;\n  setHistoryIndex: React.Dispatch<React.SetStateAction<number>>;\n}\n\n/**\n * Hook for managing undo/redo history\n */\nexport function useHistory(\n  tree: UITree | null,\n  conversation: ConversationTurn[],\n  setTree: (tree: UITree | null) => void,\n  setConversation: React.Dispatch<React.SetStateAction<ConversationTurn[]>>,\n  treeRef: React.MutableRefObject<UITree | null>,\n): UseHistoryReturn {\n  const [history, setHistory] = useState<HistorySnapshot[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  const pushHistory = useCallback(() => {\n    const snapshot = {\n      tree: tree ? JSON.parse(JSON.stringify(tree)) : null,\n      conversation: JSON.parse(JSON.stringify(conversation)),\n    };\n    setHistory((prev) => {\n      const newHistory = prev.slice(0, historyIndex + 1);\n      return [...newHistory, snapshot];\n    });\n    setHistoryIndex((prev) => prev + 1);\n  }, [tree, conversation, historyIndex]);\n\n  const undo = useCallback(() => {\n    if (historyIndex < 0) return;\n    const snapshot = history[historyIndex];\n    if (snapshot) {\n      setTree(snapshot.tree);\n      treeRef.current = snapshot.tree;\n      setConversation(snapshot.conversation);\n      setHistoryIndex((prev) => prev - 1);\n    }\n  }, [history, historyIndex, setTree, setConversation, treeRef]);\n\n  const redo = useCallback(() => {\n    if (historyIndex >= history.length - 1) return;\n    const nextIndex = historyIndex + 1;\n    const snapshot = history[nextIndex];\n    if (!snapshot) return;\n    setTree(snapshot.tree);\n    treeRef.current = snapshot.tree;\n    setConversation(snapshot.conversation);\n    setHistoryIndex(nextIndex);\n  }, [history, historyIndex, setTree, setConversation, treeRef]);\n\n  const canUndo = historyIndex >= 0;\n  const canRedo = historyIndex < history.length - 1;\n\n  return {\n    history,\n    historyIndex,\n    pushHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    setHistory,\n    setHistoryIndex,\n  };\n}\n","\"use client\";\n\n/**\n * Stream Logger - Buffered logger for useUIStream\n *\n * DISABLED by default. Set NEXT_PUBLIC_DEBUG=true to enable.\n * Batches logs and sends them to debug endpoint every 500ms.\n */\n\nconst DEBUG =\n  typeof window !== \"undefined\" &&\n  process.env.NODE_ENV === \"development\" &&\n  process.env.NEXT_PUBLIC_DEBUG === \"true\";\n\nconst LOG_ENDPOINT = \"/api/debug-log\";\nconst LOG_BUFFER: string[] = [];\nlet flushTimer: ReturnType<typeof setTimeout> | null = null;\n\nfunction formatLog(level: string, message: string, data?: unknown): string {\n  const timestamp = new Date().toISOString();\n  const dataStr = data\n    ? `\\n  DATA: ${JSON.stringify(data, null, 2).replace(/\\n/g, \"\\n  \")}`\n    : \"\";\n  return `[${timestamp}] [${level}] [useUIStream] ${message}${dataStr}`;\n}\n\nfunction flushLogs(): void {\n  if (!DEBUG || LOG_BUFFER.length === 0) return;\n  const logs = LOG_BUFFER.splice(0, LOG_BUFFER.length);\n  if (typeof window !== \"undefined\") {\n    fetch(LOG_ENDPOINT, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ logs }),\n    }).catch(() => {});\n  }\n}\n\nfunction scheduleFlush(): void {\n  if (flushTimer) return;\n  flushTimer = setTimeout(() => {\n    flushTimer = null;\n    flushLogs();\n  }, 500);\n}\n\nexport interface StreamLogger {\n  debug: (msg: string, data?: unknown) => void;\n  info: (msg: string, data?: unknown) => void;\n  warn: (msg: string, data?: unknown) => void;\n  error: (msg: string, data?: unknown) => void;\n}\n\n/**\n * Logger - all output disabled by default, requires NEXT_PUBLIC_DEBUG=true\n */\nexport const streamLog: StreamLogger = {\n  debug: (msg: string, data?: unknown) => {\n    if (!DEBUG) return;\n    LOG_BUFFER.push(formatLog(\"DEBUG\", msg, data));\n    scheduleFlush();\n  },\n  info: (msg: string, data?: unknown) => {\n    if (!DEBUG) return;\n    LOG_BUFFER.push(formatLog(\"INFO\", msg, data));\n    scheduleFlush();\n  },\n  warn: (msg: string, data?: unknown) => {\n    if (!DEBUG) return;\n    LOG_BUFFER.push(formatLog(\"WARN\", msg, data));\n    scheduleFlush();\n  },\n  error: (msg: string, data?: unknown) => {\n    if (!DEBUG) return;\n    console.error(`[useUIStream] ${msg}`, data ?? \"\");\n    LOG_BUFFER.push(formatLog(\"ERROR\", msg, data));\n    scheduleFlush();\n  },\n};\n\n/**\n * Silent logger for testing or production\n */\nexport const silentLogger: StreamLogger = {\n  debug: () => {},\n  info: () => {},\n  warn: () => {},\n  error: () => {},\n};\n","\"use client\";\n\n/**\n * Plan Execution Handler - Processes plan events from stream\n *\n * Handles multi-agent orchestration events:\n * - plan-created: Initial plan with steps\n * - step-started / step-done: Step lifecycle\n * - subtask-started / subtask-done: Subtask lifecycle\n * - level-started: Parallel execution levels\n * - orchestration-done: Plan completion\n */\n\nexport interface PlanStep {\n  id: number;\n  task: string;\n  agent: string;\n  dependencies: number[];\n  parallel?: boolean;\n  subtasks?: Array<{\n    id: number;\n    task: string;\n    agent: string;\n  }>;\n}\n\nexport interface PlanPayload {\n  goal: string;\n  steps: Array<{\n    id: number;\n    task: string;\n    agent: string;\n    dependencies?: number[];\n    parallel?: boolean;\n    subtasks?: Array<{\n      id: number;\n      task: string;\n      agent: string;\n    }>;\n  }>;\n}\n\nexport interface PlanStoreActions {\n  setPlanCreated: (goal: string, steps: PlanStep[]) => void;\n  setStepStarted: (stepId: number) => void;\n  setStepDone: (stepId: number, result?: string) => void;\n  setSubtaskStarted: (stepId: number, subtaskId: number) => void;\n  setSubtaskDone: (stepId: number, subtaskId: number, result?: string) => void;\n  setLevelStarted: (level: number) => void;\n  setOrchestrationDone: (finalResult?: string) => void;\n}\n\n/**\n * Handle plan-created event\n */\nexport function handlePlanCreated(\n  payload: { plan: PlanPayload },\n  store: PlanStoreActions,\n): void {\n  const { plan } = payload;\n  store.setPlanCreated(\n    plan.goal,\n    plan.steps.map((s) => ({\n      id: s.id,\n      task: s.task,\n      agent: s.agent,\n      dependencies: s.dependencies ?? [],\n      parallel: s.parallel,\n      subtasks: s.subtasks?.map((st) => ({\n        id: st.id,\n        task: st.task,\n        agent: st.agent,\n      })),\n    })),\n  );\n}\n\n/**\n * Handle step-started event\n */\nexport function handleStepStarted(\n  payload: { stepId: number },\n  store: PlanStoreActions,\n): void {\n  store.setStepStarted(payload.stepId);\n}\n\n/**\n * Handle step-done event\n */\nexport function handleStepDone(\n  payload: { stepId: number; result?: string },\n  store: PlanStoreActions,\n): void {\n  store.setStepDone(payload.stepId, payload.result);\n}\n\n/**\n * Handle subtask-started event\n */\nexport function handleSubtaskStarted(\n  payload: { parentId: number; stepId: number },\n  store: PlanStoreActions,\n): void {\n  store.setSubtaskStarted(payload.parentId, payload.stepId);\n}\n\n/**\n * Handle subtask-done event\n */\nexport function handleSubtaskDone(\n  payload: { parentId: number; stepId: number; result?: unknown },\n  store: PlanStoreActions,\n): void {\n  store.setSubtaskDone(payload.parentId, payload.stepId, payload.result);\n}\n\n/**\n * Handle level-started event\n */\nexport function handleLevelStarted(\n  payload: { level: number },\n  store: PlanStoreActions,\n): void {\n  store.setLevelStarted(payload.level);\n}\n\n/**\n * Handle orchestration-done event\n */\nexport function handleOrchestrationDone(\n  payload: { finalResult?: string },\n  store: PlanStoreActions,\n): void {\n  store.setOrchestrationDone(payload.finalResult);\n}\n\n/**\n * Process plan event from stream payload\n */\nexport function processPlanEvent(\n  payload: Record<string, unknown>,\n  store: PlanStoreActions,\n): boolean {\n  const type = payload.type as string;\n\n  switch (type) {\n    case \"plan-created\":\n      handlePlanCreated(payload as { plan: PlanPayload }, store);\n      return true;\n\n    case \"step-started\":\n      handleStepStarted(payload as { stepId: number }, store);\n      return true;\n\n    case \"step-done\":\n      handleStepDone(payload as { stepId: number; result?: string }, store);\n      return true;\n\n    case \"subtask-started\":\n      handleSubtaskStarted(\n        payload as { parentId: number; stepId: number },\n        store,\n      );\n      return true;\n\n    case \"subtask-done\":\n      handleSubtaskDone(\n        payload as { parentId: number; stepId: number; result?: unknown },\n        store,\n      );\n      return true;\n\n    case \"level-started\":\n      handleLevelStarted(payload as { level: number }, store);\n      return true;\n\n    case \"orchestration-done\":\n      handleOrchestrationDone(payload as { finalResult?: string }, store);\n      return true;\n\n    default:\n      return false;\n  }\n}\n","\"use client\";\n\n/**\n * Request Builder - Constructs HTTP request body and headers\n *\n * Handles different request formats:\n * - FormData for file uploads\n * - JSON for library documents only\n * - JSON for text-only requests\n */\n\nimport type { UITree } from \"@onegenui/core\";\nimport type {\n  Attachment,\n  ConversationTurn,\n  FileAttachment,\n  LibraryAttachment,\n} from \"../types\";\n\n/**\n * Generate idempotency key for request deduplication\n */\nexport function generateIdempotencyKey(): string {\n  return `req_${Date.now()}_${Math.random().toString(36).slice(2, 11)}`;\n}\n\nexport function isFileAttachment(a: Attachment): a is FileAttachment {\n  return a.type !== \"library-document\" && \"file\" in a && a.file instanceof File;\n}\n\nexport function isLibraryAttachment(a: Attachment): a is LibraryAttachment {\n  return a.type === \"library-document\" && \"documentId\" in a;\n}\n\n/** Build conversation messages array for multi-turn context */\nexport function buildConversationMessages(\n  conversation: ConversationTurn[],\n): Array<{ role: \"user\" | \"assistant\"; content: string }> {\n  const messages: Array<{ role: \"user\" | \"assistant\"; content: string }> = [];\n\n  for (const turn of conversation) {\n    // Only include completed turns (not loading)\n    if (turn.isLoading) continue;\n\n    // Add user message\n    if (turn.userMessage) {\n      messages.push({ role: \"user\", content: turn.userMessage });\n    }\n\n    // Add assistant response (combine all messages)\n    const assistantContent = turn.assistantMessages\n      .filter((m) => m.type === \"text\" && m.text)\n      .map((m) => m.text)\n      .join(\"\\n\");\n\n    if (assistantContent) {\n      messages.push({ role: \"assistant\", content: assistantContent });\n    }\n  }\n\n  return messages;\n}\n\nexport interface RequestBuilderInput {\n  prompt: string;\n  context?: Record<string, unknown>;\n  currentTree: UITree;\n  conversation: ConversationTurn[];\n  attachments?: Attachment[];\n}\n\nexport interface RequestBuilderOutput {\n  body: string | FormData;\n  headers: Record<string, string>;\n}\n\n/**\n * Build request body and headers based on attachment types\n */\nexport function buildRequest(input: RequestBuilderInput): RequestBuilderOutput {\n  const { prompt, context, currentTree, conversation, attachments } = input;\n  const headers: Record<string, string> = {};\n\n  // Generate idempotency key for deduplication\n  const idempotencyKey = generateIdempotencyKey();\n  headers[\"X-Idempotency-Key\"] = idempotencyKey;\n\n  const hasTreeContext =\n    context && typeof context === \"object\" && \"tree\" in context;\n\n  // Build conversation history for multi-turn support\n  const conversationMessages = buildConversationMessages(conversation);\n\n  // Separate file attachments from library attachments\n  const fileAttachments = attachments?.filter(isFileAttachment) ?? [];\n  const libraryAttachments = attachments?.filter(isLibraryAttachment) ?? [];\n\n  if (fileAttachments.length > 0) {\n    // Use FormData for file uploads\n    const formData = new FormData();\n    formData.append(\"prompt\", prompt);\n    formData.append(\"idempotencyKey\", idempotencyKey);\n    if (context) {\n      formData.append(\"context\", JSON.stringify(context));\n    }\n    if (!hasTreeContext) {\n      formData.append(\"currentTree\", JSON.stringify(currentTree));\n    }\n    // Include conversation history for multi-turn context\n    if (conversationMessages.length > 0) {\n      formData.append(\"messages\", JSON.stringify(conversationMessages));\n    }\n\n    fileAttachments.forEach((att) => {\n      formData.append(\"files\", att.file);\n    });\n\n    // Include library document IDs\n    if (libraryAttachments.length > 0) {\n      formData.append(\n        \"libraryDocumentIds\",\n        JSON.stringify(libraryAttachments.map((a) => a.documentId)),\n      );\n    }\n\n    // Don't set Content-Type header for FormData, browser sets it with boundary\n    return { body: formData, headers };\n  }\n\n  if (libraryAttachments.length > 0) {\n    // Only library documents, use JSON\n    const bodyPayload: Record<string, unknown> = {\n      prompt,\n      context,\n      idempotencyKey,\n      libraryDocumentIds: libraryAttachments.map((a) => a.documentId),\n    };\n    if (!hasTreeContext) {\n      bodyPayload.currentTree = currentTree;\n    }\n    if (conversationMessages.length > 0) {\n      bodyPayload.messages = conversationMessages;\n    }\n    headers[\"Content-Type\"] = \"application/json\";\n    return { body: JSON.stringify(bodyPayload), headers };\n  }\n\n  // Use JSON for text-only requests\n  const bodyPayload: Record<string, unknown> = { prompt, context, idempotencyKey };\n  if (!hasTreeContext) {\n    bodyPayload.currentTree = currentTree;\n  }\n  // Include conversation history for multi-turn context\n  if (conversationMessages.length > 0) {\n    bodyPayload.messages = conversationMessages;\n  }\n  headers[\"Content-Type\"] = \"application/json\";\n  return { body: JSON.stringify(bodyPayload), headers };\n}\n","\"use client\";\n\n/**\n * Document Index Handler - Processes document index events from stream\n *\n * Handles document-index-ui events from Vectorless:\n * - First document: Set as current index\n * - Additional documents: Merge into existing index\n */\n\nimport type { DocumentIndex, DocumentIndexNode } from \"@onegenui/core\";\n\n/**\n * Process document index UI event\n * Returns updated index (merged if existing)\n */\nexport function processDocumentIndex(\n  uiComponent: { type: string; props: DocumentIndex },\n  currentIndex: DocumentIndex | null | undefined,\n): DocumentIndex | null {\n  if (!uiComponent?.props) return currentIndex;\n\n  if (!currentIndex) {\n    // First document\n    return uiComponent.props;\n  }\n\n  // Additional document - merge into existing\n  const newDoc = uiComponent.props;\n  return {\n    title: `${currentIndex.title} + ${newDoc.title}`,\n    description: [currentIndex.description, newDoc.description]\n      .filter(Boolean)\n      .join(\"\\n\\n---\\n\\n\"),\n    pageCount: currentIndex.pageCount + newDoc.pageCount,\n    nodes: [\n      ...currentIndex.nodes,\n      // Add separator node for clarity\n      {\n        title: `📄 ${newDoc.title}`,\n        nodeId: `doc-${Date.now()}`,\n        startPage: 1,\n        endPage: newDoc.pageCount,\n        summary: newDoc.description,\n        children: newDoc.nodes,\n      } as DocumentIndexNode,\n    ],\n  };\n}\n","\"use client\";\n\n/**\n * Store Refs Hook - Manages Zustand store references for async operations\n *\n * Centralizes:\n * - Store selector subscriptions\n * - Refs for async callback access\n * - Plan execution store actions\n */\n\nimport { useRef, useEffect } from \"react\";\nimport { useStore } from \"../../store\";\nimport type { PlanStoreActions } from \"./plan-handler\";\n\nexport interface TreeStoreRef {\n  setUITree: ReturnType<typeof useStore>[\"setUITree\"];\n  bumpTreeVersion: ReturnType<typeof useStore>[\"bumpTreeVersion\"];\n  setTreeStreaming: ReturnType<typeof useStore>[\"setTreeStreaming\"];\n  clearUITree: ReturnType<typeof useStore>[\"clearUITree\"];\n}\n\n/**\n * Hook to get stable refs for store actions\n * Safe to use in async callbacks\n */\nexport function useStoreRefs() {\n  // Tree store actions\n  const storeSetUITree = useStore((s) => s.setUITree);\n  const storeClearUITree = useStore((s) => s.clearUITree);\n  const storeSetTreeStreaming = useStore((s) => s.setTreeStreaming);\n  const storeBumpTreeVersion = useStore((s) => s.bumpTreeVersion);\n\n  // Tool progress\n  const addProgressEvent = useStore((s) => s.addProgressEvent);\n\n  // Plan execution actions\n  const setPlanCreated = useStore((s) => s.setPlanCreated);\n  const setStepStarted = useStore((s) => s.setStepStarted);\n  const setStepDone = useStore((s) => s.setStepDone);\n  const setSubtaskStarted = useStore((s) => s.setSubtaskStarted);\n  const setSubtaskDone = useStore((s) => s.setSubtaskDone);\n  const setLevelStarted = useStore((s) => s.setLevelStarted);\n  const setOrchestrationDone = useStore((s) => s.setOrchestrationDone);\n  const resetPlanExecution = useStore((s) => s.resetPlanExecution);\n\n  // Keep refs for async callbacks\n  const addProgressRef = useRef(addProgressEvent);\n  useEffect(() => {\n    addProgressRef.current = addProgressEvent;\n  }, [addProgressEvent]);\n\n  // Tree store ref\n  const storeRef = useRef<TreeStoreRef>({\n    setUITree: storeSetUITree,\n    bumpTreeVersion: storeBumpTreeVersion,\n    setTreeStreaming: storeSetTreeStreaming,\n    clearUITree: storeClearUITree,\n  });\n  useEffect(() => {\n    storeRef.current = {\n      setUITree: storeSetUITree,\n      bumpTreeVersion: storeBumpTreeVersion,\n      setTreeStreaming: storeSetTreeStreaming,\n      clearUITree: storeClearUITree,\n    };\n  }, [storeSetUITree, storeBumpTreeVersion, storeSetTreeStreaming, storeClearUITree]);\n\n  // Plan store ref\n  const planStoreRef = useRef<PlanStoreActions>({\n    setPlanCreated,\n    setStepStarted,\n    setStepDone,\n    setSubtaskStarted,\n    setSubtaskDone,\n    setLevelStarted,\n    setOrchestrationDone,\n  });\n  useEffect(() => {\n    planStoreRef.current = {\n      setPlanCreated,\n      setStepStarted,\n      setStepDone,\n      setSubtaskStarted,\n      setSubtaskDone,\n      setLevelStarted,\n      setOrchestrationDone,\n    };\n  }, [\n    setPlanCreated,\n    setStepStarted,\n    setStepDone,\n    setSubtaskStarted,\n    setSubtaskDone,\n    setLevelStarted,\n    setOrchestrationDone,\n  ]);\n\n  // Keep setUITree ref for sync wrapper\n  const storeSetUITreeRef = useRef(storeSetUITree);\n  useEffect(() => {\n    storeSetUITreeRef.current = storeSetUITree;\n  }, [storeSetUITree]);\n\n  return {\n    storeRef,\n    planStoreRef,\n    addProgressRef,\n    storeSetUITreeRef,\n    resetPlanExecution,\n  };\n}\n","\"use client\";\n\n/**\n * Turn Manager - Handles conversation turn lifecycle\n *\n * Manages:\n * - Creating new turns\n * - Updating turn data during streaming\n * - Finalizing completed turns\n * - Marking failed turns\n */\n\nimport type { UITree, DocumentIndex } from \"@onegenui/core\";\nimport type {\n  ConversationTurn,\n  ChatMessage,\n  QuestionPayload,\n  SuggestionChip,\n  ToolProgress,\n  PersistedAttachment,\n  Attachment,\n} from \"../types\";\n\nexport interface TurnData {\n  messages: ChatMessage[];\n  questions: QuestionPayload[];\n  suggestions: SuggestionChip[];\n  toolProgress: ToolProgress[];\n  persistedAttachments: PersistedAttachment[];\n  documentIndex: DocumentIndex | null | undefined;\n}\n\n/**\n * Create a new pending conversation turn\n */\nexport function createPendingTurn(\n  prompt: string,\n  options: {\n    isProactive?: boolean;\n    attachments?: Attachment[];\n  } = {},\n): ConversationTurn {\n  const { isProactive = false, attachments } = options;\n  return {\n    id: `turn-${Date.now()}`,\n    userMessage: prompt,\n    assistantMessages: [],\n    treeSnapshot: null,\n    timestamp: Date.now(),\n    isProactive,\n    attachments,\n    isLoading: true,\n    status: \"streaming\",\n  } as ConversationTurn;\n}\n\n/**\n * Update turn with streaming data\n */\nexport function updateTurnData(\n  turns: ConversationTurn[],\n  turnId: string,\n  data: Partial<TurnData>,\n): ConversationTurn[] {\n  return turns.map((t) =>\n    t.id === turnId\n      ? ({\n          ...t,\n          assistantMessages: data.messages ?? t.assistantMessages,\n          questions: data.questions ?? t.questions,\n          suggestions: data.suggestions ?? t.suggestions,\n          toolProgress: data.toolProgress ?? t.toolProgress,\n          persistedAttachments:\n            data.persistedAttachments && data.persistedAttachments.length > 0\n              ? data.persistedAttachments\n              : t.persistedAttachments,\n          documentIndex: data.documentIndex ?? t.documentIndex,\n        } as ConversationTurn)\n      : t,\n  );\n}\n\n/**\n * Finalize a completed turn\n */\nexport function finalizeTurn(\n  turns: ConversationTurn[],\n  turnId: string,\n  finalData: {\n    messages: ChatMessage[];\n    questions: QuestionPayload[];\n    suggestions: SuggestionChip[];\n    treeSnapshot: UITree;\n    documentIndex: DocumentIndex | null | undefined;\n  },\n): ConversationTurn[] {\n  return turns.map((t) =>\n    t.id === turnId\n      ? ({\n          ...t,\n          assistantMessages: [...finalData.messages],\n          questions: [...finalData.questions],\n          suggestions: [...finalData.suggestions],\n          treeSnapshot: JSON.parse(JSON.stringify(finalData.treeSnapshot)),\n          documentIndex: finalData.documentIndex ?? t.documentIndex,\n          isLoading: false,\n          status: \"complete\",\n        } as ConversationTurn)\n      : t,\n  );\n}\n\n/**\n * Mark turn as failed\n */\nexport function markTurnFailed(\n  turns: ConversationTurn[],\n  turnId: string,\n  errorMessage: string,\n): ConversationTurn[] {\n  return turns.map((t) =>\n    t.id === turnId\n      ? ({\n          ...t,\n          error: errorMessage,\n          isLoading: false,\n          status: \"failed\",\n        } as ConversationTurn)\n      : t,\n  );\n}\n\n/**\n * Remove turn from conversation\n */\nexport function removeTurn(\n  turns: ConversationTurn[],\n  turnId: string,\n): ConversationTurn[] {\n  return turns.filter((t) => t.id !== turnId);\n}\n\nexport interface TurnRollbackResult {\n  newConversation: ConversationTurn[];\n  restoredTree: UITree | null;\n}\n\n/**\n * Rollback to state before a specific turn\n * Returns new conversation and tree to restore\n */\nexport function rollbackToTurn(\n  turns: ConversationTurn[],\n  turnId: string,\n): TurnRollbackResult | null {\n  const turnIndex = turns.findIndex((t) => t.id === turnId);\n  if (turnIndex === -1) return null;\n\n  const newConversation = turns.slice(0, turnIndex);\n  const previousTurn = newConversation[newConversation.length - 1];\n  const restoredTree = previousTurn?.treeSnapshot ?? null;\n\n  return { newConversation, restoredTree };\n}\n","\"use client\";\n\n/**\n * Question Handler - Manages question answers and context\n *\n * Handles:\n * - Collecting previous answers from conversation\n * - Formatting answer responses\n * - Building prompt for question responses\n */\n\nimport type { ConversationTurn, QuestionPayload } from \"../types\";\n\n/**\n * Collect all previous question answers from conversation\n */\nexport function collectPreviousAnswers(\n  conversation: ConversationTurn[],\n  currentTurnId?: string,\n): Record<string, unknown> {\n  const allPreviousAnswers: Record<string, unknown> = {};\n\n  for (const t of conversation) {\n    if (t.questionAnswers) {\n      for (const qAnswers of Object.values(t.questionAnswers)) {\n        if (typeof qAnswers === \"object\" && qAnswers !== null) {\n          Object.assign(allPreviousAnswers, qAnswers);\n        }\n      }\n    }\n  }\n\n  // Add current turn's existing answers if provided\n  if (currentTurnId) {\n    const currentTurn = conversation.find((t) => t.id === currentTurnId);\n    if (currentTurn?.questionAnswers) {\n      for (const qAnswers of Object.values(currentTurn.questionAnswers)) {\n        if (typeof qAnswers === \"object\" && qAnswers !== null) {\n          Object.assign(\n            allPreviousAnswers,\n            qAnswers as Record<string, unknown>,\n          );\n        }\n      }\n    }\n  }\n\n  return allPreviousAnswers;\n}\n\n/**\n * Format answer summary for prompt\n */\nexport function formatAnswerSummary(answers: Record<string, unknown>): string {\n  return Object.entries(answers)\n    .map(([key, value]) => `${key}: ${value}`)\n    .join(\", \");\n}\n\n/**\n * Build prompt for question response\n */\nexport function buildQuestionResponsePrompt(\n  questionText: string,\n  answers: Record<string, unknown>,\n): string {\n  const answerSummary = formatAnswerSummary(answers);\n  return `[User Response] ${questionText}\\nAnswer: ${answerSummary}`;\n}\n\n/**\n * Build context for question response send\n */\nexport function buildQuestionResponseContext(\n  question: QuestionPayload,\n  turnId: string,\n  answers: Record<string, unknown>,\n  previousAnswers: Record<string, unknown>,\n): Record<string, unknown> {\n  return {\n    isQuestionResponse: true,\n    questionId: question.id,\n    turnId,\n    originalQuestion: question.text,\n    answers,\n    previousAnswers,\n    allCollectedData: { ...previousAnswers, ...answers },\n    hideUserMessage: true,\n  };\n}\n\n/**\n * Update conversation with question answer\n */\nexport function addQuestionAnswer(\n  turns: ConversationTurn[],\n  turnId: string,\n  questionId: string,\n  answers: Record<string, unknown>,\n): ConversationTurn[] {\n  return turns.map((t) => {\n    if (t.id !== turnId) return t;\n    const existing = t.questionAnswers ?? {};\n    return {\n      ...t,\n      questionAnswers: {\n        ...existing,\n        [questionId]: answers,\n      },\n    };\n  });\n}\n","\"use client\";\n\n/**\n * Stream Parser - SSE event parsing and dispatch\n *\n * Handles parsing of Server-Sent Events from the API:\n * - Text deltas\n * - JSON patches\n * - Messages\n * - Questions\n * - Suggestions\n * - Tool progress\n * - Plan events\n * - Document index\n */\n\nimport type { JsonPatch } from \"@onegenui/core\";\nimport type {\n  ChatMessage,\n  QuestionPayload,\n  SuggestionChip,\n  ToolProgress,\n} from \"../types\";\nimport { streamLog } from \"./logger\";\n\n/** Parsed SSE event with typed payload */\nexport type StreamEvent =\n  | { type: \"text-delta\" }\n  | { type: \"done\" }\n  | { type: \"streaming-started\"; timestamp: number }\n  | { type: \"message\"; message: ChatMessage }\n  | { type: \"question\"; question: QuestionPayload }\n  | { type: \"suggestion\"; suggestions: SuggestionChip[] }\n  | { type: \"tool-progress\"; progress: ToolProgress }\n  | { type: \"patch\"; patch: JsonPatch }\n  | { type: \"plan-created\"; plan: unknown }\n  | { type: \"persisted-attachments\"; attachments: unknown[] }\n  | { type: \"document-index-ui\"; uiComponent: unknown }\n  | { type: \"level-started\"; level: number }\n  | { type: \"step-started\"; stepId: number }\n  | { type: \"subtask-started\"; parentId: number; stepId: number }\n  | { type: \"subtask-done\"; parentId: number; stepId: number; result: unknown }\n  | { type: \"step-done\"; stepId: number; result: unknown }\n  | { type: \"level-completed\"; level: number }\n  | { type: \"orchestration-done\"; finalResult?: unknown }\n  | { type: \"citations\"; citations: unknown[] }\n  | { type: \"unknown\"; payload: unknown };\n\n/**\n * Parse a single SSE line into a stream event\n */\nexport function parseSSELine(line: string): StreamEvent | null {\n  if (!line) return null;\n\n  const colIdx = line.indexOf(\":\");\n  if (colIdx === -1) return null;\n\n  const lineType = line.slice(0, colIdx);\n  const content = line.slice(colIdx + 1);\n\n  // Only process \"d\" or \"data\" line types\n  if (lineType !== \"d\" && lineType !== \"data\") {\n    return null;\n  }\n\n  if (content.trim() === \"[DONE]\") {\n    streamLog.debug(\"Stream DONE received\");\n    return { type: \"done\" };\n  }\n\n  try {\n    const data = JSON.parse(content);\n    // Handle wrapped format: { type: \"data\", data: {...} }\n    const payload = data?.type === \"data\" ? data.data : data;\n    return parsePayload(payload);\n  } catch {\n    streamLog.warn(\"Failed to parse SSE line\", { content: content.slice(0, 100) });\n    return null;\n  }\n}\n\n/**\n * Parse payload into typed event\n */\nfunction parsePayload(payload: Record<string, unknown> | null): StreamEvent | null {\n  if (!payload) return null;\n\n  // Type-based events\n  if (payload.type === \"streaming-started\") {\n    return { type: \"streaming-started\", timestamp: payload.timestamp as number };\n  }\n\n  if (payload.type === \"text-delta\") {\n    return { type: \"text-delta\" };\n  }\n\n  if (payload.type === \"plan-created\") {\n    return { type: \"plan-created\", plan: payload.plan };\n  }\n\n  if (payload.type === \"persisted-attachments\") {\n    return { type: \"persisted-attachments\", attachments: payload.attachments as unknown[] };\n  }\n\n  if (payload.type === \"tool-progress\") {\n    return {\n      type: \"tool-progress\",\n      progress: {\n        toolName: payload.toolName as string,\n        toolCallId: payload.toolCallId as string,\n        status: payload.status as ToolProgress[\"status\"],\n        message: payload.message as string | undefined,\n        data: payload.data,\n      },\n    };\n  }\n\n  if (payload.type === \"document-index-ui\") {\n    return { type: \"document-index-ui\", uiComponent: payload.uiComponent };\n  }\n\n  if (payload.type === \"level-started\") {\n    return { type: \"level-started\", level: payload.level as number };\n  }\n\n  if (payload.type === \"step-started\") {\n    return { type: \"step-started\", stepId: payload.stepId as number };\n  }\n\n  if (payload.type === \"subtask-started\") {\n    return {\n      type: \"subtask-started\",\n      parentId: payload.parentId as number,\n      stepId: payload.stepId as number,\n    };\n  }\n\n  if (payload.type === \"subtask-done\") {\n    return {\n      type: \"subtask-done\",\n      parentId: payload.parentId as number,\n      stepId: payload.stepId as number,\n      result: payload.result,\n    };\n  }\n\n  if (payload.type === \"step-done\") {\n    return {\n      type: \"step-done\",\n      stepId: payload.stepId as number,\n      result: payload.result,\n    };\n  }\n\n  if (payload.type === \"level-completed\") {\n    return { type: \"level-completed\", level: payload.level as number };\n  }\n\n  if (payload.type === \"orchestration-done\") {\n    return { type: \"orchestration-done\", finalResult: payload.finalResult };\n  }\n\n  if (payload.type === \"citations\") {\n    return { type: \"citations\", citations: payload.citations as unknown[] };\n  }\n\n  // Op-based events\n  if (payload.op) {\n    const { op, path, value } = payload;\n\n    if (op === \"message\") {\n      const content = (payload.content || value) as string;\n      if (content) {\n        return {\n          type: \"message\",\n          message: {\n            role: (payload.role as ChatMessage[\"role\"]) || \"assistant\",\n            content,\n          },\n        };\n      }\n    }\n\n    if (op === \"question\") {\n      const question = value || payload.question;\n      if (question) {\n        return { type: \"question\", question: question as QuestionPayload };\n      }\n    }\n\n    if (op === \"suggestion\") {\n      const suggestions = value || payload.suggestions;\n      if (Array.isArray(suggestions)) {\n        return { type: \"suggestion\", suggestions: suggestions as SuggestionChip[] };\n      }\n    }\n\n    if (op === \"tool-progress\") {\n      return {\n        type: \"tool-progress\",\n        progress: {\n          toolName: payload.toolName as string,\n          toolCallId: payload.toolCallId as string,\n          status: payload.status as ToolProgress[\"status\"],\n          message: payload.message as string | undefined,\n          data: payload.data,\n        },\n      };\n    }\n\n    // Tree patch\n    if (path) {\n      return {\n        type: \"patch\",\n        patch: { op, path, value } as JsonPatch,\n      };\n    }\n  }\n\n  return { type: \"unknown\", payload };\n}\n\n/**\n * Create a line buffer for processing chunked SSE data\n */\nexport function createLineBuffer(): {\n  add: (chunk: string) => string[];\n  flush: () => string | null;\n} {\n  let buffer = \"\";\n\n  return {\n    add(chunk: string): string[] {\n      buffer += chunk;\n      const lines = buffer.split(\"\\n\");\n      buffer = lines.pop() ?? \"\";\n      return lines;\n    },\n    flush(): string | null {\n      const remaining = buffer;\n      buffer = \"\";\n      return remaining || null;\n    },\n  };\n}\n","\"use client\";\n\n/**\n * Stream Reader - Async iterator for SSE streams with timeout\n *\n * Provides:\n * - Idle timeout protection\n * - Line buffering\n * - Event parsing via parseSSELine\n */\n\nimport { parseSSELine, type StreamEvent } from \"./stream-parser\";\n\nconst IDLE_TIMEOUT_MS = 300000; // 5 minutes - deep research can take longer\n\n/**\n * Read SSE stream with idle timeout protection\n * Yields parsed events from the stream\n */\nexport async function* readStreamWithTimeout(\n  reader: ReadableStreamDefaultReader<Uint8Array>,\n): AsyncGenerator<StreamEvent, void, unknown> {\n  const decoder = new TextDecoder();\n  let buffer = \"\";\n  let lastActivityTime = Date.now();\n\n  const resetIdleTimer = () => {\n    lastActivityTime = Date.now();\n  };\n\n  while (true) {\n    // Create read with idle timeout check\n    const readPromise = reader.read();\n    const timeoutPromise = new Promise<never>((_, reject) => {\n      const checkInterval = setInterval(() => {\n        if (Date.now() - lastActivityTime > IDLE_TIMEOUT_MS) {\n          clearInterval(checkInterval);\n          reject(new Error(`Stream idle timeout: no activity for ${IDLE_TIMEOUT_MS / 1000}s`));\n        }\n      }, 5000);\n      readPromise.finally(() => clearInterval(checkInterval));\n    });\n\n    const { done, value } = await Promise.race([readPromise, timeoutPromise]);\n    if (done) break;\n\n    // Raw data received - reset timer\n    resetIdleTimer();\n\n    buffer += decoder.decode(value, { stream: true });\n    const lines = buffer.split(\"\\n\");\n    buffer = lines.pop() ?? \"\";\n\n    for (const line of lines) {\n      if (!line) continue;\n\n      const event = parseSSELine(line);\n      if (event) {\n        yield event;\n      }\n    }\n  }\n}\n","\"use client\";\n\n/**\n * Patch Processor - Handles batched JSON patch application\n *\n * Manages:\n * - Patch buffering and batch scheduling\n * - Tree updates with protection for specific types\n * - Zustand store synchronization\n * - Selection preservation during updates\n */\n\nimport type { UITree, JsonPatch } from \"@onegenui/core\";\nimport { applyPatchesBatch } from \"../patch-utils\";\nimport { streamLog } from \"./logger\";\n\n/** Flush interval in ms - higher = less jarring, lower = more responsive */\nconst PATCH_FLUSH_INTERVAL_MS = 100;\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Selection Preservation Utilities\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface SavedSelection {\n  anchorNodePath: number[];\n  anchorOffset: number;\n  focusNodePath: number[];\n  focusOffset: number;\n}\n\n/** Get path from root to node as array of child indices */\nfunction getNodePath(node: Node | null): number[] {\n  const path: number[] = [];\n  let current = node;\n  while (current?.parentNode) {\n    const parent = current.parentNode;\n    const index = Array.from(parent.childNodes).indexOf(current as ChildNode);\n    path.unshift(index);\n    current = parent;\n  }\n  return path;\n}\n\n/** Resolve a node path back to a DOM node */\nfunction resolveNodePath(path: number[], root: Document): Node | null {\n  let node: Node = root.body;\n  for (const index of path) {\n    if (!node.childNodes[index]) return null;\n    node = node.childNodes[index];\n  }\n  return node;\n}\n\n/** Save current browser selection state */\nexport function saveSelection(): SavedSelection | null {\n  if (typeof window === \"undefined\") return null;\n  const sel = window.getSelection();\n  if (!sel || sel.rangeCount === 0 || sel.isCollapsed) return null;\n  \n  return {\n    anchorNodePath: getNodePath(sel.anchorNode),\n    anchorOffset: sel.anchorOffset,\n    focusNodePath: getNodePath(sel.focusNode),\n    focusOffset: sel.focusOffset,\n  };\n}\n\n/** Restore browser selection from saved state */\nexport function restoreSelection(saved: SavedSelection | null): void {\n  if (!saved || typeof window === \"undefined\") return;\n  \n  try {\n    const anchorNode = resolveNodePath(saved.anchorNodePath, document);\n    const focusNode = resolveNodePath(saved.focusNodePath, document);\n    \n    if (!anchorNode || !focusNode) return;\n    \n    const sel = window.getSelection();\n    if (!sel) return;\n    \n    const range = document.createRange();\n    range.setStart(anchorNode, Math.min(saved.anchorOffset, anchorNode.textContent?.length ?? 0));\n    range.setEnd(focusNode, Math.min(saved.focusOffset, focusNode.textContent?.length ?? 0));\n    \n    sel.removeAllRanges();\n    sel.addRange(range);\n  } catch {\n    // Selection restoration failed - likely DOM structure changed significantly\n  }\n}\n\nexport { PATCH_FLUSH_INTERVAL_MS };\n\nexport interface TreeStoreActions {\n  setUITree: (tree: { root: string; elements: UITree[\"elements\"] }) => void;\n  bumpTreeVersion: () => void;\n}\n\nexport interface PatchProcessorState {\n  patchBuffer: JsonPatch[];\n  patchFlushTimer: ReturnType<typeof setTimeout> | null;\n  currentTree: UITree;\n}\n\nexport interface PatchProcessorDeps {\n  treeRef: React.MutableRefObject<UITree | null>;\n  storeRef: React.MutableRefObject<TreeStoreActions>;\n  turnId: string;\n  context?: Record<string, unknown>;\n}\n\n/**\n * Schedule a patch flush with debouncing\n * Returns updated state and tree\n */\nexport function schedulePatchFlush(\n  state: PatchProcessorState,\n  deps: PatchProcessorDeps,\n): PatchProcessorState {\n  const { patchBuffer, patchFlushTimer } = state;\n  const { treeRef, storeRef, turnId, context } = deps;\n\n  // If timer already scheduled, just return current state\n  if (patchFlushTimer) {\n    return state;\n  }\n\n  let newTree = state.currentTree;\n  let newBuffer = patchBuffer;\n  let newTimer: ReturnType<typeof setTimeout> | null = null;\n\n  // Schedule batch application with short delay\n  newTimer = setTimeout(() => {\n    if (patchBuffer.length > 0) {\n      streamLog.debug(\"Flushing patches\", { count: patchBuffer.length });\n      \n      // Save selection before DOM changes\n      const savedSel = saveSelection();\n      \n      // Use treeRef.current as base for latest state\n      const baseTree = treeRef.current ?? state.currentTree;\n      \n      // Protect Canvas from removal when forceCanvasMode is enabled\n      const protectedTypes =\n        context?.forceCanvasMode === true ? [\"Canvas\"] : [];\n      \n      const updatedTree = applyPatchesBatch(baseTree, patchBuffer, {\n        turnId,\n        protectedTypes,\n      });\n      \n      // Update ref and local state\n      treeRef.current = updatedTree;\n      newTree = updatedTree;\n      newBuffer = [];\n      \n      // Update Zustand store for reactivity\n      const store = storeRef.current;\n      store.setUITree({\n        root: updatedTree.root,\n        elements: { ...updatedTree.elements },\n      });\n      store.bumpTreeVersion();\n      \n      // Restore selection after DOM update (deferred for React reconciliation)\n      if (savedSel) {\n        requestAnimationFrame(() => restoreSelection(savedSel));\n      }\n      \n      streamLog.debug(\"Tree updated\", {\n        elementCount: Object.keys(updatedTree.elements).length,\n      });\n    }\n  }, PATCH_FLUSH_INTERVAL_MS);\n\n  return {\n    patchBuffer: newBuffer,\n    patchFlushTimer: newTimer,\n    currentTree: newTree,\n  };\n}\n\n/**\n * Add patch to buffer and schedule flush\n */\nexport function addPatch(\n  patch: JsonPatch,\n  state: PatchProcessorState,\n  deps: PatchProcessorDeps,\n): PatchProcessorState {\n  const newBuffer = [...state.patchBuffer, patch];\n  const newState = { ...state, patchBuffer: newBuffer };\n  \n  if (!state.patchFlushTimer) {\n    return schedulePatchFlush(newState, deps);\n  }\n  \n  return newState;\n}\n\n/**\n * Clear buffer and timer (for cleanup on error)\n */\nexport function clearPatchProcessor(\n  state: PatchProcessorState,\n): PatchProcessorState {\n  if (state.patchFlushTimer) {\n    clearTimeout(state.patchFlushTimer);\n  }\n  return {\n    patchBuffer: [],\n    patchFlushTimer: null,\n    currentTree: state.currentTree,\n  };\n}\n","\"use client\";\n\nimport { useCallback } from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Information about user's native text selection\n */\nexport interface TextSelectionInfo {\n  /** The selected text content */\n  text: string;\n  /** The JSON-UI element key containing the selection (if within a component) */\n  elementKey?: string;\n  /** The component type (e.g., \"List\", \"Email\", \"Document\") */\n  elementType?: string;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to capture native browser text selection.\n *\n * This allows users to:\n * 1. Select text with click+drag (or long-press on mobile)\n * 2. Copy the text normally\n * 3. Have the selection passed to AI as context when sending a message\n *\n * @example\n * ```tsx\n * const { getTextSelection, clearTextSelection, hasTextSelection } = useTextSelection();\n *\n * const handleSend = () => {\n *   const selection = getTextSelection();\n *   if (selection) {\n *     // Include in AI context\n *     context.textSelection = selection;\n *   }\n *   // ... send message\n *   clearTextSelection();\n * };\n * ```\n */\nexport function useTextSelection() {\n  /**\n   * Get the current native text selection, if any.\n   * Returns null if no text is selected or selection is collapsed.\n   */\n  const getTextSelection = useCallback((): TextSelectionInfo | null => {\n    if (typeof window === \"undefined\") return null;\n\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return null;\n\n    const text = selection.toString().trim();\n    if (!text) return null;\n\n    // Find the JSON-UI component containing the selection\n    const anchorNode = selection.anchorNode;\n    const parentElement = anchorNode?.parentElement;\n    const componentWrapper = parentElement?.closest(\n      \"[data-jsonui-element-key]\",\n    ) as HTMLElement | null;\n\n    const elementKey =\n      componentWrapper?.getAttribute(\"data-jsonui-element-key\") ?? undefined;\n    const elementType =\n      componentWrapper?.getAttribute(\"data-jsonui-element-type\") ?? undefined;\n\n    return {\n      text,\n      elementKey,\n      elementType,\n    };\n  }, []);\n\n  const restoreTextSelection = useCallback((range: Range) => {\n    if (typeof window === \"undefined\") return;\n    const selection = window.getSelection();\n    if (!selection) return;\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }, []);\n\n  /**\n   * Clear the native text selection.\n   * Call this after processing the selection (e.g., after sending a message).\n   */\n  const clearTextSelection = useCallback(() => {\n    if (typeof window === \"undefined\") return;\n    window.getSelection()?.removeAllRanges();\n    document.dispatchEvent(new CustomEvent(\"jsonui-text-selection-cleared\"));\n  }, []);\n\n  /**\n   * Check if there's an active text selection.\n   */\n  const hasTextSelection = useCallback((): boolean => {\n    if (typeof window === \"undefined\") return false;\n    const selection = window.getSelection();\n    return !!(\n      selection &&\n      !selection.isCollapsed &&\n      selection.toString().trim()\n    );\n  }, []);\n\n  return {\n    getTextSelection,\n    restoreTextSelection,\n    clearTextSelection,\n    hasTextSelection,\n  };\n}\n","\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\n/**\n * Hook to detect mobile viewport\n */\nexport function useIsMobile(breakpoint = 768) {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const media = window.matchMedia(`(max-width: ${breakpoint}px)`);\n    const update = () => setIsMobile(media.matches);\n    update();\n    media.addEventListener(\"change\", update);\n    return () => media.removeEventListener(\"change\", update);\n  }, [breakpoint]);\n\n  return isMobile;\n}\n","\"use client\";\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Information about a preserved text selection\n */\nexport interface PreservedTextSelection {\n  /** The selected text content */\n  text: string;\n  /** The saved Range object for potential restoration */\n  range: Range | null;\n  /** The JSON-UI element key containing the selection (if within a component) */\n  elementKey?: string;\n  /** The component type (e.g., \"List\", \"Email\", \"Document\") */\n  elementType?: string;\n  /** Timestamp when the selection was preserved */\n  timestamp: number;\n  /** Whether the text was auto-copied to clipboard */\n  copiedToClipboard: boolean;\n}\n\nexport interface UsePreservedSelectionReturn {\n  /** Currently preserved selection (if any) */\n  preserved: PreservedTextSelection | null;\n  /** Preserve the current browser text selection before it's lost */\n  preserve: () => Promise<void>;\n  /** Attempt to restore the preserved selection in the DOM */\n  restore: () => boolean;\n  /** Clear the preserved selection */\n  clear: () => void;\n  /** Copy preserved text to clipboard (returns success status) */\n  copyToClipboard: () => Promise<boolean>;\n  /** Whether there is a preserved selection */\n  hasPreserved: boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to preserve text selection when focus moves to another element.\n *\n * This solves the problem where clicking on an input/textarea clears\n * the user's text selection. The hook:\n * 1. Saves the selection text and Range before it's lost\n * 2. Optionally auto-copies to clipboard for convenience\n * 3. Allows restoring the selection if the DOM structure hasn't changed\n *\n * @example\n * ```tsx\n * function ChatInput() {\n *   const { preserved, preserve, clear } = usePreservedSelection();\n *\n *   const handleFocus = useCallback(() => {\n *     preserve(); // Save any current text selection\n *   }, [preserve]);\n *\n *   return (\n *     <>\n *       <input onFocus={handleFocus} ... />\n *       {preserved && (\n *         <TextSelectionBadge\n *           text={preserved.text}\n *           onClear={clear}\n *         />\n *       )}\n *     </>\n *   );\n * }\n * ```\n */\nexport function usePreservedSelection(): UsePreservedSelectionReturn {\n  const [preserved, setPreserved] = useState<PreservedTextSelection | null>(\n    null,\n  );\n  const rangeRef = useRef<Range | null>(null);\n\n  /**\n   * Preserve the current browser text selection.\n   * Saves both the text and the Range for potential restoration.\n   * Also auto-copies to clipboard for convenience.\n   */\n  const preserve = useCallback(async () => {\n    if (typeof window === \"undefined\") return;\n\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return;\n\n    const text = selection.toString().trim();\n    if (!text) return;\n\n    // Clone the range before it's lost\n    let clonedRange: Range | null = null;\n    try {\n      clonedRange = selection.getRangeAt(0).cloneRange();\n      rangeRef.current = clonedRange;\n    } catch {\n      // Range might not be available in some cases\n      rangeRef.current = null;\n    }\n\n    // Find the containing JSON-UI component\n    const anchorNode = selection.anchorNode;\n    const parentElement = anchorNode?.parentElement;\n    const componentWrapper = parentElement?.closest(\n      \"[data-jsonui-element-key]\",\n    ) as HTMLElement | null;\n\n    const elementKey =\n      componentWrapper?.getAttribute(\"data-jsonui-element-key\") ?? undefined;\n    const elementType =\n      componentWrapper?.getAttribute(\"data-jsonui-element-type\") ?? undefined;\n\n    // Try to copy to clipboard\n    let copiedToClipboard = false;\n    try {\n      await navigator.clipboard.writeText(text);\n      copiedToClipboard = true;\n    } catch {\n      // Clipboard write might fail (permissions, etc.)\n      copiedToClipboard = false;\n    }\n\n    setPreserved({\n      text,\n      range: clonedRange,\n      elementKey,\n      elementType,\n      timestamp: Date.now(),\n      copiedToClipboard,\n    });\n  }, []);\n\n  /**\n   * Attempt to restore the preserved selection in the DOM.\n   * Returns true if successful, false if the Range is no longer valid.\n   */\n  const restore = useCallback((): boolean => {\n    if (typeof window === \"undefined\") return false;\n    if (!rangeRef.current) return false;\n\n    const selection = window.getSelection();\n    if (!selection) return false;\n\n    try {\n      selection.removeAllRanges();\n      selection.addRange(rangeRef.current);\n      return true;\n    } catch {\n      // Range might be invalid if DOM changed\n      return false;\n    }\n  }, []);\n\n  /**\n   * Clear the preserved selection.\n   */\n  const clear = useCallback(() => {\n    setPreserved(null);\n    rangeRef.current = null;\n  }, []);\n\n  /**\n   * Copy the preserved text to clipboard.\n   */\n  const copyToClipboard = useCallback(async (): Promise<boolean> => {\n    if (!preserved?.text) return false;\n\n    try {\n      await navigator.clipboard.writeText(preserved.text);\n      setPreserved((prev) =>\n        prev ? { ...prev, copiedToClipboard: true } : null,\n      );\n      return true;\n    } catch {\n      return false;\n    }\n  }, [preserved]);\n\n  // Auto-clear after 5 minutes to prevent stale data\n  useEffect(() => {\n    if (!preserved) return;\n\n    const timeout = setTimeout(\n      () => {\n        clear();\n      },\n      5 * 60 * 1000,\n    );\n\n    return () => clearTimeout(timeout);\n  }, [preserved, clear]);\n\n  return {\n    preserved,\n    preserve,\n    restore,\n    clear,\n    copyToClipboard,\n    hasPreserved: preserved !== null,\n  };\n}\n","\"use client\";\n\nimport { useCallback, useMemo } from \"react\";\nimport type { UITree, UIElement, ElementLayout } from \"@onegenui/core\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface UseLayoutManagerOptions {\n  /** Current UI tree */\n  tree: UITree | null;\n  /** Callback to update the tree */\n  onTreeUpdate?: (updater: (tree: UITree) => UITree) => void;\n  /** Callback when layout changes (for AI context) */\n  onLayoutChange?: (elementKey: string, layout: ElementLayout) => void;\n}\n\nexport interface UseLayoutManagerReturn {\n  /** Update layout for an element */\n  updateLayout: (elementKey: string, layout: Partial<ElementLayout>) => void;\n  /** Update size for an element */\n  updateSize: (elementKey: string, width: number, height: number) => void;\n  /** Update grid position for an element */\n  updateGridPosition: (\n    elementKey: string,\n    position: {\n      column?: number;\n      row?: number;\n      columnSpan?: number;\n      rowSpan?: number;\n    },\n  ) => void;\n  /** Enable/disable resize for an element */\n  setResizable: (elementKey: string, resizable: boolean) => void;\n  /** Get layout for an element */\n  getLayout: (elementKey: string) => ElementLayout | undefined;\n  /** Get all elements with layout */\n  getLayoutElements: () => Array<{ key: string; layout: ElementLayout }>;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to manage element layouts within a UI tree.\n *\n * Provides functions to update element sizes, grid positions, and resize configs.\n * Changes are persisted back to the tree and optionally notified to the AI.\n *\n * @example\n * ```tsx\n * function Dashboard() {\n *   const { tree, setTree } = useUIStream(...);\n *   const { updateSize, updateGridPosition } = useLayoutManager({\n *     tree,\n *     onTreeUpdate: (updater) => setTree(updater(tree!)),\n *     onLayoutChange: (key, layout) => console.log(`${key} layout changed`, layout),\n *   });\n *\n *   return (\n *     <FreeGridCanvas>\n *       <ResizableWrapper\n *         element={element}\n *         onResize={(key, size) => updateSize(key, size.width, size.height)}\n *       >\n *         <Card>Content</Card>\n *       </ResizableWrapper>\n *     </FreeGridCanvas>\n *   );\n * }\n * ```\n */\nexport function useLayoutManager({\n  tree,\n  onTreeUpdate,\n  onLayoutChange,\n}: UseLayoutManagerOptions): UseLayoutManagerReturn {\n  /**\n   * Update layout for an element\n   */\n  const updateLayout = useCallback(\n    (elementKey: string, layoutUpdate: Partial<ElementLayout>) => {\n      if (!tree || !onTreeUpdate) return;\n\n      onTreeUpdate((currentTree) => {\n        const element = currentTree.elements[elementKey];\n        if (!element) return currentTree;\n\n        const currentLayout = element.layout ?? {};\n        const newLayout: ElementLayout = {\n          ...currentLayout,\n          ...layoutUpdate,\n          // Deep merge size and grid\n          size: layoutUpdate.size\n            ? { ...currentLayout.size, ...layoutUpdate.size }\n            : currentLayout.size,\n          grid: layoutUpdate.grid\n            ? { ...currentLayout.grid, ...layoutUpdate.grid }\n            : currentLayout.grid,\n        };\n\n        const updatedElement: UIElement = {\n          ...element,\n          layout: newLayout,\n        };\n\n        onLayoutChange?.(elementKey, newLayout);\n\n        return {\n          ...currentTree,\n          elements: {\n            ...currentTree.elements,\n            [elementKey]: updatedElement,\n          },\n        };\n      });\n    },\n    [tree, onTreeUpdate, onLayoutChange],\n  );\n\n  /**\n   * Update size for an element\n   */\n  const updateSize = useCallback(\n    (elementKey: string, width: number, height: number) => {\n      updateLayout(elementKey, {\n        size: { width, height },\n      });\n    },\n    [updateLayout],\n  );\n\n  /**\n   * Update grid position for an element\n   */\n  const updateGridPosition = useCallback(\n    (\n      elementKey: string,\n      position: {\n        column?: number;\n        row?: number;\n        columnSpan?: number;\n        rowSpan?: number;\n      },\n    ) => {\n      updateLayout(elementKey, {\n        grid: position,\n      });\n    },\n    [updateLayout],\n  );\n\n  /**\n   * Enable/disable resize for an element\n   */\n  const setResizable = useCallback(\n    (elementKey: string, resizable: boolean) => {\n      updateLayout(elementKey, { resizable });\n    },\n    [updateLayout],\n  );\n\n  /**\n   * Get layout for an element\n   */\n  const getLayout = useCallback(\n    (elementKey: string): ElementLayout | undefined => {\n      if (!tree) return undefined;\n      return tree.elements[elementKey]?.layout;\n    },\n    [tree],\n  );\n\n  /**\n   * Get all elements with layout\n   */\n  const getLayoutElements = useMemo(() => {\n    return (): Array<{ key: string; layout: ElementLayout }> => {\n      if (!tree) return [];\n\n      return Object.entries(tree.elements)\n        .filter(([, element]) => element.layout !== undefined)\n        .map(([key, element]) => ({\n          key,\n          layout: element.layout!,\n        }));\n    };\n  }, [tree]);\n\n  return {\n    updateLayout,\n    updateSize,\n    updateGridPosition,\n    setResizable,\n    getLayout,\n    getLayoutElements,\n  };\n}\n","\"use client\";\n\nimport { useState, useCallback } from \"react\";\nimport type { UITree } from \"@onegenui/core\";\nimport type { ConversationTurn } from \"./types\";\n\n/**\n * State snapshot for history\n */\nexport interface HistorySnapshot {\n  tree: UITree | null;\n  conversation: ConversationTurn[];\n}\n\n/**\n * Return type for useHistory hook\n */\nexport interface UseHistoryReturn {\n  history: HistorySnapshot[];\n  historyIndex: number;\n  pushHistory: () => void;\n  undo: () => HistorySnapshot | null;\n  redo: () => HistorySnapshot | null;\n  canUndo: boolean;\n  canRedo: boolean;\n  clearHistory: () => void;\n}\n\n/**\n * Hook for managing undo/redo history\n * Follows Single Responsibility Principle - only manages history state\n */\nexport function useHistory(\n  getCurrentState: () => {\n    tree: UITree | null;\n    conversation: ConversationTurn[];\n  },\n): UseHistoryReturn {\n  const [history, setHistory] = useState<HistorySnapshot[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  const pushHistory = useCallback(() => {\n    const { tree, conversation } = getCurrentState();\n    const snapshot: HistorySnapshot = {\n      tree: tree ? JSON.parse(JSON.stringify(tree)) : null,\n      conversation: JSON.parse(JSON.stringify(conversation)),\n    };\n    setHistory((prev) => {\n      // Truncate any redo history\n      const newHistory = prev.slice(0, historyIndex + 1);\n      return [...newHistory, snapshot];\n    });\n    setHistoryIndex((prev) => prev + 1);\n  }, [getCurrentState, historyIndex]);\n\n  const undo = useCallback((): HistorySnapshot | null => {\n    if (historyIndex < 0) return null;\n    const snapshot = history[historyIndex];\n    if (snapshot) {\n      setHistoryIndex((prev) => prev - 1);\n      return snapshot;\n    }\n    return null;\n  }, [history, historyIndex]);\n\n  const redo = useCallback((): HistorySnapshot | null => {\n    if (historyIndex >= history.length - 1) return null;\n    const nextIndex = historyIndex + 1;\n    const snapshot = history[nextIndex];\n    if (snapshot) {\n      setHistoryIndex(nextIndex);\n      return snapshot;\n    }\n    return null;\n  }, [history, historyIndex]);\n\n  const clearHistory = useCallback(() => {\n    setHistory([]);\n    setHistoryIndex(-1);\n  }, []);\n\n  const canUndo = historyIndex >= 0;\n  const canRedo = historyIndex < history.length - 1;\n\n  return {\n    history,\n    historyIndex,\n    pushHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    clearHistory,\n  };\n}\n","\"use client\";\n\nimport { useCallback, useRef } from \"react\";\nimport { useStore } from \"../store\";\nimport type { DeepResearchEffortLevel } from \"../store/slices/deep-research\";\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface DeepResearchCallbacks {\n  onProgress?: (progress: number, phase: string) => void;\n  onSourceFound?: (source: {\n    url: string;\n    title: string;\n    domain: string;\n  }) => void;\n  onComplete?: (result: DeepResearchResult) => void;\n  onError?: (error: Error) => void;\n}\n\nexport interface DeepResearchResult {\n  qualityScore: number;\n  sourcesUsed: number;\n  report?: unknown;\n}\n\nexport interface DeepResearchPhase {\n  id: string;\n  label: string;\n  weight: number;\n}\n\n// =============================================================================\n// Configuration (aligned with @onegenui/deep-research)\n// =============================================================================\n\nconst EFFORT_DISPLAY: Record<DeepResearchEffortLevel, string> = {\n  standard: \"~3 min\",\n  deep: \"~10 min\",\n  max: \"~30 min\",\n};\n\nconst RESEARCH_PHASES: DeepResearchPhase[] = [\n  { id: \"query-decomposition\", label: \"Query Decomposition\", weight: 5 },\n  { id: \"source-discovery\", label: \"Source Discovery\", weight: 25 },\n  { id: \"content-extraction\", label: \"Content Extraction\", weight: 30 },\n  { id: \"analysis\", label: \"Analysis\", weight: 20 },\n  { id: \"synthesis\", label: \"Synthesis\", weight: 15 },\n  { id: \"visualization\", label: \"Visualization\", weight: 5 },\n];\n\n// =============================================================================\n// Event Handler for Streaming API\n// =============================================================================\n\nexport interface DeepResearchEvent {\n  type:\n    | \"phase-start\"\n    | \"phase-progress\"\n    | \"phase-complete\"\n    | \"source-found\"\n    | \"complete\"\n    | \"error\";\n  phaseId?: string;\n  progress?: number;\n  message?: string;\n  source?: { url: string; title: string; domain: string };\n  result?: DeepResearchResult;\n  error?: string;\n}\n\n/**\n * Hook for executing deep research from React components\n *\n * Integrates with:\n * - DeepResearchSlice for research-specific state\n * - ToolProgressSlice for unified progress display\n *\n * Designed to work with streaming API responses via handleEvent()\n */\nexport function useDeepResearch(callbacks: DeepResearchCallbacks = {}) {\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const toolCallIdRef = useRef<string>(\"\");\n  const callbacksRef = useRef(callbacks);\n  callbacksRef.current = callbacks;\n\n  // Deep Research store actions\n  const startResearchAction = useStore((s) => s.startResearch);\n  const updateResearchProgress = useStore((s) => s.updateResearchProgress);\n  const updateResearchPhase = useStore((s) => s.updateResearchPhase);\n  const addResearchSource = useStore((s) => s.addResearchSource);\n  const completeResearch = useStore((s) => s.completeResearch);\n  const failResearch = useStore((s) => s.failResearch);\n  const stopResearchAction = useStore((s) => s.stopResearch);\n  const clearActiveResearch = useStore((s) => s.clearActiveResearch);\n\n  // Tool Progress store actions\n  const addProgress = useStore((s) => s.addProgress);\n  const updateProgress = useStore((s) => s.updateProgress);\n  const removeProgress = useStore((s) => s.removeProgress);\n\n  // Settings & state\n  const settings = useStore((s) => s.deepResearchSettings);\n  const activeResearch = useStore((s) => s.activeResearch);\n\n  /**\n   * Handle streaming events from the deep research API\n   */\n  const handleEvent = useCallback(\n    (event: DeepResearchEvent) => {\n      const toolCallId = toolCallIdRef.current;\n      if (!toolCallId) return;\n\n      switch (event.type) {\n        case \"phase-start\": {\n          if (event.phaseId) {\n            const phase = RESEARCH_PHASES.find((p) => p.id === event.phaseId);\n            if (phase) {\n              updateResearchProgress({ currentPhase: phase.label });\n              updateResearchPhase(event.phaseId, {\n                status: \"running\",\n                progress: 0,\n                startTime: Date.now(),\n              });\n              updateProgress(toolCallId, {\n                status: \"progress\",\n                message: phase.label,\n                progress: event.progress ?? 0,\n              });\n            }\n          }\n          break;\n        }\n\n        case \"phase-progress\": {\n          if (event.phaseId && event.progress !== undefined) {\n            updateResearchPhase(event.phaseId, { progress: event.progress });\n            updateResearchProgress({ progress: event.progress });\n            updateProgress(toolCallId, {\n              status: \"progress\",\n              progress: event.progress,\n              message: event.message,\n            });\n            callbacksRef.current.onProgress?.(\n              event.progress,\n              event.message ?? \"\",\n            );\n          }\n          break;\n        }\n\n        case \"phase-complete\": {\n          if (event.phaseId) {\n            updateResearchPhase(event.phaseId, {\n              status: \"complete\",\n              progress: 100,\n              endTime: Date.now(),\n            });\n          }\n          break;\n        }\n\n        case \"source-found\": {\n          if (event.source) {\n            addResearchSource({\n              id: `src-${Date.now()}`,\n              url: event.source.url,\n              title: event.source.title,\n              domain: event.source.domain,\n              credibility: 0.5,\n              status: \"fetching\",\n            });\n            callbacksRef.current.onSourceFound?.(event.source);\n          }\n          break;\n        }\n\n        case \"complete\": {\n          const result = event.result ?? { qualityScore: 0.8, sourcesUsed: 0 };\n          completeResearch(result.qualityScore);\n          updateProgress(toolCallId, {\n            status: \"complete\",\n            message: \"Research complete\",\n            progress: 100,\n            data: result,\n          });\n          callbacksRef.current.onComplete?.(result);\n\n          // Auto-remove from tool progress after delay\n          setTimeout(() => removeProgress(toolCallId), 5000);\n          break;\n        }\n\n        case \"error\": {\n          const errorMessage = event.error ?? \"Research failed\";\n          failResearch(errorMessage);\n          updateProgress(toolCallId, {\n            status: \"error\",\n            message: errorMessage,\n          });\n          callbacksRef.current.onError?.(new Error(errorMessage));\n          break;\n        }\n      }\n    },\n    [\n      updateResearchProgress,\n      updateResearchPhase,\n      addResearchSource,\n      completeResearch,\n      failResearch,\n      updateProgress,\n      removeProgress,\n    ],\n  );\n\n  /**\n   * Start deep research on a query\n   *\n   * Returns an abort function to cancel the research\n   */\n  const startResearch = useCallback(\n    (\n      query: string,\n      effortOverride?: DeepResearchEffortLevel,\n    ): { abort: () => void; toolCallId: string } => {\n      if (!settings.enabled) {\n        console.warn(\"Deep Research is not enabled\");\n        return { abort: () => {}, toolCallId: \"\" };\n      }\n\n      // Abort any existing research\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n\n      abortControllerRef.current = new AbortController();\n      const effort = effortOverride ?? settings.effortLevel;\n      const toolCallId = `deep-research-${Date.now()}`;\n      toolCallIdRef.current = toolCallId;\n\n      // Initialize deep research state\n      startResearchAction(query);\n\n      // Add to tool progress for unified display\n      addProgress({\n        toolCallId,\n        toolName: \"deep-research\",\n        status: \"starting\",\n        message: `Starting ${effort} research...`,\n        data: {\n          query,\n          effort,\n          estimatedTime: EFFORT_DISPLAY[effort],\n        },\n      });\n\n      return {\n        abort: () => abortControllerRef.current?.abort(),\n        toolCallId,\n      };\n    },\n    [settings, startResearchAction, addProgress],\n  );\n\n  /**\n   * Stop ongoing research\n   */\n  const stopResearch = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    stopResearchAction();\n\n    const toolCallId = toolCallIdRef.current;\n    if (toolCallId) {\n      updateProgress(toolCallId, {\n        status: \"complete\",\n        message: \"Research stopped\",\n      });\n      setTimeout(() => removeProgress(toolCallId), 2000);\n    }\n  }, [stopResearchAction, updateProgress, removeProgress]);\n\n  /**\n   * Clear research state\n   */\n  const clearResearch = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    clearActiveResearch();\n\n    const toolCallId = toolCallIdRef.current;\n    if (toolCallId) {\n      removeProgress(toolCallId);\n    }\n  }, [clearActiveResearch, removeProgress]);\n\n  /**\n   * Get abort signal for API requests\n   */\n  const getAbortSignal = useCallback(() => {\n    return abortControllerRef.current?.signal;\n  }, []);\n\n  const isResearching =\n    activeResearch?.status === \"initializing\" ||\n    activeResearch?.status === \"searching\" ||\n    activeResearch?.status === \"analyzing\" ||\n    activeResearch?.status === \"synthesizing\";\n\n  return {\n    // State\n    isResearching,\n    progress: activeResearch?.progress ?? 0,\n    currentPhase: activeResearch?.currentPhase ?? \"\",\n    sourcesFound: activeResearch?.sources.length ?? 0,\n    error: activeResearch?.error ?? null,\n    activeResearch,\n\n    // Actions\n    startResearch,\n    stopResearch,\n    clearResearch,\n    handleEvent,\n    getAbortSignal,\n\n    // Settings\n    isEnabled: settings.enabled,\n    effortLevel: settings.effortLevel,\n\n    // Constants\n    phases: RESEARCH_PHASES,\n  };\n}\n","/**\n * useRenderEditableText hook\n *\n * Provides a render function for editable text props.\n * When edit mode is active, returns an editable span.\n * When not in edit mode, returns the text as-is.\n */\n\n\"use client\";\n\nimport React, { useCallback, type ReactNode } from \"react\";\nimport type { UIElement } from \"@onegenui/core\";\nimport { useEditMode } from \"../contexts/edit-mode\";\nimport { useIsMobile } from \"../hooks/useIsMobile\";\nimport { EditableText } from \"../components/EditableText\";\n\nexport interface RenderEditableTextOptions {\n  className?: string;\n  as?: \"span\" | \"div\" | \"p\" | \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"h5\" | \"h6\";\n  multiline?: boolean;\n  placeholder?: string;\n}\n\nexport type RenderEditableTextFn = (\n  propName: string,\n  value: string | null | undefined,\n  options?: RenderEditableTextOptions,\n) => ReactNode;\n\n/**\n * Hook that creates a renderEditableText function for a specific element.\n *\n * @param element - The UIElement to create the render function for\n * @returns A function to render editable text\n */\nexport function useRenderEditableText(\n  element: UIElement,\n): RenderEditableTextFn {\n  const { isEditing } = useEditMode();\n  const isMobile = useIsMobile();\n\n  // Determine if this element can be edited\n  const canEdit =\n    isEditing && element.editable !== false && !element.locked;\n\n  const renderEditableText = useCallback(\n    (\n      propName: string,\n      value: string | null | undefined,\n      options?: RenderEditableTextOptions,\n    ): ReactNode => {\n      // If no value, return null or placeholder\n      if (value === null || value === undefined || value === \"\") {\n        if (canEdit && options?.placeholder) {\n          // Return editable placeholder in edit mode\n          return (\n            <EditableText\n              elementKey={element.key}\n              propName={propName}\n              value=\"\"\n              placeholder={options.placeholder}\n              as={options?.as}\n              multiline={options?.multiline}\n              className={options?.className}\n            />\n          );\n        }\n        return null;\n      }\n\n      // If not in edit mode, return plain text\n      if (!canEdit) {\n        const Tag = options?.as || \"span\";\n        return (\n          <Tag className={options?.className}>{value}</Tag>\n        );\n      }\n\n      // In edit mode, return editable text\n      return (\n        <EditableText\n          elementKey={element.key}\n          propName={propName}\n          value={value}\n          placeholder={options?.placeholder}\n          as={options?.as}\n          multiline={options?.multiline}\n          className={options?.className}\n        />\n      );\n    },\n    [canEdit, element.key],\n  );\n\n  return renderEditableText;\n}\n\n/**\n * Creates a renderEditableText function without hooks (for use in renderer)\n *\n * @param element - The UIElement\n * @param isEditing - Whether edit mode is active\n * @returns A function to render editable text\n */\nexport function createRenderEditableText(\n  element: UIElement,\n  isEditing: boolean,\n): RenderEditableTextFn {\n  const canEdit =\n    isEditing && element.editable !== false && !element.locked;\n\n  return (\n    propName: string,\n    value: string | null | undefined,\n    options?: RenderEditableTextOptions,\n  ): ReactNode => {\n    if (value === null || value === undefined || value === \"\") {\n      if (canEdit && options?.placeholder) {\n        return React.createElement(EditableText, {\n          elementKey: element.key,\n          propName,\n          value: \"\",\n          placeholder: options.placeholder,\n          as: options.as,\n          multiline: options.multiline,\n          className: options.className,\n        });\n      }\n      return null;\n    }\n\n    if (!canEdit) {\n      const Tag = options?.as || \"span\";\n      return React.createElement(Tag, { className: options?.className }, value);\n    }\n\n    return React.createElement(EditableText, {\n      elementKey: element.key,\n      propName,\n      value,\n      placeholder: options?.placeholder,\n      as: options?.as,\n      multiline: options?.multiline,\n      className: options?.className,\n    });\n  };\n}\n","/**\n * EditableText Component\n *\n * A wrapper that makes text content editable when edit mode is active.\n * Uses contentEditable for inline editing.\n */\n\n\"use client\";\n\nimport React, {\n  useRef,\n  useCallback,\n  useEffect,\n  useState,\n  memo,\n  type KeyboardEvent,\n  type FocusEvent,\n} from \"react\";\nimport { useElementEdit } from \"../contexts/edit-mode\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface EditableTextProps {\n  /** The element key for tracking changes */\n  elementKey: string;\n  /** The prop name being edited */\n  propName: string;\n  /** Current text value */\n  value: string;\n  /** Custom class name */\n  className?: string;\n  /** Tag to render (default: span) */\n  as?: \"span\" | \"div\" | \"p\" | \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"h5\" | \"h6\";\n  /** Placeholder when empty */\n  placeholder?: string;\n  /** Disable editing for this specific text */\n  disabled?: boolean;\n  /** Allow multiline editing (uses div instead of span) */\n  multiline?: boolean;\n  /** Optional style override */\n  style?: React.CSSProperties;\n  /** Callback when value changes */\n  onValueChange?: (newValue: string) => void;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Component\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const EditableText = memo(function EditableText({\n  elementKey,\n  propName,\n  value,\n  className = \"\",\n  as: Tag = \"span\",\n  placeholder = \"Click to edit...\",\n  disabled = false,\n  multiline = false,\n  style,\n  onValueChange,\n}: EditableTextProps) {\n  const ref = useRef<HTMLElement>(null);\n  const [localValue, setLocalValue] = useState(value);\n  const { isEditing, isFocused, handleChange, handleFocus } =\n    useElementEdit(elementKey);\n\n  // Sync local value with prop\n  useEffect(() => {\n    setLocalValue(value);\n    if (ref.current && !isFocused) {\n      ref.current.textContent = value || \"\";\n    }\n  }, [value, isFocused]);\n\n  const handleInput = useCallback(() => {\n    if (ref.current) {\n      const newValue = ref.current.textContent || \"\";\n      setLocalValue(newValue);\n      handleChange(propName, newValue);\n      onValueChange?.(newValue);\n    }\n  }, [handleChange, propName, onValueChange]);\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent<HTMLElement>) => {\n      // Prevent enter from creating new lines in single-line mode\n      if (!multiline && e.key === \"Enter\") {\n        e.preventDefault();\n        ref.current?.blur();\n      }\n      // Allow escape to cancel editing\n      if (e.key === \"Escape\") {\n        if (ref.current) {\n          ref.current.textContent = value;\n          setLocalValue(value);\n        }\n        ref.current?.blur();\n      }\n    },\n    [multiline, value],\n  );\n\n  const handleBlur = useCallback(\n    (e: FocusEvent<HTMLElement>) => {\n      // Ensure final value is recorded\n      if (ref.current) {\n        const finalValue = ref.current.textContent || \"\";\n        if (finalValue !== value) {\n          handleChange(propName, finalValue);\n          onValueChange?.(finalValue);\n        }\n      }\n    },\n    [handleChange, propName, value, onValueChange],\n  );\n\n  const handleFocusEvent = useCallback(() => {\n    handleFocus();\n    // Select all text on focus for easier editing\n    if (ref.current && document.activeElement === ref.current) {\n      const selection = window.getSelection();\n      const range = document.createRange();\n      range.selectNodeContents(ref.current);\n      selection?.removeAllRanges();\n      selection?.addRange(range);\n    }\n  }, [handleFocus]);\n\n  const canEdit = isEditing && !disabled;\n  const isEmpty = !localValue || localValue.trim() === \"\";\n\n  // Determine the tag to use\n  const ActualTag = multiline ? \"div\" : Tag;\n\n  return (\n    <ActualTag\n      ref={ref as React.RefObject<HTMLDivElement & HTMLSpanElement>}\n      className={`editable-text ${className} ${canEdit ? \"editable-text--active\" : \"\"} ${isFocused ? \"editable-text--focused\" : \"\"} ${isEmpty ? \"editable-text--empty\" : \"\"}`}\n      contentEditable={canEdit}\n      suppressContentEditableWarning\n      onInput={handleInput}\n      onKeyDown={handleKeyDown}\n      onFocus={handleFocusEvent}\n      onBlur={handleBlur}\n      data-placeholder={placeholder}\n      data-element-key={elementKey}\n      data-prop-name={propName}\n      style={{\n        ...style,\n        outline: canEdit ? undefined : \"none\",\n        cursor: canEdit ? \"text\" : \"inherit\",\n        minWidth: canEdit ? \"1ch\" : undefined,\n      }}\n    >\n      {localValue || (canEdit ? \"\" : value)}\n    </ActualTag>\n  );\n});\n\n// ─────────────────────────────────────────────────────────────────────────────\n// CSS (to be included in styles)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const editableTextStyles = `\n.editable-text {\n  position: relative;\n  transition: background-color 0.15s, box-shadow 0.15s;\n}\n\n.editable-text--active {\n  cursor: text;\n}\n\n.editable-text--active:hover {\n  background-color: rgba(14, 165, 233, 0.05);\n  border-radius: 4px;\n}\n\n.editable-text--focused {\n  background-color: rgba(14, 165, 233, 0.1);\n  border-radius: 4px;\n  box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.3);\n  outline: none;\n}\n\n.editable-text--empty::before {\n  content: attr(data-placeholder);\n  color: #9ca3af;\n  font-style: italic;\n  pointer-events: none;\n}\n`;\n","import type { UITree, UIElement } from \"@onegenui/core\";\nimport type { FlatElement } from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// flatToTree\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Convert a flat element list to a UITree\n */\nexport function flatToTree(elements: FlatElement[]): UITree {\n  const elementMap: Record<string, UIElement> = {};\n  let root = \"\";\n\n  // First pass: add all elements to map\n  for (const element of elements) {\n    elementMap[element.key] = {\n      key: element.key,\n      type: element.type,\n      props: element.props,\n      children: [],\n      visible: element.visible,\n      parentKey: element.parentKey,\n    };\n  }\n\n  // Second pass: build parent-child relationships\n  for (const element of elements) {\n    if (element.parentKey) {\n      const parent = elementMap[element.parentKey];\n      if (parent) {\n        if (!parent.children) {\n          parent.children = [];\n        }\n        parent.children.push(element.key);\n      }\n    } else {\n      root = element.key;\n    }\n  }\n\n  return { root, elements: elementMap };\n}\n","\"use client\";\n\nimport type { ReactNode } from \"react\";\nimport { DataProvider } from \"../contexts/data\";\nimport { VisibilityProvider } from \"../contexts/visibility\";\nimport { ActionProvider, useActions, ConfirmDialog } from \"../contexts/actions\";\nimport { ValidationProvider } from \"../contexts/validation\";\nimport { MarkdownProvider } from \"../contexts/markdown\";\nimport type { JSONUIProviderProps } from \"./types\";\n\n/**\n * Renders the confirmation dialog when needed\n */\nfunction ConfirmationDialogManager() {\n  const { pendingConfirmation, confirm, cancel } = useActions();\n\n  if (!pendingConfirmation?.action.confirm) {\n    return null;\n  }\n\n  return (\n    <ConfirmDialog\n      confirm={pendingConfirmation.action.confirm}\n      onConfirm={confirm}\n      onCancel={cancel}\n    />\n  );\n}\n\n/**\n * Combined provider for all JSONUI contexts\n */\nexport function JSONUIProvider({\n  registry,\n  initialData,\n  authState,\n  actionHandlers,\n  navigate,\n  validationFunctions,\n  onDataChange,\n  children,\n}: JSONUIProviderProps) {\n  return (\n    <MarkdownProvider>\n      <DataProvider\n        initialData={initialData}\n        authState={authState}\n        onDataChange={onDataChange}\n      >\n        <VisibilityProvider>\n          <ActionProvider handlers={actionHandlers} navigate={navigate}>\n            <ValidationProvider customFunctions={validationFunctions}>\n              {children}\n              <ConfirmationDialogManager />\n            </ValidationProvider>\n          </ActionProvider>\n        </VisibilityProvider>\n      </DataProvider>\n    </MarkdownProvider>\n  );\n}\n","\"use client\";\n\nimport type { ComponentType, ReactNode } from \"react\";\nimport type { Catalog, ComponentDefinition } from \"@onegenui/core\";\nimport { InteractionTrackingWrapper } from \"./components/InteractionTrackingWrapper\";\nimport { ErrorBoundary } from \"./components/ErrorBoundary\";\nimport { DEFAULT_SELECTION_DELAY } from \"./utils/selection\";\nimport type {\n  ComponentRenderProps,\n  ComponentRenderer,\n  ComponentRegistry,\n  RendererProps,\n  JSONUIProviderProps,\n} from \"./renderer/types\";\nimport { ElementRenderer } from \"./renderer/element-renderer\";\nimport { JSONUIProvider } from \"./renderer/provider\";\n\n// Re-export types for convenience\nexport type {\n  ComponentRenderProps,\n  ComponentRenderer,\n  ComponentRegistry,\n  RendererProps,\n  JSONUIProviderProps,\n};\nexport { JSONUIProvider };\n\n/**\n * Default renderer error fallback\n */\nfunction RendererErrorFallback(error: Error, reset: () => void): ReactNode {\n  return (\n    <div\n      role=\"alert\"\n      className=\"p-4 rounded-lg bg-destructive/10 border border-destructive/20 text-destructive\"\n    >\n      <h3 className=\"font-semibold mb-2\">Render Error</h3>\n      <p className=\"text-sm text-muted-foreground mb-3\">{error.message}</p>\n      <button\n        onClick={reset}\n        className=\"px-3 py-1.5 text-sm rounded bg-destructive/20 hover:bg-destructive/30 transition-colors\"\n      >\n        Retry\n      </button>\n    </div>\n  );\n}\n\n/**\n * Main renderer component with error boundary\n */\nexport function Renderer({\n  tree,\n  registry,\n  loading,\n  fallback,\n  selectable = false,\n  onElementSelect,\n  selectionDelayMs = DEFAULT_SELECTION_DELAY,\n  selectedKey,\n  trackInteractions = false,\n  onInteraction,\n  onResize,\n  autoGrid = true,\n  onError,\n}: RendererProps & { onError?: (error: Error) => void }) {\n  if (!tree || !tree.root) return null;\n\n  const rootElement = tree.elements[tree.root];\n  if (!rootElement) return null;\n\n  const content = (\n    <ErrorBoundary\n      name=\"ElementRenderer\"\n      fallback={RendererErrorFallback}\n      onError={(error) => onError?.(error)}\n    >\n      <ElementRenderer\n        element={rootElement}\n        tree={tree}\n        registry={registry}\n        loading={loading}\n        fallback={fallback}\n        selectable={selectable}\n        onElementSelect={onElementSelect}\n        selectionDelayMs={selectionDelayMs}\n        selectedKey={selectedKey}\n        onResize={onResize}\n      />\n    </ErrorBoundary>\n  );\n\n  const gridContent = autoGrid ? (\n    <div\n      style={{\n        display: \"grid\",\n        gridTemplateColumns: \"repeat(auto-fit, minmax(min(400px, 100%), 1fr))\",\n        gap: 24,\n        width: \"100%\",\n        alignItems: \"stretch\",\n      }}\n      data-renderer-auto-grid\n    >\n      {content}\n    </div>\n  ) : (\n    content\n  );\n\n  if (trackInteractions && onInteraction) {\n    return (\n      <InteractionTrackingWrapper tree={tree} onInteraction={onInteraction}>\n        {gridContent}\n      </InteractionTrackingWrapper>\n    );\n  }\n\n  return gridContent;\n}\n\n/**\n * Helper to create a renderer component from a catalog\n */\nexport function createRendererFromCatalog<\n  C extends Catalog<Record<string, ComponentDefinition>>,\n>(\n  _catalog: C,\n  registry: ComponentRegistry,\n): ComponentType<Omit<RendererProps, \"registry\">> {\n  return function CatalogRenderer(props: Omit<RendererProps, \"registry\">) {\n    return <Renderer {...props} registry={registry} />;\n  };\n}\n","/**\n * Element props equality comparator for memoization\n */\n\nimport type { ElementRendererProps } from \"./types\";\n\n/**\n * Memoization comparator: structural sharing in patch-utils.ts means only\n * modified elements get new references. This enables O(1) equality checks\n * instead of deep comparison.\n */\nexport function elementRendererPropsAreEqual(\n  prevProps: ElementRendererProps,\n  nextProps: ElementRendererProps,\n): boolean {\n  // Element reference check (structural sharing)\n  if (prevProps.element !== nextProps.element) {\n    return false;\n  }\n\n  // Selection state change\n  const wasSelected = prevProps.selectedKey === prevProps.element.key;\n  const isSelected = nextProps.selectedKey === nextProps.element.key;\n  if (wasSelected !== isSelected) {\n    return false;\n  }\n\n  // Loading state change\n  if (prevProps.loading !== nextProps.loading) {\n    return false;\n  }\n\n  // Tree change - check if children have changed\n  if (prevProps.tree !== nextProps.tree) {\n    const children = prevProps.element.children;\n    if (children) {\n      for (const childKey of children) {\n        if (\n          prevProps.tree.elements[childKey] !==\n          nextProps.tree.elements[childKey]\n        ) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n","/**\n * Skeleton Loader Components\n *\n * Loading states for placeholder and missing elements during streaming.\n */\n\nimport type { ReactNode } from \"react\";\n\n/**\n * Props for skeleton loader components\n */\nexport interface SkeletonProps {\n  /** Element key for data attribute */\n  elementKey: string;\n  /** Optional custom class name */\n  className?: string;\n}\n\n/**\n * Placeholder skeleton for forward-referenced elements\n */\nexport function PlaceholderSkeleton({ elementKey }: SkeletonProps): ReactNode {\n  return (\n    <div\n      key={elementKey}\n      className=\"w-full h-16 bg-muted/10 animate-pulse rounded-lg my-2 border border-border/20\"\n      data-placeholder-for={elementKey}\n    />\n  );\n}\n\n/**\n * Child skeleton for missing children during streaming\n */\nexport function ChildSkeleton({ elementKey }: SkeletonProps): ReactNode {\n  return (\n    <div\n      key={`${elementKey}-skeleton`}\n      className=\"w-full h-12 bg-muted/10 animate-pulse rounded-md my-1\"\n    />\n  );\n}\n\n/**\n * Check if an element is a placeholder\n */\nexport function isPlaceholderElement(element: {\n  type: string;\n  _meta?: { isPlaceholder?: boolean };\n}): boolean {\n  return (\n    element.type === \"__placeholder__\" || element._meta?.isPlaceholder === true\n  );\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  type ReactNode,\n  type CSSProperties,\n} from \"react\";\nimport { cn } from \"./utils\";\n\n/**\n * EditableContext state management for inline editing\n */\ninterface EditableContextValue {\n  /** Currently editing path (e.g., \"elements/card-1/props/title\") */\n  editingPath: string | null;\n  /** Current value being edited */\n  editingValue: unknown;\n  /** Start editing a field */\n  startEdit: (path: string, currentValue: unknown) => void;\n  /** Commit the edit with new value */\n  commitEdit: (path: string, newValue: unknown) => void;\n  /** Cancel editing */\n  cancelEdit: () => void;\n  /** Callback when a value is changed */\n  onValueChange?: (path: string, newValue: unknown) => void;\n}\n\nconst EditableContext = createContext<EditableContextValue | null>(null);\n\n/**\n * Provider for editable content management\n */\nexport function EditableProvider({\n  children,\n  onValueChange,\n}: {\n  children: ReactNode;\n  onValueChange?: (path: string, newValue: unknown) => void;\n}) {\n  const [editingPath, setEditingPath] = useState<string | null>(null);\n  const [editingValue, setEditingValue] = useState<unknown>(null);\n\n  const startEdit = useCallback((path: string, currentValue: unknown) => {\n    setEditingPath(path);\n    setEditingValue(currentValue);\n  }, []);\n\n  const commitEdit = useCallback(\n    (path: string, newValue: unknown) => {\n      onValueChange?.(path, newValue);\n      setEditingPath(null);\n      setEditingValue(null);\n    },\n    [onValueChange],\n  );\n\n  const cancelEdit = useCallback(() => {\n    setEditingPath(null);\n    setEditingValue(null);\n  }, []);\n\n  return (\n    <EditableContext.Provider\n      value={{\n        editingPath,\n        editingValue,\n        startEdit,\n        commitEdit,\n        cancelEdit,\n        onValueChange,\n      }}\n    >\n      {children}\n    </EditableContext.Provider>\n  );\n}\n\n/**\n * Hook to access editable context\n */\nexport function useEditableContext() {\n  return useContext(EditableContext);\n}\n\n/**\n * Props returned by useEditable hook\n */\nexport interface EditableProps {\n  /** Whether this field is currently being edited */\n  isEditing: boolean;\n  /** Current value (editing value if editing, otherwise original) */\n  value: unknown;\n  /** Trigger edit mode */\n  onStartEdit: () => void;\n  /** Commit the current edit */\n  onCommit: (newValue: unknown) => void;\n  /** Cancel the current edit */\n  onCancel: () => void;\n  /** Style hint for editable elements */\n  editableClassName: string;\n}\n\n/**\n * Hook for making content editable\n *\n * @param path - Unique path to this editable value (e.g., \"elements/card-1/props/title\")\n * @param currentValue - Current value to display\n * @param locked - If true, editing is disabled\n * @returns Props and handlers for editable content\n */\nexport function useEditable(\n  path: string,\n  currentValue: unknown,\n  locked = false,\n): EditableProps {\n  const ctx = useEditableContext();\n\n  const isEditing = ctx?.editingPath === path;\n  const value = isEditing ? ctx?.editingValue : currentValue;\n\n  const onStartEdit = useCallback(() => {\n    if (locked || !ctx) return;\n    ctx.startEdit(path, currentValue);\n  }, [ctx, path, currentValue, locked]);\n\n  const onCommit = useCallback(\n    (newValue: unknown) => {\n      if (!ctx) return;\n      ctx.commitEdit(path, newValue);\n    },\n    [ctx, path],\n  );\n\n  const onCancel = useCallback(() => {\n    ctx?.cancelEdit();\n  }, [ctx]);\n\n  const editableClassName = locked\n    ? \"\"\n    : \"cursor-text rounded transition-[background-color,box-shadow] duration-150 hover:bg-black/5\";\n\n  return {\n    isEditing,\n    value,\n    onStartEdit,\n    onCommit,\n    onCancel,\n    editableClassName,\n  };\n}\n\n/**\n * Generic editable text component\n */\nexport function EditableText({\n  path,\n  value,\n  locked = false,\n  as: Component = \"span\",\n  className,\n}: {\n  path: string;\n  value: string;\n  locked?: boolean;\n  as?: \"span\" | \"p\" | \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"div\";\n  className?: string;\n}) {\n  const { isEditing, onStartEdit, onCommit, onCancel, editableClassName } =\n    useEditable(path, value, locked);\n  const [localValue, setLocalValue] = useState(value);\n\n  // Sync local value when not editing\n  React.useEffect(() => {\n    if (!isEditing) {\n      setLocalValue(value);\n    }\n  }, [value, isEditing]);\n\n  if (isEditing) {\n    return (\n      <input\n        type=\"text\"\n        value={localValue}\n        onChange={(e) => setLocalValue(e.target.value)}\n        onBlur={() => onCommit(localValue)}\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\") {\n            e.preventDefault();\n            onCommit(localValue);\n          }\n          if (e.key === \"Escape\") {\n            onCancel();\n          }\n        }}\n        autoFocus\n        className={cn(\n          \"w-full box-border -m-0.5 rounded px-1.5 py-0.5 font-inherit text-inherit outline-none\",\n          \"bg-background text-foreground border border-border\",\n          className,\n        )}\n      />\n    );\n  }\n\n  return (\n    <Component\n      className={cn(editableClassName, className)}\n      onDoubleClick={onStartEdit}\n      title={locked ? undefined : \"Double-click to edit\"}\n    >\n      {value}\n    </Component>\n  );\n}\n\n/**\n * Editable number component\n */\nexport function EditableNumber({\n  path,\n  value,\n  locked = false,\n  className,\n}: {\n  path: string;\n  value: number;\n  locked?: boolean;\n  className?: string;\n}) {\n  const { isEditing, onStartEdit, onCommit, onCancel, editableClassName } =\n    useEditable(path, value, locked);\n  const [localValue, setLocalValue] = useState(String(value));\n\n  // Sync local value when not editing\n  React.useEffect(() => {\n    if (!isEditing) {\n      setLocalValue(String(value));\n    }\n  }, [value, isEditing]);\n\n  if (isEditing) {\n    return (\n      <input\n        type=\"number\"\n        value={localValue}\n        onChange={(e) => setLocalValue(e.target.value)}\n        onBlur={() => onCommit(parseFloat(localValue) || 0)}\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\") {\n            e.preventDefault();\n            onCommit(parseFloat(localValue) || 0);\n          }\n          if (e.key === \"Escape\") {\n            onCancel();\n          }\n        }}\n        autoFocus\n        className={cn(\n          \"w-20 box-border -m-0.5 rounded px-1.5 py-0.5 font-inherit text-inherit outline-none\",\n          \"bg-background text-foreground border border-border\",\n          className,\n        )}\n      />\n    );\n  }\n\n  return (\n    <span\n      className={cn(editableClassName, className)}\n      onDoubleClick={onStartEdit}\n      title={locked ? undefined : \"Double-click to edit\"}\n    >\n      {value}\n    </span>\n  );\n}\n","\"use client\";\n\nimport { memo, type CSSProperties, type ReactNode } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkMath from \"remark-math\";\nimport rehypeKatex from \"rehype-katex\";\nimport { cn } from \"../utils\";\n\nexport interface MarkdownTextProps {\n  content: string;\n  className?: string;\n  style?: CSSProperties;\n  inline?: boolean;\n  theme?: Partial<MarkdownTheme>;\n  enableMath?: boolean;\n}\n\nexport interface MarkdownTheme {\n  codeBlockBg: string;\n  codeBlockBorder: string;\n  inlineCodeBg: string;\n  linkColor: string;\n  blockquoteBorder: string;\n  hrColor: string;\n}\n\nconst defaultTheme: MarkdownTheme = {\n  codeBlockBg: \"rgba(0, 0, 0, 0.3)\",\n  codeBlockBorder: \"rgba(255, 255, 255, 0.08)\",\n  inlineCodeBg: \"rgba(0, 0, 0, 0.25)\",\n  linkColor: \"var(--primary, #3b82f6)\",\n  blockquoteBorder: \"var(--primary, #3b82f6)\",\n  hrColor: \"rgba(255, 255, 255, 0.1)\",\n};\n\nexport const MarkdownText = memo(function MarkdownText({\n  content,\n  className,\n  style,\n  inline = false,\n  theme: themeOverrides,\n  enableMath = true,\n}: MarkdownTextProps) {\n  const theme = { ...defaultTheme, ...themeOverrides };\n\n  const wrapperStyle = {\n    \"--markdown-code-bg\": theme.codeBlockBg,\n    \"--markdown-code-border\": theme.codeBlockBorder,\n    \"--markdown-inline-code-bg\": theme.inlineCodeBg,\n    \"--markdown-link-color\": theme.linkColor,\n    \"--markdown-quote-border\": theme.blockquoteBorder,\n    \"--markdown-hr-color\": theme.hrColor,\n    ...style,\n  } as CSSProperties;\n\n  const components = {\n    pre: ({ children }: { children?: ReactNode }) => (\n      <pre className=\"bg-[var(--markdown-code-bg)] rounded-lg p-3 overflow-x-auto text-[13px] font-mono border border-[var(--markdown-code-border)] my-2\">\n        {children}\n      </pre>\n    ),\n    code: ({\n      children,\n      className: codeClassName,\n    }: {\n      children?: ReactNode;\n      className?: string;\n    }) => {\n      const isInline = !codeClassName;\n      if (isInline) {\n        return (\n          <code className=\"bg-[var(--markdown-inline-code-bg)] rounded px-1.5 py-0.5 text-[0.9em] font-mono\">\n            {children}\n          </code>\n        );\n      }\n      return <code>{children}</code>;\n    },\n    a: ({ href, children }: { href?: string; children?: ReactNode }) => (\n      <a\n        href={href}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"text-[var(--markdown-link-color)] underline underline-offset-2 hover:opacity-80 transition-opacity\"\n      >\n        {children}\n      </a>\n    ),\n    ul: ({ children }: { children?: ReactNode }) => (\n      <ul className=\"my-2 pl-5 list-disc\">{children}</ul>\n    ),\n    ol: ({ children }: { children?: ReactNode }) => (\n      <ol className=\"my-2 pl-5 list-decimal\">{children}</ol>\n    ),\n    li: ({ children }: { children?: ReactNode }) => (\n      <li className=\"mb-1\">{children}</li>\n    ),\n    h1: ({ children }: { children?: ReactNode }) => (\n      <h1 className=\"font-semibold mt-3 mb-2 text-lg\">{children}</h1>\n    ),\n    h2: ({ children }: { children?: ReactNode }) => (\n      <h2 className=\"font-semibold mt-3 mb-2 text-base\">{children}</h2>\n    ),\n    h3: ({ children }: { children?: ReactNode }) => (\n      <h3 className=\"font-semibold mt-3 mb-2 text-[15px]\">{children}</h3>\n    ),\n    h4: ({ children }: { children?: ReactNode }) => (\n      <h4 className=\"font-semibold mt-3 mb-2 text-sm\">{children}</h4>\n    ),\n    h5: ({ children }: { children?: ReactNode }) => (\n      <h5 className=\"font-semibold mt-3 mb-2 text-[13px]\">{children}</h5>\n    ),\n    h6: ({ children }: { children?: ReactNode }) => (\n      <h6 className=\"font-semibold mt-3 mb-2 text-xs\">{children}</h6>\n    ),\n    p: ({ children }: { children?: ReactNode }) =>\n      inline ? (\n        <span>{children}</span>\n      ) : (\n        <p className=\"my-1.5 leading-relaxed\">{children}</p>\n      ),\n    blockquote: ({ children }: { children?: ReactNode }) => (\n      <blockquote className=\"border-l-[3px] border-[var(--markdown-quote-border)] pl-3 my-2 opacity-90 italic\">\n        {children}\n      </blockquote>\n    ),\n    hr: () => (\n      <hr className=\"border-none border-t border-[var(--markdown-hr-color)] my-3\" />\n    ),\n    strong: ({ children }: { children?: ReactNode }) => (\n      <strong className=\"font-semibold\">{children}</strong>\n    ),\n    em: ({ children }: { children?: ReactNode }) => (\n      <em className=\"italic\">{children}</em>\n    ),\n  };\n\n  const Wrapper = inline ? \"span\" : \"div\";\n\n  const remarkPlugins = enableMath ? [remarkMath] : [];\n  const rehypePlugins = enableMath ? [rehypeKatex] : [];\n\n  return (\n    <Wrapper className={cn(\"markdown-content\", className)} style={wrapperStyle}>\n      <ReactMarkdown\n        components={components}\n        remarkPlugins={remarkPlugins}\n        rehypePlugins={rehypePlugins}\n      >\n        {content}\n      </ReactMarkdown>\n    </Wrapper>\n  );\n});\n\nexport default MarkdownText;\n","\"use client\";\n\nimport React from \"react\";\nimport type { PreservedTextSelection } from \"../hooks/usePreservedSelection\";\nimport { cn } from \"../utils\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface TextSelectionBadgeProps {\n  /** The preserved selection to display */\n  selection: PreservedTextSelection;\n  /** Callback when user clears the selection */\n  onClear: () => void;\n  /** Callback to restore the selection in the DOM */\n  onRestore?: () => void;\n  /** Maximum characters to show before truncating */\n  maxLength?: number;\n  /** Custom className for styling */\n  className?: string;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Component\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Badge component that displays a preserved text selection.\n *\n * Shows:\n * - Truncated preview of the selected text\n * - \"Copied\" indicator if auto-copied to clipboard\n * - Button to restore selection in DOM (if possible)\n * - Button to clear/dismiss\n *\n * @example\n * ```tsx\n * {preserved && (\n *   <TextSelectionBadge\n *     selection={preserved}\n *     onClear={clear}\n *     onRestore={restore}\n *   />\n * )}\n * ```\n */\nexport function TextSelectionBadge({\n  selection,\n  onClear,\n  onRestore,\n  maxLength = 50,\n  className,\n}: TextSelectionBadgeProps) {\n  const truncatedText =\n    selection.text.length > maxLength\n      ? `${selection.text.substring(0, maxLength)}...`\n      : selection.text;\n\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-2 px-3 py-2 rounded-lg text-[13px] text-foreground\",\n        \"bg-primary/10 border border-primary/20\",\n        className,\n      )}\n    >\n      {/* Text indicator icon */}\n      <svg\n        width=\"14\"\n        height=\"14\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        className=\"shrink-0 text-primary\"\n      >\n        <path d=\"M17 6.1H3\" />\n        <path d=\"M21 12.1H3\" />\n        <path d=\"M15.1 18H3\" />\n      </svg>\n\n      {/* Text preview */}\n      <span\n        className=\"flex-1 overflow-hidden text-ellipsis whitespace-nowrap italic text-muted-foreground\"\n        title={selection.text}\n      >\n        \"{truncatedText}\"\n      </span>\n\n      {/* Copied indicator */}\n      {selection.copiedToClipboard && (\n        <span className=\"text-[10px] px-1.5 py-0.5 bg-green-500/20 text-green-500 rounded font-medium\">\n          Copied\n        </span>\n      )}\n\n      {/* Element info if available */}\n      {selection.elementType && (\n        <span className=\"text-[10px] px-1.5 py-0.5 bg-violet-500/20 text-violet-500 rounded\">\n          {selection.elementType}\n        </span>\n      )}\n\n      {/* Restore button */}\n      {onRestore && (\n        <button\n          type=\"button\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            onRestore();\n          }}\n          title=\"Restore selection\"\n          className=\"flex items-center justify-center p-1 border-none rounded bg-transparent text-muted-foreground cursor-pointer transition-all hover:bg-primary/20 hover:text-primary\"\n        >\n          <svg\n            width=\"12\"\n            height=\"12\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n          >\n            <path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\" />\n            <path d=\"M3 3v5h5\" />\n          </svg>\n        </button>\n      )}\n\n      {/* Clear button */}\n      <button\n        type=\"button\"\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          onClear();\n        }}\n        title=\"Clear\"\n        className=\"flex items-center justify-center p-1 border-none rounded bg-transparent text-muted-foreground cursor-pointer transition-all hover:bg-destructive/20 hover:text-destructive\"\n      >\n        <svg\n          width=\"12\"\n          height=\"12\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n        >\n          <path d=\"M18 6 6 18\" />\n          <path d=\"m6 6 12 12\" />\n        </svg>\n      </button>\n    </div>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// FreeGrid Canvas Component\n// =============================================================================\n\nimport { useMemo } from \"react\";\nimport type { FreeGridCanvasProps } from \"./types\";\nimport { gridContainerBaseStyle } from \"./styles\";\nimport { GridLines } from \"./grid-lines\";\n\n/**\n * A CSS Grid-based canvas for free-form layout of UI elements.\n */\nexport function FreeGridCanvas({\n  columns = 12,\n  rows,\n  cellSize,\n  gap = 16,\n  minRowHeight = 100,\n  showGrid = false,\n  gridLineColor = \"rgba(255, 255, 255, 0.03)\",\n  backgroundColor,\n  children,\n  onLayoutChange: _onLayoutChange,\n  className,\n  style,\n}: FreeGridCanvasProps) {\n  const gridTemplateColumns = useMemo(() => {\n    if (cellSize) {\n      return `repeat(${columns}, ${cellSize}px)`;\n    }\n    return `repeat(${columns}, 1fr)`;\n  }, [columns, cellSize]);\n\n  const gridTemplateRows = useMemo(() => {\n    if (rows) {\n      if (cellSize) {\n        return `repeat(${rows}, ${cellSize}px)`;\n      }\n      return `repeat(${rows}, minmax(${minRowHeight}px, auto))`;\n    }\n    return `repeat(auto-fill, minmax(${minRowHeight}px, auto))`;\n  }, [rows, cellSize, minRowHeight]);\n\n  const containerStyle: React.CSSProperties = {\n    ...gridContainerBaseStyle,\n    gridTemplateColumns,\n    gridTemplateRows,\n    gap,\n    backgroundColor,\n    ...style,\n  };\n\n  return (\n    <div\n      style={containerStyle}\n      className={className}\n      data-free-grid-canvas\n      data-columns={columns}\n      data-rows={rows}\n    >\n      {showGrid && (\n        <GridLines columns={columns} rows={rows ?? 4} color={gridLineColor} />\n      )}\n      {children}\n    </div>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// FreeGrid Styles\n// =============================================================================\n\nimport type React from \"react\";\n\nexport const gridContainerBaseStyle: React.CSSProperties = {\n  display: \"grid\",\n  position: \"relative\",\n  width: \"100%\",\n  minHeight: \"100%\",\n  boxSizing: \"border-box\",\n};\n\nexport const gridLinesOverlayStyle: React.CSSProperties = {\n  position: \"absolute\",\n  inset: 0,\n  pointerEvents: \"none\",\n  zIndex: 0,\n};\n\nexport const gridCellBaseStyle: React.CSSProperties = {\n  position: \"relative\",\n  zIndex: 1,\n  minWidth: 0,\n  minHeight: 0,\n};\n","\"use client\";\n\n// =============================================================================\n// Grid Lines Component\n// =============================================================================\n\nimport { useMemo } from \"react\";\nimport { gridLinesOverlayStyle } from \"./styles\";\n\ninterface GridLinesProps {\n  columns: number;\n  rows: number;\n  color: string;\n}\n\nexport function GridLines({ columns, rows, color }: GridLinesProps) {\n  const patternId = useMemo(\n    () => `grid-pattern-${Math.random().toString(36).substr(2, 9)}`,\n    [],\n  );\n\n  return (\n    <svg style={gridLinesOverlayStyle} aria-hidden=\"true\">\n      <defs>\n        <pattern\n          id={patternId}\n          width={`${100 / columns}%`}\n          height={`${100 / Math.max(rows, 1)}%`}\n          patternUnits=\"objectBoundingBox\"\n        >\n          <rect\n            width=\"100%\"\n            height=\"100%\"\n            fill=\"none\"\n            stroke={color}\n            strokeWidth=\"1\"\n            strokeDasharray=\"4 2\"\n          />\n        </pattern>\n      </defs>\n      <rect width=\"100%\" height=\"100%\" fill={`url(#${patternId})`} />\n    </svg>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// Grid Cell Component\n// =============================================================================\n\nimport type { GridCellProps } from \"./types\";\nimport { gridCellBaseStyle } from \"./styles\";\n\n/**\n * A cell within the FreeGridCanvas that can span multiple columns/rows.\n */\nexport function GridCell({\n  column,\n  row,\n  columnSpan = 1,\n  rowSpan = 1,\n  children,\n  className,\n  style,\n}: GridCellProps) {\n  const cellStyle: React.CSSProperties = {\n    ...gridCellBaseStyle,\n    ...(column && { gridColumnStart: column }),\n    ...(row && { gridRowStart: row }),\n    gridColumnEnd: columnSpan > 1 ? `span ${columnSpan}` : undefined,\n    gridRowEnd: rowSpan > 1 ? `span ${rowSpan}` : undefined,\n    ...style,\n  };\n\n  return (\n    <div style={cellStyle} className={className} data-grid-cell>\n      {children}\n    </div>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// Layout Utilities\n// =============================================================================\n\nimport type React from \"react\";\nimport type { ElementLayout } from \"@onegenui/core\";\n\n/**\n * Generate CSS styles from an element's layout configuration.\n */\nexport function getLayoutStyles(\n  layout: ElementLayout | undefined,\n): React.CSSProperties {\n  if (!layout) return {};\n\n  const styles: React.CSSProperties = {};\n\n  // Apply sizing\n  if (layout.size) {\n    if (layout.size.width !== undefined) styles.width = layout.size.width;\n    if (layout.size.height !== undefined) styles.height = layout.size.height;\n    if (layout.size.minWidth !== undefined)\n      styles.minWidth = layout.size.minWidth;\n    if (layout.size.maxWidth !== undefined)\n      styles.maxWidth = layout.size.maxWidth;\n    if (layout.size.minHeight !== undefined)\n      styles.minHeight = layout.size.minHeight;\n    if (layout.size.maxHeight !== undefined)\n      styles.maxHeight = layout.size.maxHeight;\n  }\n\n  // Apply grid positioning\n  if (layout.grid) {\n    if (layout.grid.column !== undefined) {\n      styles.gridColumnStart = layout.grid.column;\n    }\n    if (layout.grid.row !== undefined) {\n      styles.gridRowStart = layout.grid.row;\n    }\n    if (layout.grid.columnSpan !== undefined && layout.grid.columnSpan > 1) {\n      styles.gridColumnEnd = `span ${layout.grid.columnSpan}`;\n    }\n    if (layout.grid.rowSpan !== undefined && layout.grid.rowSpan > 1) {\n      styles.gridRowEnd = `span ${layout.grid.rowSpan}`;\n    }\n  }\n\n  return styles;\n}\n\n/**\n * Create a layout configuration from grid position and size.\n */\nexport function createLayout(\n  options: {\n    column?: number;\n    row?: number;\n    columnSpan?: number;\n    rowSpan?: number;\n    width?: number | string;\n    height?: number | string;\n    resizable?: boolean;\n  } = {},\n): ElementLayout {\n  return {\n    grid: {\n      column: options.column,\n      row: options.row,\n      columnSpan: options.columnSpan,\n      rowSpan: options.rowSpan,\n    },\n    size: {\n      width: options.width,\n      height: options.height,\n    },\n    resizable: options.resizable,\n  };\n}\n","\"use client\";\n\nimport React, { memo, useEffect, useState } from \"react\";\nimport {\n  useActiveToolProgress,\n  useIsToolRunning,\n} from \"../contexts/tool-progress\";\nimport type { ToolProgressEvent } from \"../contexts/tool-progress\";\nimport {\n  positionStyles,\n  progressAnimations,\n  DefaultProgressItem,\n} from \"./tool-progress\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ToolProgressOverlayProps {\n  /** Position of the overlay */\n  position?:\n    | \"top-right\"\n    | \"top-left\"\n    | \"bottom-right\"\n    | \"bottom-left\"\n    | \"top-center\";\n  /** Custom class name */\n  className?: string;\n  /** Whether to show the overlay (default: auto based on isToolRunning) */\n  show?: boolean;\n  /** Maximum number of items to show */\n  maxItems?: number;\n  /** Custom render function for each progress item */\n  renderItem?: (progress: ToolProgressEvent) => React.ReactNode;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Main Component\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * ToolProgressOverlay - Automatically shows tool execution progress\n *\n * This component renders as a floating overlay that automatically appears\n * when tools are running and hides when complete. Place it once at the root\n * of your app for global tool progress visibility.\n *\n * @example\n * ```tsx\n * <ToolProgressProvider>\n *   <App />\n *   <ToolProgressOverlay position=\"top-right\" />\n * </ToolProgressProvider>\n * ```\n */\nexport const ToolProgressOverlay = memo(function ToolProgressOverlay({\n  position = \"top-right\",\n  className,\n  show,\n  maxItems = 5,\n  renderItem,\n}: ToolProgressOverlayProps) {\n  const activeProgress = useActiveToolProgress();\n  const isRunning = useIsToolRunning();\n  const [mounted, setMounted] = useState(false);\n\n  // Handle client-side mounting\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Determine visibility\n  const shouldShow = show ?? isRunning;\n\n  // Don't render on server or if not showing\n  if (!mounted || !shouldShow || activeProgress.length === 0) {\n    return null;\n  }\n\n  const visibleProgress = activeProgress.slice(0, maxItems);\n\n  return (\n    <>\n      {/* CSS Animations */}\n      <style>{progressAnimations}</style>\n\n      {/* Overlay Container */}\n      <div\n        className={className}\n        style={{\n          position: \"fixed\",\n          zIndex: 9999,\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: 8,\n          pointerEvents: \"none\",\n          ...positionStyles[position],\n        }}\n      >\n        {visibleProgress.map((progress) =>\n          renderItem ? (\n            <div key={progress.toolCallId} style={{ pointerEvents: \"auto\" }}>\n              {renderItem(progress)}\n            </div>\n          ) : (\n            <DefaultProgressItem\n              key={progress.toolCallId}\n              progress={progress}\n            />\n          ),\n        )}\n      </div>\n    </>\n  );\n});\n","/**\n * Tool icons and labels for progress display\n */\n\nimport React from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Tool Icons (inline SVG for zero dependencies)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const toolIcons: Record<string, React.ReactNode> = {\n  \"web-search\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <circle cx=\"11\" cy=\"11\" r=\"8\" />\n      <path d=\"m21 21-4.3-4.3\" />\n    </svg>\n  ),\n  \"web-scrape\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n      <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n    </svg>\n  ),\n  \"search-flight\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z\" />\n    </svg>\n  ),\n  \"search-hotel\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z\" />\n      <path d=\"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2\" />\n      <path d=\"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2\" />\n      <path d=\"M10 6h4\" />\n      <path d=\"M10 10h4\" />\n      <path d=\"M10 14h4\" />\n      <path d=\"M10 18h4\" />\n    </svg>\n  ),\n  \"document-index\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <path d=\"M12 18v-6\" />\n      <path d=\"M9 15l3 3 3-3\" />\n    </svg>\n  ),\n  \"document-index-cache\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <path d=\"M9 15l2 2 4-4\" />\n    </svg>\n  ),\n  \"document-search\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <circle cx=\"11.5\" cy=\"14.5\" r=\"2.5\" />\n      <path d=\"M13.3 16.3 15 18\" />\n    </svg>\n  ),\n  default: (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <polygon points=\"13,2 3,14 12,14 11,22 21,10 12,10 13,2\" />\n    </svg>\n  ),\n};\n\nexport const toolLabels: Record<string, string> = {\n  \"web-search\": \"Web Search\",\n  \"web-scrape\": \"Reading Page\",\n  \"search-flight\": \"Flight Search\",\n  \"search-hotel\": \"Hotel Search\",\n  search_custom: \"Custom Search\",\n  gmail_list_messages: \"Gmail\",\n  gmail_get_message: \"Gmail\",\n  gmail_get_thread: \"Gmail\",\n  calendar_list_events: \"Calendar\",\n  drive_list_files: \"Drive\",\n  \"document-index\": \"Indexing Document\",\n  \"document-index-cache\": \"Document Cached\",\n  \"document-search\": \"Searching Document\",\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Position Styles\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const positionStyles: Record<string, React.CSSProperties> = {\n  \"top-right\": { top: 16, right: 16 },\n  \"top-left\": { top: 16, left: 16 },\n  \"bottom-right\": { bottom: 16, right: 16 },\n  \"bottom-left\": { bottom: 16, left: 16 },\n  \"top-center\": { top: 16, left: \"50%\", transform: \"translateX(-50%)\" },\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// CSS Animations\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const progressAnimations = `\n  @keyframes slideIn {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  @keyframes pulse {\n    0%, 100% {\n      opacity: 1;\n      transform: scale(1);\n    }\n    50% {\n      opacity: 0.5;\n      transform: scale(1.2);\n    }\n  }\n  @keyframes bounce {\n    0%, 100% {\n      transform: translateY(0);\n    }\n    50% {\n      transform: translateY(-3px);\n    }\n  }\n`;\n","\"use client\";\n\nimport React, { memo } from \"react\";\nimport type { ToolProgressEvent } from \"../../contexts/tool-progress\";\nimport { toolIcons, toolLabels } from \"./icons\";\n\ninterface DefaultProgressItemProps {\n  progress: ToolProgressEvent;\n}\n\nexport const DefaultProgressItem = memo(function DefaultProgressItem({\n  progress,\n}: DefaultProgressItemProps) {\n  const label = toolLabels[progress.toolName] || progress.toolName;\n  const icon = toolIcons[progress.toolName] || toolIcons.default;\n  const isActive =\n    progress.status === \"starting\" || progress.status === \"progress\";\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        alignItems: \"center\",\n        gap: 12,\n        padding: \"10px 14px\",\n        borderRadius: 12,\n        background: \"rgba(24, 24, 27, 0.95)\",\n        border: \"1px solid rgba(255, 255, 255, 0.1)\",\n        backdropFilter: \"blur(12px)\",\n        boxShadow: \"0 4px 24px rgba(0, 0, 0, 0.3)\",\n        minWidth: 200,\n        animation: \"slideIn 0.3s ease-out\",\n      }}\n    >\n      {/* Icon with pulse indicator */}\n      <div style={{ position: \"relative\" }}>\n        <div\n          style={{\n            width: 32,\n            height: 32,\n            borderRadius: 8,\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            background: \"rgba(59, 130, 246, 0.2)\",\n            color: \"#60a5fa\",\n          }}\n        >\n          {icon}\n        </div>\n        {isActive && (\n          <span\n            style={{\n              position: \"absolute\",\n              top: -2,\n              right: -2,\n              width: 8,\n              height: 8,\n              borderRadius: \"50%\",\n              background: \"#3b82f6\",\n              animation: \"pulse 1.5s ease-in-out infinite\",\n            }}\n          />\n        )}\n      </div>\n\n      {/* Content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            display: \"flex\",\n            alignItems: \"center\",\n            gap: 6,\n          }}\n        >\n          <span\n            style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: \"#fafafa\",\n            }}\n          >\n            {label}\n          </span>\n          {isActive && (\n            <span style={{ display: \"flex\", gap: 2 }}>\n              {[0, 1, 2].map((i) => (\n                <span\n                  key={i}\n                  style={{\n                    width: 3,\n                    height: 3,\n                    borderRadius: \"50%\",\n                    background: \"rgba(96, 165, 250, 0.6)\",\n                    animation: `bounce 1s ease-in-out ${i * 0.15}s infinite`,\n                  }}\n                />\n              ))}\n            </span>\n          )}\n        </div>\n        {progress.message && (\n          <p\n            style={{\n              margin: 0,\n              marginTop: 2,\n              fontSize: 11,\n              color: \"#a1a1aa\",\n              overflow: \"hidden\",\n              textOverflow: \"ellipsis\",\n              whiteSpace: \"nowrap\",\n            }}\n          >\n            {progress.message}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n});\n","/**\n * CanvasBlock - Generative UI component for Canvas editor\n *\n * This is a placeholder component that renders a canvas-ready container.\n * The actual Lexical editor is loaded at the application level (dashboard)\n * to avoid bundling Lexical in the react package.\n */\n\"use client\";\n\nimport { memo, useCallback, useState, useEffect, useMemo } from \"react\";\nimport type { UIElement } from \"@onegenui/core\";\n\nexport interface CanvasBlockProps {\n  /** Document unique identifier */\n  documentId?: string;\n  /** Initial content (serialized state) */\n  initialContent?: unknown;\n  /** Markdown content (easier for AI to generate) */\n  markdown?: string;\n  /** Images to embed in document */\n  images?: Array<{\n    url: string;\n    alt?: string;\n    caption?: string;\n  }>;\n  /** Editor mode */\n  mode?: \"view\" | \"edit\" | \"collab\";\n  /** Width (CSS value) */\n  width?: string;\n  /** Height (CSS value) */\n  height?: string;\n  /** Show formatting toolbar */\n  showToolbar?: boolean;\n  /** Action to trigger on save */\n  onSaveAction?: string;\n  /** Placeholder text */\n  placeholder?: string;\n  /** Document title */\n  title?: string;\n}\n\ninterface CanvasBlockComponentProps {\n  element: UIElement<\"Canvas\", CanvasBlockProps>;\n  onAction?: (action: { type: string; payload?: unknown }) => void;\n  loading?: boolean;\n  /** Custom editor component to render (injected from app level) */\n  EditorComponent?: React.ComponentType<{\n    initialState?: unknown;\n    onChange?: (state: unknown, serialized: unknown) => void;\n    placeholder?: string;\n    editable?: boolean;\n    enableFloatingToolbar?: boolean;\n    enableDragDrop?: boolean;\n    enableAI?: boolean;\n    enableProactiveSuggestions?: boolean;\n    className?: string;\n  }>;\n}\n\nfunction CanvasBlockSkeleton() {\n  return (\n    <div className=\"w-full min-h-[200px] bg-zinc-900/50 rounded-xl border border-white/5 flex items-center justify-center\">\n      <div className=\"text-zinc-500 text-sm\">Loading editor...</div>\n    </div>\n  );\n}\n\nexport const CanvasBlock = memo(function CanvasBlock({\n  element,\n  onAction,\n  loading,\n  EditorComponent,\n}: CanvasBlockComponentProps) {\n  const {\n    documentId,\n    initialContent,\n    markdown,\n    images,\n    mode = \"edit\",\n    width = \"100%\",\n    height = \"300px\",\n    showToolbar = true,\n    placeholder = \"Start typing... Use '/' for commands\",\n    title,\n  } = element.props;\n\n  const [content, setContent] = useState<unknown>(initialContent || null);\n  // Key to force editor re-render when content is externally updated\n  const [editorKey, setEditorKey] = useState(0);\n\n  // Process markdown into content if provided (easier for AI)\n  const processedContent = useMemo(() => {\n    // If we have initialContent, use it directly\n    if (initialContent) return initialContent;\n\n    // If we have markdown, convert to editor-friendly format\n    // The actual conversion happens in the editor component\n    if (markdown) {\n      return { markdown, images };\n    }\n\n    // If we only have images, create a simple structure\n    if (images && images.length > 0) {\n      return { images };\n    }\n\n    return null;\n  }, [initialContent, markdown, images]);\n\n  // Sync with external content changes (from AI updates)\n  useEffect(() => {\n    if (processedContent !== undefined && processedContent !== null) {\n      setContent(processedContent);\n      // Force editor to re-initialize with new content\n      setEditorKey((k) => k + 1);\n    }\n  }, [processedContent]);\n\n  const handleChange = useCallback(\n    (_state: unknown, serialized: unknown) => {\n      setContent(serialized as unknown);\n      onAction?.({\n        type: \"canvas:change\",\n        payload: {\n          documentId,\n          content: serialized,\n        },\n      });\n    },\n    [documentId, onAction],\n  );\n\n  const handleSave = useCallback(() => {\n    if (content) {\n      onAction?.({\n        type: \"canvas:save\",\n        payload: {\n          documentId,\n          content,\n        },\n      });\n    }\n  }, [documentId, content, onAction]);\n\n  const handleOpenInCanvas = useCallback(() => {\n    onAction?.({\n      type: \"canvas:open\",\n      payload: {\n        documentId,\n        title,\n        content: initialContent,\n      },\n    });\n  }, [documentId, title, initialContent, onAction]);\n\n  if (loading) {\n    return <CanvasBlockSkeleton />;\n  }\n\n  // If no editor component provided, show placeholder with \"Open in Canvas\" button\n  if (!EditorComponent) {\n    return (\n      <div\n        className=\"canvas-block w-full bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden\"\n        style={{ minHeight: height }}\n        data-document-id={documentId}\n      >\n        {title && (\n          <div className=\"px-4 py-3 border-b border-white/5\">\n            <h3 className=\"text-lg font-semibold text-white\">{title}</h3>\n          </div>\n        )}\n        <div\n          className=\"flex flex-col items-center justify-center gap-4 p-8\"\n          style={{ minHeight: \"200px\" }}\n        >\n          <p className=\"text-zinc-400 text-sm\">\n            {initialContent ? \"Document content available\" : \"Empty document\"}\n          </p>\n          <button\n            onClick={handleOpenInCanvas}\n            className=\"flex items-center gap-2 px-4 py-2 rounded-lg bg-primary/10 hover:bg-primary/20 text-primary text-sm font-medium transition-colors border-none cursor-pointer\"\n          >\n            <svg\n              width=\"16\"\n              height=\"16\"\n              viewBox=\"0 0 24 24\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            >\n              <path d=\"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" />\n              <path d=\"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z\" />\n            </svg>\n            Open in Canvas\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className=\"canvas-block\"\n      style={{ width, minHeight: height }}\n      data-document-id={documentId}\n    >\n      {title && (\n        <h3 className=\"text-lg font-semibold text-white mb-3\">{title}</h3>\n      )}\n      <div className=\"bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden\">\n        <EditorComponent\n          key={editorKey}\n          initialState={content}\n          onChange={handleChange}\n          placeholder={placeholder}\n          editable={mode !== \"view\"}\n          enableFloatingToolbar={showToolbar && mode === \"edit\"}\n          enableDragDrop={mode === \"edit\"}\n          enableAI={mode === \"edit\"}\n          enableProactiveSuggestions={mode === \"edit\"}\n          className=\"prose prose-invert max-w-none p-4\"\n        />\n      </div>\n      {mode === \"edit\" && (\n        <div className=\"flex justify-end mt-2\">\n          <button\n            onClick={handleSave}\n            className=\"px-3 py-1.5 text-sm bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors border-none cursor-pointer\"\n          >\n            Save\n          </button>\n        </div>\n      )}\n    </div>\n  );\n});\n\nexport default CanvasBlock;\n","const {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor,\n} = Object;\n\nlet { freeze, seal, create } = Object; // eslint-disable-line import/no-mutable-exports\nlet { apply, construct } = typeof Reflect !== 'undefined' && Reflect;\n\nif (!freeze) {\n  freeze = function <T>(x: T): T {\n    return x;\n  };\n}\n\nif (!seal) {\n  seal = function <T>(x: T): T {\n    return x;\n  };\n}\n\nif (!apply) {\n  apply = function <T>(\n    func: (thisArg: any, ...args: any[]) => T,\n    thisArg: any,\n    ...args: any[]\n  ): T {\n    return func.apply(thisArg, args);\n  };\n}\n\nif (!construct) {\n  construct = function <T>(Func: new (...args: any[]) => T, ...args: any[]): T {\n    return new Func(...args);\n  };\n}\n\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayIndexOf = unapply(Array.prototype.indexOf);\nconst arrayLastIndexOf = unapply(Array.prototype.lastIndexOf);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst arraySlice = unapply(Array.prototype.slice);\nconst arraySplice = unapply(Array.prototype.splice);\n\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\n\nconst objectHasOwnProperty = unapply(Object.prototype.hasOwnProperty);\n\nconst regExpTest = unapply(RegExp.prototype.test);\n\nconst typeErrorCreate = unconstruct(TypeError);\n\n/**\n * Creates a new function that calls the given function with a specified thisArg and arguments.\n *\n * @param func - The function to be wrapped and called.\n * @returns A new function that calls the given function with a specified thisArg and arguments.\n */\nfunction unapply<T>(\n  func: (thisArg: any, ...args: any[]) => T\n): (thisArg: any, ...args: any[]) => T {\n  return (thisArg: any, ...args: any[]): T => {\n    if (thisArg instanceof RegExp) {\n      thisArg.lastIndex = 0;\n    }\n\n    return apply(func, thisArg, args);\n  };\n}\n\n/**\n * Creates a new function that constructs an instance of the given constructor function with the provided arguments.\n *\n * @param func - The constructor function to be wrapped and called.\n * @returns A new function that constructs an instance of the given constructor function with the provided arguments.\n */\nfunction unconstruct<T>(\n  Func: new (...args: any[]) => T\n): (...args: any[]) => T {\n  return (...args: any[]): T => construct(Func, args);\n}\n\n/**\n * Add properties to a lookup table\n *\n * @param set - The set to which elements will be added.\n * @param array - The array containing elements to be added to the set.\n * @param transformCaseFunc - An optional function to transform the case of each element before adding to the set.\n * @returns The modified set with added elements.\n */\nfunction addToSet(\n  set: Record<string, any>,\n  array: readonly any[],\n  transformCaseFunc: ReturnType<typeof unapply<string>> = stringToLowerCase\n): Record<string, any> {\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n\n  let l = array.length;\n  while (l--) {\n    let element = array[l];\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          (array as any[])[l] = lcElement;\n        }\n\n        element = lcElement;\n      }\n    }\n\n    set[element] = true;\n  }\n\n  return set;\n}\n\n/**\n * Clean up an array to harden against CSPP\n *\n * @param array - The array to be cleaned.\n * @returns The cleaned version of the array\n */\nfunction cleanArray<T>(array: T[]): Array<T | null> {\n  for (let index = 0; index < array.length; index++) {\n    const isPropertyExist = objectHasOwnProperty(array, index);\n\n    if (!isPropertyExist) {\n      array[index] = null;\n    }\n  }\n\n  return array;\n}\n\n/**\n * Shallow clone an object\n *\n * @param object - The object to be cloned.\n * @returns A new object that copies the original.\n */\nfunction clone<T extends Record<string, any>>(object: T): T {\n  const newObject = create(null);\n\n  for (const [property, value] of entries(object)) {\n    const isPropertyExist = objectHasOwnProperty(object, property);\n\n    if (isPropertyExist) {\n      if (Array.isArray(value)) {\n        newObject[property] = cleanArray(value);\n      } else if (\n        value &&\n        typeof value === 'object' &&\n        value.constructor === Object\n      ) {\n        newObject[property] = clone(value);\n      } else {\n        newObject[property] = value;\n      }\n    }\n  }\n\n  return newObject;\n}\n\n/**\n * This method automatically checks if the prop is function or getter and behaves accordingly.\n *\n * @param object - The object to look up the getter function in its prototype chain.\n * @param prop - The property name for which to find the getter function.\n * @returns The getter function found in the prototype chain or a fallback function.\n */\nfunction lookupGetter<T extends Record<string, any>>(\n  object: T,\n  prop: string\n): ReturnType<typeof unapply<any>> | (() => null) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n\n    object = getPrototypeOf(object);\n  }\n\n  function fallbackValue(): null {\n    return null;\n  }\n\n  return fallbackValue;\n}\n\nexport {\n  // Array\n  arrayForEach,\n  arrayIndexOf,\n  arrayLastIndexOf,\n  arrayPop,\n  arrayPush,\n  arraySlice,\n  arraySplice,\n  // Object\n  entries,\n  freeze,\n  getPrototypeOf,\n  getOwnPropertyDescriptor,\n  isFrozen,\n  setPrototypeOf,\n  seal,\n  clone,\n  create,\n  objectHasOwnProperty,\n  // RegExp\n  regExpTest,\n  // String\n  stringIndexOf,\n  stringMatch,\n  stringReplace,\n  stringToLowerCase,\n  stringToString,\n  stringTrim,\n  // Errors\n  typeErrorCreate,\n  // Other\n  lookupGetter,\n  addToSet,\n  // Reflect\n  unapply,\n  unconstruct,\n};\n","import { freeze } from './utils.js';\n\nexport const html = freeze([\n  'a',\n  'abbr',\n  'acronym',\n  'address',\n  'area',\n  'article',\n  'aside',\n  'audio',\n  'b',\n  'bdi',\n  'bdo',\n  'big',\n  'blink',\n  'blockquote',\n  'body',\n  'br',\n  'button',\n  'canvas',\n  'caption',\n  'center',\n  'cite',\n  'code',\n  'col',\n  'colgroup',\n  'content',\n  'data',\n  'datalist',\n  'dd',\n  'decorator',\n  'del',\n  'details',\n  'dfn',\n  'dialog',\n  'dir',\n  'div',\n  'dl',\n  'dt',\n  'element',\n  'em',\n  'fieldset',\n  'figcaption',\n  'figure',\n  'font',\n  'footer',\n  'form',\n  'h1',\n  'h2',\n  'h3',\n  'h4',\n  'h5',\n  'h6',\n  'head',\n  'header',\n  'hgroup',\n  'hr',\n  'html',\n  'i',\n  'img',\n  'input',\n  'ins',\n  'kbd',\n  'label',\n  'legend',\n  'li',\n  'main',\n  'map',\n  'mark',\n  'marquee',\n  'menu',\n  'menuitem',\n  'meter',\n  'nav',\n  'nobr',\n  'ol',\n  'optgroup',\n  'option',\n  'output',\n  'p',\n  'picture',\n  'pre',\n  'progress',\n  'q',\n  'rp',\n  'rt',\n  'ruby',\n  's',\n  'samp',\n  'search',\n  'section',\n  'select',\n  'shadow',\n  'slot',\n  'small',\n  'source',\n  'spacer',\n  'span',\n  'strike',\n  'strong',\n  'style',\n  'sub',\n  'summary',\n  'sup',\n  'table',\n  'tbody',\n  'td',\n  'template',\n  'textarea',\n  'tfoot',\n  'th',\n  'thead',\n  'time',\n  'tr',\n  'track',\n  'tt',\n  'u',\n  'ul',\n  'var',\n  'video',\n  'wbr',\n] as const);\n\nexport const svg = freeze([\n  'svg',\n  'a',\n  'altglyph',\n  'altglyphdef',\n  'altglyphitem',\n  'animatecolor',\n  'animatemotion',\n  'animatetransform',\n  'circle',\n  'clippath',\n  'defs',\n  'desc',\n  'ellipse',\n  'enterkeyhint',\n  'exportparts',\n  'filter',\n  'font',\n  'g',\n  'glyph',\n  'glyphref',\n  'hkern',\n  'image',\n  'inputmode',\n  'line',\n  'lineargradient',\n  'marker',\n  'mask',\n  'metadata',\n  'mpath',\n  'part',\n  'path',\n  'pattern',\n  'polygon',\n  'polyline',\n  'radialgradient',\n  'rect',\n  'stop',\n  'style',\n  'switch',\n  'symbol',\n  'text',\n  'textpath',\n  'title',\n  'tref',\n  'tspan',\n  'view',\n  'vkern',\n] as const);\n\nexport const svgFilters = freeze([\n  'feBlend',\n  'feColorMatrix',\n  'feComponentTransfer',\n  'feComposite',\n  'feConvolveMatrix',\n  'feDiffuseLighting',\n  'feDisplacementMap',\n  'feDistantLight',\n  'feDropShadow',\n  'feFlood',\n  'feFuncA',\n  'feFuncB',\n  'feFuncG',\n  'feFuncR',\n  'feGaussianBlur',\n  'feImage',\n  'feMerge',\n  'feMergeNode',\n  'feMorphology',\n  'feOffset',\n  'fePointLight',\n  'feSpecularLighting',\n  'feSpotLight',\n  'feTile',\n  'feTurbulence',\n] as const);\n\n// List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\nexport const svgDisallowed = freeze([\n  'animate',\n  'color-profile',\n  'cursor',\n  'discard',\n  'font-face',\n  'font-face-format',\n  'font-face-name',\n  'font-face-src',\n  'font-face-uri',\n  'foreignobject',\n  'hatch',\n  'hatchpath',\n  'mesh',\n  'meshgradient',\n  'meshpatch',\n  'meshrow',\n  'missing-glyph',\n  'script',\n  'set',\n  'solidcolor',\n  'unknown',\n  'use',\n] as const);\n\nexport const mathMl = freeze([\n  'math',\n  'menclose',\n  'merror',\n  'mfenced',\n  'mfrac',\n  'mglyph',\n  'mi',\n  'mlabeledtr',\n  'mmultiscripts',\n  'mn',\n  'mo',\n  'mover',\n  'mpadded',\n  'mphantom',\n  'mroot',\n  'mrow',\n  'ms',\n  'mspace',\n  'msqrt',\n  'mstyle',\n  'msub',\n  'msup',\n  'msubsup',\n  'mtable',\n  'mtd',\n  'mtext',\n  'mtr',\n  'munder',\n  'munderover',\n  'mprescripts',\n] as const);\n\n// Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\nexport const mathMlDisallowed = freeze([\n  'maction',\n  'maligngroup',\n  'malignmark',\n  'mlongdiv',\n  'mscarries',\n  'mscarry',\n  'msgroup',\n  'mstack',\n  'msline',\n  'msrow',\n  'semantics',\n  'annotation',\n  'annotation-xml',\n  'mprescripts',\n  'none',\n] as const);\n\nexport const text = freeze(['#text'] as const);\n","import { freeze } from './utils.js';\n\nexport const html = freeze([\n  'accept',\n  'action',\n  'align',\n  'alt',\n  'autocapitalize',\n  'autocomplete',\n  'autopictureinpicture',\n  'autoplay',\n  'background',\n  'bgcolor',\n  'border',\n  'capture',\n  'cellpadding',\n  'cellspacing',\n  'checked',\n  'cite',\n  'class',\n  'clear',\n  'color',\n  'cols',\n  'colspan',\n  'controls',\n  'controlslist',\n  'coords',\n  'crossorigin',\n  'datetime',\n  'decoding',\n  'default',\n  'dir',\n  'disabled',\n  'disablepictureinpicture',\n  'disableremoteplayback',\n  'download',\n  'draggable',\n  'enctype',\n  'enterkeyhint',\n  'exportparts',\n  'face',\n  'for',\n  'headers',\n  'height',\n  'hidden',\n  'high',\n  'href',\n  'hreflang',\n  'id',\n  'inert',\n  'inputmode',\n  'integrity',\n  'ismap',\n  'kind',\n  'label',\n  'lang',\n  'list',\n  'loading',\n  'loop',\n  'low',\n  'max',\n  'maxlength',\n  'media',\n  'method',\n  'min',\n  'minlength',\n  'multiple',\n  'muted',\n  'name',\n  'nonce',\n  'noshade',\n  'novalidate',\n  'nowrap',\n  'open',\n  'optimum',\n  'part',\n  'pattern',\n  'placeholder',\n  'playsinline',\n  'popover',\n  'popovertarget',\n  'popovertargetaction',\n  'poster',\n  'preload',\n  'pubdate',\n  'radiogroup',\n  'readonly',\n  'rel',\n  'required',\n  'rev',\n  'reversed',\n  'role',\n  'rows',\n  'rowspan',\n  'spellcheck',\n  'scope',\n  'selected',\n  'shape',\n  'size',\n  'sizes',\n  'slot',\n  'span',\n  'srclang',\n  'start',\n  'src',\n  'srcset',\n  'step',\n  'style',\n  'summary',\n  'tabindex',\n  'title',\n  'translate',\n  'type',\n  'usemap',\n  'valign',\n  'value',\n  'width',\n  'wrap',\n  'xmlns',\n  'slot',\n] as const);\n\nexport const svg = freeze([\n  'accent-height',\n  'accumulate',\n  'additive',\n  'alignment-baseline',\n  'amplitude',\n  'ascent',\n  'attributename',\n  'attributetype',\n  'azimuth',\n  'basefrequency',\n  'baseline-shift',\n  'begin',\n  'bias',\n  'by',\n  'class',\n  'clip',\n  'clippathunits',\n  'clip-path',\n  'clip-rule',\n  'color',\n  'color-interpolation',\n  'color-interpolation-filters',\n  'color-profile',\n  'color-rendering',\n  'cx',\n  'cy',\n  'd',\n  'dx',\n  'dy',\n  'diffuseconstant',\n  'direction',\n  'display',\n  'divisor',\n  'dur',\n  'edgemode',\n  'elevation',\n  'end',\n  'exponent',\n  'fill',\n  'fill-opacity',\n  'fill-rule',\n  'filter',\n  'filterunits',\n  'flood-color',\n  'flood-opacity',\n  'font-family',\n  'font-size',\n  'font-size-adjust',\n  'font-stretch',\n  'font-style',\n  'font-variant',\n  'font-weight',\n  'fx',\n  'fy',\n  'g1',\n  'g2',\n  'glyph-name',\n  'glyphref',\n  'gradientunits',\n  'gradienttransform',\n  'height',\n  'href',\n  'id',\n  'image-rendering',\n  'in',\n  'in2',\n  'intercept',\n  'k',\n  'k1',\n  'k2',\n  'k3',\n  'k4',\n  'kerning',\n  'keypoints',\n  'keysplines',\n  'keytimes',\n  'lang',\n  'lengthadjust',\n  'letter-spacing',\n  'kernelmatrix',\n  'kernelunitlength',\n  'lighting-color',\n  'local',\n  'marker-end',\n  'marker-mid',\n  'marker-start',\n  'markerheight',\n  'markerunits',\n  'markerwidth',\n  'maskcontentunits',\n  'maskunits',\n  'max',\n  'mask',\n  'mask-type',\n  'media',\n  'method',\n  'mode',\n  'min',\n  'name',\n  'numoctaves',\n  'offset',\n  'operator',\n  'opacity',\n  'order',\n  'orient',\n  'orientation',\n  'origin',\n  'overflow',\n  'paint-order',\n  'path',\n  'pathlength',\n  'patterncontentunits',\n  'patterntransform',\n  'patternunits',\n  'points',\n  'preservealpha',\n  'preserveaspectratio',\n  'primitiveunits',\n  'r',\n  'rx',\n  'ry',\n  'radius',\n  'refx',\n  'refy',\n  'repeatcount',\n  'repeatdur',\n  'restart',\n  'result',\n  'rotate',\n  'scale',\n  'seed',\n  'shape-rendering',\n  'slope',\n  'specularconstant',\n  'specularexponent',\n  'spreadmethod',\n  'startoffset',\n  'stddeviation',\n  'stitchtiles',\n  'stop-color',\n  'stop-opacity',\n  'stroke-dasharray',\n  'stroke-dashoffset',\n  'stroke-linecap',\n  'stroke-linejoin',\n  'stroke-miterlimit',\n  'stroke-opacity',\n  'stroke',\n  'stroke-width',\n  'style',\n  'surfacescale',\n  'systemlanguage',\n  'tabindex',\n  'tablevalues',\n  'targetx',\n  'targety',\n  'transform',\n  'transform-origin',\n  'text-anchor',\n  'text-decoration',\n  'text-rendering',\n  'textlength',\n  'type',\n  'u1',\n  'u2',\n  'unicode',\n  'values',\n  'viewbox',\n  'visibility',\n  'version',\n  'vert-adv-y',\n  'vert-origin-x',\n  'vert-origin-y',\n  'width',\n  'word-spacing',\n  'wrap',\n  'writing-mode',\n  'xchannelselector',\n  'ychannelselector',\n  'x',\n  'x1',\n  'x2',\n  'xmlns',\n  'y',\n  'y1',\n  'y2',\n  'z',\n  'zoomandpan',\n] as const);\n\nexport const mathMl = freeze([\n  'accent',\n  'accentunder',\n  'align',\n  'bevelled',\n  'close',\n  'columnsalign',\n  'columnlines',\n  'columnspan',\n  'denomalign',\n  'depth',\n  'dir',\n  'display',\n  'displaystyle',\n  'encoding',\n  'fence',\n  'frame',\n  'height',\n  'href',\n  'id',\n  'largeop',\n  'length',\n  'linethickness',\n  'lspace',\n  'lquote',\n  'mathbackground',\n  'mathcolor',\n  'mathsize',\n  'mathvariant',\n  'maxsize',\n  'minsize',\n  'movablelimits',\n  'notation',\n  'numalign',\n  'open',\n  'rowalign',\n  'rowlines',\n  'rowspacing',\n  'rowspan',\n  'rspace',\n  'rquote',\n  'scriptlevel',\n  'scriptminsize',\n  'scriptsizemultiplier',\n  'selection',\n  'separator',\n  'separators',\n  'stretchy',\n  'subscriptshift',\n  'supscriptshift',\n  'symmetric',\n  'voffset',\n  'width',\n  'xmlns',\n]);\n\nexport const xml = freeze([\n  'xlink:href',\n  'xml:id',\n  'xlink:title',\n  'xml:space',\n  'xmlns:xlink',\n] as const);\n","import { seal } from './utils.js';\n\n// eslint-disable-next-line unicorn/better-regex\nexport const MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\nexport const ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nexport const TMPLIT_EXPR = seal(/\\$\\{[\\w\\W]*/gm); // eslint-disable-line unicorn/better-regex\nexport const DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]+$/); // eslint-disable-line no-useless-escape\nexport const ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\nexport const IS_ALLOWED_URI = seal(\n  /^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nexport const IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nexport const ATTR_WHITESPACE = seal(\n  /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nexport const DOCTYPE_NAME = seal(/^html$/i);\nexport const CUSTOM_ELEMENT = seal(/^[a-z][.\\w]*(-[.\\w]+)+$/i);\n","/* eslint-disable @typescript-eslint/indent */\n\nimport type {\n  TrustedHTML,\n  TrustedTypesWindow,\n} from 'trusted-types/lib/index.js';\nimport type { Config, UseProfilesConfig } from './config';\nimport * as TAGS from './tags.js';\nimport * as ATTRS from './attrs.js';\nimport * as EXPRESSIONS from './regexp.js';\nimport {\n  addToSet,\n  clone,\n  entries,\n  freeze,\n  arrayForEach,\n  arrayLastIndexOf,\n  arrayPop,\n  arrayPush,\n  arraySplice,\n  stringMatch,\n  stringReplace,\n  stringToLowerCase,\n  stringToString,\n  stringIndexOf,\n  stringTrim,\n  regExpTest,\n  typeErrorCreate,\n  lookupGetter,\n  create,\n  objectHasOwnProperty,\n} from './utils.js';\n\nexport type { Config } from './config';\n\ndeclare const VERSION: string;\n\n// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\nconst NODE_TYPE = {\n  element: 1,\n  attribute: 2,\n  text: 3,\n  cdataSection: 4,\n  entityReference: 5, // Deprecated\n  entityNode: 6, // Deprecated\n  progressingInstruction: 7,\n  comment: 8,\n  document: 9,\n  documentType: 10,\n  documentFragment: 11,\n  notation: 12, // Deprecated\n};\n\nconst getGlobal = function (): WindowLike {\n  return typeof window === 'undefined' ? null : window;\n};\n\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param trustedTypes The policy factory.\n * @param purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\nconst _createTrustedTypesPolicy = function (\n  trustedTypes: TrustedTypePolicyFactory,\n  purifyHostElement: HTMLScriptElement\n) {\n  if (\n    typeof trustedTypes !== 'object' ||\n    typeof trustedTypes.createPolicy !== 'function'\n  ) {\n    return null;\n  }\n\n  // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      },\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn(\n      'TrustedTypes policy ' + policyName + ' could not be created.'\n    );\n    return null;\n  }\n};\n\nconst _createHooksMap = function (): HooksMap {\n  return {\n    afterSanitizeAttributes: [],\n    afterSanitizeElements: [],\n    afterSanitizeShadowDOM: [],\n    beforeSanitizeAttributes: [],\n    beforeSanitizeElements: [],\n    beforeSanitizeShadowDOM: [],\n    uponSanitizeAttribute: [],\n    uponSanitizeElement: [],\n    uponSanitizeShadowNode: [],\n  };\n};\n\nfunction createDOMPurify(window: WindowLike = getGlobal()): DOMPurify {\n  const DOMPurify: DOMPurify = (root: WindowLike) => createDOMPurify(root);\n\n  DOMPurify.version = VERSION;\n\n  DOMPurify.removed = [];\n\n  if (\n    !window ||\n    !window.document ||\n    window.document.nodeType !== NODE_TYPE.document ||\n    !window.Element\n  ) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n\n    return DOMPurify;\n  }\n\n  let { document } = window;\n\n  const originalDocument = document;\n  const currentScript: HTMLScriptElement =\n    originalDocument.currentScript as HTMLScriptElement;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || (window as any).MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes,\n  } = window;\n\n  const ElementPrototype = Element.prototype;\n\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const remove = lookupGetter(ElementPrototype, 'remove');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode');\n\n  // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName,\n  } = document;\n  const { importNode } = originalDocument;\n\n  let hooks = _createHooksMap();\n\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  DOMPurify.isSupported =\n    typeof entries === 'function' &&\n    typeof getParentNode === 'function' &&\n    implementation &&\n    implementation.createHTMLDocument !== undefined;\n\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE,\n    CUSTOM_ELEMENT,\n  } = EXPRESSIONS;\n\n  let { IS_ALLOWED_URI } = EXPRESSIONS;\n\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n\n  /* allowed element names */\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [\n    ...TAGS.html,\n    ...TAGS.svg,\n    ...TAGS.svgFilters,\n    ...TAGS.mathMl,\n    ...TAGS.text,\n  ]);\n\n  /* Allowed attribute names */\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [\n    ...ATTRS.html,\n    ...ATTRS.svg,\n    ...ATTRS.mathMl,\n    ...ATTRS.xml,\n  ]);\n\n  /*\n   * Configure how DOMPurify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(\n    create(null, {\n      tagNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      attributeNameCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      allowCustomizedBuiltInElements: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: false,\n      },\n    })\n  );\n\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n  let FORBID_TAGS = null;\n\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n  let FORBID_ATTR = null;\n\n  /* Config object to store ADD_TAGS/ADD_ATTR functions (when used as functions) */\n  const EXTRA_ELEMENT_HANDLING = Object.seal(\n    create(null, {\n      tagCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n      attributeCheck: {\n        writable: true,\n        configurable: false,\n        enumerable: true,\n        value: null,\n      },\n    })\n  );\n\n  /* Decide if ARIA attributes are okay */\n  let ALLOW_ARIA_ATTR = true;\n\n  /* Decide if custom data attributes are okay */\n  let ALLOW_DATA_ATTR = true;\n\n  /* Decide if unknown protocols are okay */\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n  let SAFE_FOR_TEMPLATES = false;\n\n  /* Output should be safe even for XML used within HTML and alike.\n   * This means, DOMPurify removes comments when containing risky content.\n   */\n  let SAFE_FOR_XML = true;\n\n  /* Decide if document with <html>... should be returned */\n  let WHOLE_DOCUMENT = false;\n\n  /* Track whether config is already set on this instance of DOMPurify. */\n  let SET_CONFIG = false;\n\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n  let FORCE_BODY = false;\n\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n  let RETURN_DOM = false;\n\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n  let RETURN_DOM_FRAGMENT = false;\n\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n  let RETURN_TRUSTED_TYPE = false;\n\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n  let SANITIZE_DOM = true;\n\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n\n  /* Keep element content when removing element? */\n  let KEEP_CONTENT = true;\n\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n  let IN_PLACE = false;\n\n  /* Allow usage of profiles like html, svg and mathMl */\n  let USE_PROFILES: UseProfilesConfig | false = {};\n\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, [\n    'annotation-xml',\n    'audio',\n    'colgroup',\n    'desc',\n    'foreignobject',\n    'head',\n    'iframe',\n    'math',\n    'mi',\n    'mn',\n    'mo',\n    'ms',\n    'mtext',\n    'noembed',\n    'noframes',\n    'noscript',\n    'plaintext',\n    'script',\n    'style',\n    'svg',\n    'template',\n    'thead',\n    'title',\n    'video',\n    'xmp',\n  ]);\n\n  /* Tags that are safe for data: URIs */\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, [\n    'audio',\n    'video',\n    'img',\n    'source',\n    'image',\n    'track',\n  ]);\n\n  /* Attributes safe for values like \"javascript:\" */\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, [\n    'alt',\n    'class',\n    'for',\n    'id',\n    'label',\n    'name',\n    'pattern',\n    'placeholder',\n    'role',\n    'summary',\n    'title',\n    'value',\n    'style',\n    'xmlns',\n  ]);\n\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n\n  /* Allowed XHTML+XML namespaces */\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet(\n    {},\n    [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE],\n    stringToString\n  );\n\n  let MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, [\n    'mi',\n    'mo',\n    'mn',\n    'ms',\n    'mtext',\n  ]);\n\n  let HTML_INTEGRATION_POINTS = addToSet({}, ['annotation-xml']);\n\n  // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, [\n    'title',\n    'style',\n    'font',\n    'a',\n    'script',\n  ]);\n\n  /* Parsing of strict XHTML documents */\n  let PARSER_MEDIA_TYPE: null | DOMParserSupportedType = null;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc: null | Parameters<typeof addToSet>[2] = null;\n\n  /* Keep a reference to config to pass to hooks */\n  let CONFIG: Config | null = null;\n\n  /* Ideally, do not touch anything below this line */\n  /* ______________________________________________ */\n\n  const formElement = document.createElement('form');\n\n  const isRegexOrFunction = function (\n    testValue: unknown\n  ): testValue is Function | RegExp {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n\n  /**\n   * _parseConfig\n   *\n   * @param cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n  const _parseConfig = function (cfg: Config = {}): void {\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n\n    /* Shield configuration object from tampering */\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n\n    /* Shield configuration object from prototype pollution */\n    cfg = clone(cfg);\n\n    PARSER_MEDIA_TYPE =\n      // eslint-disable-next-line unicorn/prefer-includes\n      SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1\n        ? DEFAULT_PARSER_MEDIA_TYPE\n        : cfg.PARSER_MEDIA_TYPE;\n\n    // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n    transformCaseFunc =\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml'\n        ? stringToString\n        : stringToLowerCase;\n\n    /* Set configuration parameters */\n    ALLOWED_TAGS = objectHasOwnProperty(cfg, 'ALLOWED_TAGS')\n      ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc)\n      : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = objectHasOwnProperty(cfg, 'ALLOWED_ATTR')\n      ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc)\n      : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = objectHasOwnProperty(cfg, 'ALLOWED_NAMESPACES')\n      ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString)\n      : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = objectHasOwnProperty(cfg, 'ADD_URI_SAFE_ATTR')\n      ? addToSet(\n          clone(DEFAULT_URI_SAFE_ATTRIBUTES),\n          cfg.ADD_URI_SAFE_ATTR,\n          transformCaseFunc\n        )\n      : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = objectHasOwnProperty(cfg, 'ADD_DATA_URI_TAGS')\n      ? addToSet(\n          clone(DEFAULT_DATA_URI_TAGS),\n          cfg.ADD_DATA_URI_TAGS,\n          transformCaseFunc\n        )\n      : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = objectHasOwnProperty(cfg, 'FORBID_CONTENTS')\n      ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc)\n      : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = objectHasOwnProperty(cfg, 'FORBID_TAGS')\n      ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc)\n      : clone({});\n    FORBID_ATTR = objectHasOwnProperty(cfg, 'FORBID_ATTR')\n      ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc)\n      : clone({});\n    USE_PROFILES = objectHasOwnProperty(cfg, 'USE_PROFILES')\n      ? cfg.USE_PROFILES\n      : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n    SAFE_FOR_XML = cfg.SAFE_FOR_XML !== false; // Default true\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n    IS_ALLOWED_URI = cfg.ALLOWED_URI_REGEXP || EXPRESSIONS.IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    MATHML_TEXT_INTEGRATION_POINTS =\n      cfg.MATHML_TEXT_INTEGRATION_POINTS || MATHML_TEXT_INTEGRATION_POINTS;\n    HTML_INTEGRATION_POINTS =\n      cfg.HTML_INTEGRATION_POINTS || HTML_INTEGRATION_POINTS;\n\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)\n    ) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck =\n        cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)\n    ) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck =\n        cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n\n    if (\n      cfg.CUSTOM_ELEMENT_HANDLING &&\n      typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements ===\n        'boolean'\n    ) {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements =\n        cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n\n    /* Parse profile info */\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, TAGS.text);\n      ALLOWED_ATTR = [];\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, TAGS.html);\n        addToSet(ALLOWED_ATTR, ATTRS.html);\n      }\n\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, TAGS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, TAGS.svgFilters);\n        addToSet(ALLOWED_ATTR, ATTRS.svg);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, TAGS.mathMl);\n        addToSet(ALLOWED_ATTR, ATTRS.mathMl);\n        addToSet(ALLOWED_ATTR, ATTRS.xml);\n      }\n    }\n\n    /* Merge configuration parameters */\n    if (cfg.ADD_TAGS) {\n      if (typeof cfg.ADD_TAGS === 'function') {\n        EXTRA_ELEMENT_HANDLING.tagCheck = cfg.ADD_TAGS;\n      } else {\n        if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n          ALLOWED_TAGS = clone(ALLOWED_TAGS);\n        }\n\n        addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n      }\n    }\n\n    if (cfg.ADD_ATTR) {\n      if (typeof cfg.ADD_ATTR === 'function') {\n        EXTRA_ELEMENT_HANDLING.attributeCheck = cfg.ADD_ATTR;\n      } else {\n        if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n          ALLOWED_ATTR = clone(ALLOWED_ATTR);\n        }\n\n        addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n      }\n    }\n\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n\n    if (cfg.ADD_FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n\n      addToSet(FORBID_CONTENTS, cfg.ADD_FORBID_CONTENTS, transformCaseFunc);\n    }\n\n    /* Add #text in case KEEP_CONTENT is set to true */\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate(\n          'TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.'\n        );\n      }\n\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate(\n          'TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.'\n        );\n      }\n\n      // Overwrite existing TrustedTypes policy.\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY;\n\n      // Sign local variables required by `sanitize`.\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(\n          trustedTypes,\n          currentScript\n        );\n      }\n\n      // If creating the internal policy succeeded sign internal variables.\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    }\n\n    // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n    if (freeze) {\n      freeze(cfg);\n    }\n\n    CONFIG = cfg;\n  };\n\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n  const ALL_SVG_TAGS = addToSet({}, [\n    ...TAGS.svg,\n    ...TAGS.svgFilters,\n    ...TAGS.svgDisallowed,\n  ]);\n  const ALL_MATHML_TAGS = addToSet({}, [\n    ...TAGS.mathMl,\n    ...TAGS.mathMlDisallowed,\n  ]);\n\n  /**\n   * @param element a DOM element whose namespace is being checked\n   * @returns Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n  const _checkValidNamespace = function (element: Element): boolean {\n    let parent = getParentNode(element);\n\n    // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template',\n      };\n    }\n\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      }\n\n      // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return (\n          tagName === 'svg' &&\n          (parentTagName === 'annotation-xml' ||\n            MATHML_TEXT_INTEGRATION_POINTS[parentTagName])\n        );\n      }\n\n      // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      }\n\n      // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      }\n\n      // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (\n        parent.namespaceURI === SVG_NAMESPACE &&\n        !HTML_INTEGRATION_POINTS[parentTagName]\n      ) {\n        return false;\n      }\n\n      if (\n        parent.namespaceURI === MATHML_NAMESPACE &&\n        !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]\n      ) {\n        return false;\n      }\n\n      // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n      return (\n        !ALL_MATHML_TAGS[tagName] &&\n        (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName])\n      );\n    }\n\n    // For XHTML and XML documents that support custom namespaces\n    if (\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml' &&\n      ALLOWED_NAMESPACES[element.namespaceURI]\n    ) {\n      return true;\n    }\n\n    // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n    return false;\n  };\n\n  /**\n   * _forceRemove\n   *\n   * @param node a DOM node\n   */\n  const _forceRemove = function (node: Node): void {\n    arrayPush(DOMPurify.removed, { element: node });\n\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      getParentNode(node).removeChild(node);\n    } catch (_) {\n      remove(node);\n    }\n  };\n\n  /**\n   * _removeAttribute\n   *\n   * @param name an Attribute name\n   * @param element a DOM node\n   */\n  const _removeAttribute = function (name: string, element: Element): void {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: element.getAttributeNode(name),\n        from: element,\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: element,\n      });\n    }\n\n    element.removeAttribute(name);\n\n    // We void attribute values for unremovable \"is\" attributes\n    if (name === 'is') {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(element);\n        } catch (_) {}\n      } else {\n        try {\n          element.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n\n  /**\n   * _initDocument\n   *\n   * @param dirty - a string of dirty markup\n   * @return a DOM, filled with the dirty markup\n   */\n  const _initDocument = function (dirty: string): Document {\n    /* Create a HTML document */\n    let doc = null;\n    let leadingWhitespace = null;\n\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n\n    if (\n      PARSER_MEDIA_TYPE === 'application/xhtml+xml' &&\n      NAMESPACE === HTML_NAMESPACE\n    ) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty =\n        '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' +\n        dirty +\n        '</body></html>';\n    }\n\n    const dirtyPayload = trustedTypesPolicy\n      ? trustedTypesPolicy.createHTML(dirty)\n      : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n\n    /* Use createHTMLDocument in case DOMParser is not available */\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT\n          ? emptyHTML\n          : dirtyPayload;\n      } catch (_) {\n        // Syntax error if dirtyPayload is invalid xml\n      }\n    }\n\n    const body = doc.body || doc.documentElement;\n\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(\n        document.createTextNode(leadingWhitespace),\n        body.childNodes[0] || null\n      );\n    }\n\n    /* Work on whole document or just its body */\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(\n        doc,\n        WHOLE_DOCUMENT ? 'html' : 'body'\n      )[0];\n    }\n\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n\n  /**\n   * Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n   *\n   * @param root The root element or node to start traversing on.\n   * @return The created NodeIterator\n   */\n  const _createNodeIterator = function (root: Node): NodeIterator {\n    return createNodeIterator.call(\n      root.ownerDocument || root,\n      root,\n      // eslint-disable-next-line no-bitwise\n      NodeFilter.SHOW_ELEMENT |\n        NodeFilter.SHOW_COMMENT |\n        NodeFilter.SHOW_TEXT |\n        NodeFilter.SHOW_PROCESSING_INSTRUCTION |\n        NodeFilter.SHOW_CDATA_SECTION,\n      null\n    );\n  };\n\n  /**\n   * _isClobbered\n   *\n   * @param element element to check for clobbering attacks\n   * @return true if clobbered, false if safe\n   */\n  const _isClobbered = function (element: Element): boolean {\n    return (\n      element instanceof HTMLFormElement &&\n      (typeof element.nodeName !== 'string' ||\n        typeof element.textContent !== 'string' ||\n        typeof element.removeChild !== 'function' ||\n        !(element.attributes instanceof NamedNodeMap) ||\n        typeof element.removeAttribute !== 'function' ||\n        typeof element.setAttribute !== 'function' ||\n        typeof element.namespaceURI !== 'string' ||\n        typeof element.insertBefore !== 'function' ||\n        typeof element.hasChildNodes !== 'function')\n    );\n  };\n\n  /**\n   * Checks whether the given object is a DOM node.\n   *\n   * @param value object to check whether it's a DOM node\n   * @return true is object is a DOM node\n   */\n  const _isNode = function (value: unknown): value is Node {\n    return typeof Node === 'function' && value instanceof Node;\n  };\n\n  function _executeHooks<T extends HookFunction>(\n    hooks: HookFunction[],\n    currentNode: Parameters<T>[0],\n    data: Parameters<T>[1]\n  ): void {\n    arrayForEach(hooks, (hook: T) => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  }\n\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   * @param currentNode to check for permission to exist\n   * @return true if node was killed, false if left alive\n   */\n  const _sanitizeElements = function (currentNode: any): boolean {\n    let content = null;\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeElements, currentNode, null);\n\n    /* Check if element is clobbered or can clobber */\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Now let's check the element's type and name */\n    const tagName = transformCaseFunc(currentNode.nodeName);\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.uponSanitizeElement, currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS,\n    });\n\n    /* Detect mXSS attempts abusing namespace confusion */\n    if (\n      SAFE_FOR_XML &&\n      currentNode.hasChildNodes() &&\n      !_isNode(currentNode.firstElementChild) &&\n      regExpTest(/<[/\\w!]/g, currentNode.innerHTML) &&\n      regExpTest(/<[/\\w!]/g, currentNode.textContent)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove any occurrence of processing instructions */\n    if (currentNode.nodeType === NODE_TYPE.progressingInstruction) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove any kind of possibly harmful comments */\n    if (\n      SAFE_FOR_XML &&\n      currentNode.nodeType === NODE_TYPE.comment &&\n      regExpTest(/<[/\\w]/g, currentNode.data)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Remove element if anything forbids its presence */\n    if (\n      !(\n        EXTRA_ELEMENT_HANDLING.tagCheck instanceof Function &&\n        EXTRA_ELEMENT_HANDLING.tagCheck(tagName)\n      ) &&\n      (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName])\n    ) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _isBasicCustomElement(tagName)) {\n        if (\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n          regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)\n        ) {\n          return false;\n        }\n\n        if (\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n          CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)\n        ) {\n          return false;\n        }\n      }\n\n      /* Keep content except for bad-listed elements */\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n\n          for (let i = childCount - 1; i >= 0; --i) {\n            const childClone = cloneNode(childNodes[i], true);\n            childClone.__removalCount = (currentNode.__removalCount || 0) + 1;\n            parentNode.insertBefore(childClone, getNextSibling(currentNode));\n          }\n        }\n      }\n\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Check whether element has a valid namespace */\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n    if (\n      (tagName === 'noscript' ||\n        tagName === 'noembed' ||\n        tagName === 'noframes') &&\n      regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)\n    ) {\n      _forceRemove(currentNode);\n      return true;\n    }\n\n    /* Sanitize element content to be template-safe */\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === NODE_TYPE.text) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr: RegExp) => {\n        content = stringReplace(content, expr, ' ');\n      });\n\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, { element: currentNode.cloneNode() });\n        currentNode.textContent = content;\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeElements, currentNode, null);\n\n    return false;\n  };\n\n  /**\n   * _isValidAttribute\n   *\n   * @param lcTag Lowercase tag name of containing element.\n   * @param lcName Lowercase attribute name.\n   * @param value Attribute value.\n   * @return Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n  const _isValidAttribute = function (\n    lcTag: string,\n    lcName: string,\n    value: string\n  ): boolean {\n    /* Make sure attribute cannot clobber */\n    if (\n      SANITIZE_DOM &&\n      (lcName === 'id' || lcName === 'name') &&\n      (value in document || value in formElement)\n    ) {\n      return false;\n    }\n\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n    if (\n      ALLOW_DATA_ATTR &&\n      !FORBID_ATTR[lcName] &&\n      regExpTest(DATA_ATTR, lcName)\n    ) {\n      // This attribute is safe\n    } else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) {\n      // This attribute is safe\n      /* Check if ADD_ATTR function allows this attribute */\n    } else if (\n      EXTRA_ELEMENT_HANDLING.attributeCheck instanceof Function &&\n      EXTRA_ELEMENT_HANDLING.attributeCheck(lcName, lcTag)\n    ) {\n      // This attribute is safe\n      /* Otherwise, check the name is permitted */\n    } else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if (\n        // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n        // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n        (_isBasicCustomElement(lcTag) &&\n          ((CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag)) ||\n            (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag))) &&\n          ((CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName)) ||\n            (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName, lcTag)))) ||\n        // Alternative, second condition checks if it's an `is`-attribute, AND\n        // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n        (lcName === 'is' &&\n          CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements &&\n          ((CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp &&\n            regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value)) ||\n            (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function &&\n              CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))))\n      ) {\n        // If user has supplied a regexp or function in CUSTOM_ELEMENT_HANDLING.tagNameCheck, we need to also allow derived custom elements using the same tagName test.\n        // Additionally, we need to allow attributes passing the CUSTOM_ELEMENT_HANDLING.attributeNameCheck user has configured, as custom elements can define these at their own discretion.\n      } else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) {\n      // This attribute is safe\n      /* Check no script, data or unknown possibly unsafe URI\n        unless we know URI values are safe for that attribute */\n    } else if (\n      regExpTest(IS_ALLOWED_URI, stringReplace(value, ATTR_WHITESPACE, ''))\n    ) {\n      // This attribute is safe\n      /* Keep image data URIs alive if src/xlink:href is allowed */\n      /* Further prevent gadget XSS for dynamically built script tags */\n    } else if (\n      (lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') &&\n      lcTag !== 'script' &&\n      stringIndexOf(value, 'data:') === 0 &&\n      DATA_URI_TAGS[lcTag]\n    ) {\n      // This attribute is safe\n      /* Allow unknown protocols: This provides support for links that\n        are handled by protocol handlers which may be unknown ahead of\n        time, e.g. fb:, spotify: */\n    } else if (\n      ALLOW_UNKNOWN_PROTOCOLS &&\n      !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))\n    ) {\n      // This attribute is safe\n      /* Check for binary attributes */\n    } else if (value) {\n      return false;\n    } else {\n      // Binary attributes are safe at this point\n      /* Anything else, presume unsafe, do not add it back */\n    }\n\n    return true;\n  };\n\n  /**\n   * _isBasicCustomElement\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   *\n   * @param tagName name of the tag of the node to sanitize\n   * @returns Returns true if the tag name meets the basic criteria for a custom element, otherwise false.\n   */\n  const _isBasicCustomElement = function (tagName: string): RegExpMatchArray {\n    return tagName !== 'annotation-xml' && stringMatch(tagName, CUSTOM_ELEMENT);\n  };\n\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param currentNode to sanitize\n   */\n  const _sanitizeAttributes = function (currentNode: Element): void {\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeAttributes, currentNode, null);\n\n    const { attributes } = currentNode;\n\n    /* Check if we have attributes; if not we might have a text node */\n    if (!attributes || _isClobbered(currentNode)) {\n      return;\n    }\n\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR,\n      forceKeepAttr: undefined,\n    };\n    let l = attributes.length;\n\n    /* Go backwards over all attributes; safely remove bad ones */\n    while (l--) {\n      const attr = attributes[l];\n      const { name, namespaceURI, value: attrValue } = attr;\n      const lcName = transformCaseFunc(name);\n\n      const initValue = attrValue;\n      let value = name === 'value' ? initValue : stringTrim(initValue);\n\n      /* Execute a hook if present */\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n      _executeHooks(hooks.uponSanitizeAttribute, currentNode, hookEvent);\n      value = hookEvent.attrValue;\n\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode);\n\n        // Prefix the value and later re-create the attribute with the sanitized value\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n\n      /* Work around a security issue with comments inside attributes */\n      if (\n        SAFE_FOR_XML &&\n        regExpTest(/((--!?|])>)|<\\/(style|title|textarea)/i, value)\n      ) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Make sure we cannot easily use animated hrefs, even if animations are allowed */\n      if (lcName === 'attributename' && stringMatch(value, 'href')) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Did the hooks approve of the attribute? */\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n\n      /* Did the hooks approve of the attribute? */\n      if (!hookEvent.keepAttr) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Work around a security issue in jQuery 3.0 */\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Sanitize attribute content to be template-safe */\n      if (SAFE_FOR_TEMPLATES) {\n        arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr: RegExp) => {\n          value = stringReplace(value, expr, ' ');\n        });\n      }\n\n      /* Is `value` valid for this attribute? */\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        _removeAttribute(name, currentNode);\n        continue;\n      }\n\n      /* Handle attributes that require Trusted Types */\n      if (\n        trustedTypesPolicy &&\n        typeof trustedTypes === 'object' &&\n        typeof trustedTypes.getAttributeType === 'function'\n      ) {\n        if (namespaceURI) {\n          /* Namespaces are not yet supported, see https://bugs.chromium.org/p/chromium/issues/detail?id=1305293 */\n        } else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML': {\n              value = trustedTypesPolicy.createHTML(value);\n              break;\n            }\n\n            case 'TrustedScriptURL': {\n              value = trustedTypesPolicy.createScriptURL(value);\n              break;\n            }\n\n            default: {\n              break;\n            }\n          }\n        }\n      }\n\n      /* Handle invalid data-* attribute set by try-catching it */\n      if (value !== initValue) {\n        try {\n          if (namespaceURI) {\n            currentNode.setAttributeNS(namespaceURI, name, value);\n          } else {\n            /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n            currentNode.setAttribute(name, value);\n          }\n\n          if (_isClobbered(currentNode)) {\n            _forceRemove(currentNode);\n          } else {\n            arrayPop(DOMPurify.removed);\n          }\n        } catch (_) {\n          _removeAttribute(name, currentNode);\n        }\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeAttributes, currentNode, null);\n  };\n\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param fragment to iterate over recursively\n   */\n  const _sanitizeShadowDOM = function (fragment: DocumentFragment): void {\n    let shadowNode = null;\n    const shadowIterator = _createNodeIterator(fragment);\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.beforeSanitizeShadowDOM, fragment, null);\n\n    while ((shadowNode = shadowIterator.nextNode())) {\n      /* Execute a hook if present */\n      _executeHooks(hooks.uponSanitizeShadowNode, shadowNode, null);\n\n      /* Sanitize tags and elements */\n      _sanitizeElements(shadowNode);\n\n      /* Check attributes next */\n      _sanitizeAttributes(shadowNode);\n\n      /* Deep shadow DOM detected */\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n    }\n\n    /* Execute a hook if present */\n    _executeHooks(hooks.afterSanitizeShadowDOM, fragment, null);\n  };\n\n  // eslint-disable-next-line complexity\n  DOMPurify.sanitize = function (dirty, cfg = {}) {\n    let body = null;\n    let importedNode = null;\n    let currentNode = null;\n    let returnNode = null;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n    IS_EMPTY_INPUT = !dirty;\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n\n    /* Stringify, in case dirty is an object */\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n\n    /* Return dirty HTML if DOMPurify cannot run */\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n\n    /* Assign config vars */\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n\n    /* Clean up removed elements */\n    DOMPurify.removed = [];\n\n    /* Check if dirty is correctly typed for IN_PLACE */\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if ((dirty as Node).nodeName) {\n        const tagName = transformCaseFunc((dirty as Node).nodeName);\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate(\n            'root node is forbidden and cannot be sanitized in-place'\n          );\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n      if (\n        importedNode.nodeType === NODE_TYPE.element &&\n        importedNode.nodeName === 'BODY'\n      ) {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (\n        !RETURN_DOM &&\n        !SAFE_FOR_TEMPLATES &&\n        !WHOLE_DOCUMENT &&\n        // eslint-disable-next-line unicorn/prefer-includes\n        dirty.indexOf('<') === -1\n      ) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE\n          ? trustedTypesPolicy.createHTML(dirty)\n          : dirty;\n      }\n\n      /* Initialize the document to work on */\n      body = _initDocument(dirty);\n\n      /* Check we have a DOM node from the data */\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n\n    /* Remove first element node (ours) if FORCE_BODY is set */\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n\n    /* Get node iterator */\n    const nodeIterator = _createNodeIterator(IN_PLACE ? dirty : body);\n\n    /* Now start iterating over the created document */\n    while ((currentNode = nodeIterator.nextNode())) {\n      /* Sanitize tags and elements */\n      _sanitizeElements(currentNode);\n\n      /* Check attributes next */\n      _sanitizeAttributes(currentNode);\n\n      /* Shadow DOM detected, sanitize it */\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n    }\n\n    /* If we sanitized `dirty` in-place, return it. */\n    if (IN_PLACE) {\n      return dirty;\n    }\n\n    /* Return sanitized string or DOM */\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n\n      return returnNode;\n    }\n\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n\n    /* Serialize doctype if allowed */\n    if (\n      WHOLE_DOCUMENT &&\n      ALLOWED_TAGS['!doctype'] &&\n      body.ownerDocument &&\n      body.ownerDocument.doctype &&\n      body.ownerDocument.doctype.name &&\n      regExpTest(EXPRESSIONS.DOCTYPE_NAME, body.ownerDocument.doctype.name)\n    ) {\n      serializedHTML =\n        '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n\n    /* Sanitize final string template-safe */\n    if (SAFE_FOR_TEMPLATES) {\n      arrayForEach([MUSTACHE_EXPR, ERB_EXPR, TMPLIT_EXPR], (expr: RegExp) => {\n        serializedHTML = stringReplace(serializedHTML, expr, ' ');\n      });\n    }\n\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE\n      ? trustedTypesPolicy.createHTML(serializedHTML)\n      : serializedHTML;\n  };\n\n  DOMPurify.setConfig = function (cfg = {}) {\n    _parseConfig(cfg);\n    SET_CONFIG = true;\n  };\n\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n\n  DOMPurify.addHook = function (\n    entryPoint: keyof HooksMap,\n    hookFunction: HookFunction\n  ) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n\n  DOMPurify.removeHook = function (\n    entryPoint: keyof HooksMap,\n    hookFunction: HookFunction\n  ) {\n    if (hookFunction !== undefined) {\n      const index = arrayLastIndexOf(hooks[entryPoint], hookFunction);\n\n      return index === -1\n        ? undefined\n        : arraySplice(hooks[entryPoint], index, 1)[0];\n    }\n\n    return arrayPop(hooks[entryPoint]);\n  };\n\n  DOMPurify.removeHooks = function (entryPoint: keyof HooksMap) {\n    hooks[entryPoint] = [];\n  };\n\n  DOMPurify.removeAllHooks = function () {\n    hooks = _createHooksMap();\n  };\n\n  return DOMPurify;\n}\n\nexport default createDOMPurify();\n\nexport interface DOMPurify {\n  /**\n   * Creates a DOMPurify instance using the given window-like object. Defaults to `window`.\n   */\n  (root?: WindowLike): DOMPurify;\n\n  /**\n   * Version label, exposed for easier checks\n   * if DOMPurify is up to date or not\n   */\n  version: string;\n\n  /**\n   * Array of elements that DOMPurify removed during sanitation.\n   * Empty if nothing was removed.\n   */\n  removed: Array<RemovedElement | RemovedAttribute>;\n\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n  isSupported: boolean;\n\n  /**\n   * Set the configuration once.\n   *\n   * @param cfg configuration object\n   */\n  setConfig(cfg?: Config): void;\n\n  /**\n   * Removes the configuration.\n   */\n  clearConfig(): void;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized TrustedHTML.\n   */\n  sanitize(\n    dirty: string | Node,\n    cfg: Config & { RETURN_TRUSTED_TYPE: true }\n  ): TrustedHTML;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty DOM node\n   * @param cfg object\n   * @returns Sanitized DOM node.\n   */\n  sanitize(dirty: Node, cfg: Config & { IN_PLACE: true }): Node;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized DOM node.\n   */\n  sanitize(dirty: string | Node, cfg: Config & { RETURN_DOM: true }): Node;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized document fragment.\n   */\n  sanitize(\n    dirty: string | Node,\n    cfg: Config & { RETURN_DOM_FRAGMENT: true }\n  ): DocumentFragment;\n\n  /**\n   * Provides core sanitation functionality.\n   *\n   * @param dirty string or DOM node\n   * @param cfg object\n   * @returns Sanitized string.\n   */\n  sanitize(dirty: string | Node, cfg?: Config): string;\n\n  /**\n   * Checks if an attribute value is valid.\n   * Uses last set config, if any. Otherwise, uses config defaults.\n   *\n   * @param tag Tag name of containing element.\n   * @param attr Attribute name.\n   * @param value Attribute value.\n   * @returns Returns true if `value` is valid. Otherwise, returns false.\n   */\n  isValidAttribute(tag: string, attr: string, value: string): boolean;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(entryPoint: BasicHookName, hookFunction: NodeHook): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(entryPoint: ElementHookName, hookFunction: ElementHook): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: DocumentFragmentHookName,\n    hookFunction: DocumentFragmentHook\n  ): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: 'uponSanitizeElement',\n    hookFunction: UponSanitizeElementHook\n  ): void;\n\n  /**\n   * Adds a DOMPurify hook.\n   *\n   * @param entryPoint entry point for the hook to add\n   * @param hookFunction function to execute\n   */\n  addHook(\n    entryPoint: 'uponSanitizeAttribute',\n    hookFunction: UponSanitizeAttributeHook\n  ): void;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: BasicHookName,\n    hookFunction?: NodeHook\n  ): NodeHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: ElementHookName,\n    hookFunction?: ElementHook\n  ): ElementHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: DocumentFragmentHookName,\n    hookFunction?: DocumentFragmentHook\n  ): DocumentFragmentHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: 'uponSanitizeElement',\n    hookFunction?: UponSanitizeElementHook\n  ): UponSanitizeElementHook | undefined;\n\n  /**\n   * Remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if hook not specified)\n   *\n   * @param entryPoint entry point for the hook to remove\n   * @param hookFunction optional specific hook to remove\n   * @returns removed hook\n   */\n  removeHook(\n    entryPoint: 'uponSanitizeAttribute',\n    hookFunction?: UponSanitizeAttributeHook\n  ): UponSanitizeAttributeHook | undefined;\n\n  /**\n   * Removes all DOMPurify hooks at a given entryPoint\n   *\n   * @param entryPoint entry point for the hooks to remove\n   */\n  removeHooks(entryPoint: HookName): void;\n\n  /**\n   * Removes all DOMPurify hooks.\n   */\n  removeAllHooks(): void;\n}\n\n/**\n * An element removed by DOMPurify.\n */\nexport interface RemovedElement {\n  /**\n   * The element that was removed.\n   */\n  element: Node;\n}\n\n/**\n * An element removed by DOMPurify.\n */\nexport interface RemovedAttribute {\n  /**\n   * The attribute that was removed.\n   */\n  attribute: Attr | null;\n\n  /**\n   * The element that the attribute was removed.\n   */\n  from: Node;\n}\n\ntype BasicHookName =\n  | 'beforeSanitizeElements'\n  | 'afterSanitizeElements'\n  | 'uponSanitizeShadowNode';\ntype ElementHookName = 'beforeSanitizeAttributes' | 'afterSanitizeAttributes';\ntype DocumentFragmentHookName =\n  | 'beforeSanitizeShadowDOM'\n  | 'afterSanitizeShadowDOM';\ntype UponSanitizeElementHookName = 'uponSanitizeElement';\ntype UponSanitizeAttributeHookName = 'uponSanitizeAttribute';\n\ninterface HooksMap {\n  beforeSanitizeElements: NodeHook[];\n  afterSanitizeElements: NodeHook[];\n  beforeSanitizeShadowDOM: DocumentFragmentHook[];\n  uponSanitizeShadowNode: NodeHook[];\n  afterSanitizeShadowDOM: DocumentFragmentHook[];\n  beforeSanitizeAttributes: ElementHook[];\n  afterSanitizeAttributes: ElementHook[];\n  uponSanitizeElement: UponSanitizeElementHook[];\n  uponSanitizeAttribute: UponSanitizeAttributeHook[];\n}\n\ntype ArrayElement<T> = T extends Array<infer U> ? U : never;\n\ntype HookFunction = ArrayElement<HooksMap[keyof HooksMap]>;\n\nexport type HookName =\n  | BasicHookName\n  | ElementHookName\n  | DocumentFragmentHookName\n  | UponSanitizeElementHookName\n  | UponSanitizeAttributeHookName;\n\nexport type NodeHook = (\n  this: DOMPurify,\n  currentNode: Node,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type ElementHook = (\n  this: DOMPurify,\n  currentNode: Element,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type DocumentFragmentHook = (\n  this: DOMPurify,\n  currentNode: DocumentFragment,\n  hookEvent: null,\n  config: Config\n) => void;\n\nexport type UponSanitizeElementHook = (\n  this: DOMPurify,\n  currentNode: Node,\n  hookEvent: UponSanitizeElementHookEvent,\n  config: Config\n) => void;\n\nexport type UponSanitizeAttributeHook = (\n  this: DOMPurify,\n  currentNode: Element,\n  hookEvent: UponSanitizeAttributeHookEvent,\n  config: Config\n) => void;\n\nexport interface UponSanitizeElementHookEvent {\n  tagName: string;\n  allowedTags: Record<string, boolean>;\n}\n\nexport interface UponSanitizeAttributeHookEvent {\n  attrName: string;\n  attrValue: string;\n  keepAttr: boolean;\n  allowedAttributes: Record<string, boolean>;\n  forceKeepAttr: boolean | undefined;\n}\n\n/**\n * A `Window`-like object containing the properties and types that DOMPurify requires.\n */\nexport type WindowLike = Pick<\n  typeof globalThis,\n  | 'DocumentFragment'\n  | 'HTMLTemplateElement'\n  | 'Node'\n  | 'Element'\n  | 'NodeFilter'\n  | 'NamedNodeMap'\n  | 'HTMLFormElement'\n  | 'DOMParser'\n> & {\n  document?: Document;\n  MozNamedAttrMap?: typeof window.NamedNodeMap;\n} & Pick<TrustedTypesWindow, 'trustedTypes'>;\n","/**\n * DocumentBlock - Simplified document display component\n *\n * Renders document content in markdown/html format with optional\n * \"Open in Canvas\" action for full editing.\n */\n\"use client\";\n\nimport DOMPurify from \"dompurify\";\nimport { memo, useMemo } from \"react\";\nimport type { UIElement } from \"@onegenui/core\";\n\nexport interface DocumentBlockProps {\n  /** Document title */\n  title: string;\n  /** Document content */\n  content: string;\n  /** Content format */\n  format?: \"markdown\" | \"html\" | \"text\";\n  /** Allow editing inline */\n  editable?: boolean;\n  /** Document ID for opening in Canvas */\n  documentId?: string;\n  /** Show \"Open in Canvas\" button */\n  showOpenInCanvas?: boolean;\n}\n\ninterface DocumentBlockComponentProps {\n  element: UIElement<\"Document\", DocumentBlockProps>;\n  onAction?: (action: { type: string; payload?: unknown }) => void;\n  renderText?: (\n    content: string,\n    options?: { markdown?: boolean },\n  ) => React.ReactNode;\n  loading?: boolean;\n}\n\nexport const DocumentBlock = memo(function DocumentBlock({\n  element,\n  onAction,\n  renderText,\n  loading,\n}: DocumentBlockComponentProps) {\n  const {\n    title,\n    content,\n    format = \"markdown\",\n    editable = false,\n    documentId,\n    showOpenInCanvas = true,\n  } = element.props;\n\n  const renderedContent = useMemo(() => {\n    if (format === \"html\") {\n      return (\n        <div\n          className=\"prose prose-invert max-w-none\"\n          dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(content) }}\n        />\n      );\n    }\n    if (format === \"markdown\" && renderText) {\n      return renderText(content, { markdown: true });\n    }\n    return <pre className=\"whitespace-pre-wrap text-sm\">{content}</pre>;\n  }, [content, format, renderText]);\n\n  const handleOpenInCanvas = () => {\n    onAction?.({\n      type: \"canvas:open\",\n      payload: {\n        documentId,\n        title,\n        content,\n        format,\n      },\n    });\n  };\n\n  if (loading) {\n    return (\n      <div className=\"w-full p-6 bg-zinc-900/50 rounded-xl border border-white/5 animate-pulse\">\n        <div className=\"h-6 w-1/3 bg-zinc-800 rounded mb-4\" />\n        <div className=\"space-y-2\">\n          <div className=\"h-4 bg-zinc-800 rounded w-full\" />\n          <div className=\"h-4 bg-zinc-800 rounded w-5/6\" />\n          <div className=\"h-4 bg-zinc-800 rounded w-4/6\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"document-block w-full bg-zinc-900/50 rounded-xl border border-white/5 overflow-hidden\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-white/5 bg-zinc-900/30\">\n        <div className=\"flex items-center gap-2\">\n          <svg\n            width=\"16\"\n            height=\"16\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            className=\"text-zinc-400\"\n          >\n            <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n            <polyline points=\"14 2 14 8 20 8\" />\n            <line x1=\"16\" x2=\"8\" y1=\"13\" y2=\"13\" />\n            <line x1=\"16\" x2=\"8\" y1=\"17\" y2=\"17\" />\n            <line x1=\"10\" x2=\"8\" y1=\"9\" y2=\"9\" />\n          </svg>\n          <h3 className=\"text-sm font-medium text-white\">{title}</h3>\n        </div>\n        {showOpenInCanvas && (\n          <button\n            onClick={handleOpenInCanvas}\n            className=\"flex items-center gap-1.5 px-2.5 py-1 text-xs text-zinc-400 hover:text-white bg-zinc-800 hover:bg-zinc-700 rounded-md transition-colors border-none cursor-pointer\"\n          >\n            <svg\n              width=\"12\"\n              height=\"12\"\n              viewBox=\"0 0 24 24\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            >\n              <path d=\"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\" />\n              <path d=\"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z\" />\n            </svg>\n            Open in Canvas\n          </button>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"p-4\">{renderedContent}</div>\n    </div>\n  );\n});\n\nexport default DocumentBlock;\n","/**\n * Selection Use Cases - Pure Business Logic\n * Extracted from provider.tsx for testability and reusability\n */\n\nimport type {\n  SelectedItem,\n  SelectableItemData,\n  DeepSelectionInfo,\n} from \"../contexts/selection/types\";\nimport type { DeepSelectionData } from \"../ports/selection.port\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Item Selection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Determine if an item should be added to or removed from selection\n */\nexport function computeToggleSelection(\n  currentSelection: SelectedItem[],\n  item: SelectedItem,\n): SelectedItem[] {\n  const isCurrentlySelected = currentSelection.some(\n    (s) => s.itemId === item.itemId && s.elementKey === item.elementKey,\n  );\n\n  if (isCurrentlySelected) {\n    return currentSelection.filter(\n      (s) => !(s.itemId === item.itemId && s.elementKey === item.elementKey),\n    );\n  }\n\n  return [...currentSelection, item];\n}\n\n/**\n * Add item to selection (no-op if already selected)\n */\nexport function computeAddSelection(\n  currentSelection: SelectedItem[],\n  item: SelectedItem,\n): SelectedItem[] {\n  const isCurrentlySelected = currentSelection.some(\n    (s) => s.itemId === item.itemId && s.elementKey === item.elementKey,\n  );\n\n  if (isCurrentlySelected) {\n    return currentSelection;\n  }\n\n  return [...currentSelection, item];\n}\n\n/**\n * Remove item from selection\n */\nexport function computeRemoveSelection(\n  currentSelection: SelectedItem[],\n  itemId: string,\n  elementKey?: string,\n): SelectedItem[] {\n  return currentSelection.filter((s) => {\n    if (elementKey) {\n      return !(s.itemId === itemId && s.elementKey === elementKey);\n    }\n    return s.itemId !== itemId;\n  });\n}\n\n/**\n * Replace entire selection with new items\n */\nexport function computeReplaceSelection(\n  _currentSelection: SelectedItem[],\n  newItems: SelectedItem[],\n): SelectedItem[] {\n  return [...newItems];\n}\n\n/**\n * Check if an item is in selection\n */\nexport function isItemSelected(\n  selection: SelectedItem[],\n  itemId: string,\n  elementKey?: string,\n): boolean {\n  return selection.some((s) => {\n    if (elementKey) {\n      return s.itemId === itemId && s.elementKey === elementKey;\n    }\n    return s.itemId === itemId;\n  });\n}\n\n/**\n * Get selection count by element key\n */\nexport function getSelectionCountByElement(\n  selection: SelectedItem[],\n  elementKey: string,\n): number {\n  return selection.filter((s) => s.elementKey === elementKey).length;\n}\n\n/**\n * Get all items for a specific element\n */\nexport function getSelectionForElement(\n  selection: SelectedItem[],\n  elementKey: string,\n): SelectedItem[] {\n  return selection.filter((s) => s.elementKey === elementKey);\n}\n\n/**\n * Compute multi-select with shift key\n * Returns items between last selected and current\n */\nexport function computeRangeSelection(\n  allItems: SelectableItemData[],\n  currentSelection: SelectedItem[],\n  newItem: SelectableItemData,\n  elementKey: string,\n): SelectedItem[] {\n  const itemsForElement = allItems.filter((i) => i.elementKey === elementKey);\n  const lastSelected = currentSelection\n    .filter((s) => s.elementKey === elementKey)\n    .pop();\n\n  if (!lastSelected) {\n    return computeAddSelection(currentSelection, {\n      itemId: newItem.itemId,\n      elementKey: newItem.elementKey,\n      data: newItem.data,\n    });\n  }\n\n  const lastIndex = itemsForElement.findIndex(\n    (i) => i.itemId === lastSelected.itemId,\n  );\n  const newIndex = itemsForElement.findIndex(\n    (i) => i.itemId === newItem.itemId,\n  );\n\n  if (lastIndex === -1 || newIndex === -1) {\n    return computeAddSelection(currentSelection, {\n      itemId: newItem.itemId,\n      elementKey: newItem.elementKey,\n      data: newItem.data,\n    });\n  }\n\n  const start = Math.min(lastIndex, newIndex);\n  const end = Math.max(lastIndex, newIndex);\n\n  const rangeItems = itemsForElement.slice(start, end + 1).map((item) => ({\n    itemId: item.itemId,\n    elementKey: item.elementKey,\n    data: item.data,\n  }));\n\n  // Merge with existing selection, avoiding duplicates\n  const merged = [...currentSelection];\n  for (const item of rangeItems) {\n    if (!isItemSelected(merged, item.itemId, item.elementKey)) {\n      merged.push(item);\n    }\n  }\n\n  return merged;\n}\n\n/**\n * Generate summary text for selected items\n */\nexport function generateSelectionSummary(selection: SelectedItem[]): string {\n  if (selection.length === 0) {\n    return \"No items selected\";\n  }\n\n  if (selection.length === 1) {\n    const item = selection[0]!;\n    return `1 item selected (${item.elementKey})`;\n  }\n\n  // Group by element key\n  const groups = new Map<string, number>();\n  for (const item of selection) {\n    groups.set(item.elementKey, (groups.get(item.elementKey) || 0) + 1);\n  }\n\n  const parts = Array.from(groups.entries()).map(\n    ([key, count]) => `${count} from ${key}`,\n  );\n\n  return `${selection.length} items selected: ${parts.join(\", \")}`;\n}\n\n/**\n * Export selection as AI-friendly format\n */\nexport function exportSelectionForAI(selection: SelectedItem[]): {\n  summary: string;\n  items: Array<{\n    type: string;\n    id: string;\n    elementKey: string;\n    data?: unknown;\n  }>;\n} {\n  return {\n    summary: generateSelectionSummary(selection),\n    items: selection.map((item) => ({\n      type: \"selected-item\",\n      id: item.itemId,\n      elementKey: item.elementKey,\n      data: item.data,\n    })),\n  };\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Deep Selection Use Cases\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Generate summary text for deep selections\n */\nexport function generateDeepSelectionSummary(\n  selections: DeepSelectionData[],\n): string {\n  if (selections.length === 0) {\n    return \"No elements selected\";\n  }\n\n  if (selections.length === 1) {\n    const sel = selections[0]!;\n    const preview =\n      sel.textContent.length > 30\n        ? sel.textContent.slice(0, 30) + \"...\"\n        : sel.textContent;\n    return `1 ${sel.tagName} selected: \"${preview}\"`;\n  }\n\n  // Group by element key\n  const groups = new Map<string, number>();\n  for (const sel of selections) {\n    groups.set(sel.elementKey, (groups.get(sel.elementKey) || 0) + 1);\n  }\n\n  const parts = Array.from(groups.entries()).map(\n    ([key, count]) => `${count} from ${key}`,\n  );\n\n  return `${selections.length} elements selected: ${parts.join(\", \")}`;\n}\n\n/**\n * Export deep selections for AI context\n */\nexport function exportDeepSelectionForAI(selections: DeepSelectionData[]): {\n  summary: string;\n  selections: Array<{\n    type: string;\n    elementKey: string;\n    cssPath: string;\n    tagName: string;\n    textContent: string;\n    itemId?: string;\n  }>;\n} {\n  return {\n    summary: generateDeepSelectionSummary(selections),\n    selections: selections.map((sel) => ({\n      type: sel.selectionType,\n      elementKey: sel.elementKey,\n      cssPath: sel.cssPath,\n      tagName: sel.tagName,\n      textContent: sel.textContent,\n      itemId: sel.itemId,\n    })),\n  };\n}\n\n/**\n * Export deep selections as plain text (for clipboard)\n */\nexport function exportDeepSelectionAsText(\n  selections: DeepSelectionData[],\n): string {\n  if (selections.length === 0) return \"\";\n\n  return selections.map((sel) => sel.textContent).join(\"\\n\");\n}\n\n/**\n * Export deep selections as JSON\n */\nexport function exportDeepSelectionAsJSON(\n  selections: DeepSelectionData[],\n): string {\n  return JSON.stringify(\n    selections.map((sel) => ({\n      elementKey: sel.elementKey,\n      cssPath: sel.cssPath,\n      tagName: sel.tagName,\n      textContent: sel.textContent,\n      itemId: sel.itemId,\n      selectionType: sel.selectionType,\n    })),\n    null,\n    2,\n  );\n}\n\n/**\n * Check if a CSS path is selected for an element\n */\nexport function isDeepSelectionSelected(\n  selections: DeepSelectionData[],\n  elementKey: string,\n  cssPath: string,\n): boolean {\n  return selections.some(\n    (s) => s.elementKey === elementKey && s.cssPath === cssPath,\n  );\n}\n\n/**\n * Get deep selections grouped by element key\n */\nexport function groupDeepSelectionsByElement(\n  selections: DeepSelectionData[],\n): Map<string, DeepSelectionData[]> {\n  const groups = new Map<string, DeepSelectionData[]>();\n\n  for (const sel of selections) {\n    const existing = groups.get(sel.elementKey) || [];\n    existing.push(sel);\n    groups.set(sel.elementKey, existing);\n  }\n\n  return groups;\n}\n"],"mappings":"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F;AACT;AASA,SAASK,aACPN,QACAO,MAAY;AAEZ,SAAOP,WAAW,MAAM;AACtB,UAAMQ,OAAO7E,yBAAyBqE,QAAQO,IAAI;AAElD,QAAIC,MAAM;AACR,UAAIA,KAAKC,KAAK;AACZ,eAAOzD,QAAQwD,KAAKC,GAAG;MACzB;AAEA,UAAI,OAAOD,KAAKL,UAAU,YAAY;AACpC,eAAOnD,QAAQwD,KAAKL,KAAK;MAC3B;IACF;AAEAH,aAAStE,eAAesE,MAAM;EAChC;AAEA,WAASU,gBAAa;AACpB,WAAO;EACT;AAEA,SAAOA;AACT;ACjNO,IAAMC,SAAO9E,OAAO,CACzB,KACA,QACA,WACA,WACA,QACA,WACA,SACA,SACA,KACA,OACA,OACA,OACA,SACA,cACA,QACA,MACA,UACA,UACA,WACA,UACA,QACA,QACA,OACA,YACA,WACA,QACA,YACA,MACA,aACA,OACA,WACA,OACA,UACA,OACA,OACA,MACA,MACA,WACA,MACA,YACA,cACA,UACA,QACA,UACA,QACA,MACA,MACA,MACA,MACA,MACA,MACA,QACA,UACA,UACA,MACA,QACA,KACA,OACA,SACA,OACA,OACA,SACA,UACA,MACA,QACA,OACA,QACA,WACA,QACA,YACA,SACA,OACA,QACA,MACA,YACA,UACA,UACA,KACA,WACA,OACA,YACA,KACA,MACA,MACA,QACA,KACA,QACA,UACA,WACA,UACA,UACA,QACA,SACA,UACA,UACA,QACA,UACA,UACA,SACA,OACA,WACA,OACA,SACA,SACA,MACA,YACA,YACA,SACA,MACA,SACA,QACA,MACA,SACA,MACA,KACA,MACA,OACA,SACA,KAAK,CACG;AAEH,IAAM+E,QAAM/E,OAAO,CACxB,OACA,KACA,YACA,eACA,gBACA,gBACA,iBACA,oBACA,UACA,YACA,QACA,QACA,WACA,gBACA,eACA,UACA,QACA,KACA,SACA,YACA,SACA,SACA,aACA,QACA,kBACA,UACA,QACA,YACA,SACA,QACA,QACA,WACA,WACA,YACA,kBACA,QACA,QACA,SACA,UACA,UACA,QACA,YACA,SACA,QACA,SACA,QACA,OAAO,CACC;AAEH,IAAMgF,aAAahF,OAAO,CAC/B,WACA,iBACA,uBACA,eACA,oBACA,qBACA,qBACA,kBACA,gBACA,WACA,WACA,WACA,WACA,WACA,kBACA,WACA,WACA,eACA,gBACA,YACA,gBACA,sBACA,eACA,UACA,cAAc,CACN;AAMH,IAAMiF,gBAAgBjF,OAAO,CAClC,WACA,iBACA,UACA,WACA,aACA,oBACA,kBACA,iBACA,iBACA,iBACA,SACA,aACA,QACA,gBACA,aACA,WACA,iBACA,UACA,OACA,cACA,WACA,KAAK,CACG;AAEH,IAAMkF,WAASlF,OAAO,CAC3B,QACA,YACA,UACA,WACA,SACA,UACA,MACA,cACA,iBACA,MACA,MACA,SACA,WACA,YACA,SACA,QACA,MACA,UACA,SACA,UACA,QACA,QACA,WACA,UACA,OACA,SACA,OACA,UACA,cACA,aAAa,CACL;AAIH,IAAMmF,mBAAmBnF,OAAO,CACrC,WACA,eACA,cACA,YACA,aACA,WACA,WACA,UACA,UACA,SACA,aACA,cACA,kBACA,eACA,MAAM,CACE;AAEH,IAAMoF,OAAOpF,OAAO,CAAC,OAAO,CAAU;AC1RtC,IAAM8E,OAAO9E,OAAO,CACzB,UACA,UACA,SACA,OACA,kBACA,gBACA,wBACA,YACA,cACA,WACA,UACA,WACA,eACA,eACA,WACA,QACA,SACA,SACA,SACA,QACA,WACA,YACA,gBACA,UACA,eACA,YACA,YACA,WACA,OACA,YACA,2BACA,yBACA,YACA,aACA,WACA,gBACA,eACA,QACA,OACA,WACA,UACA,UACA,QACA,QACA,YACA,MACA,SACA,aACA,aACA,SACA,QACA,SACA,QACA,QACA,WACA,QACA,OACA,OACA,aACA,SACA,UACA,OACA,aACA,YACA,SACA,QACA,SACA,WACA,cACA,UACA,QACA,WACA,QACA,WACA,eACA,eACA,WACA,iBACA,uBACA,UACA,WACA,WACA,cACA,YACA,OACA,YACA,OACA,YACA,QACA,QACA,WACA,cACA,SACA,YACA,SACA,QACA,SACA,QACA,QACA,WACA,SACA,OACA,UACA,QACA,SACA,WACA,YACA,SACA,aACA,QACA,UACA,UACA,SACA,SACA,QACA,SACA,MAAM,CACE;AAEH,IAAM+E,MAAM/E,OAAO,CACxB,iBACA,cACA,YACA,sBACA,aACA,UACA,iBACA,iBACA,WACA,iBACA,kBACA,SACA,QACA,MACA,SACA,QACA,iBACA,aACA,aACA,SACA,uBACA,+BACA,iBACA,mBACA,MACA,MACA,KACA,MACA,MACA,mBACA,aACA,WACA,WACA,OACA,YACA,aACA,OACA,YACA,QACA,gBACA,aACA,UACA,eACA,eACA,iBACA,eACA,aACA,oBACA,gBACA,cACA,gBACA,eACA,MACA,MACA,MACA,MACA,cACA,YACA,iBACA,qBACA,UACA,QACA,MACA,mBACA,MACA,OACA,aACA,KACA,MACA,MACA,MACA,MACA,WACA,aACA,cACA,YACA,QACA,gBACA,kBACA,gBACA,oBACA,kBACA,SACA,cACA,cACA,gBACA,gBACA,eACA,eACA,oBACA,aACA,OACA,QACA,aACA,SACA,UACA,QACA,OACA,QACA,cACA,UACA,YACA,WACA,SACA,UACA,eACA,UACA,YACA,eACA,QACA,cACA,uBACA,oBACA,gBACA,UACA,iBACA,uBACA,kBACA,KACA,MACA,MACA,UACA,QACA,QACA,eACA,aACA,WACA,UACA,UACA,SACA,QACA,mBACA,SACA,oBACA,oBACA,gBACA,eACA,gBACA,eACA,cACA,gBACA,oBACA,qBACA,kBACA,mBACA,qBACA,kBACA,UACA,gBACA,SACA,gBACA,kBACA,YACA,eACA,WACA,WACA,aACA,oBACA,eACA,mBACA,kBACA,cACA,QACA,MACA,MACA,WACA,UACA,WACA,cACA,WACA,cACA,iBACA,iBACA,SACA,gBACA,QACA,gBACA,oBACA,oBACA,KACA,MACA,MACA,SACA,KACA,MACA,MACA,KACA,YAAY,CACJ;AAEH,IAAMkF,SAASlF,OAAO,CAC3B,UACA,eACA,S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","names":["confirmationIdCounter","value","createContext","useContext","useMemo","jsx","createContext","useMemo","useContext","React","createContext","useContext","useCallback","useMemo","jsx","createContext","React","useCallback","useMemo","useContext","executeAction","React","createContext","useContext","useCallback","useMemo","jsx","createContext","React","useCallback","value","useMemo","useContext","createContext","useMemo","useEffect","useCallback","useCallback","useMemo","useMemo","useCallback","useRef","useCallback","useEffect","useRef","useCallback","useEffect","createContext","useContext","useCallback","useMemo","useRef","useEffect","jsx","jsx","useCallback","componentWrapper","useEffect","useMemo","useContext","useCallback","useMemo","useContext","isItemSelected","useCallback","useMemo","useCallback","jsx","Component","React","useMemo","createContext","useContext","useMemo","useState","useCallback","useEffect","useState","useRef","useEffect","useCallback","jsx","jsxs","InlineCitation","handleClick","jsx","text","useMemo","React","createContext","useContext","useMemo","jsx","createContext","useMemo","useContext","createContext","useContext","useState","useEffect","useCallback","useRef","jsx","createContext","useState","useRef","useEffect","useCallback","useContext","createContext","useState","useCallback","useRef","useEffect","jsx","ActionContext","createContext","ActionProvider","useState","useRef","useCallback","scheduleFlush","useEffect","useContext","useCallback","useEffect","useContext","ActionContext","useCallback","useEffect","React","createContext","useContext","useCallback","useRef","useMemo","jsx","createContext","useContext","useCallback","useMemo","useEffect","useShallow","jsx","createContext","useCallback","useEffect","useMemo","useContext","useActiveToolProgress","createContext","useContext","useMemo","useCallback","useShallow","jsx","createContext","useMemo","useCallback","useContext","useEffect","useRef","createContext","useContext","jsx","createContext","useRef","useEffect","jsx","jsx","jsxs","React","useMemo","React","useRef","useCallback","useMemo","useState","useCallback","useRef","useEffect","useState","useRef","useEffect","useCallback","jsx","jsxs","React","useRef","useCallback","state","useMemo","useCallback","useState","useRef","useEffect","useState","useRef","useEffect","jsx","jsxs","jsx","jsxs","useState","useRef","useCallback","target","useEffect","React","memo","useCallback","useRef","useState","useEffect","useState","useCallback","useRef","useEffect","useMemo","useShallow","createPlaceholder","useState","useCallback","isFileAttachment","isLibraryAttachment","buildConversationMessages","bodyPayload","useRef","useEffect","useRef","useEffect","useShallow","useMemo","useState","useRef","useEffect","useCallback","isFileAttachment","error","useCallback","text","useState","useEffect","useState","useCallback","useRef","useEffect","text","useCallback","useMemo","useState","useCallback","useCallback","useRef","React","useCallback","useRef","useCallback","useEffect","useState","memo","jsx","memo","EditableText","useRef","useState","useEffect","useCallback","jsx","React","Fragment","jsx","jsxs","memo","EditableTextNode","useRef","useState","useEffect","useCallback","memo","EditableWrapper","useRef","useState","jsx","Fragment","useCallback","jsxs","jsx","React","ElementRenderer","useMemo","Component","jsx","jsxs","jsx","jsxs","jsxs","jsx","elementRendererPropsAreEqual","jsx","React","createContext","useContext","useState","useCallback","jsx","createContext","useState","useCallback","useContext","EditableText","Component","React","memo","ReactMarkdown","jsx","defaultTheme","memo","MarkdownText","ReactMarkdown","jsx","jsxs","useMemo","useMemo","jsx","jsxs","useMemo","jsx","jsxs","useMemo","jsx","memo","useEffect","useState","jsx","jsxs","memo","jsx","jsxs","memo","DefaultProgressItem","Fragment","jsx","jsxs","memo","ToolProgressOverlay","useActiveToolProgress","useState","useEffect","memo","useCallback","useState","useEffect","useMemo","jsx","jsxs","CanvasBlock","entries","setPrototypeOf","isFrozen","getPrototypeOf","getOwnPropertyDescriptor","Object","freeze","seal","create","apply","construct","Reflect","x","func","thisArg","_len","arguments","length","args","Array","_key","Func","_len2","_key2","arrayForEach","unapply","prototype","forEach","arrayLastIndexOf","lastIndexOf","arrayPop","pop","arrayPush","push","arraySplice","splice","stringToLowerCase","String","toLowerCase","stringToString","toString","stringMatch","match","stringReplace","replace","stringIndexOf","indexOf","stringTrim","trim","objectHasOwnProperty","hasOwnProperty","regExpTest","RegExp","test","typeErrorCreate","unconstruct","TypeError","lastIndex","_len3","_key3","_len4","_key4","addToSet","set","array","transformCaseFunc","l","element","lcElement","cleanArray","index","isPropertyExist","clone","object","newObject","property","value","isArray","constructor","lookupGetter","prop","desc","get","fallbackValue","html","svg","svgFilters","svgDisallowed","mathMl","mathMlDisallowed","text","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","CUSTOM_ELEMENT","NODE_TYPE","attribute","cdataSection","entityReference","entityNode","progressingInstruction","comment","document","documentType","documentFragment","notation","getGlobal","window","_createTrustedTypesPolicy","trustedTypes","purifyHostElement","createPolicy","suffix","ATTR_NAME","hasAttribute","getAttribute","policyName","createHTML","createScriptURL","scriptUrl","_","console","warn","_createHooksMap","afterSanitizeAttributes","afterSanitizeElements","afterSanitizeShadowDOM","beforeSanitizeAttributes","beforeSanitizeElements","beforeSanitizeShadowDOM","uponSanitizeAttribute","uponSanitizeElement","uponSanitizeShadowNode","createDOMPurify","undefined","DOMPurify","root","version","VERSION","removed","nodeType","Element","isSupported","originalDocument","currentScript","DocumentFragment","HTMLTemplateElement","Node","NodeFilter","NamedNodeMap","MozNamedAttrMap","HTMLFormElement","DOMParser","ElementPrototype","cloneNode","remove","getNextSibling","getChildNodes","getParentNode","template","createElement","content","ownerDocument","trustedTypesPolicy","emptyHTML","implementation","createNodeIterator","createDocumentFragment","getElementsByTagName","importNode","hooks","createHTMLDocument","EXPRESSIONS","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","ATTRS","CUSTOM_ELEMENT_HANDLING","tagNameCheck","writable","configurable","enumerable","attributeNameCheck","allowCustomizedBuiltInElements","FORBID_TAGS","FORBID_ATTR","EXTRA_ELEMENT_HANDLING","tagCheck","attributeCheck","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","SAFE_FOR_XML","WHOLE_DOCUMENT","SET_CONFIG","FORCE_BODY","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","SANITIZE_DOM","SANITIZE_NAMED_PROPS","SANITIZE_NAMED_PROPS_PREFIX","KEEP_CONTENT","IN_PLACE","USE_PROFILES","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","MATHML_NAMESPACE","SVG_NAMESPACE","HTML_NAMESPACE","NAMESPACE","IS_EMPTY_INPUT","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","COMMON_SVG_AND_HTML_ELEMENTS","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","DEFAULT_PARSER_MEDIA_TYPE","CONFIG","formElement","isRegexOrFunction","testValue","Function","_parseConfig","cfg","ADD_URI_SAFE_ATTR","ADD_DATA_URI_TAGS","ALLOWED_URI_REGEXP","ADD_TAGS","ADD_ATTR","ADD_FORBID_CONTENTS","table","tbody","TRUSTED_TYPES_POLICY","ALL_SVG_TAGS","ALL_MATHML_TAGS","_checkValidNamespace","parent","tagName","namespaceURI","parentTagName","Boolean","_forceRemove","node","removeChild","_removeAttribute","name","getAttributeNode","from","removeAttribute","setAttribute","_initDocument","dirty","doc","leadingWhitespace","matches","dirtyPayload","parseFromString","documentElement","createDocument","innerHTML","body","insertBefore","createTextNode","childNodes","call","_createNodeIterator","SHOW_ELEMENT","SHOW_COMMENT","SHOW_TEXT","SHOW_PROCESSING_INSTRUCTION","SHOW_CDATA_SECTION","_isClobbered","nodeName","textContent","attributes","hasChildNodes","_isNode","_executeHooks","currentNode","data","hook","_sanitizeElements","allowedTags","firstElementChild","_isBasicCustomElement","parentNode","childCount","i","childClone","__removalCount","expr","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","hookEvent","attrName","attrValue","keepAttr","allowedAttributes","forceKeepAttr","attr","initValue","getAttributeType","setAttributeNS","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","nextNode","sanitize","importedNode","returnNode","appendChild","firstChild","nodeIterator","shadowroot","shadowrootmode","serializedHTML","outerHTML","doctype","setConfig","clearConfig","isValidAttribute","tag","addHook","entryPoint","hookFunction","removeHook","removeHooks","removeAllHooks","memo","useMemo","jsx","jsxs","DocumentBlock"]}