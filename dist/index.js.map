{"version":3,"sources":["../src/index.ts","../src/contexts/data.tsx","../src/store/index.ts","../src/store/slices/domain.ts","../src/store/slices/ui.ts","../src/store/slices/selection.ts","../src/store/slices/settings.ts","../src/store/slices/analytics.ts","../src/store/slices/actions.ts","../src/store/slices/validation.ts","../src/store/slices/tool-progress.ts","../src/store/slices/plan-execution.ts","../src/store/slices/deep-research.ts","../src/store/slices/ui-tree.ts","../src/contexts/visibility.tsx","../src/contexts/actions.tsx","../src/utils.ts","../src/contexts/validation.tsx","../src/contexts/selection/context.ts","../src/contexts/selection/provider.tsx","../src/contexts/selection/styles.ts","../src/contexts/selection/utils.ts","../src/contexts/selection/use-selection-state.ts","../src/contexts/selection/use-long-press.ts","../src/utils/dom.ts","../src/contexts/selection/hooks.ts","../src/contexts/selection/use-dom-tracking.ts","../src/contexts/selection/SelectableItem.tsx","../src/contexts/markdown/types.ts","../src/contexts/markdown/internal-markdown.tsx","../src/contexts/citation/index.ts","../src/contexts/citation/inline-citation.tsx","../src/contexts/markdown/provider.tsx","../src/contexts/ai-settings.tsx","../src/hooks/types.ts","../src/contexts/ai-settings/types.ts","../src/contexts/ai-settings/storage.ts","../src/contexts/action-tracking/provider.tsx","../src/contexts/action-tracking/types.ts","../src/contexts/action-tracking/utils.ts","../src/contexts/action-tracking/hooks.ts","../src/contexts/autosave.tsx","../src/contexts/tool-progress.tsx","../src/contexts/unified-progress.tsx","../src/components/InteractionTrackingWrapper.tsx","../src/utils/selection.ts","../src/renderer/element-renderer.tsx","../src/components/ResizableWrapper.tsx","../src/hooks/resizable/types.ts","../src/hooks/resizable/utils.ts","../src/hooks/resizable/hook.ts","../src/components/SelectionWrapper.tsx","../src/components/LongPressIndicator.tsx","../src/renderer/provider.tsx","../src/renderer.tsx","../src/renderer/memo-utils.ts","../src/renderer/skeleton-loader.tsx","../src/hooks/useUIStream.ts","../src/hooks/patches/structural-sharing.ts","../src/hooks/patches/tree-utils.ts","../src/hooks/patches/types.ts","../src/hooks/patch-utils.ts","../src/hooks/ui-stream/tree-mutations.ts","../src/hooks/ui-stream/use-history.ts","../src/hooks/useTextSelection.ts","../src/hooks/useIsMobile.ts","../src/hooks/usePreservedSelection.ts","../src/hooks/useLayoutManager.ts","../src/hooks/useHistory.ts","../src/hooks/useDeepResearch.ts","../src/hooks/flat-to-tree.ts","../src/editable.tsx","../src/components/MarkdownText.tsx","../src/components/TextSelectionBadge.tsx","../src/components/free-grid/canvas.tsx","../src/components/free-grid/styles.ts","../src/components/free-grid/grid-lines.tsx","../src/components/free-grid/grid-cell.tsx","../src/components/free-grid/layout-utils.ts","../src/components/ToolProgressOverlay.tsx","../src/components/tool-progress/icons.tsx","../src/components/tool-progress/progress-item.tsx","../src/use-cases/selection.use-case.ts"],"sourcesContent":["// Contexts\nexport {\n  DataProvider,\n  useData,\n  useDataValue,\n  useDataBinding,\n  type DataContextValue,\n  type DataProviderProps,\n} from \"./contexts/data\";\n\nexport {\n  VisibilityProvider,\n  useVisibility,\n  useIsVisible,\n  type VisibilityContextValue,\n  type VisibilityProviderProps,\n} from \"./contexts/visibility\";\n\nexport {\n  ActionProvider,\n  useActions,\n  useAction,\n  ConfirmDialog,\n  type ActionContextValue,\n  type ActionProviderProps,\n  type PendingConfirmation,\n  type ConfirmDialogProps,\n  type ActionTrackingCallback,\n} from \"./contexts/actions\";\n\nexport {\n  ValidationProvider,\n  useValidation,\n  useFieldValidation,\n  type ValidationContextValue,\n  type ValidationProviderProps,\n  type FieldValidationState,\n} from \"./contexts/validation\";\n\nexport {\n  SelectionProvider,\n  useSelection,\n  useItemSelection,\n  selectableItemProps,\n  SelectableItem,\n  type SelectionContextValue,\n  type SelectionProviderProps,\n  type SelectableItemProps,\n  type DeepSelectionInfo,\n  type DeepSelectionInput,\n} from \"./contexts/selection\";\n\n// Markdown Context (core-level markdown rendering)\nexport {\n  MarkdownProvider,\n  useMarkdown,\n  useRenderText,\n  type MarkdownContextValue,\n  type MarkdownProviderProps,\n  type MarkdownTheme,\n  type RenderTextOptions,\n} from \"./contexts/markdown\";\n\n// Citation Context (inline citation support for documents)\nexport {\n  CitationProvider,\n  useCitations,\n  type Citation,\n} from \"./contexts/citation\";\n\n// AI Settings Context\nexport {\n  AISettingsProvider,\n  useAISettings,\n  useAISettingsOptional,\n  useIsProactivityEnabled,\n  useAreSuggestionsEnabled,\n  useIsSmartParsingEnabled,\n  type DocumentSettings,\n  type ExtendedAISettings,\n  DEFAULT_EXTENDED_SETTINGS,\n} from \"./contexts/ai-settings\";\n\n// Action Tracking Context\nexport {\n  ActionProvider as ActionTrackingProvider,\n  useActionContext,\n  useElementActionTracker,\n  useActionSubscriber,\n  formatActionsForPrompt,\n} from \"./contexts/action-tracking\";\n\n// Auto-Save Context (domain data persistence)\nexport {\n  AutoSaveProvider,\n  useAutoSave,\n  useDomainAutoSave,\n  type AutoSaveContextValue,\n  type AutoSavePayload,\n  type AutoSaveResult,\n  type DomainType,\n} from \"./contexts/autosave\";\n\n// Tool Progress Context (real-time tool execution tracking)\nexport {\n  ToolProgressProvider,\n  useToolProgress,\n  useToolProgressOptional,\n  useIsToolRunning,\n  useActiveToolProgress,\n  type ToolProgressContextValue,\n  type ToolProgressProviderProps,\n  type ToolProgressEvent,\n  type ToolProgressStatus,\n} from \"./contexts/tool-progress\";\n\n// Unified Progress Context (plan + tool progress integrated)\nexport {\n  UnifiedProgressProvider,\n  useUnifiedProgress,\n  useUnifiedProgressOptional,\n  useIsGenerating,\n  useGeneratingGoal,\n  type UnifiedProgressContextValue,\n  type UnifiedProgressProviderProps,\n  type UnifiedProgressItem,\n  type UnifiedProgressItemType,\n  type UnifiedProgressStatus,\n  type UnifiedProgressState,\n} from \"./contexts/unified-progress\";\n\n// Renderer - Main UI rendering components\nexport { Renderer, createRendererFromCatalog } from \"./renderer.js\";\n\n// Renderer module (modular components from renderer directory)\nexport {\n  JSONUIProvider,\n  ElementRenderer,\n  PlaceholderSkeleton,\n  ChildSkeleton,\n  isPlaceholderElement,\n  elementRendererPropsAreEqual,\n  type ComponentRenderProps,\n  type ComponentRenderer,\n  type ComponentRegistry,\n  type RendererProps,\n  type ElementRendererProps,\n  type JSONUIProviderProps,\n  type SkeletonProps,\n} from \"./renderer/index\";\n\n// Hooks\nexport {\n  useUIStream,\n  useTextSelection,\n  useIsMobile,\n  usePreservedSelection,\n  useResizable,\n  useLayoutManager,\n  getResizeCursor,\n  flatToTree,\n  type UseUIStreamOptions,\n  type UseUIStreamReturn,\n  type ConversationTurn,\n  type ConversationMessage,\n  buildConversationMessages,\n  type ChatMessage,\n  type FlatElement,\n  type FormField,\n  type QuestionPayload,\n  type SuggestionChip,\n  type ActionType,\n  type TrackedAction,\n  type ActionTrackerOptions,\n  type ProactivityMode,\n  type AIAssistantSettings,\n  type TextSelectionInfo,\n  type PreservedTextSelection,\n  type Attachment,\n  type FileAttachment,\n  type LibraryAttachment,\n  type PersistedAttachment,\n  type UsePreservedSelectionReturn,\n  type ResizeHandle,\n  type ResizeState,\n  type UseResizableOptions,\n  type UseResizableReturn,\n  type UseLayoutManagerOptions,\n  type UseLayoutManagerReturn,\n  type ToolProgress,\n  type DocumentIndex,\n  type DocumentIndexNode,\n  DEFAULT_AI_SETTINGS,\n} from \"./hooks\";\n\n// Attachment utilities (runtime functions)\nexport { isLibraryAttachment, isFileAttachment } from \"./hooks/types\";\n\n// Editable\nexport {\n  EditableProvider,\n  useEditableContext,\n  useEditable,\n  EditableText,\n  EditableNumber,\n  type EditableProps,\n} from \"./editable\";\n\n// Components\nexport {\n  MarkdownText,\n  TextSelectionBadge,\n  ResizableWrapper,\n  FreeGridCanvas,\n  GridCell,\n  getLayoutStyles,\n  createLayout,\n  ToolProgressOverlay,\n  type MarkdownTextProps,\n  type TextSelectionBadgeProps,\n  type ResizableWrapperProps,\n  type FreeGridCanvasProps,\n  type GridCellProps,\n  type ToolProgressOverlayProps,\n} from \"./components\";\n\n// Ports (Hexagonal Architecture)\nexport {\n  type SelectionManagerPort,\n  type DOMSelectorPort,\n  type SelectionEventPort,\n  type SelectionExportPort,\n  type SelectionPort,\n  type DeepSelectionData,\n  type AddDeepSelectionInput,\n  type DataManagerPort,\n  type ActionManagerPort,\n  type ValidationManagerPort,\n  type ToolProgressManagerPort,\n} from \"./ports\";\n\n// Store (Zustand)\nexport {\n  useStore,\n  useUIStore,\n  useDeepSelections,\n  useDeepSelectionActive,\n  useGranularSelection,\n  // Actions selectors\n  useLoadingActions,\n  usePendingConfirmations,\n  useActionHistory,\n  // Validation selectors\n  useFieldStates,\n  useIsValidating,\n  useFormState,\n  // Tool progress selectors\n  useProgressEvents,\n  useActiveToolProgress as useActiveToolProgressStore,\n  useIsAnyToolRunning,\n  // Plan execution selectors\n  selectPlanExecution,\n  usePlanExecution,\n  useIsPlanRunning,\n  usePlanProgress,\n  useActiveStep,\n  // Deep Research selectors\n  useDeepResearchSettings,\n  useDeepResearchEnabled,\n  useDeepResearchEffortLevel,\n  useActiveResearch,\n  useAuthenticatedSources,\n  useResearchHistory,\n  useIsResearchActive,\n  useResearchProgress,\n  // Types\n  type PlanExecutionState,\n  type PlanStep,\n  type PlanSubtask,\n  type PlanStepStatus,\n  type ExecutionPlan as StorePlanType,\n  type DeepResearchEffortLevel,\n  // Note: DeepSelectionInfo is exported from ./contexts/selection\n} from \"./store\";\n\n// Use Cases (Pure Business Logic)\nexport {\n  computeToggleSelection,\n  computeAddSelection,\n  computeRemoveSelection,\n  computeReplaceSelection,\n  computeRangeSelection,\n  isItemSelected,\n  getSelectionCountByElement,\n  getSelectionForElement,\n  generateSelectionSummary,\n  exportSelectionForAI,\n  // Deep selection use cases\n  generateDeepSelectionSummary,\n  exportDeepSelectionForAI,\n  exportDeepSelectionAsText,\n  exportDeepSelectionAsJSON,\n  isDeepSelectionSelected,\n  groupDeepSelectionsByElement,\n} from \"./use-cases\";\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  useEffect,\n  type ReactNode,\n} from \"react\";\nimport { getByPath, type DataModel, type AuthState } from \"@onegenui/core\";\nimport { useStore } from \"../store\";\n\n/**\n * Data context value\n */\nexport interface DataContextValue {\n  /** The current data model */\n  data: DataModel;\n  /** Auth state for visibility evaluation */\n  authState?: AuthState;\n  /** Get a value by path */\n  get: (path: string) => unknown;\n  /** Set a value by path */\n  set: (path: string, value: unknown) => void;\n  /** Update multiple values at once */\n  update: (updates: Record<string, unknown>) => void;\n}\n\nconst DataContext = createContext<DataContextValue | null>(null);\n\n/**\n * Props for DataProvider\n */\nexport interface DataProviderProps {\n  /** Initial data model */\n  initialData?: DataModel;\n  /** Auth state */\n  authState?: AuthState;\n  /** Callback when data changes */\n  onDataChange?: (path: string, value: unknown) => void;\n  children: ReactNode;\n}\n\n/**\n * Provider for data model context\n *\n * Uses Zustand store as backing store for optimal performance.\n * Context API provides stable public interface for package consumers.\n */\nexport function DataProvider({\n  initialData = {},\n  authState,\n  onDataChange,\n  children,\n}: DataProviderProps) {\n  // Use Zustand store for state management\n  const data = useStore((s) => s.dataModel);\n  const storeAuth = useStore((s) => s.auth);\n  const setDataModel = useStore((s) => s.setDataModel);\n  const updateDataModel = useStore((s) => s.updateDataModel);\n  const setAuth = useStore((s) => s.setAuth);\n\n  // Sync initial data to store on mount\n  useEffect(() => {\n    if (Object.keys(initialData).length > 0) {\n      setDataModel(initialData);\n    }\n  }, []); // Only on mount\n\n  // Sync authState prop to store\n  useEffect(() => {\n    if (authState) {\n      setAuth(authState);\n    }\n  }, [authState, setAuth]);\n\n  const get = useCallback((path: string) => getByPath(data, path), [data]);\n\n  const set = useCallback(\n    (path: string, value: unknown) => {\n      updateDataModel(path, value);\n      onDataChange?.(path, value);\n    },\n    [updateDataModel, onDataChange],\n  );\n\n  const update = useCallback(\n    (updates: Record<string, unknown>) => {\n      for (const [path, value] of Object.entries(updates)) {\n        updateDataModel(path, value);\n        onDataChange?.(path, value);\n      }\n    },\n    [updateDataModel, onDataChange],\n  );\n\n  // Use store auth or prop auth\n  const effectiveAuth = authState ?? storeAuth;\n\n  const value = useMemo<DataContextValue>(\n    () => ({\n      data,\n      authState: effectiveAuth,\n      get,\n      set,\n      update,\n    }),\n    [data, effectiveAuth, get, set, update],\n  );\n\n  return <DataContext.Provider value={value}>{children}</DataContext.Provider>;\n}\n\n/**\n * Hook to access the data context\n */\nexport function useData(): DataContextValue {\n  const ctx = useContext(DataContext);\n  if (!ctx) {\n    throw new Error(\"useData must be used within a DataProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to get a value from the data model\n * Optimized: subscribes only to the specific path via Zustand selector\n */\nexport function useDataValue<T>(path: string): T | undefined {\n  // Direct Zustand subscription for granular updates\n  const value = useStore((s) => getByPath(s.dataModel, path));\n  return value as T | undefined;\n}\n\n/**\n * Hook to get and set a value from the data model (like useState)\n */\nexport function useDataBinding<T>(\n  path: string,\n): [T | undefined, (value: T) => void] {\n  const value = useDataValue<T>(path);\n  const updateDataModel = useStore((s) => s.updateDataModel);\n\n  const setValue = useCallback(\n    (newValue: T) => updateDataModel(path, newValue),\n    [path, updateDataModel],\n  );\n\n  return [value, setValue];\n}\n","/**\n * Root Store - Combined Zustand store with all slices\n *\n * Uses the official Zustand slice pattern with immer middleware.\n * See: https://zustand.docs.pmnd.rs/guides/typescript#slices-pattern\n */\nimport { create } from \"zustand\";\nimport { devtools, subscribeWithSelector } from \"zustand/middleware\";\nimport { immer } from \"zustand/middleware/immer\";\nimport { enableMapSet } from \"immer\";\nimport { useShallow } from \"zustand/react/shallow\";\nimport type { StoreApi, UseBoundStore } from \"zustand\";\n\n// Enable Immer MapSet plugin for Set/Map support in store\nenableMapSet();\n\nimport {\n  createDomainSlice,\n  createUISlice,\n  createSelectionSlice,\n  createSettingsSlice,\n  createAnalyticsSlice,\n  createActionsSlice,\n  createValidationSlice,\n  createToolProgressSlice,\n  createPlanExecutionSlice,\n  createDeepResearchSlice,\n  createUITreeSlice,\n} from \"./slices\";\n\nimport type { StoreState } from \"./types\";\nexport type { StoreState } from \"./types\";\nexport type { UITreeSlice } from \"./slices/ui-tree\";\nexport type { DeepSelectionInfo, DeepSelectionInput } from \"./slices/selection\";\nexport type {\n  PlanExecutionState,\n  PlanStep,\n  PlanSubtask,\n  PlanStepStatus,\n  ExecutionPlan,\n} from \"./slices/plan-execution\";\nexport type {\n  DeepResearchSlice,\n  DeepResearchEffortLevel,\n  DeepResearchSettings,\n  AuthenticatedSource,\n  ResearchPhase,\n  ResearchSource,\n  ActiveResearch,\n  ResearchResultSummary,\n} from \"./slices/deep-research\";\n\n// =============================================================================\n// Store Type (exported for external use)\n// =============================================================================\n\n/**\n * Public store hook type - hides internal immer types\n */\nexport type OneGenUIStore = UseBoundStore<StoreApi<StoreState>>;\n\n// =============================================================================\n// Store Creation\n// =============================================================================\n\n/**\n * Main store hook. Use this to access the store state and actions.\n *\n * @example\n * ```tsx\n * const theme = useStore((s) => s.theme);\n * const setTheme = useStore((s) => s.setTheme);\n * ```\n */\nexport const useStore: OneGenUIStore = create<StoreState>()(\n  devtools(\n    subscribeWithSelector(\n      immer((...args) => ({\n        ...createDomainSlice(...args),\n        ...createUISlice(...args),\n        ...createSelectionSlice(...args),\n        ...createSettingsSlice(...args),\n        ...createAnalyticsSlice(...args),\n        ...createActionsSlice(...args),\n        ...createValidationSlice(...args),\n        ...createToolProgressSlice(...args),\n        ...createPlanExecutionSlice(...args),\n        ...createDeepResearchSlice(...args),\n        ...createUITreeSlice(...args),\n      })),\n    ),\n    {\n      name: \"onegenui-store\",\n      enabled: process.env.NODE_ENV !== \"production\",\n    },\n  ),\n) as OneGenUIStore;\n\n/**\n * Alias for useStore - alternative name\n */\nexport const useUIStore: OneGenUIStore = useStore;\n\n// =============================================================================\n// Selector Hooks (for optimized re-renders)\n// =============================================================================\n\n// Domain selectors\nexport const useDataModel = () => useStore((s) => s.dataModel);\nexport const useAuth = () => useStore((s) => s.auth);\nexport const useIsLoading = () => useStore((s) => s.isLoading);\n\n// UI selectors\nexport const useConfirmations = () => useStore((s) => s.confirmations);\nexport const useToolProgress = () => useStore((s) => s.toolProgress);\nexport const useGlobalLoading = () => useStore((s) => s.globalLoading);\nexport const useSidebarOpen = () => useStore((s) => s.sidebarOpen);\n\n// Selection selectors - Component level\nexport const useSelectedKey = () => useStore((s) => s.selectedKey);\nexport const useSelectedElement = () => useStore((s) => s.selectedElement);\nexport const useMultiSelectedKeys = () => useStore((s) => s.multiSelectedKeys);\nexport const useHoveredKey = () => useStore((s) => s.hoveredKey);\n\n// Selection selectors - Deep selection\nexport const useDeepSelections = () => useStore((s) => s.deepSelections);\nexport const useDeepSelectionActive = () =>\n  useStore((s) => s.deepSelectionActive);\n// Use useShallow for derived objects that are computed on every call\nexport const useGranularSelection = () =>\n  useStore(\n    useShallow((s) => {\n      const result: Record<string, Set<string>> = {};\n      for (const sel of s.deepSelections) {\n        if (sel.itemId) {\n          if (!result[sel.elementKey]) {\n            result[sel.elementKey] = new Set();\n          }\n          result[sel.elementKey]!.add(sel.itemId);\n        }\n      }\n      return result;\n    }),\n  );\n\n// Settings selectors\nexport const useTheme = () => useStore((s) => s.theme);\nexport const useAISettings = () => useStore((s) => s.aiSettings);\nexport const useCompactMode = () => useStore((s) => s.compactMode);\n\n// Analytics selectors - use useShallow for array slicing\nexport const useRecentActions = (count = 10) =>\n  useStore(useShallow((s) => s.actions.slice(0, count)));\n\n// Actions selectors\nexport const useLoadingActions = () => useStore((s) => s.loadingActions);\nexport const usePendingConfirmations = () =>\n  useStore((s) => s.pendingConfirmations);\nexport const useActionHistory = () => useStore((s) => s.actionHistory);\n\n// Validation selectors\nexport const useFieldStates = () => useStore((s) => s.fieldStates);\nexport const useIsValidating = () => useStore((s) => s.isValidating);\n// Use useShallow for derived form state\nexport const useFormState = () =>\n  useStore(\n    useShallow((s) => {\n      const states = Object.values(s.fieldStates);\n      let touchedCount = 0;\n      let errorCount = 0;\n      let isValid = true;\n      let isDirty = false;\n\n      for (const state of states) {\n        if (state.touched) {\n          touchedCount++;\n          isDirty = true;\n        }\n        if (state.validationResult && !state.validationResult.isValid) {\n          isValid = false;\n          errorCount += state.validationResult.errors.length;\n        }\n      }\n\n      return {\n        isValid,\n        isDirty,\n        isValidating: s.isValidating,\n        touchedCount,\n        errorCount,\n      };\n    }),\n  );\n\n// Tool Progress selectors\nexport const useProgressEvents = () => useStore((s) => s.progressEvents);\n// Use useShallow for filtered arrays\nexport const useActiveToolProgress = () =>\n  useStore(\n    useShallow((s) =>\n      s.progressEvents.filter(\n        (e) => e.status === \"starting\" || e.status === \"progress\",\n      ),\n    ),\n  );\n// Boolean primitives are stable, no useShallow needed\nexport const useIsAnyToolRunning = () =>\n  useStore((s) =>\n    s.progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    ),\n  );\n\n// Plan Execution selectors\nexport const selectPlanExecution = (s: StoreState) => s.planExecution;\nexport const usePlanExecution = () => useStore(selectPlanExecution);\nexport const useIsPlanRunning = () =>\n  useStore((s) => s.planExecution.isOrchestrating);\nexport const usePlanProgress = () =>\n  useStore(\n    useShallow((s) => {\n      const plan = s.planExecution.plan;\n      if (!plan) return { completed: 0, total: 0, percentage: 0 };\n      const completed = plan.steps.filter(\n        (st) => st.status === \"complete\",\n      ).length;\n      const total = plan.steps.length;\n      return {\n        completed,\n        total,\n        percentage: total > 0 ? Math.round((completed / total) * 100) : 0,\n      };\n    }),\n  );\nexport const useActiveStep = () =>\n  useStore(\n    (s) =>\n      s.planExecution.plan?.steps.find((st) => st.status === \"running\") ?? null,\n  );\n\n// Deep Research selectors\nexport const useDeepResearchSettings = () =>\n  useStore((s) => s.deepResearchSettings);\nexport const useDeepResearchEnabled = () =>\n  useStore((s) => s.deepResearchSettings.enabled);\nexport const useDeepResearchEffortLevel = () =>\n  useStore((s) => s.deepResearchSettings.effortLevel);\nexport const useActiveResearch = () => useStore((s) => s.activeResearch);\nexport const useAuthenticatedSources = () =>\n  useStore((s) => s.authenticatedSources);\nexport const useResearchHistory = () => useStore((s) => s.researchHistory);\nexport const useIsResearchActive = () =>\n  useStore(\n    (s) =>\n      s.activeResearch !== null &&\n      s.activeResearch.status !== \"complete\" &&\n      s.activeResearch.status !== \"error\" &&\n      s.activeResearch.status !== \"stopped\",\n  );\nexport const useResearchProgress = () =>\n  useStore(\n    useShallow((s) => {\n      const research = s.activeResearch;\n      if (!research)\n        return { progress: 0, phase: \"\", sourcesFound: 0, sourcesTarget: 0 };\n      return {\n        progress: research.progress,\n        phase: research.currentPhase,\n        sourcesFound: research.sources.length,\n        sourcesTarget: research.sourcesTarget,\n      };\n    }),\n  );\n\n// UI Tree selectors\nexport const useUITree = () => useStore((s) => s.uiTree);\nexport const useTreeVersion = () => useStore((s) => s.treeVersion);\nexport const useIsTreeStreaming = () => useStore((s) => s.isTreeStreaming);\nexport const useUITreeActions = () =>\n  useStore(\n    useShallow((s) => ({\n      setUITree: s.setUITree,\n      updateUITree: s.updateUITree,\n      setElement: s.setElement,\n      removeElement: s.removeElement,\n      applyTreePatch: s.applyTreePatch,\n      setTreeStreaming: s.setTreeStreaming,\n      clearUITree: s.clearUITree,\n      bumpTreeVersion: s.bumpTreeVersion,\n    })),\n  );\n\n// =============================================================================\n// Re-export slice creators for direct use\n// =============================================================================\n\nexport {\n  createDomainSlice,\n  createUISlice,\n  createSelectionSlice,\n  createSettingsSlice,\n  createAnalyticsSlice,\n  createActionsSlice,\n  createValidationSlice,\n  createToolProgressSlice,\n  createPlanExecutionSlice,\n  createDeepResearchSlice,\n  createUITreeSlice,\n} from \"./slices\";\n","/**\n * Domain Slice - Data model, auth state, validation\n */\nimport type { DataModel, AuthState } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\nexport interface DomainSlice {\n  // Data model\n  dataModel: DataModel;\n  setDataModel: (data: DataModel) => void;\n  updateDataModel: (path: string, value: unknown) => void;\n  resetDataModel: () => void;\n\n  // Auth state\n  auth: AuthState;\n  setAuth: (auth: AuthState) => void;\n\n  // Data loading\n  isLoading: boolean;\n  setIsLoading: (loading: boolean) => void;\n}\n\nconst initialDataModel: DataModel = {};\nconst initialAuth: AuthState = {\n  isSignedIn: false,\n  user: undefined,\n};\n\nexport const createDomainSlice: SliceCreator<DomainSlice> = (set) => ({\n  // Data model\n  dataModel: initialDataModel,\n  setDataModel: (data) => set({ dataModel: data }),\n  updateDataModel: (path, value) =>\n    set((state) => {\n      // Support both JSON Pointer (\"/a/b\") and dot notation (\"a.b\")\n      const normalizedPath = path.startsWith(\"/\") ? path.slice(1) : path;\n      const parts = normalizedPath.includes(\"/\")\n        ? normalizedPath.split(\"/\")\n        : normalizedPath.split(\".\");\n\n      if (parts.length === 0 || (parts.length === 1 && parts[0] === \"\")) return;\n\n      const obj = state.dataModel as Record<string, unknown>;\n\n      // Single level path\n      if (parts.length === 1) {\n        obj[parts[0] as string] = value;\n        return;\n      }\n\n      // Multi-level path\n      let current = obj;\n      for (let i = 0; i < parts.length - 1; i++) {\n        const key = parts[i] as string;\n        if (!current[key] || typeof current[key] !== \"object\") {\n          current[key] = {};\n        }\n        current = current[key] as Record<string, unknown>;\n      }\n      const lastKey = parts[parts.length - 1] as string;\n      current[lastKey] = value;\n    }),\n  resetDataModel: () => set({ dataModel: initialDataModel }),\n\n  // Auth\n  auth: initialAuth,\n  setAuth: (auth) => set({ auth }),\n\n  // Loading\n  isLoading: false,\n  setIsLoading: (isLoading) => set({ isLoading }),\n});\n","/**\n * UI Slice - Loading states, progress, confirmations\n */\nimport type { SliceCreator } from \"../types\";\n\nexport interface ConfirmationDialog {\n  id: string;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  onConfirm: () => void;\n  onCancel?: () => void;\n}\n\nexport interface ToolProgress {\n  id: string;\n  name: string;\n  status: \"pending\" | \"running\" | \"complete\" | \"error\";\n  progress?: number;\n  message?: string;\n}\n\nexport interface UISlice {\n  // Confirmations\n  confirmations: ConfirmationDialog[];\n  showConfirmation: (dialog: Omit<ConfirmationDialog, \"id\">) => string;\n  hideConfirmation: (id: string) => void;\n\n  // Tool progress\n  toolProgress: Map<string, ToolProgress>;\n  setToolProgress: (progress: ToolProgress) => void;\n  clearToolProgress: (id: string) => void;\n  clearAllToolProgress: () => void;\n\n  // Global loading\n  globalLoading: boolean;\n  setGlobalLoading: (loading: boolean) => void;\n\n  // Sidebar/panels\n  sidebarOpen: boolean;\n  setSidebarOpen: (open: boolean) => void;\n  toggleSidebar: () => void;\n}\n\nlet confirmationIdCounter = 0;\n\nexport const createUISlice: SliceCreator<UISlice> = (set) => ({\n  // Confirmations\n  confirmations: [],\n  showConfirmation: (dialog) => {\n    const id = `ui_confirm_${++confirmationIdCounter}`;\n    set((state) => {\n      state.confirmations.push({ ...dialog, id });\n    });\n    return id;\n  },\n  hideConfirmation: (id) =>\n    set((state) => {\n      state.confirmations = state.confirmations.filter((c) => c.id !== id);\n    }),\n\n  // Tool progress\n  toolProgress: new Map(),\n  setToolProgress: (progress) =>\n    set((state) => {\n      state.toolProgress.set(progress.id, progress);\n    }),\n  clearToolProgress: (id) =>\n    set((state) => {\n      state.toolProgress.delete(id);\n    }),\n  clearAllToolProgress: () => set({ toolProgress: new Map() }),\n\n  // Global loading\n  globalLoading: false,\n  setGlobalLoading: (globalLoading) => set({ globalLoading }),\n\n  // Sidebar\n  sidebarOpen: true,\n  setSidebarOpen: (sidebarOpen) => set({ sidebarOpen }),\n  toggleSidebar: () =>\n    set((state) => {\n      state.sidebarOpen = !state.sidebarOpen;\n    }),\n});\n","/**\n * Selection Slice - Unified element selection state\n *\n * Supports:\n * - Single element selection (component focus)\n * - Multi-selection\n * - Deep selection (granular sub-element selection)\n * - Hover/focus tracking\n */\nimport type { UIElement } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Deep selection info - represents a selected sub-element (SERIALIZABLE)\n *\n * This is the canonical type for selection data stored in Zustand.\n * It contains ONLY serializable data - no DOM references.\n *\n * For DOM access, use DeepSelectionInfoWithElement from contexts/selection/types.ts\n * which extends this type with an optional `element` property.\n */\nexport interface DeepSelectionInfo {\n  /** Unique ID for this selection (store-generated) */\n  id: string;\n  /** The parent component's element key */\n  elementKey: string;\n  /** CSS path from component root to the selected element */\n  cssPath: string;\n  /** Tag name of the selected element */\n  tagName: string;\n  /** Text content (truncated) for AI context */\n  textContent: string;\n  /** The containing item's data (if selection is within a selectable-item) */\n  containingItem?: Record<string, unknown>;\n  /** The index of the item in the parent array */\n  itemIndex?: number;\n  /** The item's unique ID (from data-item-id attribute) */\n  itemId?: string;\n  /** Type of selection: 'item' for full item, 'granular' for specific text */\n  selectionType: \"item\" | \"granular\";\n  /** Timestamp of selection */\n  timestamp: number;\n}\n\n/**\n * Input type for creating a new selection.\n * id and timestamp are generated by the store.\n */\nexport type DeepSelectionInput = Omit<DeepSelectionInfo, \"id\" | \"timestamp\">;\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface SelectionSlice {\n  // ─────────────────────────────────────────────────────────────────────────\n  // Single selection (component level focus)\n  // ─────────────────────────────────────────────────────────────────────────\n  selectedKey: string | null;\n  selectedElement: UIElement | null;\n  select: (key: string | null, element: UIElement | null) => void;\n  clearSelection: () => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Multi-selection (component level)\n  // ─────────────────────────────────────────────────────────────────────────\n  multiSelectedKeys: Set<string>;\n  addToMultiSelection: (key: string) => void;\n  removeFromMultiSelection: (key: string) => void;\n  toggleMultiSelection: (key: string) => void;\n  clearMultiSelection: () => void;\n  isMultiSelected: (key: string) => boolean;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Deep selection (sub-element level)\n  // ─────────────────────────────────────────────────────────────────────────\n  deepSelections: DeepSelectionInfo[];\n  deepSelectionActive: boolean;\n\n  addDeepSelection: (selection: DeepSelectionInput) => string;\n  removeDeepSelection: (id: string) => void;\n  removeDeepSelectionByElement: (elementKey: string, cssPath: string) => void;\n  clearDeepSelections: () => void;\n  clearDeepSelectionsForElement: (elementKey: string) => void;\n\n  isDeepSelected: (elementKey: string, cssPath: string) => boolean;\n  getDeepSelectionsForElement: (elementKey: string) => DeepSelectionInfo[];\n\n  setDeepSelectionActive: (active: boolean) => void;\n\n  // Derived: flat selection map for component API\n  getGranularSelection: () => Record<string, Set<string>>;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Hover state\n  // ─────────────────────────────────────────────────────────────────────────\n  hoveredKey: string | null;\n  setHoveredKey: (key: string | null) => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Focus state\n  // ─────────────────────────────────────────────────────────────────────────\n  focusedKey: string | null;\n  setFocusedKey: (key: string | null) => void;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nlet selectionIdCounter = 0;\nconst generateSelectionId = () => `sel_${++selectionIdCounter}_${Date.now()}`;\n\nexport const createSelectionSlice: SliceCreator<SelectionSlice> = (\n  set,\n  get,\n) => ({\n  // ─────────────────────────────────────────────────────────────────────────\n  // Single selection\n  // ─────────────────────────────────────────────────────────────────────────\n  selectedKey: null,\n  selectedElement: null,\n  select: (key, element) => set({ selectedKey: key, selectedElement: element }),\n  clearSelection: () => set({ selectedKey: null, selectedElement: null }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Multi-selection\n  // ─────────────────────────────────────────────────────────────────────────\n  multiSelectedKeys: new Set(),\n  addToMultiSelection: (key) =>\n    set((state) => {\n      state.multiSelectedKeys.add(key);\n    }),\n  removeFromMultiSelection: (key) =>\n    set((state) => {\n      state.multiSelectedKeys.delete(key);\n    }),\n  toggleMultiSelection: (key) => {\n    const { multiSelectedKeys } = get();\n    if (multiSelectedKeys.has(key)) {\n      get().removeFromMultiSelection(key);\n    } else {\n      get().addToMultiSelection(key);\n    }\n  },\n  clearMultiSelection: () => set({ multiSelectedKeys: new Set() }),\n  isMultiSelected: (key) => get().multiSelectedKeys.has(key),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Deep selection\n  // ─────────────────────────────────────────────────────────────────────────\n  deepSelections: [],\n  deepSelectionActive: false,\n\n  addDeepSelection: (selection) => {\n    const id = generateSelectionId();\n    set((state) => {\n      state.deepSelections.push({ ...selection, id, timestamp: Date.now() });\n    });\n    return id;\n  },\n\n  removeDeepSelection: (id) =>\n    set((state) => {\n      state.deepSelections = state.deepSelections.filter((s) => s.id !== id);\n    }),\n\n  removeDeepSelectionByElement: (elementKey, cssPath) =>\n    set((state) => {\n      state.deepSelections = state.deepSelections.filter(\n        (s) => !(s.elementKey === elementKey && s.cssPath === cssPath),\n      );\n    }),\n\n  clearDeepSelections: () => set({ deepSelections: [] }),\n\n  clearDeepSelectionsForElement: (elementKey) =>\n    set((state) => {\n      state.deepSelections = state.deepSelections.filter(\n        (s) => s.elementKey !== elementKey,\n      );\n    }),\n\n  isDeepSelected: (elementKey, cssPath) => {\n    return get().deepSelections.some(\n      (s) => s.elementKey === elementKey && s.cssPath === cssPath,\n    );\n  },\n\n  getDeepSelectionsForElement: (elementKey) => {\n    return get().deepSelections.filter((s) => s.elementKey === elementKey);\n  },\n\n  setDeepSelectionActive: (active) => {\n    set({ deepSelectionActive: active });\n    // Auto-reset after 100ms (prevents component-level selection during deep selection)\n    if (active) {\n      setTimeout(() => {\n        set({ deepSelectionActive: false });\n      }, 100);\n    }\n  },\n\n  // Derived state: flat selection map for component API\n  getGranularSelection: () => {\n    const result: Record<string, Set<string>> = {};\n    for (const sel of get().deepSelections) {\n      if (sel.itemId) {\n        if (!result[sel.elementKey]) {\n          result[sel.elementKey] = new Set();\n        }\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        result[sel.elementKey]!.add(sel.itemId);\n      }\n    }\n    return result;\n  },\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Hover\n  // ─────────────────────────────────────────────────────────────────────────\n  hoveredKey: null,\n  setHoveredKey: (hoveredKey) => set({ hoveredKey }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Focus\n  // ─────────────────────────────────────────────────────────────────────────\n  focusedKey: null,\n  setFocusedKey: (focusedKey) => set({ focusedKey }),\n});\n","/**\n * Settings Slice - AI settings, theme, preferences\n */\nimport type { SliceCreator } from \"../types\";\n\nexport type ThemeMode = \"light\" | \"dark\" | \"system\";\nexport type AIModel =\n  | \"gemini-2.0-flash\"\n  | \"gemini-2.5-pro\"\n  | \"gpt-4o\"\n  | \"claude-3.5-sonnet\";\n\nexport interface AISettings {\n  model: AIModel;\n  temperature: number;\n  maxTokens: number;\n  streamingEnabled: boolean;\n  autoSuggestions: boolean;\n}\n\nexport interface SettingsSlice {\n  // Theme\n  theme: ThemeMode;\n  setTheme: (theme: ThemeMode) => void;\n\n  // AI settings\n  aiSettings: AISettings;\n  setAISettings: (settings: Partial<AISettings>) => void;\n  resetAISettings: () => void;\n\n  // Preferences\n  compactMode: boolean;\n  setCompactMode: (compact: boolean) => void;\n  animationsEnabled: boolean;\n  setAnimationsEnabled: (enabled: boolean) => void;\n}\n\nconst defaultAISettings: AISettings = {\n  model: \"gemini-2.0-flash\",\n  temperature: 0.7,\n  maxTokens: 8192,\n  streamingEnabled: true,\n  autoSuggestions: true,\n};\n\nexport const createSettingsSlice: SliceCreator<SettingsSlice> = (set) => ({\n  // Theme\n  theme: \"system\",\n  setTheme: (theme) => set({ theme }),\n\n  // AI settings\n  aiSettings: defaultAISettings,\n  setAISettings: (settings) =>\n    set((state) => {\n      Object.assign(state.aiSettings, settings);\n    }),\n  resetAISettings: () => set({ aiSettings: defaultAISettings }),\n\n  // Preferences\n  compactMode: false,\n  setCompactMode: (compactMode) => set({ compactMode }),\n  animationsEnabled: true,\n  setAnimationsEnabled: (animationsEnabled) => set({ animationsEnabled }),\n});\n","/**\n * Analytics Slice - Action tracking, metrics\n */\nimport type { SliceCreator } from \"../types\";\n\nexport interface TrackedAction {\n  id: string;\n  type: string;\n  elementKey?: string;\n  elementType?: string;\n  timestamp: number;\n  data?: unknown;\n}\n\nexport interface AnalyticsSlice {\n  // Action history\n  actions: TrackedAction[];\n  trackAction: (action: Omit<TrackedAction, \"id\" | \"timestamp\">) => void;\n  clearActions: () => void;\n\n  // Metrics\n  metrics: {\n    totalActions: number;\n    sessionStart: number;\n    lastActionTime: number;\n  };\n\n  // Get recent actions (for AI context)\n  getRecentActions: (count?: number) => TrackedAction[];\n  getActionsByType: (type: string) => TrackedAction[];\n  getActionsByElement: (elementKey: string) => TrackedAction[];\n}\n\nconst MAX_ACTIONS = 100;\nlet analyticsIdCounter = 0;\n\nexport const createAnalyticsSlice: SliceCreator<AnalyticsSlice> = (\n  set,\n  get,\n) => ({\n  // Actions\n  actions: [],\n  trackAction: (action) => {\n    const tracked: TrackedAction = {\n      ...action,\n      id: `analytics_${++analyticsIdCounter}`,\n      timestamp: Date.now(),\n    };\n\n    set((state) => {\n      state.actions.unshift(tracked);\n      if (state.actions.length > MAX_ACTIONS) {\n        state.actions = state.actions.slice(0, MAX_ACTIONS);\n      }\n      state.metrics.totalActions++;\n      state.metrics.lastActionTime = tracked.timestamp;\n    });\n  },\n  clearActions: () =>\n    set((state) => {\n      state.actions = [];\n      state.metrics.totalActions = 0;\n    }),\n\n  // Metrics\n  metrics: {\n    totalActions: 0,\n    sessionStart: Date.now(),\n    lastActionTime: 0,\n  },\n\n  // Getters\n  getRecentActions: (count = 10) => get().actions.slice(0, count),\n  getActionsByType: (type) => get().actions.filter((a) => a.type === type),\n  getActionsByElement: (elementKey) =>\n    get().actions.filter((a) => a.elementKey === elementKey),\n});\n","/**\n * Actions Slice - Action execution state management\n *\n * Manages:\n * - Loading states per action\n * - Pending confirmations\n * - Action history\n */\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Pending confirmation dialog\n */\nexport interface PendingConfirmation {\n  id: string;\n  actionName: string;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  payload?: unknown;\n  timestamp: number;\n}\n\n/**\n * Action execution record\n */\nexport interface ActionExecution {\n  id: string;\n  actionName: string;\n  status: \"pending\" | \"running\" | \"success\" | \"error\";\n  startTime: number;\n  endTime?: number;\n  error?: string;\n  payload?: unknown;\n  result?: unknown;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ActionsSlice {\n  // ─────────────────────────────────────────────────────────────────────────\n  // Loading states\n  // ─────────────────────────────────────────────────────────────────────────\n  loadingActions: Set<string>;\n  isActionLoading: (actionName: string) => boolean;\n  setActionLoading: (actionName: string, loading: boolean) => void;\n  clearActionLoading: (actionName: string) => void;\n  clearAllLoading: () => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Pending Action Confirmations (different from UISlice confirmations)\n  // ─────────────────────────────────────────────────────────────────────────\n  pendingConfirmations: PendingConfirmation[];\n  addPendingConfirmation: (\n    confirmation: Omit<PendingConfirmation, \"id\" | \"timestamp\">,\n  ) => string;\n  removePendingConfirmation: (id: string) => void;\n  getPendingConfirmation: (id: string) => PendingConfirmation | undefined;\n  clearPendingConfirmations: () => void;\n\n  // Convenience aliases\n  addConfirmation: (\n    confirmation: Omit<PendingConfirmation, \"id\" | \"timestamp\">,\n  ) => string;\n  removeConfirmation: (id: string) => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Action history\n  // ─────────────────────────────────────────────────────────────────────────\n  actionHistory: ActionExecution[];\n  maxHistorySize: number;\n\n  startAction: (actionName: string, payload?: unknown) => string;\n  completeAction: (id: string, result?: unknown) => void;\n  failAction: (id: string, error: string) => void;\n  getActionStatus: (id: string) => ActionExecution | undefined;\n  getRecentActionExecutions: (count?: number) => ActionExecution[];\n  addToHistory: (info: { actionName: string; payload?: unknown }) => void;\n  clearHistory: () => void;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nlet actionIdCounter = 0;\nconst generateActionId = () => `action_${++actionIdCounter}_${Date.now()}`;\n\nlet confirmationIdCounter = 0;\nconst generateConfirmationId = () =>\n  `confirm_${++confirmationIdCounter}_${Date.now()}`;\n\nexport const createActionsSlice: SliceCreator<ActionsSlice> = (set, get) => ({\n  // ─────────────────────────────────────────────────────────────────────────\n  // Loading states\n  // ─────────────────────────────────────────────────────────────────────────\n  loadingActions: new Set(),\n\n  isActionLoading: (actionName) => get().loadingActions.has(actionName),\n\n  setActionLoading: (actionName, loading) =>\n    set((state) => {\n      if (loading) {\n        state.loadingActions.add(actionName);\n      } else {\n        state.loadingActions.delete(actionName);\n      }\n    }),\n\n  clearActionLoading: (actionName) =>\n    set((state) => {\n      state.loadingActions.delete(actionName);\n    }),\n\n  clearAllLoading: () => set({ loadingActions: new Set() }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Pending Action Confirmations\n  // ─────────────────────────────────────────────────────────────────────────\n  pendingConfirmations: [],\n\n  addPendingConfirmation: (confirmation) => {\n    const id = generateConfirmationId();\n    set((state) => {\n      state.pendingConfirmations.push({\n        ...confirmation,\n        id,\n        timestamp: Date.now(),\n      });\n    });\n    return id;\n  },\n\n  removePendingConfirmation: (id) =>\n    set((state) => {\n      state.pendingConfirmations = state.pendingConfirmations.filter(\n        (c) => c.id !== id,\n      );\n    }),\n\n  getPendingConfirmation: (id) => {\n    return get().pendingConfirmations.find((c) => c.id === id);\n  },\n\n  clearPendingConfirmations: () => set({ pendingConfirmations: [] }),\n\n  // Convenience aliases\n  addConfirmation: (confirmation) => {\n    const id = generateConfirmationId();\n    set((state) => {\n      state.pendingConfirmations.push({\n        ...confirmation,\n        id,\n        timestamp: Date.now(),\n      });\n    });\n    return id;\n  },\n\n  removeConfirmation: (id) =>\n    set((state) => {\n      state.pendingConfirmations = state.pendingConfirmations.filter(\n        (c) => c.id !== id,\n      );\n    }),\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Action history\n  // ─────────────────────────────────────────────────────────────────────────\n  actionHistory: [],\n  maxHistorySize: 100,\n\n  startAction: (actionName, payload) => {\n    const id = generateActionId();\n\n    set((state) => {\n      state.loadingActions.add(actionName);\n      state.actionHistory.push({\n        id,\n        actionName,\n        status: \"running\",\n        startTime: Date.now(),\n        payload,\n      });\n      if (state.actionHistory.length > state.maxHistorySize) {\n        state.actionHistory = state.actionHistory.slice(-state.maxHistorySize);\n      }\n    });\n\n    return id;\n  },\n\n  completeAction: (id, result) =>\n    set((state) => {\n      const execution = state.actionHistory.find((a) => a.id === id);\n      if (execution) {\n        state.loadingActions.delete(execution.actionName);\n        execution.status = \"success\";\n        execution.endTime = Date.now();\n        execution.result = result;\n      }\n    }),\n\n  failAction: (id, error) =>\n    set((state) => {\n      const execution = state.actionHistory.find((a) => a.id === id);\n      if (execution) {\n        state.loadingActions.delete(execution.actionName);\n        execution.status = \"error\";\n        execution.endTime = Date.now();\n        execution.error = error;\n      }\n    }),\n\n  getActionStatus: (id) => {\n    return get().actionHistory.find((a) => a.id === id);\n  },\n\n  getRecentActionExecutions: (count = 10) => {\n    return get().actionHistory.slice(-count);\n  },\n\n  addToHistory: (info) => {\n    const id = generateActionId();\n\n    set((state) => {\n      state.actionHistory.push({\n        id,\n        actionName: info.actionName,\n        status: \"success\",\n        startTime: Date.now(),\n        endTime: Date.now(),\n        payload: info.payload,\n      });\n      if (state.actionHistory.length > state.maxHistorySize) {\n        state.actionHistory = state.actionHistory.slice(-state.maxHistorySize);\n      }\n    });\n  },\n\n  clearHistory: () => set({ actionHistory: [] }),\n});\n","/**\n * Validation Slice - Field validation state management\n *\n * Manages:\n * - Field touched states\n * - Validation results per field\n * - Form-level validation state\n */\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Validation result for a single field\n */\nexport interface FieldValidationResult {\n  isValid: boolean;\n  errors: string[];\n  warnings?: string[];\n}\n\n/**\n * State for a single field\n */\nexport interface FieldState {\n  path: string;\n  touched: boolean;\n  validated: boolean;\n  validationResult: FieldValidationResult | null;\n  lastValidatedAt?: number;\n}\n\n/**\n * Form-level validation state\n */\nexport interface FormValidationState {\n  isValid: boolean;\n  isDirty: boolean;\n  isValidating: boolean;\n  touchedCount: number;\n  errorCount: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ValidationSlice {\n  // Field states (keyed by path)\n  fieldStates: Record<string, FieldState>;\n\n  // Field operations\n  touchField: (path: string) => void;\n  untouchField: (path: string) => void;\n  setFieldValidation: (path: string, result: FieldValidationResult) => void;\n  clearFieldValidation: (path: string) => void;\n\n  // Getters\n  getFieldState: (path: string) => FieldState | undefined;\n  isFieldTouched: (path: string) => boolean;\n  isFieldValid: (path: string) => boolean;\n  getFieldErrors: (path: string) => string[];\n\n  // Form-level operations\n  isValidating: boolean;\n  setIsValidating: (validating: boolean) => void;\n\n  // Form state\n  getFormState: () => FormValidationState;\n  touchAllFields: (paths: string[]) => void;\n  clearAllValidation: () => void;\n\n  // Bulk operations\n  setMultipleFieldValidations: (\n    results: Array<{ path: string; result: FieldValidationResult }>,\n  ) => void;\n\n  getFieldsWithErrors: () => string[];\n  getTouchedFields: () => string[];\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createValidationSlice: SliceCreator<ValidationSlice> = (\n  set,\n  get,\n) => ({\n  fieldStates: {},\n\n  touchField: (path) =>\n    set((state) => {\n      const existing = state.fieldStates[path];\n      state.fieldStates[path] = {\n        path,\n        touched: true,\n        validated: existing?.validated ?? false,\n        validationResult: existing?.validationResult ?? null,\n        lastValidatedAt: existing?.lastValidatedAt,\n      };\n    }),\n\n  untouchField: (path) =>\n    set((state) => {\n      if (state.fieldStates[path]) {\n        state.fieldStates[path].touched = false;\n      }\n    }),\n\n  setFieldValidation: (path, result) =>\n    set((state) => {\n      const existing = state.fieldStates[path];\n      state.fieldStates[path] = {\n        path,\n        touched: existing?.touched ?? false,\n        validated: true,\n        validationResult: result,\n        lastValidatedAt: Date.now(),\n      };\n    }),\n\n  clearFieldValidation: (path) =>\n    set((state) => {\n      if (state.fieldStates[path]) {\n        state.fieldStates[path].validated = false;\n        state.fieldStates[path].validationResult = null;\n        state.fieldStates[path].lastValidatedAt = undefined;\n      }\n    }),\n\n  getFieldState: (path) => {\n    return get().fieldStates[path];\n  },\n\n  isFieldTouched: (path) => {\n    return get().fieldStates[path]?.touched ?? false;\n  },\n\n  isFieldValid: (path) => {\n    const state = get().fieldStates[path];\n    return state?.validationResult?.isValid ?? true;\n  },\n\n  getFieldErrors: (path) => {\n    return get().fieldStates[path]?.validationResult?.errors ?? [];\n  },\n\n  isValidating: false,\n\n  setIsValidating: (validating) => set({ isValidating: validating }),\n\n  getFormState: () => {\n    const { fieldStates, isValidating } = get();\n    let touchedCount = 0;\n    let errorCount = 0;\n    let isValid = true;\n    let isDirty = false;\n\n    for (const state of Object.values(fieldStates)) {\n      if (state.touched) {\n        touchedCount++;\n        isDirty = true;\n      }\n      if (state.validationResult && !state.validationResult.isValid) {\n        isValid = false;\n        errorCount += state.validationResult.errors.length;\n      }\n    }\n\n    return { isValid, isDirty, isValidating, touchedCount, errorCount };\n  },\n\n  touchAllFields: (paths) =>\n    set((state) => {\n      for (const path of paths) {\n        const existing = state.fieldStates[path];\n        state.fieldStates[path] = {\n          path,\n          touched: true,\n          validated: existing?.validated ?? false,\n          validationResult: existing?.validationResult ?? null,\n          lastValidatedAt: existing?.lastValidatedAt,\n        };\n      }\n    }),\n\n  clearAllValidation: () => {\n    set({ fieldStates: {}, isValidating: false });\n  },\n\n  setMultipleFieldValidations: (results) =>\n    set((state) => {\n      for (const { path, result } of results) {\n        const existing = state.fieldStates[path];\n        state.fieldStates[path] = {\n          path,\n          touched: existing?.touched ?? false,\n          validated: true,\n          validationResult: result,\n          lastValidatedAt: Date.now(),\n        };\n      }\n    }),\n\n  getFieldsWithErrors: () => {\n    const result: string[] = [];\n    for (const [path, state] of Object.entries(get().fieldStates)) {\n      if (state.validationResult && !state.validationResult.isValid) {\n        result.push(path);\n      }\n    }\n    return result;\n  },\n\n  getTouchedFields: () => {\n    const result: string[] = [];\n    for (const [path, state] of Object.entries(get().fieldStates)) {\n      if (state.touched) {\n        result.push(path);\n      }\n    }\n    return result;\n  },\n});\n","/**\n * Tool Progress Slice - Tool execution progress tracking\n *\n * Manages:\n * - Active tool progress\n * - Tool execution history\n * - Auto-cleanup of completed tools\n */\nimport type { ToolProgressStatus, ToolProgressEvent } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\n// Re-export types from core for convenience\nexport type { ToolProgressStatus, ToolProgressEvent } from \"@onegenui/core\";\n\n/**\n * Slice-specific progress event (with required timestamp)\n */\nexport interface StoredProgressEvent extends ToolProgressEvent {\n  timestamp: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ToolProgressSlice {\n  // ─────────────────────────────────────────────────────────────────────────\n  // Progress events (stored with required timestamp)\n  // ─────────────────────────────────────────────────────────────────────────\n  progressEvents: StoredProgressEvent[];\n  maxEvents: number;\n\n  // Add/update progress (timestamp added automatically)\n  addProgress: (event: Omit<ToolProgressEvent, \"timestamp\" | \"type\">) => void;\n  addProgressEvent: (\n    event: Omit<ToolProgressEvent, \"timestamp\" | \"type\">,\n  ) => void;\n  updateProgress: (\n    toolCallId: string,\n    updates: Partial<\n      Omit<ToolProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) => void;\n  updateProgressEvent: (\n    toolCallId: string,\n    updates: Partial<\n      Omit<ToolProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) => void;\n\n  // Clear operations\n  clearProgress: () => void;\n  clearProgressEvents: () => void;\n  clearCompletedOlderThan: (ms: number) => void;\n  clearCompletedProgressOlderThan: (ms: number) => void;\n  removeProgress: (toolCallId: string) => void;\n\n  // ─────────────────────────────────────────────────────────────────────────\n  // Getters\n  // ─────────────────────────────────────────────────────────────────────────\n  getProgress: (toolCallId: string) => StoredProgressEvent | undefined;\n  getActiveProgress: () => StoredProgressEvent[];\n  getAllProgress: () => StoredProgressEvent[];\n  isToolRunning: () => boolean;\n  isSpecificToolRunning: (toolName: string) => boolean;\n  getProgressByToolName: (toolName: string) => StoredProgressEvent[];\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createToolProgressSlice: SliceCreator<ToolProgressSlice> = (\n  set,\n  get,\n) => {\n  // Shared implementation for add\n  const addProgressImpl = (\n    event: Omit<ToolProgressEvent, \"timestamp\" | \"type\">,\n  ) =>\n    set((state) => {\n      const timestamp = Date.now();\n      const existingIndex = state.progressEvents.findIndex(\n        (p) => p.toolCallId === event.toolCallId,\n      );\n\n      const storedEvent: StoredProgressEvent = {\n        type: \"tool-progress\",\n        ...event,\n        timestamp,\n      };\n\n      if (existingIndex >= 0) {\n        state.progressEvents[existingIndex] = storedEvent;\n      } else {\n        state.progressEvents.push(storedEvent);\n        if (state.progressEvents.length > state.maxEvents) {\n          state.progressEvents = state.progressEvents.slice(-state.maxEvents);\n        }\n      }\n    });\n\n  // Shared implementation for update\n  const updateProgressImpl = (\n    toolCallId: string,\n    updates: Partial<\n      Omit<ToolProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) =>\n    set((state) => {\n      const idx = state.progressEvents.findIndex(\n        (p) => p.toolCallId === toolCallId,\n      );\n      if (idx >= 0) {\n        const existing = state.progressEvents[idx];\n        if (existing) {\n          Object.assign(existing, updates, { timestamp: Date.now() });\n        }\n      }\n    });\n\n  // Shared implementation for clear\n  const clearProgressImpl = () => set({ progressEvents: [] });\n\n  // Shared implementation for clear old\n  const clearCompletedOlderThanImpl = (ms: number) => {\n    const cutoff = Date.now() - ms;\n    set((state) => {\n      state.progressEvents = state.progressEvents.filter(\n        (p) =>\n          (p.status !== \"complete\" && p.status !== \"error\") ||\n          p.timestamp > cutoff,\n      );\n    });\n  };\n\n  return {\n    progressEvents: [],\n    maxEvents: 50,\n\n    addProgress: addProgressImpl,\n    addProgressEvent: addProgressImpl,\n\n    updateProgress: updateProgressImpl,\n    updateProgressEvent: updateProgressImpl,\n\n    clearProgress: clearProgressImpl,\n    clearProgressEvents: clearProgressImpl,\n\n    clearCompletedOlderThan: clearCompletedOlderThanImpl,\n    clearCompletedProgressOlderThan: clearCompletedOlderThanImpl,\n\n    removeProgress: (toolCallId) =>\n      set((state) => {\n        state.progressEvents = state.progressEvents.filter(\n          (p) => p.toolCallId !== toolCallId,\n        );\n      }),\n\n    getProgress: (toolCallId) => {\n      return get().progressEvents.find((p) => p.toolCallId === toolCallId);\n    },\n\n    getActiveProgress: () => {\n      return get().progressEvents.filter(\n        (p) => p.status === \"starting\" || p.status === \"progress\",\n      );\n    },\n\n    getAllProgress: () => {\n      return get().progressEvents;\n    },\n\n    isToolRunning: () => {\n      return get().progressEvents.some(\n        (p) => p.status === \"starting\" || p.status === \"progress\",\n      );\n    },\n\n    isSpecificToolRunning: (toolName) => {\n      return get().progressEvents.some(\n        (p) =>\n          p.toolName === toolName &&\n          (p.status === \"starting\" || p.status === \"progress\"),\n      );\n    },\n\n    getProgressByToolName: (toolName) => {\n      return get().progressEvents.filter((p) => p.toolName === toolName);\n    },\n  };\n};\n","/**\n * Plan Execution Slice - Unified plan and progress tracking\n *\n * Integrates planning with tool progress for native \"generating\" state.\n * Replaces separate usePlanState hook with Zustand-based centralized state.\n */\nimport type { SliceCreator } from \"../types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type PlanStepStatus = \"pending\" | \"running\" | \"complete\" | \"error\";\n\nexport interface PlanSubtask {\n  id: number;\n  task: string;\n  agent: string;\n  status: PlanStepStatus;\n  startTime?: number;\n  endTime?: number;\n}\n\nexport interface PlanStep {\n  id: number;\n  task: string;\n  agent: string;\n  status: PlanStepStatus;\n  dependencies: number[];\n  parallel?: boolean;\n  subtasks?: PlanSubtask[];\n  startTime?: number;\n  endTime?: number;\n  result?: unknown;\n}\n\nexport interface ExecutionPlan {\n  goal: string;\n  steps: PlanStep[];\n}\n\nexport interface PlanExecutionState {\n  /** Current execution plan */\n  plan: ExecutionPlan | null;\n  /** Whether orchestration is active */\n  isOrchestrating: boolean;\n  /** Current parallel execution level */\n  parallelLevel: number | null;\n  /** Timestamp when orchestration started */\n  orchestrationStartTime: number | null;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Interface\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface PlanExecutionSlice {\n  // State\n  planExecution: PlanExecutionState;\n\n  // Actions\n  setPlanCreated: (\n    goal: string,\n    steps: Array<{\n      id: number;\n      task: string;\n      agent: string;\n      dependencies?: number[];\n      parallel?: boolean;\n      subtasks?: Array<{ id: number; task: string; agent: string }>;\n    }>,\n  ) => void;\n  setStepStarted: (stepId: number) => void;\n  setStepDone: (stepId: number, result?: unknown) => void;\n  setStepError: (stepId: number, error: string) => void;\n  setSubtaskStarted: (parentId: number, subtaskId: number) => void;\n  setSubtaskDone: (\n    parentId: number,\n    subtaskId: number,\n    result?: unknown,\n  ) => void;\n  setLevelStarted: (level: number) => void;\n  setOrchestrationDone: () => void;\n  resetPlanExecution: () => void;\n\n  // Getters\n  getActiveStep: () => PlanStep | null;\n  getActiveSubtask: () => PlanSubtask | null;\n  getCompletedStepIds: () => number[];\n  getPlanProgress: () => {\n    completed: number;\n    total: number;\n    percentage: number;\n  };\n  isPlanRunning: () => boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Initial State\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst initialPlanState: PlanExecutionState = {\n  plan: null,\n  isOrchestrating: false,\n  parallelLevel: null,\n  orchestrationStartTime: null,\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Slice Implementation\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createPlanExecutionSlice: SliceCreator<PlanExecutionSlice> = (\n  set,\n  get,\n) => ({\n  planExecution: initialPlanState,\n\n  setPlanCreated: (goal, steps) => {\n    set((state) => {\n      state.planExecution = {\n        plan: {\n          goal,\n          steps: steps.map((s) => ({\n            id: s.id,\n            task: s.task,\n            agent: s.agent,\n            dependencies: s.dependencies ?? [],\n            parallel: s.parallel,\n            status: \"pending\" as PlanStepStatus,\n            subtasks: s.subtasks?.map((st) => ({\n              id: st.id,\n              task: st.task,\n              agent: st.agent,\n              status: \"pending\" as PlanStepStatus,\n            })),\n          })),\n        },\n        isOrchestrating: true,\n        parallelLevel: null,\n        orchestrationStartTime: Date.now(),\n      };\n    });\n  },\n\n  setStepStarted: (stepId) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find((s) => s.id === stepId);\n      if (step) {\n        step.status = \"running\";\n        step.startTime = Date.now();\n      }\n    });\n  },\n\n  setStepDone: (stepId, result) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find((s) => s.id === stepId);\n      if (step) {\n        step.status = \"complete\";\n        step.endTime = Date.now();\n        step.result = result;\n      }\n    });\n  },\n\n  setStepError: (stepId, error) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find((s) => s.id === stepId);\n      if (step) {\n        step.status = \"error\";\n        step.endTime = Date.now();\n        step.result = { error };\n      }\n    });\n  },\n\n  setSubtaskStarted: (parentId, subtaskId) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find(\n        (s) => s.id === parentId,\n      );\n      const subtask = step?.subtasks?.find((st) => st.id === subtaskId);\n      if (subtask) {\n        subtask.status = \"running\";\n        subtask.startTime = Date.now();\n      }\n    });\n  },\n\n  setSubtaskDone: (parentId, subtaskId, result) => {\n    set((state) => {\n      const step = state.planExecution.plan?.steps.find(\n        (s) => s.id === parentId,\n      );\n      const subtask = step?.subtasks?.find((st) => st.id === subtaskId);\n      if (subtask) {\n        subtask.status = \"complete\";\n        subtask.endTime = Date.now();\n      }\n    });\n  },\n\n  setLevelStarted: (level) => {\n    set((state) => {\n      state.planExecution.parallelLevel = level;\n    });\n  },\n\n  setOrchestrationDone: () => {\n    set((state) => {\n      state.planExecution.isOrchestrating = false;\n      state.planExecution.parallelLevel = null;\n    });\n  },\n\n  resetPlanExecution: () => {\n    set((state) => {\n      state.planExecution = initialPlanState;\n    });\n  },\n\n  // Getters\n  getActiveStep: () => {\n    const plan = get().planExecution.plan;\n    return plan?.steps.find((s) => s.status === \"running\") ?? null;\n  },\n\n  getActiveSubtask: () => {\n    const plan = get().planExecution.plan;\n    for (const step of plan?.steps ?? []) {\n      const activeSubtask = step.subtasks?.find(\n        (st) => st.status === \"running\",\n      );\n      if (activeSubtask) return activeSubtask;\n    }\n    return null;\n  },\n\n  getCompletedStepIds: () => {\n    const plan = get().planExecution.plan;\n    return (\n      plan?.steps.filter((s) => s.status === \"complete\").map((s) => s.id) ?? []\n    );\n  },\n\n  getPlanProgress: () => {\n    const plan = get().planExecution.plan;\n    if (!plan) return { completed: 0, total: 0, percentage: 0 };\n    const completed = plan.steps.filter((s) => s.status === \"complete\").length;\n    const total = plan.steps.length;\n    return {\n      completed,\n      total,\n      percentage: total > 0 ? Math.round((completed / total) * 100) : 0,\n    };\n  },\n\n  isPlanRunning: () => {\n    return get().planExecution.isOrchestrating;\n  },\n});\n","/**\n * Deep Research Slice - State management for deep research feature\n *\n * Manages research settings, active sessions, and results\n * Uses centralized configuration from @onegenui/deep-research\n */\nimport type { SliceCreator } from \"../types\";\n\n// =============================================================================\n// Types (aligned with @onegenui/deep-research/config)\n// =============================================================================\n\nexport type DeepResearchEffortLevel = \"standard\" | \"deep\" | \"max\";\n\nexport interface DeepResearchSettings {\n  enabled: boolean;\n  effortLevel: DeepResearchEffortLevel;\n  maxSteps: number;\n  parallelRequests: number;\n  autoStopOnQuality: boolean;\n  includeVisualizations: boolean;\n  qualityThreshold: number;\n}\n\nexport interface AuthenticatedSource {\n  platform: string;\n  displayName: string;\n  isConnected: boolean;\n  lastValidated?: Date;\n}\n\nexport interface ResearchPhase {\n  id: string;\n  label: string;\n  status: \"pending\" | \"running\" | \"complete\" | \"error\";\n  progress: number;\n  details?: string;\n  startTime?: number;\n  endTime?: number;\n}\n\nexport interface ResearchSource {\n  id: string;\n  url: string;\n  title: string;\n  domain: string;\n  credibility: number;\n  status: \"fetching\" | \"analyzing\" | \"complete\" | \"error\";\n}\n\nexport interface ActiveResearch {\n  id: string;\n  query: string;\n  effortLevel: DeepResearchEffortLevel;\n  status:\n    | \"initializing\"\n    | \"searching\"\n    | \"analyzing\"\n    | \"synthesizing\"\n    | \"complete\"\n    | \"error\"\n    | \"stopped\";\n  startTime: number;\n  estimatedTimeMs: number;\n  progress: number;\n  currentPhase: string;\n  phases: ResearchPhase[];\n  sources: ResearchSource[];\n  sourcesTarget: number;\n  error?: string;\n}\n\nexport interface ResearchResultSummary {\n  id: string;\n  query: string;\n  completedAt: number;\n  sourcesUsed: number;\n  qualityScore: number;\n  hasVisualizations: boolean;\n}\n\n// =============================================================================\n// Configuration (aligned with @onegenui/deep-research EFFORT_PRESETS)\n// =============================================================================\n\ninterface EffortPreset {\n  maxSteps: number;\n  parallelRequests: number;\n  qualityThreshold: number;\n  estimatedTimeMs: number;\n  sourcesTarget: number;\n}\n\nconst EFFORT_PRESETS: Record<DeepResearchEffortLevel, EffortPreset> = {\n  standard: {\n    maxSteps: 50,\n    parallelRequests: 10,\n    qualityThreshold: 0.75,\n    estimatedTimeMs: 3 * 60 * 1000,\n    sourcesTarget: 25,\n  },\n  deep: {\n    maxSteps: 100,\n    parallelRequests: 15,\n    qualityThreshold: 0.8,\n    estimatedTimeMs: 10 * 60 * 1000,\n    sourcesTarget: 50,\n  },\n  max: {\n    maxSteps: 200,\n    parallelRequests: 20,\n    qualityThreshold: 0.9,\n    estimatedTimeMs: 30 * 60 * 1000,\n    sourcesTarget: 100,\n  },\n};\n\nconst RESEARCH_PHASES: Array<{ id: string; label: string }> = [\n  { id: \"query-decomposition\", label: \"Query Decomposition\" },\n  { id: \"source-discovery\", label: \"Source Discovery\" },\n  { id: \"content-extraction\", label: \"Content Extraction\" },\n  { id: \"analysis\", label: \"Analysis\" },\n  { id: \"synthesis\", label: \"Synthesis\" },\n  { id: \"visualization\", label: \"Visualization\" },\n];\n\nconst createDefaultSettings = (): DeepResearchSettings => ({\n  enabled: false,\n  effortLevel: \"standard\",\n  ...EFFORT_PRESETS.standard,\n  autoStopOnQuality: true,\n  includeVisualizations: true,\n});\n\nconst MAX_HISTORY_SIZE = 20;\n\n// =============================================================================\n// Slice Interface\n// =============================================================================\n\nexport interface DeepResearchSlice {\n  // Settings\n  deepResearchSettings: DeepResearchSettings;\n  setDeepResearchEnabled: (enabled: boolean) => void;\n  setDeepResearchEffortLevel: (level: DeepResearchEffortLevel) => void;\n  setDeepResearchSettings: (settings: Partial<DeepResearchSettings>) => void;\n  resetDeepResearchSettings: () => void;\n\n  // Authenticated sources\n  authenticatedSources: AuthenticatedSource[];\n  setAuthenticatedSources: (sources: AuthenticatedSource[]) => void;\n  updateAuthenticatedSource: (\n    platform: string,\n    updates: Partial<AuthenticatedSource>,\n  ) => void;\n\n  // Active research session\n  activeResearch: ActiveResearch | null;\n  startResearch: (query: string) => void;\n  updateResearchProgress: (updates: Partial<ActiveResearch>) => void;\n  updateResearchPhase: (\n    phaseId: string,\n    updates: Partial<ResearchPhase>,\n  ) => void;\n  addResearchSource: (source: ResearchSource) => void;\n  updateResearchSource: (\n    sourceId: string,\n    updates: Partial<ResearchSource>,\n  ) => void;\n  stopResearch: () => void;\n  completeResearch: (qualityScore: number) => void;\n  failResearch: (error: string) => void;\n  clearActiveResearch: () => void;\n\n  // Research history\n  researchHistory: ResearchResultSummary[];\n  addToResearchHistory: (result: ResearchResultSummary) => void;\n  clearResearchHistory: () => void;\n}\n\n// =============================================================================\n// Slice Creator\n// =============================================================================\n\nexport const createDeepResearchSlice: SliceCreator<DeepResearchSlice> = (\n  set,\n) => ({\n  // Settings\n  deepResearchSettings: createDefaultSettings(),\n\n  setDeepResearchEnabled: (enabled) =>\n    set((state) => {\n      state.deepResearchSettings.enabled = enabled;\n    }),\n\n  setDeepResearchEffortLevel: (level) =>\n    set((state) => {\n      const preset = EFFORT_PRESETS[level];\n      state.deepResearchSettings = {\n        ...state.deepResearchSettings,\n        effortLevel: level,\n        maxSteps: preset.maxSteps,\n        parallelRequests: preset.parallelRequests,\n        qualityThreshold: preset.qualityThreshold,\n      };\n    }),\n\n  setDeepResearchSettings: (settings) =>\n    set((state) => {\n      Object.assign(state.deepResearchSettings, settings);\n    }),\n\n  resetDeepResearchSettings: () =>\n    set((state) => {\n      state.deepResearchSettings = createDefaultSettings();\n    }),\n\n  // Authenticated sources\n  authenticatedSources: [],\n\n  setAuthenticatedSources: (sources) =>\n    set((state) => {\n      state.authenticatedSources = sources;\n    }),\n\n  updateAuthenticatedSource: (platform, updates) =>\n    set((state) => {\n      const index = state.authenticatedSources.findIndex(\n        (s) => s.platform === platform,\n      );\n      if (index >= 0) {\n        Object.assign(state.authenticatedSources[index]!, updates);\n      }\n    }),\n\n  // Active research\n  activeResearch: null,\n\n  startResearch: (query) =>\n    set((state) => {\n      const level = state.deepResearchSettings.effortLevel;\n      const preset = EFFORT_PRESETS[level];\n\n      state.activeResearch = {\n        id: `research-${Date.now()}`,\n        query,\n        effortLevel: level,\n        status: \"initializing\",\n        startTime: Date.now(),\n        estimatedTimeMs: preset.estimatedTimeMs,\n        progress: 0,\n        currentPhase: RESEARCH_PHASES[0]!.label,\n        phases: RESEARCH_PHASES.map((p, i) => ({\n          ...p,\n          status: i === 0 ? \"running\" : \"pending\",\n          progress: 0,\n        })),\n        sources: [],\n        sourcesTarget: preset.sourcesTarget,\n      };\n    }),\n\n  updateResearchProgress: (updates) =>\n    set((state) => {\n      if (state.activeResearch) {\n        Object.assign(state.activeResearch, updates);\n      }\n    }),\n\n  updateResearchPhase: (phaseId, updates) =>\n    set((state) => {\n      if (state.activeResearch) {\n        const phase = state.activeResearch.phases.find((p) => p.id === phaseId);\n        if (phase) {\n          Object.assign(phase, updates);\n        }\n      }\n    }),\n\n  addResearchSource: (source) =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.sources.push(source);\n      }\n    }),\n\n  updateResearchSource: (sourceId, updates) =>\n    set((state) => {\n      if (state.activeResearch) {\n        const source = state.activeResearch.sources.find(\n          (s) => s.id === sourceId,\n        );\n        if (source) {\n          Object.assign(source, updates);\n        }\n      }\n    }),\n\n  stopResearch: () =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.status = \"stopped\";\n      }\n    }),\n\n  completeResearch: (qualityScore) =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.status = \"complete\";\n        state.activeResearch.progress = 100;\n\n        // Add to history\n        state.researchHistory.unshift({\n          id: state.activeResearch.id,\n          query: state.activeResearch.query,\n          completedAt: Date.now(),\n          sourcesUsed: state.activeResearch.sources.filter(\n            (s) => s.status === \"complete\",\n          ).length,\n          qualityScore,\n          hasVisualizations: state.deepResearchSettings.includeVisualizations,\n        });\n\n        // Trim history\n        if (state.researchHistory.length > MAX_HISTORY_SIZE) {\n          state.researchHistory = state.researchHistory.slice(\n            0,\n            MAX_HISTORY_SIZE,\n          );\n        }\n      }\n    }),\n\n  failResearch: (error) =>\n    set((state) => {\n      if (state.activeResearch) {\n        state.activeResearch.status = \"error\";\n        state.activeResearch.error = error;\n      }\n    }),\n\n  clearActiveResearch: () =>\n    set((state) => {\n      state.activeResearch = null;\n    }),\n\n  // History\n  researchHistory: [],\n\n  addToResearchHistory: (result) =>\n    set((state) => {\n      state.researchHistory.unshift(result);\n      if (state.researchHistory.length > MAX_HISTORY_SIZE) {\n        state.researchHistory = state.researchHistory.slice(\n          0,\n          MAX_HISTORY_SIZE,\n        );\n      }\n    }),\n\n  clearResearchHistory: () =>\n    set((state) => {\n      state.researchHistory = [];\n    }),\n});\n","/**\n * UI Tree Slice - Streaming UI state management\n *\n * This slice manages the UI tree state during streaming generation.\n * Using Zustand ensures proper reactivity when the tree is updated\n * from async stream handlers.\n */\nimport type { UITree, UIElement, JsonPatch } from \"@onegenui/core\";\nimport type { SliceCreator } from \"../types\";\n\nexport interface UITreeSlice {\n  // State\n  uiTree: UITree | null;\n  isTreeStreaming: boolean;\n  treeVersion: number; // Force re-renders by incrementing\n\n  // Actions\n  setUITree: (tree: UITree | null) => void;\n  updateUITree: (updater: (tree: UITree) => UITree) => void;\n  setElement: (key: string, element: UIElement) => void;\n  removeElement: (key: string) => void;\n  applyTreePatch: (patch: JsonPatch) => void;\n  setTreeStreaming: (streaming: boolean) => void;\n  clearUITree: () => void;\n  bumpTreeVersion: () => void;\n}\n\nconst initialTree: UITree | null = null;\n\nexport const createUITreeSlice: SliceCreator<UITreeSlice> = (set, get) => ({\n  // State\n  uiTree: initialTree,\n  isTreeStreaming: false,\n  treeVersion: 0,\n\n  // Actions\n  setUITree: (tree) =>\n    set((state) => {\n      state.uiTree = tree;\n      state.treeVersion += 1;\n    }),\n\n  updateUITree: (updater) =>\n    set((state) => {\n      if (state.uiTree) {\n        const updated = updater(state.uiTree);\n        state.uiTree = updated;\n        state.treeVersion += 1;\n      }\n    }),\n\n  setElement: (key, element) =>\n    set((state) => {\n      if (state.uiTree) {\n        state.uiTree.elements[key] = element;\n        state.treeVersion += 1;\n      }\n    }),\n\n  removeElement: (key) =>\n    set((state) => {\n      if (state.uiTree && state.uiTree.elements[key]) {\n        delete state.uiTree.elements[key];\n        state.treeVersion += 1;\n      }\n    }),\n\n  applyTreePatch: (patch) =>\n    set((state) => {\n      if (!state.uiTree) return;\n\n      // Handle add/replace operations for elements\n      if (\n        (patch.op === \"add\" || patch.op === \"replace\") &&\n        patch.path.startsWith(\"/elements/\")\n      ) {\n        const key = patch.path.replace(\"/elements/\", \"\").split(\"/\")[0];\n        if (key && patch.value) {\n          if (patch.path === `/elements/${key}`) {\n            // Full element replacement\n            state.uiTree.elements[key] = patch.value as UIElement;\n          } else {\n            // Nested property update - ensure element exists\n            if (!state.uiTree.elements[key]) {\n              state.uiTree.elements[key] = {\n                type: \"unknown\",\n                props: {},\n              } as UIElement;\n            }\n            // Apply nested update via JSON pointer\n            applyNestedPatch(\n              state.uiTree.elements[key],\n              patch.path.replace(`/elements/${key}`, \"\"),\n              patch.value,\n            );\n          }\n          state.treeVersion += 1;\n        }\n      }\n\n      // Handle root changes\n      if (patch.path === \"/root\" && typeof patch.value === \"string\") {\n        state.uiTree.root = patch.value;\n        state.treeVersion += 1;\n      }\n    }),\n\n  setTreeStreaming: (streaming) => set({ isTreeStreaming: streaming }),\n\n  clearUITree: () =>\n    set((state) => {\n      state.uiTree = null;\n      state.treeVersion = 0;\n      state.isTreeStreaming = false;\n    }),\n\n  bumpTreeVersion: () =>\n    set((state) => {\n      state.treeVersion += 1;\n    }),\n});\n\n/**\n * Apply a nested patch to an object using JSON pointer path\n */\nfunction applyNestedPatch(obj: unknown, path: string, value: unknown): void {\n  if (!path || path === \"/\") {\n    return;\n  }\n\n  const parts = path.slice(1).split(\"/\");\n  let current = obj as Record<string, unknown>;\n\n  for (let i = 0; i < parts.length - 1; i++) {\n    const key = parts[i]!;\n    if (!current[key] || typeof current[key] !== \"object\") {\n      current[key] = {};\n    }\n    current = current[key] as Record<string, unknown>;\n  }\n\n  const lastKey = parts[parts.length - 1]!;\n  current[lastKey] = value;\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport {\n  evaluateVisibility,\n  type VisibilityCondition,\n  type VisibilityContext as CoreVisibilityContext,\n} from \"@onegenui/core\";\nimport { useData } from \"./data\";\n\n/**\n * Visibility context value\n */\nexport interface VisibilityContextValue {\n  /** Evaluate a visibility condition */\n  isVisible: (condition: VisibilityCondition | undefined) => boolean;\n  /** The underlying visibility context */\n  ctx: CoreVisibilityContext;\n}\n\nconst VisibilityContext = createContext<VisibilityContextValue | null>(null);\n\n/**\n * Props for VisibilityProvider\n */\nexport interface VisibilityProviderProps {\n  children: ReactNode;\n}\n\n/**\n * Provider for visibility evaluation\n */\nexport function VisibilityProvider({ children }: VisibilityProviderProps) {\n  const { data, authState } = useData();\n\n  const ctx: CoreVisibilityContext = useMemo(\n    () => ({\n      dataModel: data,\n      authState,\n    }),\n    [data, authState],\n  );\n\n  const isVisible = useMemo(\n    () => (condition: VisibilityCondition | undefined) =>\n      evaluateVisibility(condition, ctx),\n    [ctx],\n  );\n\n  const value = useMemo<VisibilityContextValue>(\n    () => ({ isVisible, ctx }),\n    [isVisible, ctx],\n  );\n\n  return (\n    <VisibilityContext.Provider value={value}>\n      {children}\n    </VisibilityContext.Provider>\n  );\n}\n\n/**\n * Hook to access visibility evaluation\n */\nexport function useVisibility(): VisibilityContextValue {\n  const ctx = useContext(VisibilityContext);\n  if (!ctx) {\n    throw new Error(\"useVisibility must be used within a VisibilityProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to check if a condition is visible\n */\nexport function useIsVisible(\n  condition: VisibilityCondition | undefined,\n): boolean {\n  const { isVisible } = useVisibility();\n  return isVisible(condition);\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport {\n  resolveAction,\n  executeAction,\n  type Action,\n  type ActionHandler,\n  type ActionConfirm,\n  type ResolvedAction,\n} from \"@onegenui/core\";\nimport { useData } from \"./data\";\nimport { useStore } from \"../store\";\nimport { cn } from \"../utils\";\n\n/**\n * Pending confirmation state\n */\nexport interface PendingConfirmation {\n  /** The resolved action */\n  action: ResolvedAction;\n  /** The action handler */\n  handler: ActionHandler;\n  /** Resolve callback */\n  resolve: () => void;\n  /** Reject callback */\n  reject: () => void;\n}\n\n/**\n * Action tracking callback type\n */\nexport type ActionTrackingCallback = (info: {\n  actionName: string;\n  params: Record<string, unknown>;\n  elementType?: string;\n  context?: Record<string, unknown>;\n}) => void;\n\n/**\n * Action context value\n */\nexport interface ActionContextValue {\n  /** Registered action handlers */\n  handlers: Record<string, ActionHandler>;\n  /** Currently loading action names */\n  loadingActions: Set<string>;\n  /** Pending confirmation dialog */\n  pendingConfirmation: PendingConfirmation | null;\n  /** Execute an action */\n  execute: (action: Action) => Promise<void>;\n  /** Confirm the pending action */\n  confirm: () => void;\n  /** Cancel the pending action */\n  cancel: () => void;\n  /** Register an action handler */\n  registerHandler: (name: string, handler: ActionHandler) => void;\n}\n\nconst ActionContext = createContext<ActionContextValue | null>(null);\n\n/**\n * Props for ActionProvider\n */\nexport interface ActionProviderProps {\n  /** Initial action handlers */\n  handlers?: Record<string, ActionHandler>;\n  /** Navigation function */\n  navigate?: (path: string) => void;\n  /** Optional callback to track executed actions (for proactive AI) */\n  onActionExecuted?: ActionTrackingCallback;\n  children: ReactNode;\n}\n\n/**\n * Provider for action execution - Now uses Zustand for state\n */\nexport function ActionProvider({\n  handlers: initialHandlers = {},\n  navigate,\n  onActionExecuted,\n  children,\n}: ActionProviderProps) {\n  const { data, set } = useData();\n\n  // Bridge to Zustand store\n  const loadingActions = useStore((s) => s.loadingActions);\n  const setActionLoading = useStore((s) => s.setActionLoading);\n  const clearActionLoading = useStore((s) => s.clearActionLoading);\n  const pendingConfirmations = useStore((s) => s.pendingConfirmations);\n  const addConfirmation = useStore((s) => s.addConfirmation);\n  const removeConfirmation = useStore((s) => s.removeConfirmation);\n  const addToHistory = useStore((s) => s.addToHistory);\n\n  // Local handlers state (not in store - these are callback functions)\n  const [handlers, setHandlers] =\n    React.useState<Record<string, ActionHandler>>(initialHandlers);\n\n  // Track current pending confirmation with callbacks (not serializable in store)\n  const [localPendingConfirmation, setLocalPendingConfirmation] =\n    React.useState<PendingConfirmation | null>(null);\n\n  const registerHandler = useCallback(\n    (name: string, handler: ActionHandler) => {\n      setHandlers((prev) => ({ ...prev, [name]: handler }));\n    },\n    [],\n  );\n\n  const execute = useCallback(\n    async (action: Action) => {\n      const resolved = resolveAction(action, data);\n      const handler = handlers[resolved.name];\n\n      if (!handler) {\n        console.warn(`No handler registered for action: ${resolved.name}`);\n        return;\n      }\n\n      // Track the action execution if callback is provided\n      const trackExecution = () => {\n        addToHistory({\n          actionName: resolved.name,\n          payload: resolved.params,\n        });\n        onActionExecuted?.({\n          actionName: resolved.name,\n          params: resolved.params,\n        });\n      };\n\n      // If confirmation is required, show dialog\n      if (resolved.confirm) {\n        const confirmId = addConfirmation({\n          actionName: resolved.name,\n          title: resolved.confirm.title,\n          message: resolved.confirm.message,\n          confirmText: resolved.confirm.confirmLabel,\n          cancelText: resolved.confirm.cancelLabel,\n          payload: resolved.params,\n        });\n\n        return new Promise<void>((resolve, reject) => {\n          setLocalPendingConfirmation({\n            action: resolved,\n            handler,\n            resolve: () => {\n              removeConfirmation(confirmId);\n              setLocalPendingConfirmation(null);\n              resolve();\n            },\n            reject: () => {\n              removeConfirmation(confirmId);\n              setLocalPendingConfirmation(null);\n              reject(new Error(\"Action cancelled\"));\n            },\n          });\n        }).then(async () => {\n          setActionLoading(resolved.name, true);\n          try {\n            await executeAction({\n              action: resolved,\n              handler,\n              setData: set,\n              navigate,\n              executeAction: async (name) => {\n                const subAction: Action = { name };\n                await execute(subAction);\n              },\n            });\n            trackExecution();\n          } finally {\n            clearActionLoading(resolved.name);\n          }\n        });\n      }\n\n      // Execute immediately\n      setActionLoading(resolved.name, true);\n      try {\n        await executeAction({\n          action: resolved,\n          handler,\n          setData: set,\n          navigate,\n          executeAction: async (name) => {\n            const subAction: Action = { name };\n            await execute(subAction);\n          },\n        });\n        trackExecution();\n      } finally {\n        clearActionLoading(resolved.name);\n      }\n    },\n    [\n      data,\n      handlers,\n      set,\n      navigate,\n      onActionExecuted,\n      setActionLoading,\n      clearActionLoading,\n      addConfirmation,\n      removeConfirmation,\n      addToHistory,\n    ],\n  );\n\n  const confirm = useCallback(() => {\n    localPendingConfirmation?.resolve();\n  }, [localPendingConfirmation]);\n\n  const cancel = useCallback(() => {\n    localPendingConfirmation?.reject();\n  }, [localPendingConfirmation]);\n\n  const value = useMemo<ActionContextValue>(\n    () => ({\n      handlers,\n      loadingActions,\n      pendingConfirmation: localPendingConfirmation,\n      execute,\n      confirm,\n      cancel,\n      registerHandler,\n    }),\n    [\n      handlers,\n      loadingActions,\n      localPendingConfirmation,\n      execute,\n      confirm,\n      cancel,\n      registerHandler,\n    ],\n  );\n\n  return (\n    <ActionContext.Provider value={value}>{children}</ActionContext.Provider>\n  );\n}\n\n/**\n * Hook to access action context\n */\nexport function useActions(): ActionContextValue {\n  const ctx = useContext(ActionContext);\n  if (!ctx) {\n    throw new Error(\"useActions must be used within an ActionProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to execute an action\n */\nexport function useAction(action: Action): {\n  execute: () => Promise<void>;\n  isLoading: boolean;\n} {\n  const { execute, loadingActions } = useActions();\n  const isLoading = loadingActions.has(action.name);\n\n  const executeAction = useCallback(() => execute(action), [execute, action]);\n\n  return { execute: executeAction, isLoading };\n}\n\n/**\n * Props for ConfirmDialog component\n */\nexport interface ConfirmDialogProps {\n  /** The confirmation config */\n  confirm: ActionConfirm;\n  /** Called when confirmed */\n  onConfirm: () => void;\n  /** Called when cancelled */\n  onCancel: () => void;\n}\n\n// ... existing code ...\n\n/**\n * Default confirmation dialog component\n */\nexport function ConfirmDialog({\n  confirm,\n  onConfirm,\n  onCancel,\n}: ConfirmDialogProps) {\n  const isDanger = confirm.variant === \"danger\";\n\n  return (\n    <div\n      className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\"\n      onClick={onCancel}\n    >\n      <div\n        className=\"bg-white rounded-lg p-6 max-w-[400px] w-full shadow-2xl\"\n        onClick={(e) => e.stopPropagation()}\n      >\n        <h3 className=\"m-0 mb-2 text-lg font-semibold\">{confirm.title}</h3>\n        <p className=\"m-0 mb-6 text-gray-500\">{confirm.message}</p>\n        <div className=\"flex gap-3 justify-end\">\n          <button\n            onClick={onCancel}\n            className=\"px-4 py-2 rounded-md border border-gray-300 bg-white cursor-pointer hover:bg-gray-50 transition-colors\"\n          >\n            {confirm.cancelLabel ?? \"Cancel\"}\n          </button>\n          <button\n            onClick={onConfirm}\n            className={cn(\n              \"px-4 py-2 rounded-md border-none text-white cursor-pointer transition-colors\",\n              isDanger\n                ? \"bg-red-600 hover:bg-red-700\"\n                : \"bg-blue-500 hover:bg-blue-600\",\n            )}\n          >\n            {confirm.confirmLabel ?? \"Confirm\"}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport {\n  runValidation,\n  type ValidationConfig,\n  type ValidationFunction,\n  type ValidationResult,\n} from \"@onegenui/core\";\nimport { useData } from \"./data\";\nimport { useStore } from \"../store\";\n\n/**\n * Field validation state\n */\nexport interface FieldValidationState {\n  /** Whether the field has been touched */\n  touched: boolean;\n  /** Whether the field has been validated */\n  validated: boolean;\n  /** Validation result */\n  result: ValidationResult | null;\n}\n\n/**\n * Validation context value\n */\nexport interface ValidationContextValue {\n  /** Custom validation functions from catalog */\n  customFunctions: Record<string, ValidationFunction>;\n  /** Validation state by field path */\n  fieldStates: Record<string, FieldValidationState>;\n  /** Validate a field */\n  validate: (path: string, config: ValidationConfig) => ValidationResult;\n  /** Mark field as touched */\n  touch: (path: string) => void;\n  /** Clear validation for a field */\n  clear: (path: string) => void;\n  /** Validate all fields */\n  validateAll: () => boolean;\n  /** Register field config */\n  registerField: (path: string, config: ValidationConfig) => void;\n}\n\nconst ValidationContext = createContext<ValidationContextValue | null>(null);\n\n/**\n * Props for ValidationProvider\n */\nexport interface ValidationProviderProps {\n  /** Custom validation functions from catalog */\n  customFunctions?: Record<string, ValidationFunction>;\n  children: ReactNode;\n}\n\n/**\n * Provider for validation - Now uses Zustand for state\n */\nexport function ValidationProvider({\n  customFunctions = {},\n  children,\n}: ValidationProviderProps) {\n  const { data, authState } = useData();\n\n  // Bridge to Zustand store for field states\n  const fieldStates = useStore((s) => s.fieldStates);\n  const touchField = useStore((s) => s.touchField);\n  const setFieldValidation = useStore((s) => s.setFieldValidation);\n  const clearFieldValidation = useStore((s) => s.clearFieldValidation);\n\n  // Local state for field configs (not serializable - contains functions)\n  const [fieldConfigs, setFieldConfigs] = React.useState<\n    Record<string, ValidationConfig>\n  >({});\n\n  const registerField = useCallback(\n    (path: string, config: ValidationConfig) => {\n      setFieldConfigs((prev) => ({ ...prev, [path]: config }));\n    },\n    [],\n  );\n\n  const validate = useCallback(\n    (path: string, config: ValidationConfig): ValidationResult => {\n      const value = data[path.split(\"/\").filter(Boolean).join(\".\")];\n      const result = runValidation(config, {\n        value,\n        dataModel: data,\n        customFunctions,\n        authState,\n      });\n\n      // Store validation result in Zustand\n      setFieldValidation(path, {\n        isValid: result.valid,\n        errors: result.errors,\n        // ValidationResult from core doesn't have warnings, use empty array\n        warnings: [],\n      });\n\n      return result;\n    },\n    [data, customFunctions, authState, setFieldValidation],\n  );\n\n  const touch = useCallback(\n    (path: string) => {\n      touchField(path);\n    },\n    [touchField],\n  );\n\n  const clear = useCallback(\n    (path: string) => {\n      clearFieldValidation(path);\n    },\n    [clearFieldValidation],\n  );\n\n  const validateAll = useCallback(() => {\n    let allValid = true;\n\n    for (const [path, config] of Object.entries(fieldConfigs)) {\n      const result = validate(path, config);\n      if (!result.valid) {\n        allValid = false;\n      }\n    }\n\n    return allValid;\n  }, [fieldConfigs, validate]);\n\n  // Convert Zustand field states to context format\n  const contextFieldStates = useMemo(() => {\n    const result: Record<string, FieldValidationState> = {};\n    for (const [path, state] of Object.entries(fieldStates)) {\n      result[path] = {\n        touched: state.touched,\n        validated: state.validationResult !== null,\n        result: state.validationResult\n          ? {\n              valid: state.validationResult.isValid,\n              errors: state.validationResult.errors,\n              checks: [], // ValidationResult requires checks\n            }\n          : null,\n      };\n    }\n    return result;\n  }, [fieldStates]);\n\n  const value = useMemo<ValidationContextValue>(\n    () => ({\n      customFunctions,\n      fieldStates: contextFieldStates,\n      validate,\n      touch,\n      clear,\n      validateAll,\n      registerField,\n    }),\n    [\n      customFunctions,\n      contextFieldStates,\n      validate,\n      touch,\n      clear,\n      validateAll,\n      registerField,\n    ],\n  );\n\n  return (\n    <ValidationContext.Provider value={value}>\n      {children}\n    </ValidationContext.Provider>\n  );\n}\n\n/**\n * Hook to access validation context\n */\nexport function useValidation(): ValidationContextValue {\n  const ctx = useContext(ValidationContext);\n  if (!ctx) {\n    throw new Error(\"useValidation must be used within a ValidationProvider\");\n  }\n  return ctx;\n}\n\n/**\n * Hook to get validation state for a field\n */\nexport function useFieldValidation(\n  path: string,\n  config?: ValidationConfig,\n): {\n  state: FieldValidationState;\n  validate: () => ValidationResult;\n  touch: () => void;\n  clear: () => void;\n  errors: string[];\n  isValid: boolean;\n} {\n  const {\n    fieldStates,\n    validate: validateField,\n    touch: touchField,\n    clear: clearField,\n    registerField,\n  } = useValidation();\n\n  // Stabilize config reference to avoid infinite loops\n  const configJson = config ? JSON.stringify(config) : null;\n\n  // Register field on mount or when config changes\n  React.useEffect(() => {\n    if (config && configJson) {\n      registerField(path, config);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [path, configJson, registerField]);\n\n  const state = fieldStates[path] ?? {\n    touched: false,\n    validated: false,\n    result: null,\n  };\n\n  const validate = useCallback(\n    () => validateField(path, config ?? { checks: [] }),\n    [path, config, validateField],\n  );\n\n  const touch = useCallback(() => touchField(path), [path, touchField]);\n  const clear = useCallback(() => clearField(path), [path, clearField]);\n\n  return {\n    state,\n    validate,\n    touch,\n    clear,\n    errors: state.result?.errors ?? [],\n    isValid: state.result?.valid ?? true,\n  };\n}\n","\"use client\";\n\nimport { createContext } from \"react\";\nimport type { SelectionContextValue } from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const SelectionContext = createContext<\n  SelectionContextValue | undefined\n>(undefined);\n","\"use client\";\n\nimport React, { useMemo, useEffect, useCallback } from \"react\";\nimport { SelectionContext } from \"./context\";\nimport { SELECTION_STYLE_ID, SELECTION_CSS } from \"./styles\";\nimport { getUniqueCSSPath } from \"./utils\";\nimport { useSelectionState } from \"./use-selection-state\";\nimport { useLongPress } from \"./use-long-press\";\nimport type { SelectionContextValue, SelectionProviderProps } from \"./types\";\n\n/**\n * Provider for granular item selection within components.\n *\n * Architecture:\n * - `deepSelections` is the SINGLE SOURCE OF TRUTH for all selections\n * - `granularSelection` is DERIVED from deepSelections (flat structure for component API)\n * - This ensures visual state and logical state are always in sync\n *\n * Features:\n * - Automatic event delegation: components only need data-* attributes\n * - Global CSS injection for consistent styling\n * - Zero boilerplate in components\n *\n * Components should add these attributes to selectable items:\n * - data-selectable-item: marks the element as selectable\n * - data-element-key: the component's element.key\n * - data-item-id: unique identifier for the item\n */\nexport function SelectionProvider({ children }: SelectionProviderProps) {\n  const selectionState = useSelectionState();\n  const {\n    deepSelections,\n    granularSelection,\n    addSelection,\n    removeSelectionByElement,\n    toggleSelection,\n    clearSelection,\n    isSelected,\n    getSelectedItems,\n    selectedElementsRef,\n    deepSelectionActiveRef,\n    setDeepSelectionActive,\n  } = selectionState;\n\n  // Function to check if deep selection is active\n  const isDeepSelectionActive = useCallback(\n    () => deepSelectionActiveRef.current,\n    [deepSelectionActiveRef],\n  );\n\n  // Clear all deep selections and remove visual feedback\n  const clearDeepSelection = () => {\n    // Clear elements from ref\n    selectedElementsRef.current.forEach((el) => {\n      el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n      el.removeAttribute(\"aria-selected\");\n    });\n    selectedElementsRef.current.clear();\n\n    // Also query DOM directly in case elements were re-rendered\n    if (typeof document !== \"undefined\") {\n      document\n        .querySelectorAll(\".jsonui-deep-selected, .jsonui-item-selected\")\n        .forEach((el) => {\n          el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n          el.removeAttribute(\"aria-selected\");\n        });\n    }\n\n    clearSelection();\n  };\n\n  // Handle long-press selection\n  const handleLongPress = (\n    target: HTMLElement,\n    componentWrapper: HTMLElement,\n  ) => {\n    const elementKey = componentWrapper.getAttribute(\"data-jsonui-element-key\");\n    if (!elementKey) return;\n\n    // Check if already selected (toggle off)\n    if (selectedElementsRef.current.has(target)) {\n      target.classList.remove(\"jsonui-deep-selected\");\n      target.removeAttribute(\"aria-selected\");\n      removeSelectionByElement(target);\n      return;\n    }\n\n    // Set flag to prevent component-level selection (via context ref, no global pollution)\n    setDeepSelectionActive();\n\n    // Generate CSS path\n    const cssPath = getUniqueCSSPath(target, componentWrapper);\n    const textContent = (target.textContent || \"\").trim().substring(0, 100);\n\n    // Apply visual selection\n    target.classList.add(\"jsonui-deep-selected\");\n    target.setAttribute(\"aria-selected\", \"true\");\n\n    // Haptic feedback on mobile\n    if (navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n\n    // Find containing selectable-item\n    const selectableItem = target.closest(\n      \"[data-selectable-item]\",\n    ) as HTMLElement | null;\n    const itemId = selectableItem?.getAttribute(\"data-item-id\") || undefined;\n\n    addSelection({\n      elementKey,\n      cssPath,\n      tagName: target.tagName.toLowerCase(),\n      textContent,\n      element: target,\n      selectionType: \"granular\",\n      itemId,\n    });\n  };\n\n  // Handle click selection\n  const handleClick = (target: HTMLElement, _event: MouseEvent) => {\n    // Check for selectable-item click\n    const selectableItem = target.closest(\n      \"[data-selectable-item]\",\n    ) as HTMLElement | null;\n    if (selectableItem) {\n      const componentWrapper = selectableItem.closest(\n        \"[data-jsonui-element-key]\",\n      ) as HTMLElement | null;\n      if (!componentWrapper) return;\n\n      const elementKey = componentWrapper.getAttribute(\n        \"data-jsonui-element-key\",\n      );\n      if (!elementKey) return;\n\n      // Toggle if already selected\n      if (selectedElementsRef.current.has(selectableItem)) {\n        selectableItem.classList.remove(\n          \"jsonui-deep-selected\",\n          \"jsonui-item-selected\",\n        );\n        selectableItem.removeAttribute(\"aria-selected\");\n        removeSelectionByElement(selectableItem);\n        return;\n      }\n\n      const itemId = selectableItem.getAttribute(\"data-item-id\") || undefined;\n      const cssPath = getUniqueCSSPath(selectableItem, componentWrapper);\n      const textContent = (selectableItem.textContent || \"\")\n        .trim()\n        .substring(0, 200);\n\n      // Apply visual selection\n      selectableItem.classList.add(\n        \"jsonui-deep-selected\",\n        \"jsonui-item-selected\",\n      );\n      selectableItem.setAttribute(\"aria-selected\", \"true\");\n\n      addSelection({\n        elementKey,\n        cssPath,\n        tagName: selectableItem.tagName.toLowerCase(),\n        textContent,\n        element: selectableItem,\n        selectionType: \"item\",\n        itemId,\n      });\n      return;\n    }\n\n    // Check for click outside to clear selection\n    const componentWrapper = target.closest(\"[data-jsonui-element-key]\");\n    const isInChatArea =\n      target.closest(\"[data-chat-sidebar]\") ||\n      target.closest(\"input\") ||\n      target.closest(\"textarea\") ||\n      target.closest(\"[data-jsonui-no-clear-selection]\");\n\n    if (\n      !componentWrapper &&\n      !isInChatArea &&\n      selectedElementsRef.current.size > 0\n    ) {\n      clearDeepSelection();\n    }\n  };\n\n  // Use the long-press hook for event handling\n  useLongPress(\n    {\n      onLongPress: handleLongPress,\n      onClick: handleClick,\n    },\n    { debug: false },\n  );\n\n  // Keyboard shortcuts for selection\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Escape - clear all selections\n      if (e.key === \"Escape\" && deepSelections.length > 0) {\n        e.preventDefault();\n        clearDeepSelection();\n        return;\n      }\n\n      // Delete/Backspace - clear selections (alternative to Escape)\n      if (\n        (e.key === \"Delete\" || e.key === \"Backspace\") &&\n        deepSelections.length > 0 &&\n        !document.activeElement?.matches(\"input, textarea, [contenteditable]\")\n      ) {\n        e.preventDefault();\n        clearDeepSelection();\n        return;\n      }\n    };\n\n    document.addEventListener(\"keydown\", handleKeyDown);\n    return () => document.removeEventListener(\"keydown\", handleKeyDown);\n  }, [deepSelections, clearDeepSelection]);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      selectedElementsRef.current.forEach((el) => {\n        el.classList.remove(\"jsonui-deep-selected\");\n        el.removeAttribute(\"aria-selected\");\n      });\n    };\n  }, [selectedElementsRef]);\n\n  // CSS Injection\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n    if (document.getElementById(SELECTION_STYLE_ID)) return;\n\n    const style = document.createElement(\"style\");\n    style.id = SELECTION_STYLE_ID;\n    style.textContent = SELECTION_CSS;\n    document.head.appendChild(style);\n\n    return () => {\n      const el = document.getElementById(SELECTION_STYLE_ID);\n      if (el) el.remove();\n    };\n  }, []);\n\n  const value = useMemo<SelectionContextValue>(\n    () => ({\n      granularSelection,\n      toggleSelection,\n      clearSelection,\n      isSelected,\n      getSelectedItems,\n      deepSelections,\n      clearDeepSelection,\n      isDeepSelectionActive,\n    }),\n    [\n      granularSelection,\n      toggleSelection,\n      clearSelection,\n      isSelected,\n      getSelectedItems,\n      deepSelections,\n      isDeepSelectionActive,\n    ],\n  );\n\n  return (\n    <SelectionContext.Provider value={value}>\n      {children}\n    </SelectionContext.Provider>\n  );\n}\n","// ─────────────────────────────────────────────────────────────────────────────\n// Selection CSS Styles\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const SELECTION_STYLE_ID = \"jsonui-selection-styles\";\n\nexport const SELECTION_CSS = `\n@keyframes selection-shimmer {\n  0% {\n    background-position: -200% 0;\n  }\n  100% {\n    background-position: 200% 0;\n  }\n}\n\n@keyframes selection-pulse {\n  0%, 100% {\n    box-shadow: inset 0 0 0 2px var(--primary, #3b82f6), 0 0 0 0 rgba(59, 130, 246, 0.4);\n  }\n  50% {\n    box-shadow: inset 0 0 0 2px var(--primary, #3b82f6), 0 0 12px 2px rgba(59, 130, 246, 0.2);\n  }\n}\n\n/* ─────────────────────────────────────────────────────────────────────────────\n   TEXT SELECTION: Enable native text selection for copy/paste\n   ───────────────────────────────────────────────────────────────────────────── */\n\n/* Enable text selection on all JSON-UI components by default */\n[data-jsonui-element-key] {\n  user-select: text;\n  -webkit-user-select: text;\n}\n\n/* Prevent text selection from being cleared when clicking in chat sidebar */\n[data-chat-sidebar] {\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n/* But allow selection in chat input fields */\n[data-chat-sidebar] input,\n[data-chat-sidebar] textarea {\n  user-select: text;\n  -webkit-user-select: text;\n}\n\n/* Disable text selection on interactive elements to prevent accidental selection */\n[data-interactive],\n[data-jsonui-element-key] button,\n[data-jsonui-element-key] [role=\"button\"],\n[data-jsonui-element-key] input,\n[data-jsonui-element-key] select,\n[data-jsonui-element-key] textarea,\n[data-jsonui-element-key] label,\n[data-jsonui-element-key] [draggable=\"true\"] {\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n/* But allow selection on text content within labels */\n[data-jsonui-element-key] label span,\n[data-jsonui-element-key] label p {\n  user-select: text;\n  -webkit-user-select: text;\n}\n\n/* ─────────────────────────────────────────────────────────────────────────────\n   ITEM SELECTION: Click on data-selectable-item elements\n   ───────────────────────────────────────────────────────────────────────────── */\n\n[data-selectable-item] {\n  cursor: pointer;\n  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  border-radius: 8px;\n  position: relative;\n}\n\n[data-selectable-item]:hover:not([data-selected=\"true\"]):not(.jsonui-item-selected) {\n  background-color: rgba(255, 255, 255, 0.03);\n  transform: translateY(-1px);\n}\n\n/* Data attribute based selection */\n[data-selectable-item][data-selected=\"true\"] {\n  background: linear-gradient(\n    110deg,\n    #8b5cf6 0%,\n    rgba(139, 92, 246, 0.15) 20%,\n    rgba(196, 181, 253, 0.25) 40%,\n    rgba(139, 92, 246, 0.15) 60%,\n    #8b5cf6 100%\n  ) !important;\n  background-size: 200% 100% !important;\n  animation: selection-shimmer 2.5s ease-in-out infinite !important;\n  box-shadow: \n    inset 0 0 0 2px #8b5cf6,\n    0 0 16px 4px rgba(139, 92, 246, 0.5),\n    0 0 4px 1px rgba(139, 92, 246, 0.8) !important;\n  z-index: 10 !important;\n}\n\n[data-selectable-item][data-selected=\"true\"]::before {\n  content: \"\";\n  position: absolute;\n  inset: 2px;\n  background: #1a1a2e;\n  border-radius: 6px;\n  z-index: 0;\n  opacity: 0.95;\n}\n\n[data-selectable-item][data-selected=\"true\"] > * {\n  position: relative;\n  z-index: 1;\n}\n\n/* ─────────────────────────────────────────────────────────────────────────────\n   DEEP/GRANULAR SELECTION: Long-press on any element - BLUE shimmer\n   ───────────────────────────────────────────────────────────────────────────── */\n\n.jsonui-deep-selected {\n  position: relative !important;\n  border-radius: 8px !important;\n  z-index: 50 !important;\n  padding: 4px 8px !important;\n  margin: -4px -8px !important;\n  /* Shimmer background - blue for granular */\n  background: linear-gradient(\n    110deg,\n    #3b82f6 0%,\n    rgba(59, 130, 246, 0.15) 20%,\n    rgba(147, 197, 253, 0.25) 40%,\n    rgba(59, 130, 246, 0.15) 60%,\n    #3b82f6 100%\n  ) !important;\n  background-size: 200% 100% !important;\n  animation: selection-shimmer 2.5s ease-in-out infinite !important;\n  /* Bold inner border + outer glow */\n  box-shadow: \n    inset 0 0 0 2px #3b82f6,\n    0 0 20px 4px rgba(59, 130, 246, 0.6),\n    0 0 6px 2px rgba(59, 130, 246, 0.8) !important;\n  /* Ensure text stays visible */\n  color: #fff !important;\n}\n\n/* Inner content layer for deep selection */\n.jsonui-deep-selected::before {\n  content: \"\" !important;\n  position: absolute !important;\n  inset: 2px !important;\n  background: #0f172a !important;\n  border-radius: 6px !important;\n  z-index: 0 !important;\n  opacity: 0.92 !important;\n}\n\n/* Text inside deep selection stays visible */\n.jsonui-deep-selected > * {\n  position: relative !important;\n  z-index: 1 !important;\n}\n\n/* Item Selection via click - PURPLE shimmer (overrides deep-selected blue) */\n.jsonui-item-selected {\n  background: linear-gradient(\n    110deg,\n    #8b5cf6 0%,\n    rgba(139, 92, 246, 0.15) 20%,\n    rgba(196, 181, 253, 0.25) 40%,\n    rgba(139, 92, 246, 0.15) 60%,\n    #8b5cf6 100%\n  ) !important;\n  box-shadow: \n    inset 0 0 0 2px #8b5cf6,\n    0 0 20px 4px rgba(139, 92, 246, 0.6),\n    0 0 6px 2px rgba(139, 92, 246, 0.8) !important;\n}\n\n.jsonui-item-selected::before {\n  background: #1a1a2e !important;\n}\n\n@keyframes selection-pulse {\n  0%, 100% {\n    filter: brightness(1);\n  }\n  50% {\n    filter: brightness(1.15);\n  }\n}\n`;\n","// ─────────────────────────────────────────────────────────────────────────────\n// Deep Selection Utilities\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Cache for CSS paths to avoid recomputation\n * Uses WeakMap to automatically clean up when elements are GC'd\n */\nconst cssPathCache = new WeakMap<HTMLElement, Map<HTMLElement, string>>();\n\n/**\n * Generate a unique CSS selector path for an element relative to a root\n * Memoized for performance - same element/root pair returns cached result\n */\nexport function getUniqueCSSPath(\n  element: HTMLElement,\n  root: HTMLElement,\n): string {\n  // Check cache first\n  let elementCache = cssPathCache.get(element);\n  if (elementCache) {\n    const cached = elementCache.get(root);\n    if (cached !== undefined) {\n      return cached;\n    }\n  }\n\n  // Compute path\n  const parts: string[] = [];\n  let current: HTMLElement | null = element;\n\n  while (current && current !== root && current !== document.body) {\n    let selector = current.tagName.toLowerCase();\n\n    // Add nth-child for uniqueness\n    const parent = current.parentElement;\n    if (parent) {\n      const siblings = Array.from(parent.children).filter(\n        (child) => child.tagName === current!.tagName,\n      );\n      if (siblings.length > 1) {\n        const index = siblings.indexOf(current) + 1;\n        selector += `:nth-of-type(${index})`;\n      }\n    }\n\n    parts.unshift(selector);\n    current = current.parentElement;\n  }\n\n  const path = parts.join(\" > \");\n\n  // Store in cache\n  if (!elementCache) {\n    elementCache = new Map();\n    cssPathCache.set(element, elementCache);\n  }\n  elementCache.set(root, path);\n\n  return path;\n}\n\n/**\n * Clear CSS path cache for a specific element (call when element is re-rendered)\n */\nexport function clearCSSPathCache(element: HTMLElement): void {\n  cssPathCache.delete(element);\n}\n\n/**\n * Helper to generate the required data attributes for a selectable item.\n * Use this in components to reduce boilerplate.\n *\n * @example\n * ```tsx\n * {items.map(item => (\n *   <div key={item.id} {...selectableItemProps(element.key, item.id)}>\n *     {item.content}\n *   </div>\n * ))}\n * ```\n */\nexport function selectableItemProps(\n  elementKey: string,\n  itemId: string,\n  isSelected?: boolean,\n): Record<string, string | undefined> {\n  return {\n    \"data-selectable-item\": \"true\",\n    \"data-element-key\": elementKey,\n    \"data-item-id\": itemId,\n    \"data-selected\": isSelected ? \"true\" : undefined,\n  };\n}\n","/**\n * useSelectionState - Selection state management with Zustand\n *\n * This hook bridges the Context API with Zustand for granular subscriptions.\n * The Zustand store is the single source of truth for serializable data.\n * DOM element references are computed on-demand via findElementByCssPath().\n */\n\nimport { useCallback, useMemo, useRef } from \"react\";\nimport {\n  useStore,\n  useDeepSelections,\n  useDeepSelectionActive,\n} from \"../../store\";\nimport type { DeepSelectionInfo, DeepSelectionInput } from \"./types\";\n\nexport interface UseSelectionStateReturn {\n  /** All current deep selections (from Zustand store, with element computed) */\n  deepSelections: DeepSelectionInfo[];\n  /** Derived granular selection map (flat structure for component API) */\n  granularSelection: Record<string, Set<string>>;\n  /** Add a new selection (element is tracked in WeakMap, not stored) */\n  addSelection: (selection: DeepSelectionInput) => void;\n  /** Remove a selection by element reference */\n  removeSelectionByElement: (\n    element: HTMLElement,\n  ) => DeepSelectionInfo | undefined;\n  /** Toggle selection for an item (programmatic) */\n  toggleSelection: (elementKey: string, itemId: string) => void;\n  /** Clear selection for specific element or all */\n  clearSelection: (elementKey?: string) => DeepSelectionInfo[];\n  /** Check if item is selected */\n  isSelected: (elementKey: string, itemId: string) => boolean;\n  /** Get selected items for an element */\n  getSelectedItems: (elementKey: string) => string[];\n  /** Ref to track selected DOM elements (for visual feedback) */\n  selectedElementsRef: React.RefObject<Set<HTMLElement>>;\n  /** Flag indicating deep selection is active */\n  deepSelectionActiveRef: React.RefObject<boolean>;\n  /** Set deep selection active flag with auto-reset */\n  setDeepSelectionActive: () => void;\n}\n\n// WeakMap to track element → cssPath mapping for removal\nconst elementToCssPath = new WeakMap<HTMLElement, string>();\nconst elementToElementKey = new WeakMap<HTMLElement, string>();\n\n/**\n * Hook for managing selection state via Zustand store\n */\nexport function useSelectionState(): UseSelectionStateReturn {\n  // Zustand selectors\n  const storeSelections = useDeepSelections();\n  const isDeepActive = useDeepSelectionActive();\n\n  // Zustand actions\n  const addDeepSelection = useStore((s) => s.addDeepSelection);\n  const removeDeepSelectionByElement = useStore(\n    (s) => s.removeDeepSelectionByElement,\n  );\n  const clearDeepSelections = useStore((s) => s.clearDeepSelections);\n  const clearDeepSelectionsForElement = useStore(\n    (s) => s.clearDeepSelectionsForElement,\n  );\n  const setDeepSelectionActiveStore = useStore((s) => s.setDeepSelectionActive);\n\n  // Refs for DOM elements and active flag\n  const selectedElementsRef = useRef<Set<HTMLElement>>(new Set());\n  const deepSelectionActiveRef = useRef(false);\n\n  // Sync ref with store\n  deepSelectionActiveRef.current = isDeepActive;\n\n  // Convert store selections to context format (add DOM element ref)\n  const deepSelections = useMemo<DeepSelectionInfo[]>(() => {\n    return storeSelections.map((sel) => ({\n      ...sel,\n      element: findElementByCssPath(sel.elementKey, sel.cssPath),\n    }));\n  }, [storeSelections]);\n\n  // Derived state: granularSelection provides flat structure for component API\n  const granularSelection = useMemo(() => {\n    const result: Record<string, Set<string>> = {};\n    for (const sel of storeSelections) {\n      if (sel.itemId) {\n        if (!result[sel.elementKey]) {\n          result[sel.elementKey] = new Set();\n        }\n        result[sel.elementKey]!.add(sel.itemId);\n      }\n    }\n    return result;\n  }, [storeSelections]);\n\n  const addSelection = useCallback(\n    (selection: DeepSelectionInput) => {\n      // Store element mapping for later removal (not in Zustand)\n      if (selection.element) {\n        elementToCssPath.set(selection.element, selection.cssPath);\n        elementToElementKey.set(selection.element, selection.elementKey);\n        selectedElementsRef.current.add(selection.element);\n      }\n\n      // Send only serializable data to the store\n      addDeepSelection({\n        elementKey: selection.elementKey,\n        cssPath: selection.cssPath,\n        tagName: selection.tagName,\n        textContent: selection.textContent,\n        itemId: selection.itemId,\n        selectionType: selection.selectionType,\n      });\n    },\n    [addDeepSelection],\n  );\n\n  const removeSelectionByElement = useCallback(\n    (element: HTMLElement): DeepSelectionInfo | undefined => {\n      const cssPath = elementToCssPath.get(element);\n      const elementKey = elementToElementKey.get(element);\n\n      if (!cssPath || !elementKey) return undefined;\n\n      // Find the selection to return\n      const removed = deepSelections.find(\n        (s) => s.elementKey === elementKey && s.cssPath === cssPath,\n      );\n\n      // Remove from store\n      removeDeepSelectionByElement(elementKey, cssPath);\n      selectedElementsRef.current.delete(element);\n\n      return removed;\n    },\n    [deepSelections, removeDeepSelectionByElement],\n  );\n\n  const toggleSelection = useCallback(\n    (elementKey: string, itemId: string) => {\n      const existing = storeSelections.find(\n        (s) => s.elementKey === elementKey && s.itemId === itemId,\n      );\n\n      if (existing) {\n        // Remove visual feedback\n        const el = findElementByCssPath(elementKey, existing.cssPath);\n        if (el) {\n          el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n          el.removeAttribute(\"aria-selected\");\n          selectedElementsRef.current.delete(el);\n        }\n        removeDeepSelectionByElement(elementKey, existing.cssPath);\n      } else {\n        // Add - but we need the element to get cssPath\n        // This is for programmatic toggle, cssPath will be empty\n        addDeepSelection({\n          elementKey,\n          cssPath: \"\",\n          tagName: \"div\",\n          textContent: \"\",\n          itemId,\n          selectionType: \"item\",\n        });\n      }\n    },\n    [storeSelections, removeDeepSelectionByElement, addDeepSelection],\n  );\n\n  const clearSelection = useCallback(\n    (elementKey?: string): DeepSelectionInfo[] => {\n      // Get selections to return\n      const removed = elementKey\n        ? deepSelections.filter((s) => s.elementKey === elementKey)\n        : deepSelections;\n\n      // Clean up DOM references\n      for (const sel of removed) {\n        if (sel.element) {\n          sel.element.classList.remove(\n            \"jsonui-deep-selected\",\n            \"jsonui-item-selected\",\n          );\n          sel.element.removeAttribute(\"aria-selected\");\n          selectedElementsRef.current.delete(sel.element);\n        }\n      }\n\n      // Clear from store\n      if (elementKey) {\n        clearDeepSelectionsForElement(elementKey);\n      } else {\n        clearDeepSelections();\n      }\n\n      return removed;\n    },\n    [deepSelections, clearDeepSelections, clearDeepSelectionsForElement],\n  );\n\n  const isSelected = useCallback(\n    (elementKey: string, itemId: string) => {\n      return granularSelection[elementKey]?.has(itemId) ?? false;\n    },\n    [granularSelection],\n  );\n\n  const getSelectedItems = useCallback(\n    (elementKey: string) => {\n      return Array.from(granularSelection[elementKey] ?? []);\n    },\n    [granularSelection],\n  );\n\n  const setDeepSelectionActive = useCallback(() => {\n    setDeepSelectionActiveStore(true);\n  }, [setDeepSelectionActiveStore]);\n\n  return {\n    deepSelections,\n    granularSelection,\n    addSelection,\n    removeSelectionByElement,\n    toggleSelection,\n    clearSelection,\n    isSelected,\n    getSelectedItems,\n    selectedElementsRef,\n    deepSelectionActiveRef,\n    setDeepSelectionActive,\n  };\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Helper: Find element by CSS path\n// ─────────────────────────────────────────────────────────────────────────────\n\nfunction findElementByCssPath(\n  elementKey: string,\n  cssPath: string,\n): HTMLElement | null {\n  if (typeof document === \"undefined\" || !cssPath) {\n    return null;\n  }\n\n  const wrapper = document.querySelector(\n    `[data-jsonui-element-key=\"${elementKey}\"]`,\n  );\n  if (!wrapper) return null;\n\n  try {\n    const el = wrapper.querySelector(cssPath);\n    return el as HTMLElement | null;\n  } catch {\n    return null;\n  }\n}\n","/**\n * useLongPress - Long-press detection hook\n * Handles timing, movement tolerance, and cleanup\n */\n\nimport { useRef, useCallback, useEffect } from \"react\";\nimport { isInteractiveElement, shouldNeverSelect } from \"../../utils/dom\";\n\nexport interface LongPressConfig {\n  /** Duration in ms to trigger long-press */\n  duration: number;\n  /** Movement tolerance in px */\n  movementThreshold: number;\n  /** Enable debug logging */\n  debug?: boolean;\n}\n\nexport const DEFAULT_LONG_PRESS_CONFIG: LongPressConfig = {\n  duration: 450,\n  movementThreshold: 10,\n  debug: false,\n};\n\nexport interface LongPressCallbacks {\n  /** Called when long-press triggers */\n  onLongPress: (target: HTMLElement, componentWrapper: HTMLElement) => void;\n  /** Called when click happens (not long-press) */\n  onClick: (target: HTMLElement, event: MouseEvent) => void;\n  /** Called when right-click happens */\n  onContextMenu?: () => void;\n}\n\nexport interface UseLongPressReturn {\n  /** Flag indicating if long-press just completed (to prevent click) */\n  longPressJustCompleted: boolean;\n}\n\n/**\n * Hook for handling long-press detection on document\n * Automatically attaches/detaches event listeners\n */\nexport function useLongPress(\n  callbacks: LongPressCallbacks,\n  config: Partial<LongPressConfig> = {},\n): UseLongPressReturn {\n  const fullConfig = { ...DEFAULT_LONG_PRESS_CONFIG, ...config };\n  const { duration, movementThreshold, debug } = fullConfig;\n\n  const pressTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const pressTargetRef = useRef<HTMLElement | null>(null);\n  const longPressCompletedRef = useRef(false);\n\n  const log = useCallback(\n    (message: string, ...args: unknown[]) => {\n      if (debug) {\n        console.log(`[LongPress] ${message}`, ...args);\n      }\n    },\n    [debug],\n  );\n\n  const cancelPress = useCallback(() => {\n    if (pressTimerRef.current) {\n      clearTimeout(pressTimerRef.current);\n      pressTimerRef.current = null;\n    }\n    pressTargetRef.current = null;\n  }, []);\n\n  useEffect(() => {\n    const handlePointerDown = (e: PointerEvent) => {\n      // Only respond to primary button (left-click)\n      if (e.button !== 0) {\n        log(\"pointerdown SKIPPED - not primary button:\", e.button);\n        return;\n      }\n\n      const target = e.target as HTMLElement;\n      log(\"pointerdown on:\", target.tagName, target.className);\n\n      // Reset flag on new press\n      longPressCompletedRef.current = false;\n\n      // Cancel any existing press\n      cancelPress();\n\n      // Skip interactive elements\n      if (isInteractiveElement(target)) {\n        log(\"pointerdown SKIPPED - interactive element:\", target.tagName);\n        return;\n      }\n\n      // Skip elements that should never trigger selection\n      if (shouldNeverSelect(target)) {\n        log(\"pointerdown SKIPPED - shouldNeverSelect:\", target.tagName);\n        return;\n      }\n\n      // Find parent JSON-UI component\n      const componentWrapper = target.closest(\n        \"[data-jsonui-element-key]\",\n      ) as HTMLElement | null;\n      if (!componentWrapper) return;\n\n      // Skip non-meaningful elements\n      const skipTags = new Set([\"SCRIPT\", \"STYLE\", \"META\", \"LINK\", \"BR\", \"HR\"]);\n      if (skipTags.has(target.tagName)) return;\n\n      // Skip if pressing the component wrapper itself\n      if (target === componentWrapper) return;\n\n      // Store target and start timer\n      pressTargetRef.current = target;\n\n      pressTimerRef.current = setTimeout(() => {\n        if (!pressTargetRef.current) return;\n\n        log(\"Long-press triggered on:\", pressTargetRef.current.tagName);\n\n        callbacks.onLongPress(pressTargetRef.current, componentWrapper);\n\n        longPressCompletedRef.current = true;\n        pressTargetRef.current = null;\n      }, duration);\n    };\n\n    const handlePointerUp = () => cancelPress();\n\n    const handlePointerMove = (e: PointerEvent) => {\n      // Cancel if user moves significantly during press\n      if (\n        pressTargetRef.current &&\n        Math.abs(e.movementX) + Math.abs(e.movementY) > movementThreshold\n      ) {\n        cancelPress();\n      }\n    };\n\n    const handlePointerCancel = () => cancelPress();\n\n    const handleClick = (e: MouseEvent) => {\n      // Only respond to primary button\n      if (e.button !== 0) {\n        log(\"click SKIPPED - not primary button:\", e.button);\n        return;\n      }\n\n      const target = e.target as HTMLElement;\n      log(\"click on:\", target.tagName, target.className);\n\n      // Skip if long-press just completed\n      if (longPressCompletedRef.current) {\n        log(\"click SKIPPED - long-press just completed\");\n        longPressCompletedRef.current = false;\n        return;\n      }\n\n      // Skip if user has selected text\n      const textSelection = window.getSelection();\n      if (\n        textSelection &&\n        !textSelection.isCollapsed &&\n        textSelection.toString().trim()\n      ) {\n        log(\"click SKIPPED - text selection active\");\n        return;\n      }\n\n      // Skip interactive elements\n      if (isInteractiveElement(target)) {\n        log(\"click SKIPPED - interactive element:\", target.tagName);\n        return;\n      }\n\n      // Skip elements that should never trigger selection\n      if (shouldNeverSelect(target)) {\n        log(\"click SKIPPED - shouldNeverSelect:\", target.tagName);\n        return;\n      }\n\n      callbacks.onClick(target, e);\n    };\n\n    const handleContextMenu = () => {\n      cancelPress();\n      callbacks.onContextMenu?.();\n    };\n\n    document.addEventListener(\"pointerdown\", handlePointerDown, true);\n    document.addEventListener(\"pointerup\", handlePointerUp, true);\n    document.addEventListener(\"pointermove\", handlePointerMove, true);\n    document.addEventListener(\"pointercancel\", handlePointerCancel, true);\n    document.addEventListener(\"click\", handleClick, true);\n    document.addEventListener(\"contextmenu\", handleContextMenu, true);\n\n    return () => {\n      document.removeEventListener(\"pointerdown\", handlePointerDown, true);\n      document.removeEventListener(\"pointerup\", handlePointerUp, true);\n      document.removeEventListener(\"pointermove\", handlePointerMove, true);\n      document.removeEventListener(\"pointercancel\", handlePointerCancel, true);\n      document.removeEventListener(\"click\", handleClick, true);\n      document.removeEventListener(\"contextmenu\", handleContextMenu, true);\n      cancelPress();\n    };\n  }, [callbacks, duration, movementThreshold, cancelPress, log]);\n\n  return {\n    get longPressJustCompleted() {\n      return longPressCompletedRef.current;\n    },\n  };\n}\n","/**\n * DOM utility functions for interaction detection\n * Used to properly handle priority between interactive elements and selection\n *\n * ARCHITECTURE:\n * - Interactive elements (buttons, inputs, links) have PRIORITY over selection\n * - When user clicks on interactive element, native behavior happens, selection SKIPPED\n * - This is implemented at CORE level, not per-component\n *\n * KISS/DRY/SOLID:\n * - Single source of truth for what's \"interactive\"\n * - Extensible via data-* attributes for custom components\n * - No component-specific logic needed\n */\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Interactive Elements Detection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * List of natively interactive HTML elements\n * These always take priority over selection\n */\nconst NATIVE_INTERACTIVE_TAGS = new Set([\n  \"input\",\n  \"button\",\n  \"select\",\n  \"textarea\",\n  \"a\",\n  \"label\",\n  \"details\",\n  \"summary\",\n  \"dialog\",\n  \"menu\",\n  \"optgroup\",\n  \"option\",\n  \"datalist\",\n  \"fieldset\",\n  \"legend\",\n  \"progress\",\n  \"meter\",\n  \"output\",\n]);\n\n/**\n * ARIA roles that indicate interactive behavior\n */\nconst INTERACTIVE_ARIA_ROLES = new Set([\n  \"button\",\n  \"checkbox\",\n  \"radio\",\n  \"switch\",\n  \"link\",\n  \"menuitem\",\n  \"menuitemcheckbox\",\n  \"menuitemradio\",\n  \"option\",\n  \"tab\",\n  \"slider\",\n  \"spinbutton\",\n  \"combobox\",\n  \"listbox\",\n  \"searchbox\",\n  \"textbox\",\n  \"scrollbar\",\n  \"grid\",\n  \"gridcell\",\n  \"row\",\n  \"rowheader\",\n  \"columnheader\",\n  \"tree\",\n  \"treeitem\",\n  \"treegrid\",\n  \"tabpanel\",\n  \"toolbar\",\n  \"tooltip\",\n  \"progressbar\",\n  \"alertdialog\",\n]);\n\n/**\n * CSS selector for all known interactive elements\n * Used for parent lookup optimization\n */\nconst INTERACTIVE_SELECTOR = [\n  // Native elements\n  \"button\",\n  \"input\",\n  \"select\",\n  \"textarea\",\n  \"a[href]\",\n  \"label\",\n  \"details\",\n  \"summary\",\n  // ARIA roles (most common)\n  \"[role='button']\",\n  \"[role='checkbox']\",\n  \"[role='radio']\",\n  \"[role='switch']\",\n  \"[role='link']\",\n  \"[role='tab']\",\n  \"[role='slider']\",\n  \"[role='combobox']\",\n  \"[role='listbox']\",\n  \"[role='textbox']\",\n  \"[role='menuitem']\",\n  \"[role='option']\",\n  // Custom markers\n  \"[data-interactive]\",\n  \"[data-interactive-wrapper]\",\n  \"[data-checkbox]\",\n  \"[data-no-select]\",\n  // Elements that look interactive\n  \"[contenteditable='true']\",\n  \"[tabindex]:not([tabindex='-1'])\",\n  // Clickable elements\n  \"[onclick]\",\n  \"[draggable='true']\",\n].join(\", \");\n\n/**\n * Determines if an element is interactive (button, checkbox, input, link, etc.)\n * Used to give priority to interactive elements over selection.\n *\n * When a user clicks on an interactive element inside a selectable item,\n * the native interaction should happen WITHOUT triggering selection.\n *\n * @param target - The element to check\n * @returns true if the element or any ancestor is interactive\n */\nexport function isInteractiveElement(target: HTMLElement): boolean {\n  // Fast path: check tag\n  const tagName = target.tagName.toLowerCase();\n  if (NATIVE_INTERACTIVE_TAGS.has(tagName)) {\n    return true;\n  }\n\n  // Check ARIA role\n  const role = target.getAttribute(\"role\")?.toLowerCase();\n  if (role && INTERACTIVE_ARIA_ROLES.has(role)) {\n    return true;\n  }\n\n  // Check if contenteditable\n  if (target.isContentEditable) {\n    return true;\n  }\n\n  // Check custom data attributes\n  if (\n    target.hasAttribute(\"data-interactive\") ||\n    target.hasAttribute(\"data-interactive-wrapper\") ||\n    target.hasAttribute(\"data-checkbox\") ||\n    target.hasAttribute(\"data-no-select\")\n  ) {\n    return true;\n  }\n\n  // Check if element has explicit click handler (React synthetic events don't show in DOM)\n  if (target.hasAttribute(\"onclick\")) {\n    return true;\n  }\n\n  // Check for draggable elements\n  if (target.getAttribute(\"draggable\") === \"true\") {\n    return true;\n  }\n\n  // Check for focusable elements with positive tabindex\n  const tabindex = target.getAttribute(\"tabindex\");\n  if (tabindex !== null && tabindex !== \"-1\") {\n    // Only consider it interactive if it looks like a control\n    const computedStyle = window.getComputedStyle(target);\n    if (computedStyle.cursor === \"pointer\") {\n      return true;\n    }\n  }\n\n  // Check if inside an interactive parent (for nested elements like icon inside button)\n  // This is crucial for icon buttons and complex interactive components\n  const interactiveParent = target.closest(INTERACTIVE_SELECTOR);\n\n  return interactiveParent !== null;\n}\n\n/**\n * Quick check if element should never trigger selection\n * Used for elements like resize handles, scrollbars, etc.\n */\nexport function shouldNeverSelect(target: HTMLElement): boolean {\n  // Resize handles\n  if (\n    target.hasAttribute(\"data-resize-handle\") ||\n    target.closest(\"[data-resize-handle]\")\n  ) {\n    return true;\n  }\n\n  // Scrollbars and similar\n  if (\n    target.hasAttribute(\"data-no-select\") ||\n    target.closest(\"[data-no-select]\")\n  ) {\n    return true;\n  }\n\n  // Canvas and SVG interactions\n  if (target.tagName === \"CANVAS\" || target.closest(\"canvas\")) {\n    return true;\n  }\n\n  return false;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Selection Interaction Detection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Determines if a click/interaction is related to selection UI (not a business action).\n * Selection interactions should NOT trigger proactive AI.\n *\n * Business actions (toggle, input, submit) → Track for proactive AI\n * Selection actions (select item, deselect) → Do NOT track\n *\n * IMPORTANT: Interactive elements inside selectable-items are BUSINESS ACTIONS.\n * Example: clicking a checkbox inside a todo item is a \"toggle\" action, not selection.\n *\n * @param target - The clicked element\n * @param isDeepSelectionActive - Optional callback to check if deep selection is active (from context)\n */\nexport function isSelectionInteraction(\n  target: HTMLElement,\n  isDeepSelectionActive?: () => boolean,\n): boolean {\n  // Skip if deep selection just activated (check via callback if provided)\n  if (isDeepSelectionActive?.()) {\n    return true;\n  }\n\n  // CRITICAL: Interactive elements are NEVER selection interactions\n  // Even if they're inside a selectable-item, the user is performing a business action\n  // (e.g., toggling a checkbox, typing in an input, clicking a button)\n  if (isInteractiveElement(target)) {\n    return false;\n  }\n\n  // Skip if clicking on selectable items (selection/deselection actions)\n  // This only applies to clicks on NON-interactive parts of the item\n  if (target.closest(\"[data-selectable-item]\")) {\n    return true;\n  }\n\n  // Skip if clicking on already selected elements (deselection)\n  if (target.closest(\".jsonui-deep-selected, .jsonui-item-selected\")) {\n    return true;\n  }\n\n  // Skip if clicking on selection-related UI (selection toolbar, etc.)\n  if (target.closest(\"[data-selection-ui]\")) {\n    return true;\n  }\n\n  return false;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Utility Exports\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Get the interactive element that was clicked (if any)\n * Useful for determining what type of interaction occurred\n */\nexport function getInteractiveElement(target: HTMLElement): HTMLElement | null {\n  if (isInteractiveElement(target)) {\n    // Return the actual interactive element (might be parent)\n    return target.closest(INTERACTIVE_SELECTOR) as HTMLElement | null;\n  }\n  return null;\n}\n","\"use client\";\n\nimport { useContext, useCallback, useMemo } from \"react\";\nimport { SelectionContext } from \"./context\";\nimport type { SelectionContextValue } from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to access granular selection functionality.\n * Must be used within a SelectionProvider.\n */\nexport function useSelection(): SelectionContextValue {\n  const context = useContext(SelectionContext);\n  if (context === undefined) {\n    throw new Error(\"useSelection must be used within a SelectionProvider\");\n  }\n  return context;\n}\n\n/**\n * Simplified hook for components that only need to check selection state.\n * Returns helpers scoped to a specific element.\n */\nexport function useItemSelection(elementKey: string) {\n  const { isSelected, getSelectedItems, granularSelection } = useSelection();\n\n  const isItemSelected = useCallback(\n    (itemId: string) => isSelected(elementKey, itemId),\n    [elementKey, isSelected],\n  );\n\n  const selectedItems = useMemo(\n    () => getSelectedItems(elementKey),\n    [elementKey, getSelectedItems],\n  );\n\n  const hasSelection = useMemo(\n    () => (granularSelection[elementKey]?.size ?? 0) > 0,\n    [elementKey, granularSelection],\n  );\n\n  return {\n    isItemSelected,\n    selectedItems,\n    hasSelection,\n  };\n}\n","/**\n * useDomTracking - DOM tracking and event coordination\n * Handles DOM element references and visual feedback\n */\n\nimport { useCallback } from \"react\";\nimport type { DeepSelectionInput } from \"./types\";\nimport { getUniqueCSSPath } from \"./utils\";\n\nexport interface UseDomTrackingReturn {\n  /** Apply visual selection to an element */\n  applyVisualSelection: (\n    element: HTMLElement,\n    isItemSelection?: boolean,\n  ) => void;\n  /** Remove visual selection from an element */\n  removeVisualSelection: (element: HTMLElement) => void;\n  /** Clear all visual selections from DOM */\n  clearAllVisualSelections: (selectedElementsRef: Set<HTMLElement>) => void;\n  /** Create selection input from a DOM element (id/timestamp added by store) */\n  createSelectionInput: (\n    element: HTMLElement,\n    componentWrapper: HTMLElement,\n    selectionType: \"granular\" | \"item\",\n  ) => DeepSelectionInput;\n  /** Trigger haptic feedback if available */\n  triggerHaptic: () => void;\n}\n\n/**\n * Hook for DOM tracking and visual feedback management\n */\nexport function useDomTracking(): UseDomTrackingReturn {\n  const applyVisualSelection = useCallback(\n    (element: HTMLElement, isItemSelection = false) => {\n      element.classList.add(\"jsonui-deep-selected\");\n      if (isItemSelection) {\n        element.classList.add(\"jsonui-item-selected\");\n      }\n      element.setAttribute(\"aria-selected\", \"true\");\n    },\n    [],\n  );\n\n  const removeVisualSelection = useCallback((element: HTMLElement) => {\n    element.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n    element.removeAttribute(\"aria-selected\");\n  }, []);\n\n  const clearAllVisualSelections = useCallback(\n    (selectedElementsRef: Set<HTMLElement>) => {\n      // Clear from ref\n      selectedElementsRef.forEach((el) => {\n        el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n        el.removeAttribute(\"aria-selected\");\n      });\n      selectedElementsRef.clear();\n\n      // Also query DOM directly in case elements were re-rendered\n      if (typeof document !== \"undefined\") {\n        document\n          .querySelectorAll(\".jsonui-deep-selected, .jsonui-item-selected\")\n          .forEach((el) => {\n            el.classList.remove(\"jsonui-deep-selected\", \"jsonui-item-selected\");\n            el.removeAttribute(\"aria-selected\");\n          });\n      }\n    },\n    [],\n  );\n\n  const createSelectionInput = useCallback(\n    (\n      element: HTMLElement,\n      componentWrapper: HTMLElement,\n      selectionType: \"granular\" | \"item\",\n    ): DeepSelectionInput => {\n      const elementKey =\n        componentWrapper.getAttribute(\"data-jsonui-element-key\") || \"\";\n      const cssPath = getUniqueCSSPath(element, componentWrapper);\n      const textContent = (element.textContent || \"\").trim().substring(0, 200);\n\n      // Find containing selectable-item (if any)\n      const selectableItem = element.closest(\n        \"[data-selectable-item]\",\n      ) as HTMLElement | null;\n      const itemId = selectableItem?.getAttribute(\"data-item-id\") || undefined;\n\n      return {\n        elementKey,\n        cssPath,\n        tagName: element.tagName.toLowerCase(),\n        textContent,\n        element,\n        selectionType,\n        itemId,\n      };\n    },\n    [],\n  );\n\n  const triggerHaptic = useCallback(() => {\n    if (typeof navigator !== \"undefined\" && navigator.vibrate) {\n      navigator.vibrate(50);\n    }\n  }, []);\n\n  return {\n    applyVisualSelection,\n    removeVisualSelection,\n    clearAllVisualSelections,\n    createSelectionInput,\n    triggerHaptic,\n  };\n}\n","\"use client\";\n\nimport type { SelectableItemProps } from \"./types\";\nimport { useSelection } from \"./hooks\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// SelectableItem Component - Core wrapper for granular selection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Core wrapper component for making items selectable.\n *\n * This is the recommended way to implement granular selection in components.\n * It automatically handles:\n * - Selection state tracking\n * - Visual feedback (via CSS)\n * - Event delegation integration\n *\n * @example\n * ```tsx\n * import { SelectableItem } from \"@onegenui/react\";\n *\n * // Inside your component:\n * {items.map(item => (\n *   <SelectableItem\n *     key={item.id}\n *     elementKey={element.key}\n *     itemId={item.id}\n *     style={{ padding: 16 }}\n *   >\n *     {item.content}\n *   </SelectableItem>\n * ))}\n * ```\n */\nexport function SelectableItem({\n  elementKey,\n  itemId,\n  children,\n  as: Component = \"div\",\n  className,\n  style,\n  ...rest\n}: SelectableItemProps) {\n  const { isSelected } = useSelection();\n  const selected = isSelected(elementKey, itemId);\n\n  // Filter out our known props from rest to avoid passing them to DOM\n  const {\n    elementKey: _ek,\n    itemId: _id,\n    as: _as,\n    ...domProps\n  } = rest as Record<string, unknown>;\n\n  return (\n    <Component\n      data-selectable-item=\"true\"\n      data-element-key={elementKey}\n      data-item-id={itemId}\n      data-selected={selected ? \"true\" : undefined}\n      className={className}\n      style={style}\n      {...domProps}\n    >\n      {children}\n    </Component>\n  );\n}\n","import type { ReactNode, CSSProperties } from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface MarkdownTheme {\n  /** Code block background color */\n  codeBlockBg: string;\n  /** Code block border color */\n  codeBlockBorder: string;\n  /** Inline code background color */\n  inlineCodeBg: string;\n  /** Link color */\n  linkColor: string;\n  /** Blockquote border color */\n  blockquoteBorder: string;\n  /** Horizontal rule color */\n  hrColor: string;\n}\n\nexport interface MarkdownContextValue {\n  /** Whether markdown rendering is enabled globally */\n  enabled: boolean;\n  /** The theme for markdown rendering */\n  theme: MarkdownTheme;\n  /** Render text with markdown support */\n  renderText: (\n    content: string | null | undefined,\n    options?: RenderTextOptions,\n  ) => ReactNode;\n}\n\nexport interface RenderTextOptions {\n  /** Whether to render inline (no block elements like paragraphs) */\n  inline?: boolean;\n  /** Additional className */\n  className?: string;\n  /** Additional style */\n  style?: CSSProperties;\n}\n\nexport interface MarkdownProviderProps {\n  children: ReactNode;\n  /** Whether markdown rendering is enabled (default: true) */\n  enabled?: boolean;\n  /** Custom theme overrides */\n  theme?: Partial<MarkdownTheme>;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Default Theme\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const defaultTheme: MarkdownTheme = {\n  codeBlockBg: \"rgba(0, 0, 0, 0.3)\",\n  codeBlockBorder: \"rgba(255, 255, 255, 0.08)\",\n  inlineCodeBg: \"rgba(0, 0, 0, 0.25)\",\n  linkColor: \"var(--primary, #3b82f6)\",\n  blockquoteBorder: \"var(--primary, #3b82f6)\",\n  hrColor: \"rgba(255, 255, 255, 0.1)\",\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Styles Factory\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const createStyles = (theme: MarkdownTheme) => ({\n  codeBlock: {\n    backgroundColor: theme.codeBlockBg,\n    borderRadius: 8,\n    padding: \"12px 16px\",\n    overflowX: \"auto\" as const,\n    fontSize: 13,\n    fontFamily:\n      \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace\",\n    border: `1px solid ${theme.codeBlockBorder}`,\n    margin: \"8px 0\",\n  },\n  inlineCode: {\n    backgroundColor: theme.inlineCodeBg,\n    borderRadius: 4,\n    padding: \"2px 6px\",\n    fontSize: \"0.9em\",\n    fontFamily:\n      \"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace\",\n  },\n  link: {\n    color: theme.linkColor,\n    textDecoration: \"underline\" as const,\n    textUnderlineOffset: 2,\n  },\n  list: {\n    margin: \"8px 0\",\n    paddingLeft: 20,\n    listStylePosition: \"outside\" as const,\n  },\n  listItem: {\n    marginBottom: 4,\n  },\n  headingBase: {\n    fontWeight: 600,\n    marginTop: 12,\n    marginBottom: 8,\n  },\n  paragraph: {\n    margin: \"6px 0\",\n    lineHeight: 1.6,\n  },\n  blockquote: {\n    borderLeft: `3px solid ${theme.blockquoteBorder}`,\n    paddingLeft: 12,\n    margin: \"8px 0\",\n    opacity: 0.9,\n    fontStyle: \"italic\" as const,\n  },\n  hr: {\n    border: \"none\",\n    borderTop: `1px solid ${theme.hrColor}`,\n    margin: \"12px 0\",\n  },\n});\n","\"use client\";\n\nimport React, { useMemo, type ReactNode, type CSSProperties } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport type { MarkdownTheme } from \"./types\";\nimport { createStyles } from \"./types\";\nimport { useCitations } from \"../citation\";\nimport { InlineCitation } from \"../citation/inline-citation\";\n\ninterface InternalMarkdownProps {\n  content: string;\n  inline: boolean;\n  theme: MarkdownTheme;\n  className?: string;\n  style?: CSSProperties;\n}\n\nimport type { Citation } from \"../citation\";\n\n/**\n * Parse text content and replace [N] markers with citation components\n */\nfunction parseCitationMarkers(\n  text: string,\n  getCitation: (id: string) => Citation | undefined,\n): ReactNode[] {\n  const parts = text.split(/(\\[\\d+\\])/g);\n  return parts.map((part, idx) => {\n    const match = part.match(/\\[(\\d+)\\]/);\n    if (match) {\n      const id = match[1]!;\n      const citation = getCitation(id);\n      return <InlineCitation key={`cite-${idx}`} id={id} citation={citation} />;\n    }\n    return part;\n  });\n}\n\nexport function InternalMarkdown({\n  content,\n  inline,\n  theme,\n  className,\n  style,\n}: InternalMarkdownProps) {\n  const styles = useMemo(() => createStyles(theme), [theme]);\n  const { getCitation, citations } = useCitations();\n\n  // Memoize citation parsing capability\n  const hasCitations = citations.length > 0;\n\n  const components = useMemo(\n    () => ({\n      // Images - responsive with high quality\n      img: (props: React.ImgHTMLAttributes<HTMLImageElement>) => (\n        <img\n          {...props}\n          loading=\"lazy\"\n          style={{\n            maxWidth: \"100%\",\n            height: \"auto\",\n            borderRadius: 8,\n            marginTop: 8,\n            marginBottom: 8,\n            objectFit: \"contain\",\n            backgroundColor: \"rgba(0,0,0,0.1)\",\n          }}\n        />\n      ),\n      // Videos - native player with controls\n      video: (props: React.VideoHTMLAttributes<HTMLVideoElement>) => (\n        <video\n          {...props}\n          controls\n          preload=\"metadata\"\n          style={{\n            maxWidth: \"100%\",\n            height: \"auto\",\n            borderRadius: 8,\n            marginTop: 8,\n            marginBottom: 8,\n            backgroundColor: \"#000\",\n          }}\n        />\n      ),\n      // Code blocks\n      pre: ({ children }: { children?: ReactNode }) => (\n        <pre style={styles.codeBlock}>{children}</pre>\n      ),\n      code: ({\n        children,\n        className: codeClassName,\n      }: {\n        children?: ReactNode;\n        className?: string;\n      }) => {\n        const isInline = !codeClassName;\n        if (isInline) {\n          return <code style={styles.inlineCode}>{children}</code>;\n        }\n        return <code>{children}</code>;\n      },\n      // Links\n      a: ({ href, children }: { href?: string; children?: ReactNode }) => (\n        <a\n          href={href}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          style={styles.link}\n        >\n          {children}\n        </a>\n      ),\n      // Lists\n      ul: ({ children }: { children?: ReactNode }) => (\n        <ul style={styles.list}>{children}</ul>\n      ),\n      ol: ({ children }: { children?: ReactNode }) => (\n        <ol\n          style={{\n            ...styles.list,\n            listStyleType: \"decimal\",\n            paddingLeft: 24,\n          }}\n        >\n          {children}\n        </ol>\n      ),\n      li: ({ children }: { children?: ReactNode }) => (\n        <li style={styles.listItem}>{children}</li>\n      ),\n      // Headings\n      h1: ({ children }: { children?: ReactNode }) => (\n        <h1 style={{ ...styles.headingBase, fontSize: 18 }}>{children}</h1>\n      ),\n      h2: ({ children }: { children?: ReactNode }) => (\n        <h2 style={{ ...styles.headingBase, fontSize: 16 }}>{children}</h2>\n      ),\n      h3: ({ children }: { children?: ReactNode }) => (\n        <h3 style={{ ...styles.headingBase, fontSize: 15 }}>{children}</h3>\n      ),\n      h4: ({ children }: { children?: ReactNode }) => (\n        <h4 style={{ ...styles.headingBase, fontSize: 14 }}>{children}</h4>\n      ),\n      h5: ({ children }: { children?: ReactNode }) => (\n        <h5 style={{ ...styles.headingBase, fontSize: 13 }}>{children}</h5>\n      ),\n      h6: ({ children }: { children?: ReactNode }) => (\n        <h6 style={{ ...styles.headingBase, fontSize: 12 }}>{children}</h6>\n      ),\n      // Paragraphs - with citation parsing\n      p: ({ children }: { children?: ReactNode }) => {\n        // Parse citations in text nodes\n        const processedChildren = hasCitations\n          ? React.Children.map(children, (child) => {\n              if (typeof child === \"string\") {\n                return parseCitationMarkers(child, getCitation);\n              }\n              return child;\n            })\n          : children;\n\n        return inline ? (\n          <span>{processedChildren}</span>\n        ) : (\n          <p style={styles.paragraph}>{processedChildren}</p>\n        );\n      },\n      // Blockquotes\n      blockquote: ({ children }: { children?: ReactNode }) => (\n        <blockquote style={styles.blockquote}>{children}</blockquote>\n      ),\n      // Horizontal rules\n      hr: () => <hr style={styles.hr} />,\n      // Strong/Bold - with citation parsing\n      strong: ({ children }: { children?: ReactNode }) => {\n        const processedChildren = hasCitations\n          ? React.Children.map(children, (child) => {\n              if (typeof child === \"string\") {\n                return parseCitationMarkers(child, getCitation);\n              }\n              return child;\n            })\n          : children;\n        return <strong style={{ fontWeight: 600 }}>{processedChildren}</strong>;\n      },\n      // Emphasis/Italic - with citation parsing\n      em: ({ children }: { children?: ReactNode }) => {\n        const processedChildren = hasCitations\n          ? React.Children.map(children, (child) => {\n              if (typeof child === \"string\") {\n                return parseCitationMarkers(child, getCitation);\n              }\n              return child;\n            })\n          : children;\n        return <em style={{ fontStyle: \"italic\" }}>{processedChildren}</em>;\n      },\n    }),\n    [styles, inline, hasCitations, getCitation],\n  );\n\n  const Wrapper = inline ? \"span\" : \"div\";\n\n  return (\n    <Wrapper className={className} style={style}>\n      <ReactMarkdown components={components}>{content}</ReactMarkdown>\n    </Wrapper>\n  );\n}\n","\"use client\";\n\nimport {\n  createContext,\n  useContext,\n  useMemo,\n  type ReactNode,\n  useState,\n  useCallback,\n  useEffect,\n} from \"react\";\nimport { createElement } from \"react\";\n\n/**\n * Citation data structure - supports both web and document citations\n */\nexport interface Citation {\n  id: string;\n  title: string;\n  // Web source fields\n  url?: string | null;\n  domain?: string | null;\n  // Document source fields\n  pageNumber?: number | null;\n  excerpt?: string | null;\n  documentTitle?: string | null;\n  // Common\n  snippet?: string | null;\n}\n\ninterface CitationContextValue {\n  citations: Citation[];\n  setCitations: (citations: Citation[]) => void;\n  addCitation: (citation: Citation) => void;\n  clearCitations: () => void;\n  getCitation: (id: string) => Citation | undefined;\n}\n\nconst CitationContext = createContext<CitationContextValue | null>(null);\n\n/**\n * Provider for citation data that can be displayed inline in markdown.\n */\nexport function CitationProvider({ children }: { children: ReactNode }) {\n  const [citations, setCitationsState] = useState<Citation[]>([]);\n\n  const setCitations = useCallback((newCitations: Citation[]) => {\n    setCitationsState(newCitations);\n  }, []);\n\n  const addCitation = useCallback((citation: Citation) => {\n    setCitationsState((prev) => {\n      // Avoid duplicates\n      if (prev.some((c) => c.id === citation.id)) return prev;\n      return [...prev, citation];\n    });\n  }, []);\n\n  const clearCitations = useCallback(() => {\n    setCitationsState([]);\n  }, []);\n\n  const getCitation = useCallback(\n    (id: string) => citations.find((c) => c.id === id),\n    [citations],\n  );\n\n  // Listen for citations events from useUIStream\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const handleCitations = (event: CustomEvent<{ citations: Citation[] }>) => {\n      const newCitations = event.detail?.citations;\n      if (newCitations && Array.isArray(newCitations)) {\n        setCitationsState(newCitations);\n      }\n    };\n\n    window.addEventListener(\n      \"onegenui:citations\",\n      handleCitations as EventListener,\n    );\n    return () => {\n      window.removeEventListener(\n        \"onegenui:citations\",\n        handleCitations as EventListener,\n      );\n    };\n  }, []);\n\n  const value = useMemo(\n    () => ({\n      citations,\n      setCitations,\n      addCitation,\n      clearCitations,\n      getCitation,\n    }),\n    [citations, setCitations, addCitation, clearCitations, getCitation],\n  );\n\n  return createElement(CitationContext.Provider, { value }, children);\n}\n\n/**\n * Hook to access citation context\n */\nexport function useCitations(): CitationContextValue {\n  const context = useContext(CitationContext);\n  if (!context) {\n    // Fallback for when no provider is present\n    return {\n      citations: [],\n      setCitations: () => {},\n      addCitation: () => {},\n      clearCitations: () => {},\n      getCitation: () => undefined,\n    };\n  }\n  return context;\n}\n\nexport { CitationContext };\n","\"use client\";\n\nimport { memo, useState, useRef, useEffect, useCallback } from \"react\";\nimport type { Citation } from \"./index\";\n\ninterface InlineCitationProps {\n  id: string;\n  citation?: Citation;\n}\n\n/**\n * Inline citation badge with popover for showing source details\n */\nexport const InlineCitation = memo(function InlineCitation({\n  id,\n  citation,\n}: InlineCitationProps) {\n  const [showPopover, setShowPopover] = useState(false);\n  const [popoverPosition, setPopoverPosition] = useState<\"top\" | \"bottom\">(\n    \"bottom\",\n  );\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  // Calculate popover position based on viewport\n  const updatePosition = useCallback(() => {\n    if (!buttonRef.current) return;\n    const rect = buttonRef.current.getBoundingClientRect();\n    const spaceBelow = window.innerHeight - rect.bottom;\n    setPopoverPosition(spaceBelow < 200 ? \"top\" : \"bottom\");\n  }, []);\n\n  // Close on outside click\n  useEffect(() => {\n    if (!showPopover) return;\n    const handleClick = (e: MouseEvent) => {\n      if (\n        popoverRef.current &&\n        !popoverRef.current.contains(e.target as Node) &&\n        buttonRef.current &&\n        !buttonRef.current.contains(e.target as Node)\n      ) {\n        setShowPopover(false);\n      }\n    };\n    document.addEventListener(\"click\", handleClick);\n    return () => document.removeEventListener(\"click\", handleClick);\n  }, [showPopover]);\n\n  if (!citation) {\n    // No citation data - render plain marker\n    return (\n      <span\n        style={{\n          display: \"inline-flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          minWidth: 16,\n          height: 16,\n          padding: \"0 4px\",\n          fontSize: 10,\n          fontWeight: 500,\n          backgroundColor: \"rgba(59, 130, 246, 0.2)\",\n          color: \"rgb(59, 130, 246)\",\n          borderRadius: 4,\n          marginLeft: 2,\n        }}\n      >\n        {id}\n      </span>\n    );\n  }\n\n  const isWebSource = !!citation.url;\n  const hasExcerpt = !!(citation.excerpt || citation.snippet);\n\n  const handleClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (isWebSource && !hasExcerpt) {\n      // Web source without excerpt - open URL\n      window.open(citation.url!, \"_blank\", \"noopener,noreferrer\");\n    } else {\n      // Document source or has excerpt - show popover\n      updatePosition();\n      setShowPopover(!showPopover);\n    }\n  };\n\n  return (\n    <span style={{ position: \"relative\", display: \"inline-block\" }}>\n      <button\n        ref={buttonRef}\n        onClick={handleClick}\n        title={citation.title}\n        style={{\n          display: \"inline-flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          minWidth: 16,\n          height: 16,\n          padding: \"0 4px\",\n          fontSize: 10,\n          fontWeight: 500,\n          backgroundColor: \"rgba(59, 130, 246, 0.2)\",\n          color: \"rgb(59, 130, 246)\",\n          borderRadius: 4,\n          marginLeft: 2,\n          cursor: \"pointer\",\n          border: \"none\",\n          transition: \"background-color 0.15s\",\n        }}\n        onMouseEnter={(e) => {\n          e.currentTarget.style.backgroundColor = \"rgba(59, 130, 246, 0.3)\";\n        }}\n        onMouseLeave={(e) => {\n          e.currentTarget.style.backgroundColor = \"rgba(59, 130, 246, 0.2)\";\n        }}\n      >\n        {id}\n      </button>\n\n      {showPopover && hasExcerpt && (\n        <div\n          ref={popoverRef}\n          style={{\n            position: \"absolute\",\n            zIndex: 50,\n            width: 288,\n            maxWidth: \"90vw\",\n            padding: 12,\n            borderRadius: 8,\n            border: \"1px solid rgba(255, 255, 255, 0.1)\",\n            backgroundColor: \"rgba(24, 24, 27, 0.95)\",\n            backdropFilter: \"blur(8px)\",\n            boxShadow: \"0 10px 25px rgba(0, 0, 0, 0.3)\",\n            ...(popoverPosition === \"top\"\n              ? { bottom: \"100%\", marginBottom: 8 }\n              : { top: \"100%\", marginTop: 8 }),\n            left: \"50%\",\n            transform: \"translateX(-50%)\",\n          }}\n        >\n          {/* Header */}\n          <div\n            style={{\n              display: \"flex\",\n              alignItems: \"center\",\n              gap: 8,\n              marginBottom: 8,\n              paddingBottom: 8,\n              borderBottom: \"1px solid rgba(255, 255, 255, 0.05)\",\n            }}\n          >\n            {citation.pageNumber && (\n              <span\n                style={{\n                  fontSize: 10,\n                  padding: \"2px 6px\",\n                  borderRadius: 4,\n                  backgroundColor: \"rgba(59, 130, 246, 0.2)\",\n                  color: \"rgb(59, 130, 246)\",\n                  flexShrink: 0,\n                }}\n              >\n                p. {citation.pageNumber}\n              </span>\n            )}\n            <span\n              style={{\n                fontSize: 12,\n                fontWeight: 500,\n                color: \"rgba(255, 255, 255, 0.8)\",\n                overflow: \"hidden\",\n                textOverflow: \"ellipsis\",\n                whiteSpace: \"nowrap\",\n              }}\n            >\n              {citation.title}\n            </span>\n          </div>\n\n          {/* Excerpt */}\n          <p\n            style={{\n              fontSize: 12,\n              color: \"rgba(255, 255, 255, 0.7)\",\n              lineHeight: 1.5,\n              fontStyle: \"italic\",\n              margin: 0,\n            }}\n          >\n            \"{citation.excerpt || citation.snippet}\"\n          </p>\n\n          {/* Footer for web sources */}\n          {isWebSource && (\n            <a\n              href={citation.url!}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              style={{\n                display: \"flex\",\n                alignItems: \"center\",\n                gap: 4,\n                marginTop: 8,\n                paddingTop: 8,\n                borderTop: \"1px solid rgba(255, 255, 255, 0.05)\",\n                fontSize: 10,\n                color: \"rgb(59, 130, 246)\",\n                textDecoration: \"none\",\n              }}\n            >\n              {citation.domain || \"Open source\"} →\n            </a>\n          )}\n        </div>\n      )}\n    </span>\n  );\n});\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useMemo,\n  type ReactNode,\n} from \"react\";\nimport { InternalMarkdown } from \"./internal-markdown\";\nimport type {\n  MarkdownTheme,\n  MarkdownContextValue,\n  MarkdownProviderProps,\n  RenderTextOptions,\n} from \"./types\";\nimport { defaultTheme } from \"./types\";\n\nconst MarkdownContext = createContext<MarkdownContextValue | null>(null);\n\n/**\n * Provider for global markdown rendering configuration.\n *\n * Wrap your app with this provider to enable markdown rendering in all components.\n * Components can use `useRenderText()` to render text with markdown support.\n *\n * @example\n * ```tsx\n * <MarkdownProvider>\n *   <App />\n * </MarkdownProvider>\n * ```\n */\nexport function MarkdownProvider({\n  children,\n  enabled = true,\n  theme: themeOverrides,\n}: MarkdownProviderProps) {\n  const theme = useMemo(\n    () => ({ ...defaultTheme, ...themeOverrides }),\n    [themeOverrides],\n  );\n\n  const renderText = useMemo(() => {\n    return (\n      content: string | null | undefined,\n      options: RenderTextOptions = {},\n    ): ReactNode => {\n      // If no content, return null\n      if (!content) return null;\n\n      // If markdown is disabled, return plain text\n      if (!enabled) {\n        if (options.inline) {\n          return (\n            <span className={options.className} style={options.style}>\n              {content}\n            </span>\n          );\n        }\n        return (\n          <div className={options.className} style={options.style}>\n            {content}\n          </div>\n        );\n      }\n\n      // Render with markdown\n      return (\n        <InternalMarkdown\n          content={content}\n          inline={options.inline ?? false}\n          theme={theme}\n          className={options.className}\n          style={options.style}\n        />\n      );\n    };\n  }, [enabled, theme]);\n\n  const value = useMemo<MarkdownContextValue>(\n    () => ({\n      enabled,\n      theme,\n      renderText,\n    }),\n    [enabled, theme, renderText],\n  );\n\n  return (\n    <MarkdownContext.Provider value={value}>\n      {children}\n    </MarkdownContext.Provider>\n  );\n}\n\n/**\n * Hook to access the markdown rendering context.\n *\n * Returns `renderText` function that automatically applies markdown formatting.\n * If no provider is found, returns a fallback that renders plain text.\n *\n * @example\n * ```tsx\n * function MyComponent({ description }: { description: string }) {\n *   const { renderText } = useMarkdown();\n *   return <div>{renderText(description)}</div>;\n * }\n * ```\n */\nexport function useMarkdown(): MarkdownContextValue {\n  const context = useContext(MarkdownContext);\n\n  // Fallback for when no provider is present - render plain text\n  if (!context) {\n    return {\n      enabled: false,\n      theme: defaultTheme,\n      renderText: (\n        content: string | null | undefined,\n        options: RenderTextOptions = {},\n      ) => {\n        if (!content) return null;\n        if (options.inline) {\n          return (\n            <span className={options.className} style={options.style}>\n              {content}\n            </span>\n          );\n        }\n        return (\n          <div className={options.className} style={options.style}>\n            {content}\n          </div>\n        );\n      },\n    };\n  }\n\n  return context;\n}\n\n/**\n * Convenience hook that returns just the renderText function.\n *\n * @example\n * ```tsx\n * function MyComponent({ description }: { description: string }) {\n *   const renderText = useRenderText();\n *   return <div>{renderText(description)}</div>;\n * }\n * ```\n */\nexport function useRenderText() {\n  const { renderText } = useMarkdown();\n  return renderText;\n}\n","\"use client\";\n\nimport {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useCallback,\n  useRef,\n  type ReactNode,\n} from \"react\";\nimport type { ProactivityMode } from \"../hooks/types\";\nimport {\n  DEFAULT_EXTENDED_SETTINGS,\n  type ExtendedAISettings,\n  type AISettingsContextValue,\n} from \"./ai-settings/types\";\nimport {\n  loadSettings,\n  saveSettings,\n  fetchSettingsFromAPI,\n  saveSettingsToAPI,\n} from \"./ai-settings/storage\";\n\n// Re-export types for convenience\nexport type {\n  DocumentSettings,\n  ExtendedAISettings,\n  AISettingsContextValue,\n} from \"./ai-settings/types\";\nexport { DEFAULT_EXTENDED_SETTINGS } from \"./ai-settings/types\";\n\nconst AISettingsContext = createContext<AISettingsContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface AISettingsProviderProps {\n  children: ReactNode;\n  initialSettings?: Partial<ExtendedAISettings>;\n}\n\nexport function AISettingsProvider({\n  children,\n  initialSettings,\n}: AISettingsProviderProps) {\n  const [settings, setSettings] = useState<ExtendedAISettings>(() => {\n    const loaded = loadSettings();\n    if (initialSettings) {\n      return {\n        proactivity: { ...loaded.proactivity, ...initialSettings.proactivity },\n        suggestions: { ...loaded.suggestions, ...initialSettings.suggestions },\n        dataCollection: {\n          ...loaded.dataCollection,\n          ...initialSettings.dataCollection,\n        },\n        onboarding: { ...loaded.onboarding, ...initialSettings.onboarding },\n        documents: { ...loaded.documents, ...initialSettings.documents },\n      };\n    }\n    return loaded;\n  });\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const syncTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    fetchSettingsFromAPI().then((apiSettings) => {\n      if (apiSettings) {\n        setSettings(apiSettings);\n        saveSettings(apiSettings);\n      }\n      setIsLoading(false);\n    });\n  }, []);\n\n  const syncToAPI = useCallback((newSettings: Partial<ExtendedAISettings>) => {\n    if (syncTimeoutRef.current) {\n      clearTimeout(syncTimeoutRef.current);\n    }\n    syncTimeoutRef.current = setTimeout(async () => {\n      setIsSyncing(true);\n      await saveSettingsToAPI(newSettings);\n      setIsSyncing(false);\n    }, 500);\n  }, []);\n\n  const updateAndSync = useCallback(\n    (\n      newSettings: ExtendedAISettings,\n      changedPart: Partial<ExtendedAISettings>,\n    ) => {\n      setSettings(newSettings);\n      saveSettings(newSettings);\n      syncToAPI(changedPart);\n    },\n    [syncToAPI],\n  );\n\n  const updateSettings = useCallback(\n    (partial: Partial<ExtendedAISettings>) => {\n      setSettings((prev) => {\n        const next = {\n          proactivity: { ...prev.proactivity, ...partial.proactivity },\n          suggestions: { ...prev.suggestions, ...partial.suggestions },\n          dataCollection: { ...prev.dataCollection, ...partial.dataCollection },\n          onboarding: { ...prev.onboarding, ...partial.onboarding },\n          documents: { ...prev.documents, ...partial.documents },\n        };\n        saveSettings(next);\n        syncToAPI(partial);\n        return next;\n      });\n    },\n    [syncToAPI],\n  );\n\n  const setProactivityMode = useCallback(\n    (mode: ProactivityMode) => {\n      const change = {\n        proactivity: {\n          enabled: mode !== \"disabled\",\n          mode,\n          debounceMs: settings.proactivity.debounceMs,\n        },\n      };\n      updateAndSync(\n        {\n          ...settings,\n          proactivity: { ...settings.proactivity, ...change.proactivity },\n        },\n        change,\n      );\n    },\n    [settings, updateAndSync],\n  );\n\n  const setProactivityEnabled = useCallback(\n    (enabled: boolean) => {\n      const change = {\n        proactivity: {\n          enabled,\n          mode: enabled ? settings.proactivity.mode : \"disabled\",\n          debounceMs: settings.proactivity.debounceMs,\n        },\n      };\n      updateAndSync(\n        {\n          ...settings,\n          proactivity: { ...settings.proactivity, ...change.proactivity },\n        },\n        change,\n      );\n    },\n    [settings, updateAndSync],\n  );\n\n  const setSuggestionsEnabled = useCallback(\n    (enabled: boolean) => {\n      const change = { suggestions: { ...settings.suggestions, enabled } };\n      updateAndSync({ ...settings, ...change }, change);\n    },\n    [settings, updateAndSync],\n  );\n\n  const setDataCollectionPreferForm = useCallback(\n    (preferForm: boolean) => {\n      const change = {\n        dataCollection: { ...settings.dataCollection, preferForm },\n      };\n      updateAndSync({ ...settings, ...change }, change);\n    },\n    [settings, updateAndSync],\n  );\n\n  const setSmartParsingEnabled = useCallback(\n    (enabled: boolean) => {\n      const change = { documents: { smartParsingEnabled: enabled } };\n      updateAndSync({ ...settings, ...change }, change);\n    },\n    [settings, updateAndSync],\n  );\n\n  const resetSettings = useCallback(() => {\n    setSettings(DEFAULT_EXTENDED_SETTINGS);\n    saveSettings(DEFAULT_EXTENDED_SETTINGS);\n    syncToAPI(DEFAULT_EXTENDED_SETTINGS);\n  }, [syncToAPI]);\n\n  const completeOnboarding = useCallback(() => {\n    const change = { onboarding: { ...settings.onboarding, completed: true } };\n    updateAndSync({ ...settings, ...change }, change);\n  }, [settings, updateAndSync]);\n\n  const value: AISettingsContextValue = {\n    settings,\n    updateSettings,\n    setProactivityMode,\n    setProactivityEnabled,\n    setSuggestionsEnabled,\n    setDataCollectionPreferForm,\n    setSmartParsingEnabled,\n    resetSettings,\n    completeOnboarding,\n    isLoading,\n    isSyncing,\n  };\n\n  return (\n    <AISettingsContext.Provider value={value}>\n      {children}\n    </AISettingsContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function useAISettings(): AISettingsContextValue {\n  const context = useContext(AISettingsContext);\n  if (!context) {\n    throw new Error(\"useAISettings must be used within AISettingsProvider\");\n  }\n  return context;\n}\n\nexport function useAISettingsOptional(): AISettingsContextValue | null {\n  return useContext(AISettingsContext);\n}\n\nexport function useIsProactivityEnabled(): boolean {\n  const context = useContext(AISettingsContext);\n  if (!context) return true;\n  return (\n    context.settings.proactivity.enabled &&\n    context.settings.proactivity.mode !== \"disabled\"\n  );\n}\n\nexport function useAreSuggestionsEnabled(): boolean {\n  const context = useContext(AISettingsContext);\n  if (!context) return true;\n  return context.settings.suggestions.enabled;\n}\n\nexport function useIsSmartParsingEnabled(): boolean {\n  const context = useContext(AISettingsContext);\n  if (!context) return false;\n  return context.settings.documents.smartParsingEnabled;\n}\n","import type {\n  UITree,\n  UIElement,\n  DocumentIndex,\n  DocumentIndexNode,\n} from \"@onegenui/core\";\n\n// Re-export core types for convenience\nexport type { DocumentIndex, DocumentIndexNode };\n\n// ─────────────────────────────────────────────────────────────────────────────\n// AI Interactive Types (Questions, Suggestions)\n// Must be defined before ConversationTurn which uses them\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Form field for dynamic question forms\n */\nexport interface FormField {\n  id: string;\n  label: string;\n  type:\n    | \"text\"\n    | \"number\"\n    | \"select\"\n    | \"checkbox\"\n    | \"date\"\n    | \"textarea\"\n    | \"radio\";\n  options?: { value: string; label: string }[];\n  placeholder?: string;\n  defaultValue?: string | number | boolean;\n  /** Allow user to enter custom value (adds \"Other\" option to select/radio) */\n  allowCustom?: boolean;\n  validation?: {\n    required?: boolean;\n    min?: number;\n    max?: number;\n    minLength?: number;\n    maxLength?: number;\n    pattern?: string;\n  };\n}\n\n/**\n * Quick reply option for simple button choices\n */\nexport interface QuickReplyOption {\n  id: string;\n  label: string;\n  value: string;\n  variant?: \"default\" | \"primary\" | \"success\" | \"danger\";\n}\n\n/**\n * Question payload from AI asking for user input\n * Supports multiple interaction types for better UX\n */\nexport interface QuestionPayload {\n  id: string;\n  text: string;\n  type: \"text\" | \"form\" | \"quick-reply\";\n  /** Form fields (for type: \"form\") */\n  fields?: FormField[];\n  /** Quick reply options (for type: \"quick-reply\") */\n  options?: QuickReplyOption[];\n  /** Allow multiple selection for quick-reply */\n  multiple?: boolean;\n  /** Allow custom text input in addition to options */\n  allowCustom?: boolean;\n  required?: boolean;\n}\n\n/**\n * Suggestion chip for quick actions\n */\nexport interface SuggestionChip {\n  id: string;\n  label: string;\n  prompt: string;\n  icon?: string;\n  variant?: \"default\" | \"primary\" | \"success\" | \"warning\";\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Chat Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Chat message type\n */\nexport interface ChatMessage {\n  role: \"assistant\" | \"user\" | \"system\";\n  content: string;\n}\n\n/**\n * File attachment containing metadata and preview\n */\nexport interface FileAttachment {\n  id: string;\n  type: \"document\" | \"image\" | \"spreadsheet\" | \"presentation\" | \"other\";\n  file: File;\n  preview?: string;\n}\n\n/** Server-cached document attachment (from library) */\nexport interface LibraryAttachment {\n  id: string;\n  documentId: string;\n  fileName: string;\n  mimeType: string;\n  pageCount?: number;\n  type: \"library-document\";\n}\n\nexport type Attachment = FileAttachment | LibraryAttachment;\n\nexport function isLibraryAttachment(a: Attachment): a is LibraryAttachment {\n  return a.type === \"library-document\" && \"documentId\" in a;\n}\n\nexport function isFileAttachment(a: Attachment): a is FileAttachment {\n  return a.type !== \"library-document\" && \"file\" in a && a.file instanceof File;\n}\n\n/**\n * Persisted attachment data (serializable for database storage)\n */\nexport interface PersistedAttachment {\n  id: string;\n  fileName: string;\n  mimeType: string;\n  type: \"document\" | \"image\" | \"spreadsheet\" | \"presentation\" | \"other\";\n  /** Parsed text content of the document */\n  parsedContent?: string;\n  /** Base64 encoded content for images */\n  base64Content?: string;\n  /** Size in bytes */\n  size: number;\n}\n\n/**\n * Tool progress event for granular UI updates\n */\nexport interface ToolProgress {\n  toolName: string;\n  toolCallId: string;\n  status: \"starting\" | \"progress\" | \"complete\" | \"error\";\n  message?: string;\n  data?: unknown;\n}\n\n/**\n * A single turn in the conversation\n */\nexport interface ConversationTurn {\n  id: string;\n  userMessage: string;\n  assistantMessages: ChatMessage[];\n  treeSnapshot: UITree | null;\n  timestamp: number;\n  /** Questions from AI requiring user response */\n  questions?: QuestionPayload[];\n  /** Suggestion chips for quick follow-up actions */\n  suggestions?: SuggestionChip[];\n  /** User's answers to questions */\n  questionAnswers?: Record<string, unknown>;\n  /** Whether this turn was triggered proactively (hides user message in UI) */\n  isProactive?: boolean;\n  /** Files attached to this turn (runtime only, contains File objects) */\n  attachments?: Attachment[];\n  /** Persisted attachment data (serializable, for database storage) */\n  persistedAttachments?: PersistedAttachment[];\n  /** Tool progress events for granular updates */\n  toolProgress?: ToolProgress[];\n  /** Document index from Vectorless (smart parsing) */\n  documentIndex?: DocumentIndex;\n  /** Error message if turn failed */\n  error?: string;\n  /** Whether turn is still loading */\n  isLoading?: boolean;\n}\n\n/**\n * Minimal message format for AI SDK multi-turn conversations.\n * Used to pass conversation history to backend for native multi-turn support.\n */\nexport interface ConversationMessage {\n  role: \"user\" | \"assistant\";\n  content: string;\n}\n\n/**\n * Converts ConversationTurn[] to ConversationMessage[] for AI SDK.\n * Includes all completed turns - model handles context window.\n */\nexport function buildConversationMessages(\n  turns: ConversationTurn[],\n): ConversationMessage[] {\n  const messages: ConversationMessage[] = [];\n\n  for (const turn of turns) {\n    // Skip proactive turns and incomplete turns\n    if (turn.isProactive || !turn.assistantMessages?.length) continue;\n\n    // Add user message\n    if (turn.userMessage) {\n      messages.push({ role: \"user\", content: turn.userMessage });\n    }\n\n    // Add assistant response\n    const assistantContent = turn.assistantMessages\n      .map((m) => m.content)\n      .filter(Boolean)\n      .join(\"\\n\");\n\n    if (assistantContent) {\n      messages.push({ role: \"assistant\", content: assistantContent });\n    }\n  }\n\n  return messages;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// useUIStream Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Options for useUIStream\n */\nexport interface UseUIStreamOptions {\n  /** API endpoint */\n  api: string;\n  /** Callback when complete */\n  onComplete?: (tree: UITree) => void;\n  /** Callback on error */\n  onError?: (error: Error) => void;\n  /** Function to get dynamic headers (e.g. for auth) */\n  getHeaders?: () => Record<string, string> | Promise<Record<string, string>>;\n}\n\n/**\n * Return type for useUIStream\n */\nexport interface UseUIStreamReturn {\n  /** Current UI tree */\n  tree: UITree | null;\n  /** Full conversation history (user messages + assistant messages + snapshots) */\n  conversation: ConversationTurn[];\n  /** Whether currently streaming */\n  isStreaming: boolean;\n  /** Error if any */\n  error: Error | null;\n  /** Send a prompt to generate UI */\n  send: (\n    prompt: string,\n    context?: Record<string, unknown>,\n    attachments?: Attachment[],\n  ) => Promise<void>;\n  /** Clear the current tree and conversation */\n  clear: () => void;\n  /** Remove an element from the tree */\n  removeElement: (elementKey: string) => void;\n  /** Remove specific sub-items from an element's array prop by index or ID (supports undo) */\n  removeSubItems: (\n    elementKey: string,\n    identifiers: (number | string)[],\n  ) => void;\n  /** Update an element's props in the tree */\n  updateElement: (elementKey: string, updates: Record<string, unknown>) => void;\n  /** Update an element's layout (size, grid, resizable) */\n  updateElementLayout: (\n    elementKey: string,\n    layoutUpdates: {\n      width?: number;\n      height?: number;\n      column?: number;\n      row?: number;\n      columnSpan?: number;\n      rowSpan?: number;\n      resizable?: boolean;\n    },\n  ) => void;\n  /** Delete a turn and rollback to previous state */\n  deleteTurn: (turnId: string) => void;\n  /** Edit a turn message and regenerate */\n  editTurn: (turnId: string, newMessage: string) => Promise<void>;\n  /** Undo last action */\n  undo: () => void;\n  /** Redo last undone action */\n  redo: () => void;\n  /** Whether undo is available */\n  canUndo: boolean;\n  /** Whether redo is available */\n  canRedo: boolean;\n  /** Load a full session state */\n  loadSession: (session: {\n    tree: UITree;\n    conversation: ConversationTurn[];\n  }) => void;\n  /** Answer a question from AI */\n  answerQuestion: (\n    turnId: string,\n    questionId: string,\n    answers: Record<string, unknown>,\n  ) => void;\n  // Note: Plan state now in Zustand store - use usePlanExecution() hook\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// flatToTree Types (re-export from core for convenience)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type FlatElement = UIElement & { parentKey?: string | null };\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Action Tracking Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Types of user actions that can be tracked\n */\nexport type ActionType =\n  | \"toggle\"\n  | \"input\"\n  | \"select\"\n  | \"click\"\n  | \"complete\"\n  | \"create\"\n  | \"delete\"\n  | \"update\"\n  | \"submit\"\n  | \"expand\"\n  | \"collapse\"\n  | \"drag\"\n  | \"drop\";\n\n/**\n * A tracked user action on a component\n */\nexport interface TrackedAction {\n  id: string;\n  timestamp: number;\n  type: ActionType;\n  elementKey: string;\n  elementType: string;\n  payload?: unknown;\n  context?: {\n    itemId?: string;\n    itemIndex?: number;\n    itemLabel?: string;\n    previousValue?: unknown;\n    newValue?: unknown;\n    parentKey?: string;\n  };\n}\n\n/**\n * Options for action tracker\n *\n * KISS Principle: Only essential options, smart defaults handle the rest.\n * The system automatically detects when user is editing and delays triggers.\n */\nexport interface ActionTrackerOptions {\n  /** Enable/disable action tracking */\n  enabled: boolean;\n  /**\n   * Debounce delay in ms before triggering proactive AI.\n   * Timer only starts when user is NOT focused on an editable element.\n   * Default: 2000 (2 seconds)\n   */\n  debounceMs?: number;\n  /** Maximum number of actions to keep in context for AI. Default: 5 */\n  maxActionsInContext?: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// AI Settings Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Proactivity mode for AI Assistant\n */\nexport type ProactivityMode = \"full\" | \"on-request\" | \"disabled\";\n\n/**\n * AI Assistant settings\n */\nexport interface AIAssistantSettings {\n  proactivity: {\n    enabled: boolean;\n    mode: ProactivityMode;\n    debounceMs: number;\n  };\n  suggestions: {\n    enabled: boolean;\n    maxChips: number;\n  };\n  dataCollection: {\n    preferForm: boolean;\n    autoAsk: boolean;\n  };\n  onboarding: {\n    showOnFirstUse: boolean;\n    completed: boolean;\n  };\n}\n\n/**\n * Default AI Assistant settings\n */\nexport const DEFAULT_AI_SETTINGS: AIAssistantSettings = {\n  proactivity: {\n    enabled: true,\n    mode: \"full\",\n    debounceMs: 2000,\n  },\n  suggestions: {\n    enabled: true,\n    maxChips: 4,\n  },\n  dataCollection: {\n    preferForm: true,\n    autoAsk: true,\n  },\n  onboarding: {\n    showOnFirstUse: true,\n    completed: false,\n  },\n};\n","\"use client\";\n\nimport type { AIAssistantSettings, ProactivityMode } from \"../../hooks/types\";\nimport { DEFAULT_AI_SETTINGS } from \"../../hooks/types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Storage Key\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const STORAGE_KEY = \"json-render-ai-settings\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Extended Settings (includes document processing)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface DocumentSettings {\n  smartParsingEnabled: boolean;\n}\n\nexport interface ExtendedAISettings extends AIAssistantSettings {\n  documents: DocumentSettings;\n}\n\nexport const DEFAULT_EXTENDED_SETTINGS: ExtendedAISettings = {\n  ...DEFAULT_AI_SETTINGS,\n  documents: {\n    smartParsingEnabled: false,\n  },\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface AISettingsContextValue {\n  settings: ExtendedAISettings;\n  updateSettings: (partial: Partial<ExtendedAISettings>) => void;\n  setProactivityMode: (mode: ProactivityMode) => void;\n  setProactivityEnabled: (enabled: boolean) => void;\n  setSuggestionsEnabled: (enabled: boolean) => void;\n  setDataCollectionPreferForm: (preferForm: boolean) => void;\n  setSmartParsingEnabled: (enabled: boolean) => void;\n  resetSettings: () => void;\n  completeOnboarding: () => void;\n  isLoading: boolean;\n  isSyncing: boolean;\n}\n","import {\n  STORAGE_KEY,\n  DEFAULT_EXTENDED_SETTINGS,\n  type ExtendedAISettings,\n} from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Local Storage Helpers\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function loadSettings(): ExtendedAISettings {\n  if (typeof window === \"undefined\") return DEFAULT_EXTENDED_SETTINGS;\n\n  try {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored) {\n      const parsed = JSON.parse(stored) as Partial<ExtendedAISettings>;\n      return {\n        proactivity: {\n          ...DEFAULT_EXTENDED_SETTINGS.proactivity,\n          ...parsed.proactivity,\n        },\n        suggestions: {\n          ...DEFAULT_EXTENDED_SETTINGS.suggestions,\n          ...parsed.suggestions,\n        },\n        dataCollection: {\n          ...DEFAULT_EXTENDED_SETTINGS.dataCollection,\n          ...parsed.dataCollection,\n        },\n        onboarding: {\n          ...DEFAULT_EXTENDED_SETTINGS.onboarding,\n          ...parsed.onboarding,\n        },\n        documents: {\n          ...DEFAULT_EXTENDED_SETTINGS.documents,\n          ...parsed.documents,\n        },\n      };\n    }\n  } catch {\n    // Ignore parse errors\n  }\n  return DEFAULT_EXTENDED_SETTINGS;\n}\n\nexport function saveSettings(settings: ExtendedAISettings): void {\n  if (typeof window === \"undefined\") return;\n\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\n  } catch {\n    // Ignore storage errors\n  }\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// API Helpers\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport async function fetchSettingsFromAPI(): Promise<ExtendedAISettings | null> {\n  try {\n    const res = await fetch(\"/api/settings\");\n    if (!res.ok) return null;\n    const data = await res.json();\n    return {\n      proactivity: data.proactivity ?? DEFAULT_EXTENDED_SETTINGS.proactivity,\n      suggestions: data.suggestions ?? DEFAULT_EXTENDED_SETTINGS.suggestions,\n      dataCollection:\n        data.dataCollection ?? DEFAULT_EXTENDED_SETTINGS.dataCollection,\n      onboarding: {\n        showOnFirstUse: DEFAULT_EXTENDED_SETTINGS.onboarding.showOnFirstUse,\n        completed: data.onboarding?.completed ?? false,\n      },\n      documents: data.documents ?? DEFAULT_EXTENDED_SETTINGS.documents,\n    };\n  } catch {\n    return null;\n  }\n}\n\nexport async function saveSettingsToAPI(\n  settings: Partial<ExtendedAISettings>,\n): Promise<boolean> {\n  try {\n    const res = await fetch(\"/api/settings\", {\n      method: \"PUT\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(settings),\n    });\n    return res.ok;\n  } catch {\n    return false;\n  }\n}\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Provider\n// =============================================================================\n\nimport {\n  createContext,\n  useState,\n  useCallback,\n  useRef,\n  useEffect,\n  type ReactNode,\n} from \"react\";\nimport type { TrackedAction, ActionTrackerOptions } from \"../../hooks/types\";\nimport type { ActionContextValue } from \"./types\";\nimport { DEFAULT_OPTIONS } from \"./types\";\nimport { generateId, isUserCurrentlyEditing } from \"./utils\";\n\nexport const ActionContext = createContext<ActionContextValue | null>(null);\n\ninterface ActionProviderProps {\n  children: ReactNode;\n  initialOptions?: Partial<ActionTrackerOptions>;\n}\n\nexport function ActionProvider({\n  children,\n  initialOptions,\n}: ActionProviderProps) {\n  const [options, setOptionsState] = useState<ActionTrackerOptions>(() => ({\n    ...DEFAULT_OPTIONS,\n    ...initialOptions,\n  }));\n\n  const [actions, setActions] = useState<TrackedAction[]>([]);\n  const [lastAction, setLastAction] = useState<TrackedAction | null>(null);\n\n  // Refs for async operations\n  const subscribersRef = useRef<Set<(actions: TrackedAction[]) => void>>(\n    new Set(),\n  );\n  const pendingActionsRef = useRef<TrackedAction[]>([]);\n  const timerRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  // Core Logic: Smart Debounce with Focus Awareness\n  const notifySubscribers = useCallback((batch: TrackedAction[]) => {\n    subscribersRef.current.forEach((cb) => {\n      try {\n        cb(batch);\n      } catch (e) {\n        console.error(\"[ActionTracker] Subscriber error:\", e);\n      }\n    });\n  }, []);\n\n  const tryFlush = useCallback(() => {\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = null;\n    }\n\n    if (pendingActionsRef.current.length === 0) return;\n\n    if (isUserCurrentlyEditing()) {\n      timerRef.current = setTimeout(tryFlush, 1000);\n      return;\n    }\n\n    const batch = [...pendingActionsRef.current];\n    pendingActionsRef.current = [];\n    notifySubscribers(batch);\n  }, [notifySubscribers]);\n\n  const scheduleFlush = useCallback(\n    (delayMs: number) => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n      }\n      timerRef.current = setTimeout(tryFlush, delayMs);\n    },\n    [tryFlush],\n  );\n\n  // Public API\n  const trackAction = useCallback(\n    (actionData: Omit<TrackedAction, \"id\" | \"timestamp\">) => {\n      if (!options.enabled) return;\n\n      const action: TrackedAction = {\n        ...actionData,\n        id: generateId(),\n        timestamp: Date.now(),\n      };\n\n      setActions((prev) => {\n        const next = [...prev, action];\n        return next.slice(-(options.maxActionsInContext ?? 5));\n      });\n      setLastAction(action);\n\n      pendingActionsRef.current.push(action);\n      scheduleFlush(options.debounceMs ?? 2500);\n    },\n    [\n      options.enabled,\n      options.maxActionsInContext,\n      options.debounceMs,\n      scheduleFlush,\n    ],\n  );\n\n  const clearActions = useCallback(() => {\n    setActions([]);\n    setLastAction(null);\n    pendingActionsRef.current = [];\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = null;\n    }\n  }, []);\n\n  const getActionsForContext = useCallback(() => {\n    return actions.slice(-(options.maxActionsInContext ?? 5));\n  }, [actions, options.maxActionsInContext]);\n\n  const onAction = useCallback(\n    (callback: (actions: TrackedAction[]) => void) => {\n      subscribersRef.current.add(callback);\n      return () => subscribersRef.current.delete(callback);\n    },\n    [],\n  );\n\n  const setOptions = useCallback(\n    (newOptions: Partial<ActionTrackerOptions>) => {\n      setOptionsState((prev) => ({ ...prev, ...newOptions }));\n    },\n    [],\n  );\n\n  // Cleanup\n  useEffect(() => {\n    return () => {\n      if (timerRef.current) clearTimeout(timerRef.current);\n    };\n  }, []);\n\n  // Global focus listener - triggers flush when user leaves any input\n  useEffect(() => {\n    if (typeof document === \"undefined\") return;\n\n    const handleFocusOut = (e: FocusEvent) => {\n      const target = e.target as HTMLElement;\n      const tag = target?.tagName?.toLowerCase();\n      const isEditable =\n        tag === \"input\" ||\n        tag === \"textarea\" ||\n        tag === \"select\" ||\n        target?.isContentEditable;\n\n      if (!isEditable) return;\n\n      setTimeout(() => {\n        if (!isUserCurrentlyEditing() && pendingActionsRef.current.length > 0) {\n          scheduleFlush(options.debounceMs ?? 2500);\n        }\n      }, 100);\n    };\n\n    document.addEventListener(\"focusout\", handleFocusOut, true);\n    return () => document.removeEventListener(\"focusout\", handleFocusOut, true);\n  }, [options.debounceMs, scheduleFlush]);\n\n  const value: ActionContextValue = {\n    actions,\n    trackAction,\n    clearActions,\n    getActionsForContext,\n    lastAction,\n    onAction,\n    options,\n    setOptions,\n  };\n\n  return (\n    <ActionContext.Provider value={value}>{children}</ActionContext.Provider>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Types\n// =============================================================================\n\nimport type { TrackedAction, ActionTrackerOptions } from \"../../hooks/types\";\n\nexport interface ActionContextValue {\n  /** Recent actions (limited by maxActionsInContext) */\n  actions: TrackedAction[];\n  /** Track a new user action */\n  trackAction: (action: Omit<TrackedAction, \"id\" | \"timestamp\">) => void;\n  /** Clear all tracked actions */\n  clearActions: () => void;\n  /** Get actions for AI context */\n  getActionsForContext: () => TrackedAction[];\n  /** Last action tracked */\n  lastAction: TrackedAction | null;\n  /** Subscribe to action events (for proactive AI) */\n  onAction: (callback: (actions: TrackedAction[]) => void) => () => void;\n  /** Options */\n  options: ActionTrackerOptions;\n  /** Update options */\n  setOptions: (options: Partial<ActionTrackerOptions>) => void;\n}\n\nexport const DEFAULT_OPTIONS: ActionTrackerOptions = {\n  enabled: true,\n  debounceMs: 2500,\n  maxActionsInContext: 5,\n};\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Utilities\n// =============================================================================\n\nimport type { TrackedAction } from \"../../hooks/types\";\n\nexport const generateId = () =>\n  `action-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n\n/** Check if document has focus on an editable element */\nexport const isUserCurrentlyEditing = (): boolean => {\n  if (typeof document === \"undefined\") return false;\n  const active = document.activeElement;\n  if (!active) return false;\n  const tag = active.tagName.toLowerCase();\n  return (\n    tag === \"input\" ||\n    tag === \"textarea\" ||\n    tag === \"select\" ||\n    (active as HTMLElement).isContentEditable\n  );\n};\n\nexport function formatActionsForPrompt(actions: TrackedAction[]): string {\n  if (actions.length === 0) return \"\";\n\n  const formatted = actions.map((action) => {\n    const parts = [`- ${action.type} on ${action.elementType}`];\n    if (action.context?.itemLabel) {\n      parts.push(`\"${action.context.itemLabel}\"`);\n    }\n    if (\n      action.context?.previousValue !== undefined &&\n      action.context?.newValue !== undefined\n    ) {\n      parts.push(\n        `(${action.context.previousValue} -> ${action.context.newValue})`,\n      );\n    }\n    return parts.join(\" \");\n  });\n\n  return `\nRECENT USER ACTIONS:\n${formatted.join(\"\\n\")}\n\nBased on these actions, you may proactively offer relevant assistance.\n`;\n}\n","\"use client\";\n\n// =============================================================================\n// Action Tracking Hooks\n// =============================================================================\n\nimport { useContext, useCallback, useEffect } from \"react\";\nimport type { TrackedAction, ActionType } from \"../../hooks/types\";\nimport type { ActionContextValue } from \"./types\";\nimport { ActionContext } from \"./provider\";\n\nexport function useActionContext(): ActionContextValue {\n  const context = useContext(ActionContext);\n  if (!context) {\n    throw new Error(\"useActionContext must be used within ActionProvider\");\n  }\n  return context;\n}\n\nexport function useElementActionTracker(\n  elementKey: string,\n  elementType: string,\n) {\n  const { trackAction, options } = useActionContext();\n\n  const track = useCallback(\n    (\n      type: ActionType,\n      context?: TrackedAction[\"context\"],\n      payload?: unknown,\n    ) => {\n      if (!options.enabled) return;\n      trackAction({ type, elementKey, elementType, context, payload });\n    },\n    [trackAction, elementKey, elementType, options.enabled],\n  );\n\n  return { track, isEnabled: options.enabled };\n}\n\nexport function useActionSubscriber(\n  callback: (actions: TrackedAction[]) => void,\n  deps: unknown[] = [],\n) {\n  const { onAction } = useActionContext();\n\n  useEffect(() => {\n    return onAction(callback);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [onAction, ...deps]);\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useRef,\n  useMemo,\n  type ReactNode,\n} from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\ntype DomainType =\n  | \"workout\"\n  | \"workout_plan\"\n  | \"meal\"\n  | \"nutrition_plan\"\n  | \"trip\"\n  | \"flight\"\n  | \"hotel\"\n  | \"project\"\n  | \"task\"\n  | \"schedule\"\n  | \"supplement\"\n  | \"calendar\"\n  | \"diary\";\n\ninterface AutoSavePayload {\n  type: DomainType;\n  chatId: string;\n  elementKey: string;\n  data: Record<string, unknown>;\n}\n\ninterface AutoSaveResult {\n  success: boolean;\n  id?: string;\n  error?: string;\n}\n\ninterface AutoSaveContextValue {\n  /**\n   * Chat ID for the current context (used for source linking)\n   */\n  chatId: string | null;\n\n  /**\n   * Execute auto-save for a domain component\n   */\n  autoSave: (\n    payload: Omit<AutoSavePayload, \"chatId\">,\n  ) => Promise<AutoSaveResult>;\n\n  /**\n   * Debounced auto-save (recommended for use in components)\n   */\n  debouncedAutoSave: (\n    payload: Omit<AutoSavePayload, \"chatId\">,\n    delayMs?: number,\n  ) => void;\n\n  /**\n   * Check if auto-save is enabled for this context\n   */\n  isEnabled: boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst AutoSaveContext = createContext<AutoSaveContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface AutoSaveProviderProps {\n  children: ReactNode;\n  /**\n   * Current chat ID for source linking\n   */\n  chatId: string | null;\n  /**\n   * Enable/disable auto-save (default: true when chatId is provided)\n   */\n  enabled?: boolean;\n  /**\n   * Optional custom save endpoint\n   */\n  saveEndpoint?: string;\n  /**\n   * Callback when save completes\n   */\n  onSaveComplete?: (result: AutoSaveResult) => void;\n  /**\n   * Callback on save error\n   */\n  onSaveError?: (error: Error) => void;\n}\n\nconst DEFAULT_DEBOUNCE_MS = 1500;\n\nexport function AutoSaveProvider({\n  children,\n  chatId,\n  enabled = true,\n  saveEndpoint = \"/api/domain/save\",\n  onSaveComplete,\n  onSaveError,\n}: AutoSaveProviderProps) {\n  const debounceTimersRef = useRef<Map<string, NodeJS.Timeout>>(new Map());\n  const pendingRef = useRef<Map<string, AutoSavePayload>>(new Map());\n\n  const autoSave = useCallback(\n    async (\n      payload: Omit<AutoSavePayload, \"chatId\">,\n    ): Promise<AutoSaveResult> => {\n      if (!chatId || !enabled) {\n        return {\n          success: false,\n          error: \"Auto-save disabled or no chat context\",\n        };\n      }\n\n      try {\n        const fullPayload: AutoSavePayload = {\n          ...payload,\n          chatId,\n        };\n\n        const response = await fetch(saveEndpoint, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(fullPayload),\n        });\n\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          const error = errorData.error || \"Failed to save\";\n          onSaveError?.(new Error(error));\n          return { success: false, error };\n        }\n\n        const result = await response.json();\n        onSaveComplete?.(result);\n        return result;\n      } catch (error) {\n        const msg = error instanceof Error ? error.message : \"Unknown error\";\n        onSaveError?.(error instanceof Error ? error : new Error(msg));\n        return { success: false, error: msg };\n      }\n    },\n    [chatId, enabled, saveEndpoint, onSaveComplete, onSaveError],\n  );\n\n  const debouncedAutoSave = useCallback(\n    (\n      payload: Omit<AutoSavePayload, \"chatId\">,\n      delayMs = DEFAULT_DEBOUNCE_MS,\n    ) => {\n      if (!chatId || !enabled) return;\n\n      const key = `${payload.type}:${payload.elementKey}`;\n\n      // Cancel existing timer for this key\n      const existingTimer = debounceTimersRef.current.get(key);\n      if (existingTimer) {\n        clearTimeout(existingTimer);\n      }\n\n      // Store the latest payload\n      pendingRef.current.set(key, { ...payload, chatId });\n\n      // Set new timer\n      const timer = setTimeout(() => {\n        const pendingPayload = pendingRef.current.get(key);\n        if (pendingPayload) {\n          autoSave(pendingPayload);\n          pendingRef.current.delete(key);\n        }\n        debounceTimersRef.current.delete(key);\n      }, delayMs);\n\n      debounceTimersRef.current.set(key, timer);\n    },\n    [chatId, enabled, autoSave],\n  );\n\n  const value = useMemo<AutoSaveContextValue>(\n    () => ({\n      chatId,\n      autoSave,\n      debouncedAutoSave,\n      isEnabled: Boolean(chatId && enabled),\n    }),\n    [chatId, autoSave, debouncedAutoSave, enabled],\n  );\n\n  return (\n    <AutoSaveContext.Provider value={value}>\n      {children}\n    </AutoSaveContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to access auto-save functionality in domain components\n */\nexport function useAutoSave(): AutoSaveContextValue {\n  const context = useContext(AutoSaveContext);\n  if (!context) {\n    // Return a no-op context if not within a provider\n    return {\n      chatId: null,\n      autoSave: async () => ({ success: false, error: \"No AutoSaveProvider\" }),\n      debouncedAutoSave: () => {},\n      isEnabled: false,\n    };\n  }\n  return context;\n}\n\n/**\n * Hook to auto-save domain data on mount and when data changes\n */\nexport function useDomainAutoSave(\n  type: DomainType,\n  elementKey: string,\n  data: Record<string, unknown> | null,\n  options?: {\n    debounceMs?: number;\n    skipMount?: boolean;\n  },\n) {\n  const { debouncedAutoSave, isEnabled } = useAutoSave();\n  const mountedRef = useRef(false);\n  const lastDataRef = useRef<string | null>(null);\n\n  // Auto-save on mount and data changes\n  React.useEffect(() => {\n    if (!isEnabled || !data || !elementKey) return;\n\n    // Skip mount if requested\n    if (!mountedRef.current) {\n      mountedRef.current = true;\n      if (options?.skipMount) return;\n    }\n\n    // Serialize data for change detection\n    const serialized = JSON.stringify(data);\n    if (serialized === lastDataRef.current) return;\n    lastDataRef.current = serialized;\n\n    debouncedAutoSave({ type, elementKey, data }, options?.debounceMs);\n  }, [\n    type,\n    elementKey,\n    data,\n    isEnabled,\n    debouncedAutoSave,\n    options?.debounceMs,\n    options?.skipMount,\n  ]);\n}\n\nexport type {\n  DomainType,\n  AutoSaveContextValue,\n  AutoSavePayload,\n  AutoSaveResult,\n};\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useCallback,\n  useMemo,\n  useEffect,\n  type ReactNode,\n} from \"react\";\nimport { useStore } from \"../store\";\nimport { useShallow } from \"zustand/react/shallow\";\n\n// Re-export types from store slices (which come from @onegenui/core)\nexport type {\n  ToolProgressStatus,\n  ToolProgressEvent,\n  StoredProgressEvent,\n} from \"../store/slices/tool-progress\";\n\n// Use the stored event type for internal state\nimport type { StoredProgressEvent } from \"../store/slices/tool-progress\";\n\n/**\n * Tool progress context value\n */\nexport interface ToolProgressContextValue {\n  /** All active tool progress events (not yet complete) */\n  activeProgress: StoredProgressEvent[];\n  /** All tool progress events (including complete) */\n  allProgress: StoredProgressEvent[];\n  /** Whether any tool is currently running */\n  isToolRunning: boolean;\n  /** Add a new tool progress event */\n  addProgress: (event: Omit<StoredProgressEvent, \"timestamp\" | \"type\">) => void;\n  /** Update an existing tool progress event */\n  updateProgress: (\n    toolCallId: string,\n    updates: Partial<\n      Omit<StoredProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n    >,\n  ) => void;\n  /** Clear all progress */\n  clearProgress: () => void;\n  /** Clear completed progress older than X ms */\n  clearCompletedOlderThan: (ms: number) => void;\n}\n\n/**\n * Tool progress provider props\n */\nexport interface ToolProgressProviderProps {\n  children: ReactNode;\n  /** Auto-clear completed progress after X ms (default: 3000) */\n  autoClearCompleteMs?: number;\n  /** Maximum number of progress events to keep (default: 50) */\n  maxEvents?: number;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst ToolProgressContext = createContext<ToolProgressContextValue | null>(\n  null,\n);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider - Now uses Zustand for state\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * ToolProgressProvider - Global provider for tool execution progress\n *\n * Wrap your app with this provider to enable automatic tool progress tracking.\n * The progress state is managed centrally via Zustand and can be consumed anywhere.\n */\nexport function ToolProgressProvider({\n  children,\n  autoClearCompleteMs = 3000,\n  maxEvents: _maxEvents = 50,\n}: ToolProgressProviderProps) {\n  // Bridge to Zustand store\n  const progressEvents = useStore((s) => s.progressEvents);\n  const addProgressEvent = useStore((s) => s.addProgressEvent);\n  const updateProgressEvent = useStore((s) => s.updateProgressEvent);\n  const clearProgressEvents = useStore((s) => s.clearProgressEvents);\n  const clearCompletedProgressOlderThan = useStore(\n    (s) => s.clearCompletedProgressOlderThan,\n  );\n  const getActiveProgress = useStore((s) => s.getActiveProgress);\n  const isToolRunning = useStore((s) => s.isToolRunning);\n\n  // Add a new progress event (wrapper for Zustand)\n  const addProgress = useCallback(\n    (event: Omit<StoredProgressEvent, \"timestamp\" | \"type\">) => {\n      addProgressEvent({\n        toolCallId: event.toolCallId,\n        toolName: event.toolName,\n        status: event.status,\n        message: event.message,\n        data: event.data,\n        progress: event.progress,\n      });\n    },\n    [addProgressEvent],\n  );\n\n  // Update an existing progress event (wrapper for Zustand)\n  const updateProgress = useCallback(\n    (\n      toolCallId: string,\n      updates: Partial<\n        Omit<StoredProgressEvent, \"toolCallId\" | \"timestamp\" | \"type\">\n      >,\n    ) => {\n      updateProgressEvent(toolCallId, updates);\n    },\n    [updateProgressEvent],\n  );\n\n  // Clear all progress (wrapper for Zustand)\n  const clearProgress = useCallback(() => {\n    clearProgressEvents();\n  }, [clearProgressEvents]);\n\n  // Clear completed progress older than X ms (wrapper for Zustand)\n  const clearCompletedOlderThan = useCallback(\n    (ms: number) => {\n      clearCompletedProgressOlderThan(ms);\n    },\n    [clearCompletedProgressOlderThan],\n  );\n\n  // Auto-clear completed progress\n  useEffect(() => {\n    if (autoClearCompleteMs <= 0) return;\n\n    const interval = setInterval(() => {\n      clearCompletedOlderThan(autoClearCompleteMs);\n    }, 1000);\n\n    return () => clearInterval(interval);\n  }, [autoClearCompleteMs, clearCompletedOlderThan]);\n\n  // Computed values from Zustand\n  const activeProgress = getActiveProgress();\n  const toolRunning = isToolRunning();\n\n  const value = useMemo<ToolProgressContextValue>(\n    () => ({\n      activeProgress,\n      allProgress: progressEvents,\n      isToolRunning: toolRunning,\n      addProgress,\n      updateProgress,\n      clearProgress,\n      clearCompletedOlderThan,\n    }),\n    [\n      activeProgress,\n      progressEvents,\n      toolRunning,\n      addProgress,\n      updateProgress,\n      clearProgress,\n      clearCompletedOlderThan,\n    ],\n  );\n\n  return (\n    <ToolProgressContext.Provider value={value}>\n      {children}\n    </ToolProgressContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * useToolProgress - Access the tool progress context\n *\n * @throws Error if used outside of ToolProgressProvider\n */\nexport function useToolProgress(): ToolProgressContextValue {\n  const context = useContext(ToolProgressContext);\n  if (!context) {\n    throw new Error(\n      \"useToolProgress must be used within a ToolProgressProvider\",\n    );\n  }\n  return context;\n}\n\n/**\n * useToolProgressOptional - Access the tool progress context (optional)\n *\n * Returns null if used outside of ToolProgressProvider (doesn't throw)\n */\nexport function useToolProgressOptional(): ToolProgressContextValue | null {\n  return useContext(ToolProgressContext);\n}\n\n/**\n * useIsToolRunning - Check if any tool is currently running\n */\nexport function useIsToolRunning(): boolean {\n  // Select progressEvents directly and compute in selector for stability\n  return useStore((s) =>\n    s.progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    ),\n  );\n}\n\n/**\n * useActiveToolProgress - Get only active (running) tool progress\n */\nexport function useActiveToolProgress(): StoredProgressEvent[] {\n  // Use useShallow to prevent infinite loop - getActiveProgress returns new array each time\n  return useStore(\n    useShallow((s) =>\n      s.progressEvents.filter(\n        (e) => e.status === \"starting\" || e.status === \"progress\",\n      ),\n    ),\n  );\n}\n","/**\n * Unified Progress Context - Combines plan execution with tool progress\n *\n * Provides a single \"generating\" state that integrates:\n * - Plan steps (multi-agent orchestration)\n * - Tool progress (individual tool execution)\n *\n * This replaces separate usePlanState and useToolProgress with unified tracking.\n */\n\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useMemo,\n  useCallback,\n  type ReactNode,\n} from \"react\";\nimport { useStore } from \"../store\";\nimport { useShallow } from \"zustand/react/shallow\";\nimport type { PlanStep, PlanSubtask } from \"../store/slices/plan-execution\";\nimport type { StoredProgressEvent } from \"../store/slices/tool-progress\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type UnifiedProgressItemType = \"plan-step\" | \"plan-subtask\" | \"tool\";\nexport type UnifiedProgressStatus =\n  | \"pending\"\n  | \"running\"\n  | \"complete\"\n  | \"error\";\n\nexport interface UnifiedProgressItem {\n  id: string;\n  type: UnifiedProgressItemType;\n  label: string;\n  message?: string;\n  status: UnifiedProgressStatus;\n  progress?: number; // 0-100\n  startTime?: number;\n  endTime?: number;\n  parentId?: string; // For subtasks\n  children?: UnifiedProgressItem[]; // For plan steps with subtasks\n}\n\nexport interface UnifiedProgressState {\n  /** Whether any generation is in progress */\n  isGenerating: boolean;\n  /** Current goal/description of what's being generated */\n  goal: string | null;\n  /** All progress items (plan steps + tools) */\n  items: UnifiedProgressItem[];\n  /** Currently active items */\n  activeItems: UnifiedProgressItem[];\n  /** Overall progress percentage */\n  overallProgress: number;\n  /** Time elapsed since generation started (ms) */\n  elapsedTime: number | null;\n}\n\nexport interface UnifiedProgressContextValue extends UnifiedProgressState {\n  /** Get item by ID */\n  getItem: (id: string) => UnifiedProgressItem | undefined;\n  /** Check if a specific item is running */\n  isItemRunning: (id: string) => boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst UnifiedProgressContext =\n  createContext<UnifiedProgressContextValue | null>(null);\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Provider\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface UnifiedProgressProviderProps {\n  children: ReactNode;\n}\n\nfunction mapPlanStepStatus(status: string): UnifiedProgressStatus {\n  switch (status) {\n    case \"running\":\n      return \"running\";\n    case \"complete\":\n      return \"complete\";\n    case \"error\":\n      return \"error\";\n    default:\n      return \"pending\";\n  }\n}\n\nfunction mapToolStatus(status: string): UnifiedProgressStatus {\n  switch (status) {\n    case \"starting\":\n    case \"progress\":\n      return \"running\";\n    case \"complete\":\n      return \"complete\";\n    case \"error\":\n      return \"error\";\n    default:\n      return \"pending\";\n  }\n}\n\nfunction subtaskToUnified(\n  subtask: PlanSubtask,\n  parentId: string,\n): UnifiedProgressItem {\n  return {\n    id: `subtask-${subtask.id}`,\n    type: \"plan-subtask\",\n    label: subtask.task,\n    status: mapPlanStepStatus(subtask.status),\n    startTime: subtask.startTime,\n    endTime: subtask.endTime,\n    parentId,\n  };\n}\n\nfunction stepToUnified(step: PlanStep): UnifiedProgressItem {\n  const id = `step-${step.id}`;\n  return {\n    id,\n    type: \"plan-step\",\n    label: step.task,\n    status: mapPlanStepStatus(step.status),\n    startTime: step.startTime,\n    endTime: step.endTime,\n    children: step.subtasks?.map((st) => subtaskToUnified(st, id)),\n  };\n}\n\nfunction toolToUnified(tool: StoredProgressEvent): UnifiedProgressItem {\n  return {\n    id: `tool-${tool.toolCallId}`,\n    type: \"tool\",\n    label: tool.toolName,\n    message: tool.message,\n    status: mapToolStatus(tool.status),\n    progress: tool.progress,\n    startTime: tool.timestamp,\n  };\n}\n\nexport function UnifiedProgressProvider({\n  children,\n}: UnifiedProgressProviderProps) {\n  // Get plan execution state\n  const planExecution = useStore((s) => s.planExecution);\n\n  // Get tool progress - use useShallow to prevent infinite loops\n  const progressEvents = useStore(useShallow((s) => s.progressEvents));\n\n  // Build unified items\n  const items = useMemo(() => {\n    const result: UnifiedProgressItem[] = [];\n\n    // Add plan steps\n    if (planExecution.plan) {\n      for (const step of planExecution.plan.steps) {\n        result.push(stepToUnified(step));\n      }\n    }\n\n    // Add tool progress (only if not in plan-based orchestration)\n    // During orchestration, tools are tracked via plan steps\n    if (!planExecution.isOrchestrating) {\n      for (const tool of progressEvents) {\n        result.push(toolToUnified(tool));\n      }\n    }\n\n    return result;\n  }, [planExecution.plan, planExecution.isOrchestrating, progressEvents]);\n\n  // Active items\n  const activeItems = useMemo(\n    () => items.filter((item) => item.status === \"running\"),\n    [items],\n  );\n\n  // Is generating\n  const isGenerating = useMemo(() => {\n    if (planExecution.isOrchestrating) return true;\n    return progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    );\n  }, [planExecution.isOrchestrating, progressEvents]);\n\n  // Goal\n  const goal = planExecution.plan?.goal ?? null;\n\n  // Overall progress\n  const overallProgress = useMemo(() => {\n    if (!planExecution.plan) {\n      // No plan - use tool progress\n      const activeTools = progressEvents.filter(\n        (p) => p.status === \"starting\" || p.status === \"progress\",\n      );\n      if (activeTools.length === 0) return 0;\n      const sum = activeTools.reduce((acc, t) => acc + (t.progress ?? 0), 0);\n      return Math.round(sum / activeTools.length);\n    }\n\n    // Plan-based progress\n    const steps = planExecution.plan.steps;\n    const completed = steps.filter((s) => s.status === \"complete\").length;\n    return steps.length > 0 ? Math.round((completed / steps.length) * 100) : 0;\n  }, [planExecution.plan, progressEvents]);\n\n  // Elapsed time\n  const elapsedTime = useMemo(() => {\n    if (!planExecution.orchestrationStartTime) return null;\n    if (!planExecution.isOrchestrating) return null;\n    return Date.now() - planExecution.orchestrationStartTime;\n  }, [planExecution.orchestrationStartTime, planExecution.isOrchestrating]);\n\n  // Getters\n  const getItem = useCallback(\n    (id: string) => items.find((item) => item.id === id),\n    [items],\n  );\n\n  const isItemRunning = useCallback(\n    (id: string) => {\n      const item = items.find((i) => i.id === id);\n      return item?.status === \"running\";\n    },\n    [items],\n  );\n\n  const value = useMemo<UnifiedProgressContextValue>(\n    () => ({\n      isGenerating,\n      goal,\n      items,\n      activeItems,\n      overallProgress,\n      elapsedTime,\n      getItem,\n      isItemRunning,\n    }),\n    [\n      isGenerating,\n      goal,\n      items,\n      activeItems,\n      overallProgress,\n      elapsedTime,\n      getItem,\n      isItemRunning,\n    ],\n  );\n\n  return (\n    <UnifiedProgressContext.Provider value={value}>\n      {children}\n    </UnifiedProgressContext.Provider>\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hooks\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * useUnifiedProgress - Access the unified progress context\n */\nexport function useUnifiedProgress(): UnifiedProgressContextValue {\n  const context = useContext(UnifiedProgressContext);\n  if (!context) {\n    throw new Error(\n      \"useUnifiedProgress must be used within a UnifiedProgressProvider\",\n    );\n  }\n  return context;\n}\n\n/**\n * useUnifiedProgressOptional - Access unified progress (optional)\n */\nexport function useUnifiedProgressOptional(): UnifiedProgressContextValue | null {\n  return useContext(UnifiedProgressContext);\n}\n\n/**\n * useIsGenerating - Check if any generation is in progress\n */\nexport function useIsGenerating(): boolean {\n  return useStore((s) => {\n    if (s.planExecution.isOrchestrating) return true;\n    return s.progressEvents.some(\n      (p) => p.status === \"starting\" || p.status === \"progress\",\n    );\n  });\n}\n\n/**\n * useGeneratingGoal - Get the current generation goal\n */\nexport function useGeneratingGoal(): string | null {\n  return useStore((s) => s.planExecution.plan?.goal ?? null);\n}\n","\"use client\";\n\nimport {\n  type ReactNode,\n  useEffect,\n  useRef,\n  createContext,\n  useContext,\n} from \"react\";\nimport type { UITree } from \"@onegenui/core\";\nimport type { TrackedAction } from \"../hooks/types\";\nimport { isSelectionInteraction } from \"../utils/dom\";\nimport {\n  getActionTypeFromEvent,\n  extractInteractionContext,\n  findClosestElementKey,\n} from \"../utils/selection\";\nimport { useSelection } from \"../contexts/selection\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Context\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type InteractionTrackingCallback = (\n  action: Omit<TrackedAction, \"id\" | \"timestamp\">,\n) => void;\n\nexport const InteractionTrackingContext =\n  createContext<InteractionTrackingCallback | null>(null);\n\nexport function useInteractionTracking(): InteractionTrackingCallback | null {\n  return useContext(InteractionTrackingContext);\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Non-proactive element detection (DRY - single place for this logic)\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Elements that should NOT trigger proactive AI\n * (navigation, media consumption - passive interactions)\n */\nfunction isNonProactiveElement(target: HTMLElement): boolean {\n  const tagName = target.tagName.toLowerCase();\n\n  // Links - navigation\n  if (tagName === \"a\" || target.closest(\"a[href]\")) return true;\n\n  // Media elements\n  if (\n    tagName === \"video\" ||\n    tagName === \"audio\" ||\n    tagName === \"img\" ||\n    target.closest(\"video, audio, img\")\n  ) {\n    return true;\n  }\n\n  // Media controls\n  if (\n    target.closest(\n      '[class*=\"video\"], [class*=\"audio\"], [class*=\"player\"], [class*=\"media\"]',\n    )\n  ) {\n    return true;\n  }\n\n  // Navigation-related\n  if (\n    target.getAttribute(\"role\") === \"link\" ||\n    target.closest('[role=\"link\"]') ||\n    target.hasAttribute(\"data-href\") ||\n    target.hasAttribute(\"data-navigate\")\n  ) {\n    return true;\n  }\n\n  return false;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Wrapper Component (Single Responsibility - only tracks interactions)\n//\n// Focus tracking is now handled globally by ActionProvider\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface InteractionTrackingWrapperProps {\n  children: ReactNode;\n  tree: UITree;\n  onInteraction: InteractionTrackingCallback;\n}\n\nexport function InteractionTrackingWrapper({\n  children,\n  tree,\n  onInteraction,\n}: InteractionTrackingWrapperProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Try to use selection context if available\n  let isDeepSelectionActive: (() => boolean) | undefined;\n  try {\n    const selectionContext = useSelection();\n    isDeepSelectionActive = selectionContext.isDeepSelectionActive;\n  } catch {\n    // Not in a SelectionProvider - isDeepSelectionActive remains undefined\n  }\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    const handleInteraction = (event: Event) => {\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) return;\n\n      // Skip selection interactions\n      if (isSelectionInteraction(target, isDeepSelectionActive)) return;\n\n      // Skip non-proactive elements\n      if (isNonProactiveElement(target)) return;\n\n      const elementKey = findClosestElementKey(target);\n      if (!elementKey) return;\n\n      const element = tree.elements[elementKey];\n      if (!element) return;\n\n      const actionType = getActionTypeFromEvent(target, event.type);\n      if (!actionType) return;\n\n      const context = extractInteractionContext(target, elementKey);\n\n      onInteraction({\n        type: actionType,\n        elementKey,\n        elementType: element.type,\n        context,\n      });\n    };\n\n    container.addEventListener(\"click\", handleInteraction, true);\n    container.addEventListener(\"change\", handleInteraction, true);\n\n    return () => {\n      container.removeEventListener(\"click\", handleInteraction, true);\n      container.removeEventListener(\"change\", handleInteraction, true);\n    };\n  }, [tree, onInteraction]);\n\n  return (\n    <InteractionTrackingContext.Provider value={onInteraction}>\n      <div ref={containerRef} style={{ display: \"contents\" }}>\n        {children}\n      </div>\n    </InteractionTrackingContext.Provider>\n  );\n}\n","import type { ActionType, TrackedAction } from \"../hooks/types\";\nimport { isInteractiveElement } from \"./dom\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Constants\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const DEFAULT_SELECTION_DELAY = 350;\nexport const MOVE_TOLERANCE_PX = 10;\nexport const EDGE_ZONE_SIZE = 16;\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Haptic Feedback\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function triggerHaptic(pattern: number | number[] = 50): void {\n  if (typeof navigator !== \"undefined\" && \"vibrate\" in navigator) {\n    try {\n      navigator.vibrate(pattern);\n    } catch {\n      // Ignore errors on unsupported devices\n    }\n  }\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Interactive Target Detection\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function isIgnoredTarget(target: EventTarget | null): boolean {\n  if (!(target instanceof HTMLElement)) return false;\n\n  if (target.closest(\"[data-jsonui-ignore-select]\")) return true;\n\n  const tagName = target.tagName.toLowerCase();\n  if (\n    tagName === \"input\" ||\n    tagName === \"textarea\" ||\n    tagName === \"select\" ||\n    tagName === \"button\" ||\n    target.closest(\"button\") ||\n    target.isContentEditable ||\n    target.getAttribute(\"role\") === \"button\" ||\n    target.getAttribute(\"role\") === \"slider\" ||\n    target.getAttribute(\"role\") === \"tab\" ||\n    target.getAttribute(\"role\") === \"checkbox\" ||\n    target.getAttribute(\"role\") === \"switch\" ||\n    target.getAttribute(\"role\") === \"menuitem\"\n  ) {\n    return true;\n  }\n\n  if (\n    target.hasAttribute(\"draggable\") ||\n    target.closest(\"[draggable]\") ||\n    target.closest(\".react-draggable\") ||\n    target.closest(\"[data-drag-handle]\") ||\n    target.closest(\"[data-interactive]\")\n  ) {\n    return true;\n  }\n\n  if (tagName === \"a\" || target.closest(\"a\")) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function isInEdgeZone(\n  clientX: number,\n  clientY: number,\n  rect: DOMRect,\n  edgeSize: number = EDGE_ZONE_SIZE,\n): boolean {\n  const inLeftEdge = clientX < rect.left + edgeSize;\n  const inRightEdge = clientX > rect.right - edgeSize;\n  const inTopEdge = clientY < rect.top + edgeSize;\n  const inBottomEdge = clientY > rect.bottom - edgeSize;\n\n  return inLeftEdge || inRightEdge || inTopEdge || inBottomEdge;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Interaction Tracking Utilities\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport function getActionTypeFromEvent(\n  target: HTMLElement,\n  eventType: string,\n): ActionType | null {\n  const tagName = target.tagName.toLowerCase();\n  const inputType = target.getAttribute(\"type\")?.toLowerCase();\n  const role = target.getAttribute(\"role\")?.toLowerCase();\n\n  if (\n    (tagName === \"input\" && inputType === \"checkbox\") ||\n    role === \"checkbox\" ||\n    target.hasAttribute(\"data-checkbox\")\n  ) {\n    return \"toggle\";\n  }\n\n  if (\n    tagName === \"select\" ||\n    (tagName === \"input\" && inputType === \"radio\") ||\n    role === \"listbox\" ||\n    role === \"option\"\n  ) {\n    return \"select\";\n  }\n\n  if (\n    tagName === \"input\" ||\n    tagName === \"textarea\" ||\n    role === \"textbox\" ||\n    target.isContentEditable\n  ) {\n    return eventType === \"change\" ? \"input\" : null;\n  }\n\n  if (\n    tagName === \"button\" ||\n    role === \"button\" ||\n    target.hasAttribute(\"data-interactive\")\n  ) {\n    return \"click\";\n  }\n\n  if (eventType === \"click\") {\n    if (isInteractiveElement(target)) {\n      return \"click\";\n    }\n  }\n\n  return null;\n}\n\nexport function extractInteractionContext(\n  target: HTMLElement,\n  _elementKey: string,\n): TrackedAction[\"context\"] {\n  const context: TrackedAction[\"context\"] = {};\n\n  const selectableItem = target.closest(\"[data-selectable-item]\");\n  if (selectableItem instanceof HTMLElement) {\n    const itemId = selectableItem.getAttribute(\"data-item-id\");\n    if (itemId) {\n      context.itemId = itemId;\n    }\n  }\n\n  const textContent =\n    target.textContent?.trim().substring(0, 100) ||\n    target.getAttribute(\"aria-label\") ||\n    target.getAttribute(\"title\");\n\n  if (textContent) {\n    context.itemLabel = textContent;\n  }\n\n  if (target instanceof HTMLInputElement) {\n    if (target.type === \"checkbox\") {\n      context.newValue = target.checked;\n      context.previousValue = !target.checked;\n    } else {\n      context.newValue = target.value;\n    }\n  } else if (target instanceof HTMLSelectElement) {\n    context.newValue = target.value;\n    const selectedOption = target.options[target.selectedIndex];\n    if (selectedOption) {\n      context.itemLabel = selectedOption.text;\n    }\n  } else if (target instanceof HTMLTextAreaElement) {\n    context.newValue = target.value;\n  }\n\n  return context;\n}\n\nexport function findClosestElementKey(target: HTMLElement): string | null {\n  const elementWrapper = target.closest(\"[data-jsonui-element-key]\");\n  if (elementWrapper instanceof HTMLElement) {\n    return elementWrapper.getAttribute(\"data-jsonui-element-key\");\n  }\n  return null;\n}\n","\"use client\";\n\nimport React, { type ReactNode } from \"react\";\nimport type { UIElement, UITree } from \"@onegenui/core\";\nimport { useIsVisible } from \"../contexts/visibility\";\nimport { useActions } from \"../contexts/actions\";\nimport { useMarkdown } from \"../contexts/markdown\";\nimport { ResizableWrapper } from \"../components/ResizableWrapper\";\nimport { SelectionWrapper } from \"../components/SelectionWrapper\";\nimport type { ComponentRegistry, ComponentRenderer } from \"./types\";\n\ninterface ElementRendererProps {\n  element: UIElement;\n  tree: UITree;\n  registry: ComponentRegistry;\n  loading?: boolean;\n  fallback?: ComponentRenderer;\n  selectable?: boolean;\n  onElementSelect?: (element: UIElement) => void;\n  selectionDelayMs: number;\n  selectedKey?: string | null;\n  onResize?: (\n    elementKey: string,\n    size: { width: number; height: number },\n  ) => void;\n}\n\n/**\n * Memoization comparator: structural sharing in patch-utils.ts means only\n * modified elements get new references. This enables O(1) equality checks.\n */\nfunction elementRendererPropsAreEqual(\n  prevProps: ElementRendererProps,\n  nextProps: ElementRendererProps,\n): boolean {\n  if (prevProps.element !== nextProps.element) {\n    return false;\n  }\n\n  const wasSelected = prevProps.selectedKey === prevProps.element.key;\n  const isSelected = nextProps.selectedKey === nextProps.element.key;\n  if (wasSelected !== isSelected) {\n    return false;\n  }\n\n  if (prevProps.loading !== nextProps.loading) {\n    return false;\n  }\n\n  if (prevProps.tree !== nextProps.tree) {\n    const children = prevProps.element.children;\n    if (children) {\n      for (const childKey of children) {\n        if (\n          prevProps.tree.elements[childKey] !==\n          nextProps.tree.elements[childKey]\n        ) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n\nexport const ElementRenderer = React.memo(function ElementRenderer({\n  element,\n  tree,\n  registry,\n  loading,\n  fallback,\n  selectable,\n  onElementSelect,\n  selectionDelayMs,\n  selectedKey,\n  onResize,\n}: ElementRendererProps) {\n  const isVisible = useIsVisible(element.visible);\n  const { execute } = useActions();\n\n  if (!isVisible) {\n    return null;\n  }\n\n  if (\n    element.type === \"__placeholder__\" ||\n    (element._meta as any)?.isPlaceholder\n  ) {\n    return (\n      <div\n        key={element.key}\n        className=\"w-full h-16 bg-muted/10 animate-pulse rounded-lg my-2 border border-border/20\"\n        data-placeholder-for={element.key}\n      />\n    );\n  }\n\n  const { renderText } = useMarkdown();\n\n  const Component = registry[element.type] ?? fallback;\n\n  if (!Component) {\n    console.warn(`No renderer for component type: ${element.type}`);\n    return null;\n  }\n\n  const children = element.children?.map((childKey, index) => {\n    const childElement = tree.elements[childKey];\n    if (!childElement) {\n      if (loading) {\n        return (\n          <div\n            key={`${childKey}-skeleton`}\n            className=\"w-full h-12 bg-muted/10 animate-pulse rounded-md my-1\"\n          />\n        );\n      }\n      return null;\n    }\n    return (\n      <ElementRenderer\n        key={`${childKey}-${index}`}\n        element={childElement}\n        tree={tree}\n        registry={registry}\n        loading={loading}\n        fallback={fallback}\n        selectable={selectable}\n        onElementSelect={onElementSelect}\n        selectionDelayMs={selectionDelayMs}\n        selectedKey={selectedKey}\n        onResize={onResize}\n      />\n    );\n  });\n\n  const isResizable = element.layout?.resizable !== false;\n\n  const content = (\n    <Component\n      element={element}\n      onAction={execute}\n      loading={loading}\n      renderText={renderText}\n    >\n      {children}\n    </Component>\n  );\n\n  if (selectable && onElementSelect) {\n    const selectionContent = (\n      <SelectionWrapper\n        element={element}\n        enabled={selectable}\n        onSelect={onElementSelect}\n        delayMs={selectionDelayMs}\n        isSelected={selectedKey === element.key}\n      >\n        {content}\n      </SelectionWrapper>\n    );\n\n    if (isResizable) {\n      return (\n        <ResizableWrapper\n          element={element}\n          onResize={onResize}\n          showHandles={selectedKey === element.key}\n        >\n          {selectionContent}\n        </ResizableWrapper>\n      );\n    }\n\n    return selectionContent;\n  }\n\n  if (isResizable) {\n    return (\n      <ResizableWrapper element={element} onResize={onResize}>\n        {content}\n      </ResizableWrapper>\n    );\n  }\n\n  return content;\n}, elementRendererPropsAreEqual);\n","\"use client\";\n\nimport React, { useRef, useCallback, useMemo } from \"react\";\nimport type { UIElement, ElementLayout } from \"@onegenui/core\";\nimport {\n  useResizable,\n  type ResizeHandle,\n  type ResizeState,\n  getResizeCursor,\n} from \"../hooks/useResizable\";\nimport { cn } from \"../utils\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ResizableWrapperProps {\n  /** The UI element being rendered */\n  element: UIElement;\n  /** Child content to render */\n  children: React.ReactNode;\n  /** Override layout config */\n  layout?: ElementLayout;\n  /** Callback when element is resized */\n  onResize?: (\n    elementKey: string,\n    size: { width: number; height: number },\n  ) => void;\n  /** Custom className */\n  className?: string;\n  /** Whether resize is enabled (overrides element.layout.resizable) */\n  enabled?: boolean;\n  /** Force handles visible (e.g., when element is selected) */\n  showHandles?: boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Handle Component\n// ─────────────────────────────────────────────────────────────────────────────\n\ninterface ResizeHandleComponentProps {\n  position: ResizeHandle;\n  onMouseDown: (e: React.MouseEvent) => void;\n  onTouchStart: (e: React.TouchEvent) => void;\n  isResizing: boolean;\n  visible: boolean;\n}\n\nfunction ResizeHandleComponent({\n  position,\n  onMouseDown,\n  onTouchStart,\n  isResizing,\n  visible,\n}: ResizeHandleComponentProps) {\n  const [isHovered, setIsHovered] = React.useState(false);\n  const [isTouching, setIsTouching] = React.useState(false);\n\n  // Position classes map\n  const positionClasses: Record<ResizeHandle, string> = {\n    e: \"right-[-4px] top-0 bottom-0 w-2 cursor-ew-resize\",\n    w: \"left-[-4px] top-0 bottom-0 w-2 cursor-ew-resize\",\n    s: \"bottom-[-4px] left-0 right-0 h-2 cursor-ns-resize\",\n    n: \"top-[-4px] left-0 right-0 h-2 cursor-ns-resize\",\n    se: \"right-[-6px] bottom-[-6px] w-3 h-3 cursor-nwse-resize rounded-full\",\n    sw: \"left-[-6px] bottom-[-6px] w-3 h-3 cursor-nesw-resize rounded-full\",\n    ne: \"right-[-6px] top-[-6px] w-3 h-3 cursor-nesw-resize rounded-full\",\n    nw: \"left-[-6px] top-[-6px] w-3 h-3 cursor-nwse-resize rounded-full\",\n  };\n\n  return (\n    <div\n      className={cn(\n        \"absolute z-10 opacity-0 transition-opacity duration-150 bg-transparent\",\n        positionClasses[position],\n        (visible || isResizing || isTouching) && \"opacity-100\",\n        (isHovered || isResizing) && \"bg-primary\",\n      )}\n      onMouseDown={onMouseDown}\n      onTouchStart={(e) => {\n        setIsTouching(true);\n        onTouchStart(e);\n      }}\n      onTouchEnd={() => setIsTouching(false)}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      role=\"separator\"\n      aria-orientation={\n        position === \"e\" || position === \"w\" ? \"vertical\" : \"horizontal\"\n      }\n      aria-label={`Resize ${position}`}\n      data-resize-handle={position}\n    />\n  );\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Main Component\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Wrapper component that adds resize handles to its children.\n *\n * Reads configuration from `element.layout.resizable` or accepts overrides via props.\n * Handles are only shown when the wrapper is hovered.\n *\n * @example\n * ```tsx\n * <ResizableWrapper\n *   element={element}\n *   onResize={(key, size) => console.log(`${key} resized to ${size.width}x${size.height}`)}\n * >\n *   <Card {...cardProps} />\n * </ResizableWrapper>\n * ```\n */\nexport function ResizableWrapper({\n  element,\n  children,\n  layout: overrideLayout,\n  onResize,\n  className,\n  enabled: overrideEnabled,\n  showHandles = false,\n}: ResizableWrapperProps) {\n  const wrapperRef = useRef<HTMLDivElement>(null);\n  const [isHovered, setIsHovered] = React.useState(false);\n\n  // Merge layout from element and overrides\n  const layout = overrideLayout ?? element.layout;\n  const resizableConfig = layout?.resizable;\n\n  // Determine if resizing is enabled (default true unless explicitly false)\n  const isEnabled =\n    overrideEnabled !== undefined ? overrideEnabled : resizableConfig !== false;\n\n  // Normalize config to default enabled behavior\n  const normalizedConfig =\n    resizableConfig === undefined ? true : resizableConfig;\n\n  // Callback when resize ends\n  const handleResizeEnd = useCallback(\n    (state: ResizeState) => {\n      if (!onResize) return;\n      onResize(element.key, { width: state.width, height: state.height });\n    },\n    [element.key, onResize],\n  );\n\n  const {\n    state,\n    startResize,\n    resizeConfig,\n    style: resizeStyle,\n  } = useResizable({\n    initialSize: layout?.size,\n    config: normalizedConfig,\n    onResizeEnd: handleResizeEnd,\n    elementRef: wrapperRef,\n  });\n\n  // If not resizable, just render children directly\n  if (!isEnabled) {\n    return <>{children}</>;\n  }\n\n  // Determine which handles to show (memoized for performance)\n  const handles = useMemo((): ResizeHandle[] => {\n    const result: ResizeHandle[] = [];\n    if (resizeConfig.horizontal) {\n      result.push(\"e\", \"w\");\n    }\n    if (resizeConfig.vertical) {\n      result.push(\"s\", \"n\");\n    }\n    if (resizeConfig.horizontal && resizeConfig.vertical) {\n      result.push(\"se\", \"sw\", \"ne\", \"nw\");\n    }\n    return result;\n  }, [resizeConfig.horizontal, resizeConfig.vertical]);\n\n  // Build grid column/row styles properly (avoid conflicts)\n  const gridColumnStyle = (() => {\n    const col = layout?.grid?.column;\n    const span = layout?.grid?.columnSpan;\n    if (col && span && span > 1) {\n      return `${col} / span ${span}`;\n    }\n    if (span && span > 1) {\n      return `span ${span}`;\n    }\n    if (col) {\n      return col;\n    }\n    return undefined;\n  })();\n\n  const gridRowStyle = (() => {\n    const row = layout?.grid?.row;\n    const span = layout?.grid?.rowSpan;\n    if (row && span && span > 1) {\n      return `${row} / span ${span}`;\n    }\n    if (span && span > 1) {\n      return `span ${span}`;\n    }\n    if (row) {\n      return row;\n    }\n    return undefined;\n  })();\n\n  // Combine styles\n  const combinedStyle: React.CSSProperties = {\n    ...resizeStyle,\n    // Apply grid layout if configured (properly merged)\n    ...(gridColumnStyle && { gridColumn: gridColumnStyle }),\n    ...(gridRowStyle && { gridRow: gridRowStyle }),\n  };\n\n  const shouldShowHandles = showHandles || isHovered || state.isResizing;\n\n  return (\n    <div\n      ref={wrapperRef}\n      style={combinedStyle}\n      className={cn(\n        \"relative box-border\",\n        state.isResizing && \"outline-[2px] outline-primary outline-offset-2\",\n        className,\n      )}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      data-resizable=\"true\"\n      data-element-key={element.key}\n    >\n      {children}\n\n      {/* Render resize handles */}\n      {handles.map((handle) => (\n        <ResizeHandleComponent\n          key={handle}\n          position={handle}\n          onMouseDown={(e) => startResize(handle, e)}\n          onTouchStart={(e) => startResize(handle, e)}\n          isResizing={state.isResizing && state.activeHandle === handle}\n          visible={shouldShowHandles}\n        />\n      ))}\n\n      {/* Size indicator during resize */}\n      {state.isResizing && (\n        <div className=\"absolute bottom-2 right-2 px-2 py-1 bg-primary text-white text-[11px] font-medium rounded pointer-events-none z-11\">\n          {Math.round(state.width)} x {Math.round(state.height)}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Re-export types for convenience\nexport type { ResizeHandle, ResizeState };\nexport { getResizeCursor };\n","import type { ElementSize, ElementResizeConfig } from \"@onegenui/core\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport type ResizeHandle = \"e\" | \"s\" | \"se\" | \"sw\" | \"n\" | \"w\" | \"ne\" | \"nw\";\n\nexport interface ResizeState {\n  /** Current width in pixels */\n  width: number;\n  /** Current height in pixels */\n  height: number;\n  /** Whether the element is currently being resized */\n  isResizing: boolean;\n  /** The active resize handle */\n  activeHandle: ResizeHandle | null;\n}\n\nexport interface UseResizableOptions {\n  /** Initial size configuration */\n  initialSize?: ElementSize;\n  /** Resize behavior configuration */\n  config?: ElementResizeConfig | boolean;\n  /** Callback when resize starts */\n  onResizeStart?: (state: ResizeState) => void;\n  /** Callback during resize */\n  onResize?: (state: ResizeState) => void;\n  /** Callback when resize ends */\n  onResizeEnd?: (state: ResizeState) => void;\n  /** Element ref to measure initial size */\n  elementRef?: React.RefObject<HTMLElement | null>;\n  /** Constrain resize to container boundaries (default: true) */\n  constrainToContainer?: boolean;\n}\n\nexport interface UseResizableReturn {\n  /** Current resize state */\n  state: ResizeState;\n  /** Start resizing from a handle */\n  startResize: (\n    handle: ResizeHandle,\n    e: React.MouseEvent | React.TouchEvent,\n  ) => void;\n  /** Stop resizing */\n  stopResize: () => void;\n  /** Reset to initial size */\n  reset: () => void;\n  /** Get resize config (normalized from boolean) */\n  resizeConfig: ElementResizeConfig;\n  /** Style object to apply to the element */\n  style: React.CSSProperties;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Constants\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const MOBILE_BREAKPOINT = 768;\n","import type { ElementResizeConfig } from \"@onegenui/core\";\nimport type { ResizeHandle } from \"./types\";\n\n/**\n * Parse size value (number or CSS string) to number\n */\nexport function parseSize(\n  value: number | string | undefined,\n  fallback: number,\n): number {\n  if (value === undefined) return fallback;\n  if (typeof value === \"number\") return value;\n  const parsed = parseFloat(value);\n  return isNaN(parsed) ? fallback : parsed;\n}\n\n/**\n * Normalize config (boolean or object) to object\n */\nexport function normalizeConfig(\n  config: ElementResizeConfig | boolean | undefined,\n): ElementResizeConfig {\n  if (config === undefined || config === false) {\n    return { horizontal: false, vertical: false };\n  }\n  if (config === true) {\n    return { horizontal: true, vertical: true };\n  }\n  return config;\n}\n\n/**\n * Snap value to grid\n */\nexport function snapToGrid(\n  value: number,\n  gridSize: number | undefined,\n): number {\n  if (!gridSize || gridSize <= 0) return value;\n  return Math.round(value / gridSize) * gridSize;\n}\n\n/**\n * Find the closest scrollable container to constrain resize bounds\n */\nexport function findScrollableContainer(\n  element: HTMLElement | null,\n): HTMLElement | null {\n  if (!element) return null;\n\n  let parent = element.parentElement;\n  while (parent) {\n    const style = window.getComputedStyle(parent);\n    const overflowY = style.overflowY;\n    const overflowX = style.overflowX;\n\n    if (\n      overflowY === \"auto\" ||\n      overflowY === \"scroll\" ||\n      overflowX === \"auto\" ||\n      overflowX === \"scroll\" ||\n      parent.hasAttribute(\"data-render-container\")\n    ) {\n      return parent;\n    }\n\n    parent = parent.parentElement;\n  }\n\n  return document.body;\n}\n\n/**\n * Calculate max dimensions based on container bounds and element position\n */\nexport function getContainerConstraints(\n  element: HTMLElement,\n  container: HTMLElement,\n  handle: ResizeHandle,\n): { maxWidth: number; maxHeight: number } {\n  const elementRect = element.getBoundingClientRect();\n  const containerRect = container.getBoundingClientRect();\n\n  let maxWidth = Infinity;\n  let maxHeight = Infinity;\n\n  if (handle.includes(\"e\")) {\n    maxWidth = containerRect.right - elementRect.left - 16;\n  }\n  if (handle.includes(\"w\")) {\n    maxWidth = elementRect.right - containerRect.left - 16;\n  }\n  if (handle.includes(\"s\")) {\n    maxHeight = Math.max(containerRect.height * 2, 1000);\n  }\n  if (handle.includes(\"n\")) {\n    maxHeight = elementRect.bottom - containerRect.top - 16;\n  }\n\n  return { maxWidth, maxHeight };\n}\n\n/**\n * Get CSS cursor for a resize handle\n */\nexport function getCursorForHandle(handle: ResizeHandle | null): string {\n  switch (handle) {\n    case \"e\":\n    case \"w\":\n      return \"ew-resize\";\n    case \"n\":\n    case \"s\":\n      return \"ns-resize\";\n    case \"se\":\n    case \"nw\":\n      return \"nwse-resize\";\n    case \"sw\":\n    case \"ne\":\n      return \"nesw-resize\";\n    default:\n      return \"\";\n  }\n}\n\n/**\n * Get the CSS cursor for a resize handle (exported alias)\n */\nexport function getResizeCursor(handle: ResizeHandle): string {\n  return getCursorForHandle(handle);\n}\n","\"use client\";\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\nimport type {\n  ResizeState,\n  ResizeHandle,\n  UseResizableOptions,\n  UseResizableReturn,\n} from \"./types\";\nimport { MOBILE_BREAKPOINT } from \"./types\";\nimport {\n  parseSize,\n  normalizeConfig,\n  snapToGrid,\n  findScrollableContainer,\n  getContainerConstraints,\n  getCursorForHandle,\n} from \"./utils\";\n\n/**\n * Hook to handle element resizing with mouse/touch drag.\n *\n * @example\n * ```tsx\n * function ResizableCard() {\n *   const ref = useRef<HTMLDivElement>(null);\n *   const { state, startResize, style } = useResizable({\n *     initialSize: { width: 300, height: 200 },\n *     config: { horizontal: true, vertical: true },\n *     elementRef: ref,\n *   });\n *\n *   return (\n *     <div ref={ref} style={style}>\n *       <ResizeHandle position=\"se\" onMouseDown={(e) => startResize('se', e)} />\n *     </div>\n *   );\n * }\n * ```\n */\nexport function useResizable({\n  initialSize,\n  config,\n  onResizeStart,\n  onResize,\n  onResizeEnd,\n  elementRef,\n  constrainToContainer = true,\n}: UseResizableOptions = {}): UseResizableReturn {\n  const resizeConfig = normalizeConfig(config);\n\n  const initialWidth = parseSize(initialSize?.width, 0);\n  const initialHeight = parseSize(initialSize?.height, 0);\n  const hasExplicitSize = initialWidth > 0 || initialHeight > 0;\n\n  const [state, setState] = useState<ResizeState>({\n    width: initialWidth,\n    height: initialHeight,\n    isResizing: false,\n    activeHandle: null,\n  });\n\n  const [hasResized, setHasResized] = useState(hasExplicitSize);\n  const dragStart = useRef({ x: 0, y: 0, width: 0, height: 0 });\n  const containerRef = useRef<HTMLElement | null>(null);\n  const lastBreakpointRef = useRef<\"mobile\" | \"desktop\" | null>(null);\n\n  // Reset resize on breakpoint change\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n\n    const checkBreakpoint = () => {\n      const currentBreakpoint =\n        window.innerWidth <= MOBILE_BREAKPOINT ? \"mobile\" : \"desktop\";\n\n      if (\n        lastBreakpointRef.current !== null &&\n        lastBreakpointRef.current !== currentBreakpoint\n      ) {\n        setHasResized(false);\n        setState({\n          width: initialWidth,\n          height: initialHeight,\n          isResizing: false,\n          activeHandle: null,\n        });\n      }\n\n      lastBreakpointRef.current = currentBreakpoint;\n    };\n\n    checkBreakpoint();\n\n    const mediaQuery = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT}px)`);\n    mediaQuery.addEventListener(\"change\", checkBreakpoint);\n\n    return () => {\n      mediaQuery.removeEventListener(\"change\", checkBreakpoint);\n    };\n  }, [initialWidth, initialHeight]);\n\n  const startResize = useCallback(\n    (handle: ResizeHandle, e: React.MouseEvent | React.TouchEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const clientX = \"touches\" in e ? (e.touches[0]?.clientX ?? 0) : e.clientX;\n      const clientY = \"touches\" in e ? (e.touches[0]?.clientY ?? 0) : e.clientY;\n\n      let currentWidth = state.width;\n      let currentHeight = state.height;\n\n      if (elementRef?.current) {\n        const rect = elementRef.current.getBoundingClientRect();\n        currentWidth = rect.width;\n        currentHeight = rect.height;\n\n        if (constrainToContainer) {\n          containerRef.current = findScrollableContainer(elementRef.current);\n        }\n      }\n\n      dragStart.current = {\n        x: clientX,\n        y: clientY,\n        width: currentWidth,\n        height: currentHeight,\n      };\n\n      const newState: ResizeState = {\n        width: currentWidth,\n        height: currentHeight,\n        isResizing: true,\n        activeHandle: handle,\n      };\n\n      setState(newState);\n      onResizeStart?.(newState);\n    },\n    [\n      state.width,\n      state.height,\n      elementRef,\n      onResizeStart,\n      constrainToContainer,\n    ],\n  );\n\n  const stopResize = useCallback(() => {\n    setState((prev) => {\n      if (!prev.isResizing) return prev;\n\n      const finalState: ResizeState = {\n        ...prev,\n        isResizing: false,\n        activeHandle: null,\n      };\n\n      setHasResized(true);\n\n      if (onResizeEnd) {\n        queueMicrotask(() => {\n          onResizeEnd(finalState);\n        });\n      }\n\n      return finalState;\n    });\n\n    containerRef.current = null;\n  }, [onResizeEnd]);\n\n  const reset = useCallback(() => {\n    setState({\n      width: initialWidth,\n      height: initialHeight,\n      isResizing: false,\n      activeHandle: null,\n    });\n    setHasResized(hasExplicitSize);\n  }, [initialWidth, initialHeight, hasExplicitSize]);\n\n  // Handle mouse/touch move during resize\n  useEffect(() => {\n    if (!state.isResizing || !state.activeHandle) return;\n\n    const handleMove = (e: MouseEvent | TouchEvent) => {\n      const clientX = \"touches\" in e ? (e.touches[0]?.clientX ?? 0) : e.clientX;\n      const clientY = \"touches\" in e ? (e.touches[0]?.clientY ?? 0) : e.clientY;\n\n      const deltaX = clientX - dragStart.current.x;\n      const deltaY = clientY - dragStart.current.y;\n\n      let newWidth = dragStart.current.width;\n      let newHeight = dragStart.current.height;\n\n      const handle = state.activeHandle!;\n\n      if (handle.includes(\"e\") && resizeConfig.horizontal) {\n        newWidth = dragStart.current.width + deltaX;\n      }\n      if (handle.includes(\"w\") && resizeConfig.horizontal) {\n        newWidth = dragStart.current.width - deltaX;\n      }\n      if (handle.includes(\"s\") && resizeConfig.vertical) {\n        newHeight = dragStart.current.height + deltaY;\n      }\n      if (handle.includes(\"n\") && resizeConfig.vertical) {\n        newHeight = dragStart.current.height - deltaY;\n      }\n\n      let minWidth = initialSize?.minWidth ?? 50;\n      let maxWidth = initialSize?.maxWidth ?? Infinity;\n      let minHeight = initialSize?.minHeight ?? 50;\n      let maxHeight = initialSize?.maxHeight ?? Infinity;\n\n      if (constrainToContainer && containerRef.current && elementRef?.current) {\n        const containerConstraints = getContainerConstraints(\n          elementRef.current,\n          containerRef.current,\n          handle,\n        );\n        maxWidth = Math.min(maxWidth, containerConstraints.maxWidth);\n        maxHeight = Math.min(maxHeight, containerConstraints.maxHeight);\n      }\n\n      newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));\n      newHeight = Math.max(minHeight, Math.min(maxHeight, newHeight));\n\n      newWidth = snapToGrid(newWidth, resizeConfig.snapToGrid);\n      newHeight = snapToGrid(newHeight, resizeConfig.snapToGrid);\n\n      if (resizeConfig.preserveAspectRatio && dragStart.current.width > 0) {\n        const aspectRatio = dragStart.current.height / dragStart.current.width;\n        if (Math.abs(deltaX) > Math.abs(deltaY)) {\n          newHeight = newWidth * aspectRatio;\n        } else {\n          newWidth = newHeight / aspectRatio;\n        }\n      }\n\n      const newState: ResizeState = {\n        width: newWidth,\n        height: newHeight,\n        isResizing: true,\n        activeHandle: state.activeHandle,\n      };\n\n      setState(newState);\n      onResize?.(newState);\n    };\n\n    const handleEnd = () => {\n      stopResize();\n    };\n\n    window.addEventListener(\"mousemove\", handleMove);\n    window.addEventListener(\"mouseup\", handleEnd);\n    window.addEventListener(\"touchmove\", handleMove);\n    window.addEventListener(\"touchend\", handleEnd);\n\n    document.body.style.userSelect = \"none\";\n    document.body.style.cursor = getCursorForHandle(state.activeHandle);\n\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMove);\n      window.removeEventListener(\"mouseup\", handleEnd);\n      window.removeEventListener(\"touchmove\", handleMove);\n      window.removeEventListener(\"touchend\", handleEnd);\n      document.body.style.userSelect = \"\";\n      document.body.style.cursor = \"\";\n    };\n  }, [\n    state.isResizing,\n    state.activeHandle,\n    resizeConfig,\n    initialSize,\n    onResize,\n    stopResize,\n    constrainToContainer,\n    elementRef,\n  ]);\n\n  // Generate style object\n  const style: React.CSSProperties = {};\n\n  if (hasResized) {\n    if (state.width > 0) {\n      style.width = \"100%\";\n      style.maxWidth = state.width;\n      style.minWidth = Math.min(200, state.width * 0.5);\n    }\n    if (state.height > 0) {\n      style.height = state.height;\n      style.minHeight = Math.min(100, state.height * 0.5);\n    }\n  }\n\n  return {\n    state,\n    startResize,\n    stopResize,\n    reset,\n    resizeConfig,\n    style,\n  };\n}\n","\"use client\";\n\nimport {\n  type ReactNode,\n  useCallback,\n  useState,\n  useRef,\n  useEffect,\n} from \"react\";\nimport type { UIElement } from \"@onegenui/core\";\nimport { LongPressIndicator } from \"./LongPressIndicator\";\nimport {\n  triggerHaptic,\n  isIgnoredTarget,\n  isInEdgeZone,\n  MOVE_TOLERANCE_PX,\n} from \"../utils/selection\";\nimport { useSelection } from \"../contexts/selection\";\n\nexport interface SelectionWrapperProps {\n  element: UIElement;\n  enabled: boolean;\n  onSelect?: (element: UIElement) => void;\n  delayMs: number;\n  isSelected: boolean;\n  children: ReactNode;\n}\n\nexport function SelectionWrapper({\n  element,\n  enabled,\n  onSelect,\n  delayMs,\n  isSelected,\n  children,\n}: SelectionWrapperProps) {\n  const [pressing, setPressing] = useState(false);\n  const [pressPosition, setPressPosition] = useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n  const startPositionRef = useRef<{ x: number; y: number } | null>(null);\n  const longPressCompletedRef = useRef(false);\n  const onSelectableItemRef = useRef(false);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n\n  // Use context hook if available, with fallback for standalone usage\n  let isDeepSelectionActive: () => boolean;\n  try {\n    const selectionContext = useSelection();\n    isDeepSelectionActive = selectionContext.isDeepSelectionActive;\n  } catch {\n    // Fallback when used outside SelectionProvider\n    isDeepSelectionActive = () =>\n      typeof document !== \"undefined\" &&\n      (document as unknown as { __jsonuiDeepSelectionActive?: boolean })\n        .__jsonuiDeepSelectionActive === true;\n  }\n\n  const handleComplete = useCallback(() => {\n    if (isDeepSelectionActive()) {\n      setPressing(false);\n      setPressPosition(null);\n      return;\n    }\n\n    if (onSelect && enabled) {\n      triggerHaptic(50);\n      onSelect(element);\n    }\n    longPressCompletedRef.current = true;\n    setPressing(false);\n    setPressPosition(null);\n  }, [element, enabled, onSelect, isDeepSelectionActive]);\n\n  const handleCancel = useCallback(() => {\n    setPressing(false);\n    setPressPosition(null);\n    startPositionRef.current = null;\n  }, []);\n\n  const handlePointerDown = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      if (!enabled || !onSelect) return;\n      if (isIgnoredTarget(event.target)) return;\n\n      const wrapper = wrapperRef.current;\n      if (!wrapper) return;\n\n      const firstChild = wrapper.querySelector(\":scope > *\") as HTMLElement;\n      const targetElement = firstChild || wrapper;\n      const rect = targetElement.getBoundingClientRect();\n\n      if (rect.width === 0 && rect.height === 0) return;\n\n      const isOnEdge = isInEdgeZone(event.clientX, event.clientY, rect);\n\n      if (!isOnEdge && !isSelected) {\n        return;\n      }\n\n      const target = event.target as HTMLElement;\n      onSelectableItemRef.current = !!target.closest(\"[data-selectable-item]\");\n\n      longPressCompletedRef.current = false;\n      startPositionRef.current = { x: event.clientX, y: event.clientY };\n      setPressPosition({ x: event.clientX, y: event.clientY });\n      setPressing(true);\n\n      if (typeof document !== \"undefined\") {\n        document.body.classList.add(\"select-none\");\n      }\n    },\n    [enabled, onSelect, isSelected],\n  );\n\n  const handlePointerUp = useCallback(\n    (_event?: React.PointerEvent<HTMLDivElement>) => {\n      if (typeof document !== \"undefined\") {\n        document.body.classList.remove(\"select-none\");\n      }\n      handleCancel();\n    },\n    [handleCancel],\n  );\n\n  const handlePointerMove = useCallback(\n    (event: React.PointerEvent<HTMLDivElement>) => {\n      if (!pressing || !startPositionRef.current) return;\n\n      const dx = event.clientX - startPositionRef.current.x;\n      const dy = event.clientY - startPositionRef.current.y;\n      const distance = Math.sqrt(dx * dx + dy * dy);\n\n      if (distance > MOVE_TOLERANCE_PX) {\n        handleCancel();\n      }\n    },\n    [pressing, handleCancel],\n  );\n\n  const handleClickCapture = useCallback(\n    (event: React.MouseEvent<HTMLDivElement>) => {\n      if (longPressCompletedRef.current) {\n        longPressCompletedRef.current = false;\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    },\n    [],\n  );\n\n  useEffect(() => {\n    return () => {\n      if (typeof document !== \"undefined\") {\n        document.body.style.userSelect = \"\";\n        (document.body.style as any).webkitUserSelect = \"\";\n      }\n      setPressing(false);\n      setPressPosition(null);\n    };\n  }, []);\n\n  return (\n    <div\n      ref={wrapperRef}\n      style={{ display: \"contents\" }}\n      onPointerDown={handlePointerDown}\n      onPointerUp={handlePointerUp}\n      onPointerCancel={handlePointerUp}\n      onPointerLeave={handlePointerUp}\n      onPointerMove={handlePointerMove}\n      onClickCapture={handleClickCapture}\n      data-jsonui-selected={isSelected ? \"true\" : undefined}\n      data-jsonui-element-key={element.key}\n    >\n      {children}\n      {pressing && pressPosition && (\n        <LongPressIndicator\n          x={pressPosition.x}\n          y={pressPosition.y}\n          durationMs={delayMs}\n          onComplete={handleComplete}\n        />\n      )}\n    </div>\n  );\n}\n","\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport { createPortal } from \"react-dom\";\n\n// Constants\nexport const RING_SIZE = 48;\nconst STROKE_WIDTH = 3;\nconst RADIUS = (RING_SIZE - STROKE_WIDTH) / 2;\nconst CIRCUMFERENCE = 2 * Math.PI * RADIUS;\n\nexport interface LongPressIndicatorProps {\n  x: number;\n  y: number;\n  durationMs: number;\n  onComplete: () => void;\n}\n\nexport function LongPressIndicator({\n  x,\n  y,\n  durationMs,\n  onComplete,\n}: LongPressIndicatorProps) {\n  const [mounted, setMounted] = useState(false);\n  const timerRef = useRef<number | null>(null);\n  const startTimeRef = useRef<number>(0);\n  const animationFrameRef = useRef<number | null>(null);\n  const circleRef = useRef<SVGCircleElement>(null);\n\n  useEffect(() => {\n    setMounted(true);\n    startTimeRef.current = performance.now();\n\n    const animate = () => {\n      const elapsed = performance.now() - startTimeRef.current;\n      const progress = Math.min(elapsed / durationMs, 1);\n\n      if (circleRef.current) {\n        const offset = CIRCUMFERENCE * (1 - progress);\n        circleRef.current.style.strokeDashoffset = `${offset}`;\n      }\n\n      if (progress < 1) {\n        animationFrameRef.current = requestAnimationFrame(animate);\n      }\n    };\n\n    animationFrameRef.current = requestAnimationFrame(animate);\n\n    timerRef.current = window.setTimeout(() => {\n      onComplete();\n    }, durationMs);\n\n    return () => {\n      if (timerRef.current) clearTimeout(timerRef.current);\n      if (animationFrameRef.current)\n        cancelAnimationFrame(animationFrameRef.current);\n    };\n  }, [durationMs, onComplete]);\n\n  if (!mounted || typeof document === \"undefined\") return null;\n\n  return createPortal(\n    <div\n      style={{\n        position: \"fixed\",\n        left: x - RING_SIZE / 2,\n        top: y - RING_SIZE / 2,\n        width: RING_SIZE,\n        height: RING_SIZE,\n        pointerEvents: \"none\",\n        zIndex: 9999,\n        opacity: 1,\n        transition: \"opacity 150ms ease-out\",\n      }}\n      data-long-press-indicator\n    >\n      <svg\n        width={RING_SIZE}\n        height={RING_SIZE}\n        style={{ transform: \"rotate(-90deg)\" }}\n      >\n        <circle\n          cx={RING_SIZE / 2}\n          cy={RING_SIZE / 2}\n          r={RADIUS}\n          fill=\"none\"\n          stroke=\"rgba(255, 255, 255, 0.15)\"\n          strokeWidth={STROKE_WIDTH}\n        />\n        <circle\n          ref={circleRef}\n          cx={RING_SIZE / 2}\n          cy={RING_SIZE / 2}\n          r={RADIUS}\n          fill=\"none\"\n          stroke=\"var(--foreground, #fff)\"\n          strokeWidth={STROKE_WIDTH}\n          strokeLinecap=\"round\"\n          strokeDasharray={CIRCUMFERENCE}\n          strokeDashoffset={CIRCUMFERENCE}\n          style={{\n            filter: \"drop-shadow(0 0 6px rgba(255, 255, 255, 0.5))\",\n          }}\n        />\n      </svg>\n    </div>,\n    document.body,\n  );\n}\n","\"use client\";\n\nimport type { ReactNode } from \"react\";\nimport { DataProvider } from \"../contexts/data\";\nimport { VisibilityProvider } from \"../contexts/visibility\";\nimport { ActionProvider, useActions, ConfirmDialog } from \"../contexts/actions\";\nimport { ValidationProvider } from \"../contexts/validation\";\nimport { MarkdownProvider } from \"../contexts/markdown\";\nimport type { JSONUIProviderProps } from \"./types\";\n\n/**\n * Renders the confirmation dialog when needed\n */\nfunction ConfirmationDialogManager() {\n  const { pendingConfirmation, confirm, cancel } = useActions();\n\n  if (!pendingConfirmation?.action.confirm) {\n    return null;\n  }\n\n  return (\n    <ConfirmDialog\n      confirm={pendingConfirmation.action.confirm}\n      onConfirm={confirm}\n      onCancel={cancel}\n    />\n  );\n}\n\n/**\n * Combined provider for all JSONUI contexts\n */\nexport function JSONUIProvider({\n  registry,\n  initialData,\n  authState,\n  actionHandlers,\n  navigate,\n  validationFunctions,\n  onDataChange,\n  children,\n}: JSONUIProviderProps) {\n  return (\n    <MarkdownProvider>\n      <DataProvider\n        initialData={initialData}\n        authState={authState}\n        onDataChange={onDataChange}\n      >\n        <VisibilityProvider>\n          <ActionProvider handlers={actionHandlers} navigate={navigate}>\n            <ValidationProvider customFunctions={validationFunctions}>\n              {children}\n              <ConfirmationDialogManager />\n            </ValidationProvider>\n          </ActionProvider>\n        </VisibilityProvider>\n      </DataProvider>\n    </MarkdownProvider>\n  );\n}\n","\"use client\";\n\nimport type { ComponentType } from \"react\";\nimport type { Catalog, ComponentDefinition } from \"@onegenui/core\";\nimport { InteractionTrackingWrapper } from \"./components/InteractionTrackingWrapper\";\nimport { DEFAULT_SELECTION_DELAY } from \"./utils/selection\";\nimport type {\n  ComponentRenderProps,\n  ComponentRenderer,\n  ComponentRegistry,\n  RendererProps,\n  JSONUIProviderProps,\n} from \"./renderer/types\";\nimport { ElementRenderer } from \"./renderer/element-renderer\";\nimport { JSONUIProvider } from \"./renderer/provider\";\n\n// Re-export types for convenience\nexport type {\n  ComponentRenderProps,\n  ComponentRenderer,\n  ComponentRegistry,\n  RendererProps,\n  JSONUIProviderProps,\n};\nexport { JSONUIProvider };\n\n/**\n * Main renderer component\n */\nexport function Renderer({\n  tree,\n  registry,\n  loading,\n  fallback,\n  selectable = false,\n  onElementSelect,\n  selectionDelayMs = DEFAULT_SELECTION_DELAY,\n  selectedKey,\n  trackInteractions = false,\n  onInteraction,\n  onResize,\n  autoGrid = true,\n}: RendererProps) {\n  if (!tree || !tree.root) return null;\n\n  const rootElement = tree.elements[tree.root];\n  if (!rootElement) return null;\n\n  const content = (\n    <ElementRenderer\n      element={rootElement}\n      tree={tree}\n      registry={registry}\n      loading={loading}\n      fallback={fallback}\n      selectable={selectable}\n      onElementSelect={onElementSelect}\n      selectionDelayMs={selectionDelayMs}\n      selectedKey={selectedKey}\n      onResize={onResize}\n    />\n  );\n\n  const gridContent = autoGrid ? (\n    <div\n      style={{\n        display: \"grid\",\n        gridTemplateColumns: \"repeat(auto-fit, minmax(min(400px, 100%), 1fr))\",\n        gap: 24,\n        width: \"100%\",\n        alignItems: \"stretch\",\n      }}\n      data-renderer-auto-grid\n    >\n      {content}\n    </div>\n  ) : (\n    content\n  );\n\n  if (trackInteractions && onInteraction) {\n    return (\n      <InteractionTrackingWrapper tree={tree} onInteraction={onInteraction}>\n        {gridContent}\n      </InteractionTrackingWrapper>\n    );\n  }\n\n  return gridContent;\n}\n\n/**\n * Helper to create a renderer component from a catalog\n */\nexport function createRendererFromCatalog<\n  C extends Catalog<Record<string, ComponentDefinition>>,\n>(\n  _catalog: C,\n  registry: ComponentRegistry,\n): ComponentType<Omit<RendererProps, \"registry\">> {\n  return function CatalogRenderer(props: Omit<RendererProps, \"registry\">) {\n    return <Renderer {...props} registry={registry} />;\n  };\n}\n","/**\n * Element props equality comparator for memoization\n */\n\nimport type { ElementRendererProps } from \"./types\";\n\n/**\n * Memoization comparator: structural sharing in patch-utils.ts means only\n * modified elements get new references. This enables O(1) equality checks\n * instead of deep comparison.\n */\nexport function elementRendererPropsAreEqual(\n  prevProps: ElementRendererProps,\n  nextProps: ElementRendererProps,\n): boolean {\n  // Element reference check (structural sharing)\n  if (prevProps.element !== nextProps.element) {\n    return false;\n  }\n\n  // Selection state change\n  const wasSelected = prevProps.selectedKey === prevProps.element.key;\n  const isSelected = nextProps.selectedKey === nextProps.element.key;\n  if (wasSelected !== isSelected) {\n    return false;\n  }\n\n  // Loading state change\n  if (prevProps.loading !== nextProps.loading) {\n    return false;\n  }\n\n  // Tree change - check if children have changed\n  if (prevProps.tree !== nextProps.tree) {\n    const children = prevProps.element.children;\n    if (children) {\n      for (const childKey of children) {\n        if (\n          prevProps.tree.elements[childKey] !==\n          nextProps.tree.elements[childKey]\n        ) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n","/**\n * Skeleton Loader Components\n *\n * Loading states for placeholder and missing elements during streaming.\n */\n\nimport type { ReactNode } from \"react\";\n\n/**\n * Props for skeleton loader components\n */\nexport interface SkeletonProps {\n  /** Element key for data attribute */\n  elementKey: string;\n  /** Optional custom class name */\n  className?: string;\n}\n\n/**\n * Placeholder skeleton for forward-referenced elements\n */\nexport function PlaceholderSkeleton({ elementKey }: SkeletonProps): ReactNode {\n  return (\n    <div\n      key={elementKey}\n      className=\"w-full h-16 bg-muted/10 animate-pulse rounded-lg my-2 border border-border/20\"\n      data-placeholder-for={elementKey}\n    />\n  );\n}\n\n/**\n * Child skeleton for missing children during streaming\n */\nexport function ChildSkeleton({ elementKey }: SkeletonProps): ReactNode {\n  return (\n    <div\n      key={`${elementKey}-skeleton`}\n      className=\"w-full h-12 bg-muted/10 animate-pulse rounded-md my-1\"\n    />\n  );\n}\n\n/**\n * Check if an element is a placeholder\n */\nexport function isPlaceholderElement(element: {\n  type: string;\n  _meta?: { isPlaceholder?: boolean };\n}): boolean {\n  return (\n    element.type === \"__placeholder__\" || element._meta?.isPlaceholder === true\n  );\n}\n","\"use client\";\n\nimport { useState, useCallback, useRef, useEffect, useMemo } from \"react\";\nimport type { UITree, JsonPatch } from \"@onegenui/core\";\nimport { applyPatchesBatch } from \"./patch-utils\";\nimport type {\n  UseUIStreamOptions,\n  UseUIStreamReturn,\n  ConversationTurn,\n  ChatMessage,\n  QuestionPayload,\n  SuggestionChip,\n  ToolProgress,\n  PersistedAttachment,\n  ConversationMessage,\n  Attachment,\n} from \"./types\";\nimport { buildConversationMessages, isFileAttachment, isLibraryAttachment } from \"./types\";\nimport type { DocumentIndex } from \"@onegenui/core\";\nimport { useStore } from \"../store\";\nimport {\n  removeElementFromTree,\n  removeSubItemsFromTree,\n  updateElementInTree,\n  updateElementLayoutInTree,\n  type LayoutUpdates,\n} from \"./ui-stream/tree-mutations\";\nimport { useHistory } from \"./ui-stream/use-history\";\nimport { useConversation } from \"./ui-stream/use-conversation\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Debug Logger for useUIStream\n// ─────────────────────────────────────────────────────────────────────────────\n\nconst LOG_ENDPOINT = \"/api/debug-log\";\nconst LOG_BUFFER: string[] = [];\nlet flushTimer: ReturnType<typeof setTimeout> | null = null;\n\nfunction formatLog(level: string, message: string, data?: unknown): string {\n  const timestamp = new Date().toISOString();\n  const dataStr = data ? `\\n  DATA: ${JSON.stringify(data, null, 2).replace(/\\n/g, \"\\n  \")}` : \"\";\n  return `[${timestamp}] [${level}] [useUIStream] ${message}${dataStr}`;\n}\n\nfunction flushLogs(): void {\n  if (LOG_BUFFER.length === 0) return;\n  const logs = LOG_BUFFER.splice(0, LOG_BUFFER.length);\n  if (typeof window !== \"undefined\") {\n    fetch(LOG_ENDPOINT, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ logs }),\n    }).catch(() => {});\n  }\n}\n\nfunction scheduleFlush(): void {\n  if (flushTimer) return;\n  flushTimer = setTimeout(() => {\n    flushTimer = null;\n    flushLogs();\n  }, 500);\n}\n\nconst streamLog = {\n  debug: (msg: string, data?: unknown) => {\n    console.log(`[useUIStream] ${msg}`, data ?? \"\");\n    LOG_BUFFER.push(formatLog(\"DEBUG\", msg, data));\n    scheduleFlush();\n  },\n  info: (msg: string, data?: unknown) => {\n    console.log(`[useUIStream] ${msg}`, data ?? \"\");\n    LOG_BUFFER.push(formatLog(\"INFO\", msg, data));\n    scheduleFlush();\n  },\n  warn: (msg: string, data?: unknown) => {\n    console.warn(`[useUIStream] ${msg}`, data ?? \"\");\n    LOG_BUFFER.push(formatLog(\"WARN\", msg, data));\n    scheduleFlush();\n  },\n  error: (msg: string, data?: unknown) => {\n    console.error(`[useUIStream] ${msg}`, data ?? \"\");\n    LOG_BUFFER.push(formatLog(\"ERROR\", msg, data));\n    scheduleFlush();\n  },\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// useUIStream Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook for streaming UI generation\n */\nexport function useUIStream({\n  api,\n  onComplete,\n  onError,\n  getHeaders,\n}: UseUIStreamOptions): UseUIStreamReturn {\n  // Use Zustand store for tree state (ensures proper reactivity during streaming)\n  const storeTree = useStore((s) => s.uiTree);\n  const treeVersion = useStore((s) => s.treeVersion);\n  const storeSetUITree = useStore((s) => s.setUITree);\n  const storeClearUITree = useStore((s) => s.clearUITree);\n  const storeSetTreeStreaming = useStore((s) => s.setTreeStreaming);\n  const storeBumpTreeVersion = useStore((s) => s.bumpTreeVersion);\n  \n  // CRITICAL: Create new tree reference when version changes to force re-renders\n  // Without this, React.memo components won't detect tree mutations\n  const tree = useMemo(() => {\n    if (!storeTree) return null;\n    // Shallow copy to create new reference - structural sharing preserved internally\n    return {\n      ...storeTree,\n      elements: { ...storeTree.elements },\n    };\n  }, [storeTree, treeVersion]);\n  \n  // Local state for backward compat - sync from store\n  const [localTree, setLocalTree] = useState<UITree | null>(null);\n  const [conversation, setConversation] = useState<ConversationTurn[]>([]);\n  const treeRef = useRef<UITree | null>(null);\n  \n  // Keep store setters in refs to avoid calling during render\n  const storeSetUITreeRef = useRef(storeSetUITree);\n  useEffect(() => {\n    storeSetUITreeRef.current = storeSetUITree;\n  }, [storeSetUITree]);\n  \n  // Sync local tree FROM store when store changes (triggered by treeVersion)\n  useEffect(() => {\n    if (tree && tree !== localTree) {\n      setLocalTree(tree);\n      treeRef.current = tree;\n    }\n  }, [tree, treeVersion]); // treeVersion ensures we catch all updates\n  \n  // Wrapper to update store - local sync happens via effect above\n  const setTree = useCallback((newTree: UITree | null | ((prev: UITree | null) => UITree | null)) => {\n    if (typeof newTree === \"function\") {\n      const currentTree = treeRef.current;\n      const updatedTree = newTree(currentTree);\n      treeRef.current = updatedTree;\n      storeSetUITreeRef.current(updatedTree);\n    } else {\n      treeRef.current = newTree;\n      storeSetUITreeRef.current(newTree);\n    }\n  }, []);\n\n  // Tool progress actions from Zustand store (direct store access for reliability)\n  const addProgressEvent = useStore((s) => s.addProgressEvent);\n\n  // Plan execution actions from Zustand store\n  const setPlanCreated = useStore((s) => s.setPlanCreated);\n  const setStepStarted = useStore((s) => s.setStepStarted);\n  const setStepDone = useStore((s) => s.setStepDone);\n  const setSubtaskStarted = useStore((s) => s.setSubtaskStarted);\n  const setSubtaskDone = useStore((s) => s.setSubtaskDone);\n  const setLevelStarted = useStore((s) => s.setLevelStarted);\n  const setOrchestrationDone = useStore((s) => s.setOrchestrationDone);\n  const resetPlanExecution = useStore((s) => s.resetPlanExecution);\n\n  // Keep refs for async callbacks\n  const addProgressRef = useRef(addProgressEvent);\n  useEffect(() => {\n    addProgressRef.current = addProgressEvent;\n  }, [addProgressEvent]);\n  \n  // Keep store setters in refs for async use\n  const storeRef = useRef({\n    setUITree: storeSetUITree,\n    bumpTreeVersion: storeBumpTreeVersion,\n    setTreeStreaming: storeSetTreeStreaming,\n    clearUITree: storeClearUITree,\n  });\n  useEffect(() => {\n    storeRef.current = {\n      setUITree: storeSetUITree,\n      bumpTreeVersion: storeBumpTreeVersion,\n      setTreeStreaming: storeSetTreeStreaming,\n      clearUITree: storeClearUITree,\n    };\n  }, [storeSetUITree, storeBumpTreeVersion, storeSetTreeStreaming, storeClearUITree]);\n\n  const planStoreRef = useRef({\n    setPlanCreated,\n    setStepStarted,\n    setStepDone,\n    setSubtaskStarted,\n    setSubtaskDone,\n    setLevelStarted,\n    setOrchestrationDone,\n  });\n  useEffect(() => {\n    planStoreRef.current = {\n      setPlanCreated,\n      setStepStarted,\n      setStepDone,\n      setSubtaskStarted,\n      setSubtaskDone,\n      setLevelStarted,\n      setOrchestrationDone,\n    };\n  }, [\n    setPlanCreated,\n    setStepStarted,\n    setStepDone,\n    setSubtaskStarted,\n    setSubtaskDone,\n    setLevelStarted,\n    setOrchestrationDone,\n  ]);\n\n  // History management\n  const {\n    pushHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    setHistory,\n    setHistoryIndex,\n  } = useHistory(tree, conversation, setTree, setConversation, treeRef);\n\n  // Keep ref in sync\n  useEffect(() => {\n    treeRef.current = tree;\n  }, [tree]);\n\n  const [isStreaming, setIsStreaming] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const sendingRef = useRef(false); // Guard against concurrent sends\n\n  const clear = useCallback(() => {\n    setTree(null);\n    setConversation([]);\n    treeRef.current = null;\n    setError(null);\n    resetPlanExecution();\n    storeRef.current.clearUITree();\n  }, [resetPlanExecution, setTree]);\n\n  const loadSession = useCallback(\n    (session: { tree: UITree; conversation: ConversationTurn[] }) => {\n      setTree(session.tree);\n      treeRef.current = session.tree;\n      setConversation(session.conversation);\n      setHistory([]);\n      setHistoryIndex(-1);\n    },\n    [setTree, setHistory, setHistoryIndex],\n  );\n\n  const removeElement = useCallback(\n    (key: string) => {\n      pushHistory();\n      setTree((prev) => (prev ? removeElementFromTree(prev, key) : null));\n    },\n    [pushHistory, setTree],\n  );\n\n  const removeSubItems = useCallback(\n    (elementKey: string, identifiers: (number | string)[]) => {\n      if (identifiers.length === 0) return;\n      pushHistory();\n      setTree((prev) =>\n        prev ? removeSubItemsFromTree(prev, elementKey, identifiers) : null,\n      );\n    },\n    [pushHistory, setTree],\n  );\n\n  const updateElement = useCallback(\n    (elementKey: string, updates: Record<string, unknown>) => {\n      setTree((prev) =>\n        prev ? updateElementInTree(prev, elementKey, updates) : null,\n      );\n    },\n    [setTree],\n  );\n\n  const updateElementLayout = useCallback(\n    (elementKey: string, layoutUpdates: LayoutUpdates) => {\n      pushHistory();\n      setTree((prev) =>\n        prev\n          ? updateElementLayoutInTree(prev, elementKey, layoutUpdates)\n          : null,\n      );\n    },\n    [pushHistory, setTree],\n  );\n\n  const send = useCallback(\n    async (\n      prompt: string,\n      context?: Record<string, unknown>,\n      attachments?: any[],\n    ) => {\n      // Prevent concurrent sends\n      if (sendingRef.current) {\n        streamLog.warn(\"Ignoring concurrent send request\", { prompt: prompt.slice(0, 100) });\n        return;\n      }\n      sendingRef.current = true;\n      \n      streamLog.info(\"Starting send\", { \n        promptLength: prompt.length, \n        hasContext: !!context,\n        attachmentCount: attachments?.length ?? 0 \n      });\n\n      // Abort any existing request\n      abortControllerRef.current?.abort();\n      abortControllerRef.current = new AbortController();\n      const signal = abortControllerRef.current.signal;\n\n      setIsStreaming(true);\n      setError(null);\n\n      // Start with existing tree or empty\n      let currentTree: UITree = treeRef.current\n        ? JSON.parse(JSON.stringify(treeRef.current))\n        : { root: \"\", elements: {} };\n\n      // If no tree existed, initialize it and sync ref immediately\n      if (!treeRef.current) {\n        streamLog.debug(\"Initializing empty tree\");\n        setTree(currentTree);\n        treeRef.current = currentTree; // Sync ref immediately to prevent race conditions\n      }\n\n      // OPTIMISTIC UI: Create the turn immediately so user message is visible\n      // For proactive responses, we hide the user message\n      const isProactive = context?.hideUserMessage === true;\n      const turnId = `turn-${Date.now()}`;\n      streamLog.debug(\"Creating turn\", { turnId, isProactive });\n      const pendingTurn: ConversationTurn = {\n        id: turnId,\n        userMessage: prompt,\n        assistantMessages: [],\n        treeSnapshot: null, // Will be set on completion\n        timestamp: Date.now(),\n        isProactive,\n        attachments,\n        isLoading: true, // Mark as loading during streaming\n      };\n      setConversation((prev) => [...prev, pendingTurn]);\n\n      // Batch processing variables - declared outside try for cleanup in catch\n      let patchBuffer: JsonPatch[] = [];\n      let patchFlushTimer: ReturnType<typeof setTimeout> | null = null;\n\n      try {\n        const hasTreeContext =\n          context && typeof context === \"object\" && \"tree\" in context;\n\n        // Build conversation history for multi-turn support\n        // This enables the AI to maintain context across turns natively\n        const conversationMessages = buildConversationMessages(conversation);\n\n        let body: string | FormData;\n        const headers: Record<string, string> = {};\n\n        // Separate file attachments from library attachments\n        const fileAttachments = attachments?.filter(isFileAttachment) ?? [];\n        const libraryAttachments = attachments?.filter(isLibraryAttachment) ?? [];\n\n        if (fileAttachments.length > 0) {\n          // Use FormData for file uploads\n          console.debug(\"[useUIStream] Uploading attachments:\", {\n            count: fileAttachments.length,\n            files: fileAttachments.map((att) => ({\n              name: att.file.name,\n              type: att.file.type,\n              size: att.file.size,\n            })),\n            libraryDocs: libraryAttachments.map((att) => att.documentId),\n          });\n          const formData = new FormData();\n          formData.append(\"prompt\", prompt);\n          if (context) {\n            formData.append(\"context\", JSON.stringify(context));\n          }\n          if (!hasTreeContext) {\n            formData.append(\"currentTree\", JSON.stringify(currentTree));\n          }\n          // Include conversation history for multi-turn context\n          if (conversationMessages.length > 0) {\n            formData.append(\"messages\", JSON.stringify(conversationMessages));\n          }\n\n          fileAttachments.forEach((att) => {\n            formData.append(\"files\", att.file);\n          });\n\n          // Include library document IDs\n          if (libraryAttachments.length > 0) {\n            formData.append(\n              \"libraryDocumentIds\",\n              JSON.stringify(libraryAttachments.map((a) => a.documentId)),\n            );\n          }\n\n          body = formData;\n          // Don't set Content-Type header for FormData, browser sets it with boundary\n        } else if (libraryAttachments.length > 0) {\n          // Only library documents, use JSON\n          const bodyPayload: Record<string, unknown> = {\n            prompt,\n            context,\n            libraryDocumentIds: libraryAttachments.map((a) => a.documentId),\n          };\n          if (!hasTreeContext) {\n            bodyPayload.currentTree = currentTree;\n          }\n          if (conversationMessages.length > 0) {\n            bodyPayload.messages = conversationMessages;\n          }\n          body = JSON.stringify(bodyPayload);\n          headers[\"Content-Type\"] = \"application/json\";\n        } else {\n          // Use JSON for text-only requests\n          const bodyPayload: Record<string, unknown> = { prompt, context };\n          if (!hasTreeContext) {\n            bodyPayload.currentTree = currentTree;\n          }\n          // Include conversation history for multi-turn context\n          if (conversationMessages.length > 0) {\n            bodyPayload.messages = conversationMessages;\n          }\n          body = JSON.stringify(bodyPayload);\n          headers[\"Content-Type\"] = \"application/json\";\n        }\n\n        // Add dynamic headers (e.g. auth)\n        if (getHeaders) {\n          const dynamicHeaders = await getHeaders();\n          Object.assign(headers, dynamicHeaders);\n        }\n\n        streamLog.info(\"Sending request to API\", { api, hasAuth: !!getHeaders });\n\n        const response = await fetch(api, {\n          method: \"POST\",\n          headers,\n          body,\n          signal: abortControllerRef.current.signal,\n        });\n\n        streamLog.debug(\"Response received\", { status: response.status, ok: response.ok });\n\n        if (!response.ok) {\n          throw new Error(`HTTP error: ${response.status}`);\n        }\n\n        if (!response.body) {\n          throw new Error(\"No response body\");\n        }\n\n        const reader = response.body.getReader();\n        const decoder = new TextDecoder();\n\n        const currentMessages: ChatMessage[] = [];\n        const currentQuestions: QuestionPayload[] = [];\n        const currentSuggestions: SuggestionChip[] = [];\n        const currentToolProgress: ToolProgress[] = [];\n        const currentPersistedAttachments: PersistedAttachment[] = [];\n        let currentDocumentIndex: DocumentIndex | undefined = undefined;\n        let patchCount = 0;\n        let messageCount = 0;\n\n        // Helper to update the pending turn\n        const updateTurnData = () => {\n          setConversation((prev) =>\n            prev.map((t) =>\n              t.id === turnId\n                ? ({\n                    ...t,\n                    assistantMessages: [...currentMessages],\n                    questions: [...currentQuestions],\n                    suggestions: [...currentSuggestions],\n                    toolProgress: [...currentToolProgress],\n                    persistedAttachments:\n                      currentPersistedAttachments.length > 0\n                        ? [...currentPersistedAttachments]\n                        : t.persistedAttachments,\n                    documentIndex: currentDocumentIndex ?? t.documentIndex,\n                  } as ConversationTurn)\n                : t,\n            ),\n          );\n        };\n\n        streamLog.debug(\"Starting stream processing\");\n\n        // Process incoming stream data\n        let buffer = \"\";\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) break;\n\n          buffer += decoder.decode(value, { stream: true });\n          const lines = buffer.split(\"\\n\");\n          buffer = lines.pop() ?? \"\";\n\n          for (const line of lines) {\n            if (!line) continue;\n            const colIdx = line.indexOf(\":\");\n            if (colIdx === -1) continue;\n\n            const lineType = line.slice(0, colIdx);\n            const content = line.slice(colIdx + 1);\n\n            try {\n              // Only process \"d\" or \"data\" line types\n              if (lineType === \"d\" || lineType === \"data\") {\n                // Data Part - parse and apply patch\n                if (content.trim() === \"[DONE]\") {\n                  streamLog.debug(\"Stream DONE received\");\n                  continue;\n                }\n\n                const data = JSON.parse(content);\n\n                // Handle wrapped format: { type: \"data\", data: {...} }\n                const payload = data?.type === \"data\" ? data.data : data;\n\n                if (payload?.type === \"text-delta\") {\n                  // Text delta from AI SDK - not used, all chat comes from op:\"message\"\n                  continue;\n                } else if (payload?.op) {\n                  // JSON Patch operation\n                  const { op, path, value } = payload;\n\n                  if (op === \"message\") {\n                    const msgContent = payload.content || value;\n                    if (msgContent) {\n                      messageCount++;\n                      streamLog.debug(\"Message received\", { messageCount, contentLength: msgContent.length });\n                      currentMessages.push({\n                        role: payload.role || \"assistant\",\n                        content: msgContent,\n                      });\n                      updateTurnData();\n                    }\n                  } else if (op === \"question\") {\n                    // Extract question object - handles both { op: 'question', question: {...} } and { op: 'question', value: {...} }\n                    const question = value || payload.question;\n                    if (question)\n                      currentQuestions.push(question as QuestionPayload);\n                    updateTurnData();\n                  } else if (op === \"suggestion\") {\n                    const suggestions = value || payload.suggestions;\n                    if (Array.isArray(suggestions))\n                      currentSuggestions.push(...suggestions);\n                    updateTurnData();\n                  } else if (op === \"tool-progress\") {\n                    // Tool progress via op format (from SSE)\n                    const progress: ToolProgress = {\n                      toolName: payload.toolName as string,\n                      toolCallId: payload.toolCallId as string,\n                      status: payload.status as ToolProgress[\"status\"],\n                      message: payload.message as string | undefined,\n                      data: payload.data,\n                    };\n                    streamLog.debug(\"Tool progress\", { toolName: progress.toolName, status: progress.status });\n                    currentToolProgress.push(progress);\n                    updateTurnData();\n\n                    // Update global tool progress store directly\n                    addProgressRef.current({\n                      toolCallId: progress.toolCallId,\n                      toolName: progress.toolName,\n                      status: progress.status,\n                      message: progress.message,\n                      data: progress.data,\n                    });\n                  } else if (path) {\n                    // Tree mutation patch - accumulate in buffer for batch processing\n                    patchCount++;\n                    patchBuffer.push({\n                      op,\n                      path,\n                      value,\n                    } as JsonPatch);\n\n                    // Schedule batch application with short delay for immediate feel\n                    // Flush every 50ms or on next frame, whichever comes first\n                    if (!patchFlushTimer) {\n                      patchFlushTimer = setTimeout(() => {\n                        patchFlushTimer = null;\n                        if (patchBuffer.length > 0) {\n                          streamLog.debug(\"Flushing patches\", { count: patchBuffer.length });\n                          // CRITICAL: Use treeRef.current as the base, not the captured currentTree\n                          // This ensures we're always working with the latest state\n                          const baseTree = treeRef.current ?? currentTree;\n                          const updatedTree = applyPatchesBatch(\n                            baseTree,\n                            patchBuffer,\n                            turnId,\n                          );\n                          patchBuffer = [];\n                          // Update both ref and state atomically\n                          treeRef.current = updatedTree;\n                          currentTree = updatedTree; // Keep local var in sync for subsequent patches\n                          \n                          // Update Zustand store directly for guaranteed reactivity\n                          const store = storeRef.current;\n                          store.setUITree({\n                            root: updatedTree.root,\n                            elements: { ...updatedTree.elements },\n                          });\n                          store.bumpTreeVersion();\n                          \n                          streamLog.debug(\"Tree updated\", { \n                            elementCount: Object.keys(updatedTree.elements).length \n                          });\n                        }\n                      }, 50); // Flush every 50ms for more responsive UI\n                    }\n                  }\n                } else if (payload?.type === \"plan-created\") {\n                  // Multi-agent: Plan created - use Zustand store\n                  const plan = payload.plan as {\n                    goal: string;\n                    steps: Array<{\n                      id: number;\n                      task: string;\n                      agent: string;\n                      dependencies?: number[];\n                      parallel?: boolean;\n                      subtasks?: Array<{\n                        id: number;\n                        task: string;\n                        agent: string;\n                      }>;\n                    }>;\n                  };\n                  const store = planStoreRef.current;\n                  store.setPlanCreated(\n                    plan.goal,\n                    plan.steps.map((s) => ({\n                      id: s.id,\n                      task: s.task,\n                      agent: s.agent,\n                      dependencies: s.dependencies ?? [],\n                      parallel: s.parallel,\n                      subtasks: s.subtasks?.map((st) => ({\n                        id: st.id,\n                        task: st.task,\n                        agent: st.agent,\n                      })),\n                    })),\n                  );\n                } else if (payload?.type === \"persisted-attachments\") {\n                  // Persisted attachments for saving in conversation\n                  const attachments =\n                    payload.attachments as PersistedAttachment[];\n                  currentPersistedAttachments.push(...attachments);\n                  updateTurnData();\n                } else if (payload?.type === \"tool-progress\") {\n                  // Tool progress for granular updates\n                  const progress: ToolProgress = {\n                    toolName: payload.toolName as string,\n                    toolCallId: payload.toolCallId as string,\n                    status: payload.status as ToolProgress[\"status\"],\n                    message: payload.message as string | undefined,\n                    data: payload.data,\n                  };\n                  currentToolProgress.push(progress);\n                  updateTurnData();\n\n                  // Update global tool progress store directly\n                  console.debug(\"[useUIStream] Tool progress received:\", {\n                    toolName: progress.toolName,\n                    status: progress.status,\n                  });\n                  addProgressRef.current({\n                    toolCallId: progress.toolCallId,\n                    toolName: progress.toolName,\n                    status: progress.status,\n                    message: progress.message,\n                    data: progress.data,\n                  });\n                } else if (payload?.type === \"document-index-ui\") {\n                  // Document index from Vectorless smart parsing\n                  // Supports multi-document: aggregates subsequent documents\n                  const uiComponent = payload.uiComponent as {\n                    type: string;\n                    props: DocumentIndex;\n                  };\n                  if (uiComponent?.props) {\n                    if (!currentDocumentIndex) {\n                      // First document\n                      currentDocumentIndex = uiComponent.props;\n                    } else {\n                      // Additional document - merge into existing\n                      const newDoc = uiComponent.props;\n                      currentDocumentIndex = {\n                        title: `${currentDocumentIndex.title} + ${newDoc.title}`,\n                        description: [\n                          currentDocumentIndex.description,\n                          newDoc.description,\n                        ]\n                          .filter(Boolean)\n                          .join(\"\\n\\n---\\n\\n\"),\n                        pageCount:\n                          currentDocumentIndex.pageCount + newDoc.pageCount,\n                        nodes: [\n                          ...currentDocumentIndex.nodes,\n                          // Add separator node for clarity\n                          {\n                            title: `📄 ${newDoc.title}`,\n                            nodeId: `doc-${Date.now()}`,\n                            startPage: 1,\n                            endPage: newDoc.pageCount,\n                            summary: newDoc.description,\n                            children: newDoc.nodes,\n                          },\n                        ],\n                      };\n                    }\n                    updateTurnData();\n                  }\n                } else if (payload?.type === \"level-started\") {\n                  // Multi-agent: Parallel level started - use Zustand store\n                  planStoreRef.current.setLevelStarted(payload.level as number);\n                } else if (payload?.type === \"step-started\") {\n                  // Multi-agent: Step started - use Zustand store\n                  planStoreRef.current.setStepStarted(payload.stepId as number);\n                } else if (payload?.type === \"subtask-started\") {\n                  // Multi-agent: Subtask started - use Zustand store\n                  planStoreRef.current.setSubtaskStarted(\n                    payload.parentId as number,\n                    payload.stepId as number,\n                  );\n                } else if (payload?.type === \"step-done\") {\n                  // Multi-agent: Step completed - use Zustand store\n                  planStoreRef.current.setStepDone(\n                    payload.stepId as number,\n                    payload.result,\n                  );\n                } else if (payload?.type === \"subtask-done\") {\n                  // Multi-agent: Subtask completed - use Zustand store\n                  planStoreRef.current.setSubtaskDone(\n                    payload.parentId as number,\n                    payload.stepId as number,\n                    payload.result,\n                  );\n                } else if (payload?.type === \"orchestration-done\") {\n                  // Multi-agent: Orchestration complete - use Zustand store\n                  planStoreRef.current.setOrchestrationDone();\n                } else if (payload?.type === \"citations\") {\n                  // Document citations from Vectorless\n                  // Will be handled by CitationContext in the app\n                  // Emit a custom event that CitationContext can listen to\n                  if (\n                    payload.citations &&\n                    Array.isArray(payload.citations) &&\n                    typeof window !== \"undefined\"\n                  ) {\n                    window.dispatchEvent(\n                      new CustomEvent(\"onegenui:citations\", {\n                        detail: { citations: payload.citations },\n                      }),\n                    );\n                  }\n                }\n              }\n            } catch (e) {\n              // Parse error - skip line\n            }\n          }\n        }\n\n        // Final setTree with fresh reference and sync ref\n        streamLog.info(\"Stream completed\", { \n          totalPatches: patchCount, \n          totalMessages: messageCount,\n          treeElementCount: Object.keys(currentTree.elements).length \n        });\n        treeRef.current = currentTree;\n        // Create a shallow copy with new elements reference to ensure React detects change\n        setTree({\n          root: currentTree.root,\n          elements: { ...currentTree.elements },\n        });\n\n        // Clear flush timer if pending\n        if (patchFlushTimer) {\n          clearTimeout(patchFlushTimer);\n          patchFlushTimer = null;\n        }\n\n        // Flush any remaining patches before finalization\n        if (patchBuffer.length > 0) {\n          streamLog.debug(\"Final patch flush\", { count: patchBuffer.length });\n          // Use treeRef for consistency\n          const baseTree = treeRef.current ?? currentTree;\n          currentTree = applyPatchesBatch(baseTree, patchBuffer, turnId);\n          patchBuffer = [];\n          treeRef.current = currentTree;\n          \n          // Update Zustand store for final state\n          const store = storeRef.current;\n          store.setUITree({\n            root: currentTree.root,\n            elements: { ...currentTree.elements },\n          });\n          store.bumpTreeVersion();\n          \n          streamLog.debug(\"Final tree state\", { \n            elementCount: Object.keys(currentTree.elements).length \n          });\n        }\n\n        // Check abort before final state updates\n        if (signal.aborted) {\n          streamLog.warn(\"Request aborted before finalization\");\n          return;\n        }\n\n        // Finalize - mark loading complete\n        streamLog.debug(\"Finalizing turn\", { turnId });\n        setConversation((prev) =>\n          prev.map((t) =>\n            t.id === turnId\n              ? ({\n                  ...t,\n                  assistantMessages: [...currentMessages],\n                  questions: [...currentQuestions],\n                  suggestions: [...currentSuggestions],\n                  treeSnapshot: JSON.parse(JSON.stringify(currentTree)),\n                  documentIndex: currentDocumentIndex ?? t.documentIndex,\n                  isLoading: false, // Loading complete\n                } as ConversationTurn)\n              : t,\n          ),\n        );\n\n        onComplete?.(currentTree);\n      } catch (err) {\n        // Clear buffer and timer on any error\n        if (patchFlushTimer) {\n          clearTimeout(patchFlushTimer);\n          patchFlushTimer = null;\n        }\n        patchBuffer = [];\n\n        if ((err as Error).name === \"AbortError\") {\n          streamLog.info(\"Request aborted\", { turnId });\n          setConversation((prev) => prev.filter((t) => t.id !== turnId));\n          return;\n        }\n        const error = err instanceof Error ? err : new Error(String(err));\n        streamLog.error(\"Stream error\", { error: error.message, turnId });\n        setError(error);\n        onError?.(error);\n        // Mark turn as failed instead of removing it\n        setConversation((prev) =>\n          prev.map((t) =>\n            t.id === turnId\n              ? ({\n                  ...t,\n                  error: error.message,\n                } as ConversationTurn)\n              : t,\n          ),\n        );\n      } finally {\n        sendingRef.current = false;\n        setIsStreaming(false);\n        streamLog.debug(\"Send completed, isStreaming=false\");\n      }\n    },\n    [api, onComplete, onError, setTree],\n  );\n\n  const answerQuestion = useCallback(\n    (turnId: string, questionId: string, answers: Record<string, unknown>) => {\n      const turn = conversation.find((t) => t.id === turnId);\n      const question = turn?.questions?.find((q) => q.id === questionId);\n\n      // Collect all previous question answers from the conversation\n      const allPreviousAnswers: Record<string, unknown> = {};\n      for (const t of conversation) {\n        if (t.questionAnswers) {\n          // For each question answer in the turn, extract the actual values\n          for (const [qId, qAnswers] of Object.entries(t.questionAnswers)) {\n            if (typeof qAnswers === \"object\" && qAnswers !== null) {\n              Object.assign(allPreviousAnswers, qAnswers);\n            }\n          }\n        }\n      }\n\n      // Add the current turn's existing answers\n      if (turn?.questionAnswers) {\n        for (const qAnswers of Object.values(turn.questionAnswers)) {\n          if (typeof qAnswers === \"object\" && qAnswers !== null) {\n            Object.assign(\n              allPreviousAnswers,\n              qAnswers as Record<string, unknown>,\n            );\n          }\n        }\n      }\n\n      setConversation((prev) =>\n        prev.map((t) => {\n          if (t.id !== turnId) return t;\n          const existing = t.questionAnswers ?? {};\n          return {\n            ...t,\n            questionAnswers: {\n              ...existing,\n              [questionId]: answers,\n            },\n          };\n        }),\n      );\n\n      if (question) {\n        const answerSummary = Object.entries(answers)\n          .map(([key, value]) => `${key}: ${value}`)\n          .join(\", \");\n\n        const prompt = `[User Response] ${question.text}\\nAnswer: ${answerSummary}`;\n\n        // Combine all previous answers with current answers\n        const combinedAnswers = { ...allPreviousAnswers, ...answers };\n\n        send(prompt, {\n          isQuestionResponse: true,\n          questionId,\n          turnId,\n          originalQuestion: question.text,\n          answers,\n          previousAnswers: allPreviousAnswers,\n          allCollectedData: combinedAnswers,\n          hideUserMessage: true,\n        });\n      }\n    },\n    [conversation, send],\n  );\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      abortControllerRef.current?.abort();\n    };\n  }, []);\n\n  // Delete a turn and rollback to previous state\n  const deleteTurn = useCallback(\n    (turnId: string) => {\n      // Save current state to history before mutation\n      pushHistory();\n\n      // Find the turn first\n      const currentConversation = conversation;\n      const turnIndex = currentConversation.findIndex((t) => t.id === turnId);\n      if (turnIndex === -1) return;\n\n      // Get the new conversation (all turns before this one)\n      const newConversation = currentConversation.slice(0, turnIndex);\n\n      // Restore tree to previous turn's snapshot (or null if first turn)\n      const previousTurn = newConversation[newConversation.length - 1];\n      const restoredTree = previousTurn?.treeSnapshot ?? null;\n      \n      // Update tree first (outside of setConversation callback)\n      setTree(restoredTree);\n      treeRef.current = restoredTree;\n      \n      // Then update conversation\n      setConversation(newConversation);\n    },\n    [conversation, pushHistory, setTree],\n  );\n\n  // Edit a turn message and regenerate\n  const editTurn = useCallback(\n    async (turnId: string, newMessage: string) => {\n      // Save current state to history before mutation\n      pushHistory();\n\n      // Find the turn index\n      const turnIndex = conversation.findIndex((t) => t.id === turnId);\n      if (turnIndex === -1) return;\n\n      // Remove this turn and all subsequent turns\n      const newConversation = conversation.slice(0, turnIndex);\n      \n      // Restore tree to previous turn's snapshot\n      const previousTurn = newConversation[newConversation.length - 1];\n      const restoredTree = previousTurn?.treeSnapshot ?? null;\n      \n      // Update tree first\n      setTree(restoredTree);\n      treeRef.current = restoredTree;\n      \n      // Then update conversation\n      setConversation(newConversation);\n\n      // Re-send with edited message\n      await send(newMessage, restoredTree ? { tree: restoredTree } : undefined);\n    },\n    [conversation, send, pushHistory, setTree],\n  );\n\n  return {\n    tree,\n    conversation,\n    isStreaming,\n    error,\n    send,\n    clear,\n    loadSession,\n    removeElement,\n    removeSubItems,\n    updateElement,\n    updateElementLayout,\n    deleteTurn,\n    editTurn,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    answerQuestion,\n  };\n}\n","/**\n * Structural sharing utilities for immutable updates\n */\n\n/**\n * Set a value by JSON Pointer path with structural sharing.\n * Only clones objects along the modified path.\n */\nexport function setByPathWithStructuralSharing<\n  T extends Record<string, unknown>,\n>(obj: T, path: string, value: unknown): T {\n  const segments = path.startsWith(\"/\")\n    ? path.slice(1).split(\"/\")\n    : path.split(\"/\");\n  if (segments.length === 0 || (segments.length === 1 && segments[0] === \"\")) {\n    return value as T;\n  }\n\n  const result = { ...obj } as T;\n  let current: Record<string, unknown> = result;\n\n  for (let i = 0; i < segments.length - 1; i++) {\n    const segment = segments[i]!;\n    const nextValue = current[segment];\n\n    if (Array.isArray(nextValue)) {\n      current[segment] = [...nextValue];\n    } else if (nextValue && typeof nextValue === \"object\") {\n      current[segment] = { ...nextValue };\n    } else {\n      current[segment] = {};\n    }\n    current = current[segment] as Record<string, unknown>;\n  }\n\n  const lastSegment = segments[segments.length - 1]!;\n\n  // Handle JSON Pointer \"-\" suffix for array append (RFC 6901)\n  if (lastSegment === \"-\" && Array.isArray(current)) {\n    (current as unknown[]).push(value);\n  } else if (Array.isArray(current)) {\n    const index = parseInt(lastSegment, 10);\n    if (!isNaN(index)) {\n      (current as unknown[])[index] = value;\n    }\n  } else if (lastSegment === \"-\") {\n    // Edge case: path ends with /property/- for array append\n    if (segments.length >= 2) {\n      const arrayPropertyName = segments[segments.length - 2]!;\n      const arrayProperty = current[arrayPropertyName];\n      if (Array.isArray(arrayProperty)) {\n        current[arrayPropertyName] = [...arrayProperty, value];\n      } else if (!arrayProperty) {\n        current[arrayPropertyName] = [value];\n      }\n    }\n  } else {\n    current[lastSegment] = value;\n  }\n\n  return result;\n}\n\n/**\n * Remove a value from an object/array by JSON Pointer path\n */\nexport function removeByPath(\n  target: Record<string, unknown> | unknown[],\n  path: string,\n): void {\n  const segments = path.startsWith(\"/\")\n    ? path.slice(1).split(\"/\")\n    : path.split(\"/\");\n\n  if (segments.length === 0) return;\n\n  let current: Record<string, unknown> | unknown[] = target;\n\n  for (let i = 0; i < segments.length - 1; i++) {\n    const segment = segments[i]!;\n\n    if (Array.isArray(current)) {\n      const index = Number(segment);\n      if (!Number.isInteger(index) || index < 0 || index >= current.length)\n        return;\n      const nextValue = current[index];\n      if (Array.isArray(nextValue) || typeof nextValue === \"object\") {\n        current = nextValue as Record<string, unknown> | unknown[];\n      } else {\n        return;\n      }\n    } else {\n      const nextValue = current[segment];\n      if (Array.isArray(nextValue) || typeof nextValue === \"object\") {\n        current = nextValue as Record<string, unknown> | unknown[];\n      } else {\n        return;\n      }\n    }\n  }\n\n  const lastSegment = segments[segments.length - 1]!;\n\n  if (Array.isArray(current)) {\n    const index = Number(lastSegment);\n    if (!Number.isInteger(index) || index < 0 || index >= current.length)\n      return;\n    current.splice(index, 1);\n    return;\n  }\n\n  delete current[lastSegment];\n}\n","/**\n * UITree manipulation utilities\n */\n\nimport type { UITree, UIElement } from \"@onegenui/core\";\n\n/**\n * Remove a node and its descendants from the tree\n */\nexport function removeNodeFromTree(tree: UITree, key: string): void {\n  const element = tree.elements[key];\n  if (!element) return;\n\n  // Remove from parent\n  if (element.parentKey) {\n    const parent = tree.elements[element.parentKey];\n    if (parent && parent.children) {\n      parent.children = parent.children.filter((k) => k !== key);\n    }\n  } else if (tree.root === key) {\n    tree.root = \"\";\n  }\n\n  // Recursive removal using stack (avoids deep recursion)\n  const stack = [key];\n  while (stack.length > 0) {\n    const currentKey = stack.pop()!;\n    const current = tree.elements[currentKey];\n    delete tree.elements[currentKey];\n\n    if (current && current.children) {\n      stack.push(...current.children);\n    }\n  }\n}\n\n/**\n * Ensure all children references have corresponding elements in the tree.\n * Creates placeholder elements for any missing children.\n */\nexport function ensureChildrenExist(\n  elements: Record<string, UIElement>,\n  children: string[] | undefined,\n  createPlaceholder: (key: string, turnId?: string) => UIElement,\n  turnId?: string,\n): void {\n  if (!children) return;\n  for (const childKey of children) {\n    if (!elements[childKey]) {\n      elements[childKey] = createPlaceholder(childKey, turnId);\n    }\n  }\n}\n\n/**\n * Get the root element from a tree\n */\nexport function getRootElement(tree: UITree): UIElement | null {\n  if (!tree.root) return null;\n  return tree.elements[tree.root] || null;\n}\n\n/**\n * Get all descendant keys of an element\n */\nexport function getDescendantKeys(tree: UITree, key: string): string[] {\n  const result: string[] = [];\n  const stack = [key];\n\n  while (stack.length > 0) {\n    const currentKey = stack.pop()!;\n    const element = tree.elements[currentKey];\n\n    if (element && currentKey !== key) {\n      result.push(currentKey);\n    }\n\n    if (element?.children) {\n      stack.push(...element.children);\n    }\n  }\n\n  return result;\n}\n","/**\n * Patch module types\n * Types for UITree patch operations\n */\n\nimport type { JsonPatch, UIElement } from \"@onegenui/core\";\n\n/**\n * Placeholder element type for forward-referenced children\n */\nexport const PLACEHOLDER_TYPE = \"__placeholder__\";\n\n/**\n * Placeholder element metadata\n */\nexport interface PlaceholderMeta {\n  turnId?: string;\n  createdAt: number;\n  isPlaceholder: true;\n}\n\n/**\n * Create a placeholder element for a forward-referenced child\n */\nexport function createPlaceholder(key: string, turnId?: string): UIElement {\n  return {\n    key,\n    type: PLACEHOLDER_TYPE,\n    props: {},\n    children: [],\n    _meta: {\n      turnId,\n      createdAt: Date.now(),\n      isPlaceholder: true,\n    },\n  } as UIElement;\n}\n\n/**\n * Check if an element is a placeholder\n */\nexport function isPlaceholder(element: UIElement): boolean {\n  return (\n    element.type === PLACEHOLDER_TYPE ||\n    (element._meta as any)?.isPlaceholder === true\n  );\n}\n\n/**\n * Patch classification by type\n */\nexport interface ClassifiedPatches {\n  rootPatches: JsonPatch[];\n  elementPatches: JsonPatch[];\n  propPatches: JsonPatch[];\n  otherPatches: JsonPatch[];\n}\n\n/**\n * Classify patches by their type for ordered processing\n */\nexport function classifyPatches(patches: JsonPatch[]): ClassifiedPatches {\n  const rootPatches: JsonPatch[] = [];\n  const elementPatches: JsonPatch[] = [];\n  const propPatches: JsonPatch[] = [];\n  const otherPatches: JsonPatch[] = [];\n\n  for (const patch of patches) {\n    if (patch.path === \"/root\") {\n      rootPatches.push(patch);\n    } else if (patch.path.startsWith(\"/elements/\")) {\n      const depth = getPatchDepth(patch);\n      if (depth === 1) {\n        elementPatches.push(patch);\n      } else {\n        propPatches.push(patch);\n      }\n    } else {\n      otherPatches.push(patch);\n    }\n  }\n\n  return { rootPatches, elementPatches, propPatches, otherPatches };\n}\n\n/**\n * Get path depth for sorting\n */\nexport function getPatchDepth(patch: JsonPatch): number {\n  if (!patch.path.startsWith(\"/elements/\")) return 0;\n  const parts = patch.path.slice(\"/elements/\".length).split(\"/\");\n  return parts.length;\n}\n\n/**\n * Sort patches for deterministic processing order\n */\nexport function sortPatchesByPath(patches: JsonPatch[]): JsonPatch[] {\n  return [...patches].sort((a, b) => a.path.localeCompare(b.path));\n}\n","import type { UITree, UIElement, JsonPatch } from \"@onegenui/core\";\nimport {\n  setByPathWithStructuralSharing,\n  removeByPath as removeByPathSharing,\n} from \"./patches/structural-sharing\";\nimport {\n  ensureChildrenExist,\n  removeNodeFromTree as removeNode,\n} from \"./patches/tree-utils\";\nimport {\n  createPlaceholder,\n  isPlaceholder,\n  getPatchDepth,\n} from \"./patches/types\";\n\n// Re-exports from modular files\nexport { isPlaceholder };\nexport { removeNode as removeNodeFromTree };\nexport { removeByPathSharing as removeByPath };\n\n/**\n * Parse a single JSON patch line\n */\nexport function parsePatchLine(line: string): JsonPatch | null {\n  try {\n    const trimmed = line.trim();\n    if (!trimmed || trimmed.startsWith(\"//\")) {\n      return null;\n    }\n    return JSON.parse(trimmed) as JsonPatch;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Apply a JSON patch to the current tree\n */\nexport function applyPatch(\n  tree: UITree,\n  patch: JsonPatch,\n  turnId?: string,\n): UITree {\n  const newTree = { ...tree, elements: { ...tree.elements } };\n\n  switch (patch.op) {\n    case \"set\":\n    case \"add\":\n    case \"replace\": {\n      if (patch.path === \"/root\") {\n        newTree.root = patch.value as string;\n        return newTree;\n      }\n\n      if (patch.path.startsWith(\"/elements/\")) {\n        const pathParts = patch.path.slice(\"/elements/\".length).split(\"/\");\n        const elementKey = pathParts[0];\n\n        if (!elementKey) return newTree;\n\n        if (pathParts.length === 1) {\n          const element = patch.value as UIElement;\n          const newElement = turnId\n            ? {\n                ...element,\n                _meta: { ...element._meta, turnId, createdAt: Date.now() },\n              }\n            : element;\n\n          ensureChildrenExist(\n            newTree.elements,\n            newElement.children,\n            createPlaceholder,\n            turnId,\n          );\n          newTree.elements[elementKey] = newElement;\n        } else {\n          let element = newTree.elements[elementKey];\n\n          if (!element) {\n            const isChildrenOperation = pathParts.some((p) => p === \"children\");\n            if (isChildrenOperation) {\n              element = {\n                key: elementKey,\n                type: \"Stack\",\n                props: { gap: \"md\" },\n                children: [],\n                _meta: { turnId, createdAt: Date.now(), autoCreated: true },\n              } as UIElement;\n            } else {\n              element = createPlaceholder(elementKey, turnId);\n            }\n            newTree.elements[elementKey] = element;\n          }\n\n          const propPath = \"/\" + pathParts.slice(1).join(\"/\");\n          const newElement = setByPathWithStructuralSharing(\n            element as unknown as Record<string, unknown>,\n            propPath,\n            patch.value,\n          ) as unknown as UIElement;\n\n          if (\n            propPath.startsWith(\"/children\") &&\n            typeof patch.value === \"string\"\n          ) {\n            const childKey = patch.value;\n            if (!newTree.elements[childKey]) {\n              newTree.elements[childKey] = createPlaceholder(childKey, turnId);\n            }\n            const childElement = newTree.elements[childKey];\n            if (childElement && childElement.parentKey !== elementKey) {\n              newTree.elements[childKey] = {\n                ...childElement,\n                parentKey: elementKey,\n              };\n            }\n          }\n\n          newTree.elements[elementKey] = newElement;\n        }\n      }\n      break;\n    }\n    case \"remove\": {\n      if (patch.path === \"/root\") {\n        newTree.root = \"\";\n        return newTree;\n      }\n\n      if (patch.path.startsWith(\"/elements/\")) {\n        const pathParts = patch.path.slice(\"/elements/\".length).split(\"/\");\n        const elementKey = pathParts[0];\n\n        if (!elementKey) return newTree;\n\n        if (pathParts.length === 1) {\n          const { [elementKey]: _, ...rest } = newTree.elements;\n          newTree.elements = rest;\n        } else {\n          const element = newTree.elements[elementKey];\n          if (element) {\n            const propPath = \"/\" + pathParts.slice(1).join(\"/\");\n            const newElement = { ...element };\n            removeByPathSharing(\n              newElement as unknown as Record<string, unknown>,\n              propPath,\n            );\n            newTree.elements[elementKey] = newElement;\n          }\n        }\n      }\n      break;\n    }\n    case \"ensure\": {\n      if (patch.path.startsWith(\"/elements/\")) {\n        const pathParts = patch.path.slice(\"/elements/\".length).split(\"/\");\n        const elementKey = pathParts[0];\n\n        if (!elementKey) return newTree;\n\n        if (pathParts.length === 1 && !newTree.elements[elementKey]) {\n          const newElement = patch.value as UIElement;\n          if (turnId && newElement._meta) {\n            newElement._meta.turnId = turnId;\n          } else if (turnId) {\n            (newElement as any)._meta = { turnId };\n          }\n          ensureChildrenExist(\n            newTree.elements,\n            newElement.children,\n            createPlaceholder,\n            turnId,\n          );\n          newTree.elements[elementKey] = newElement;\n        }\n      }\n      break;\n    }\n  }\n\n  return newTree;\n}\n\n/**\n * Apply multiple patches in dependency order (ORDER-INDEPENDENT).\n */\nexport function applyPatchesBatch(\n  tree: UITree,\n  patches: JsonPatch[],\n  turnId?: string,\n): UITree {\n  if (patches.length === 0) return tree;\n\n  const rootPatches: JsonPatch[] = [];\n  const elementPatches: JsonPatch[] = [];\n  const propPatches: JsonPatch[] = [];\n  const otherPatches: JsonPatch[] = [];\n\n  for (const patch of patches) {\n    if (patch.path === \"/root\") {\n      rootPatches.push(patch);\n    } else if (patch.path.startsWith(\"/elements/\")) {\n      const depth = getPatchDepth(patch);\n      if (depth === 1) {\n        elementPatches.push(patch);\n      } else {\n        propPatches.push(patch);\n      }\n    } else {\n      otherPatches.push(patch);\n    }\n  }\n\n  elementPatches.sort((a, b) => a.path.localeCompare(b.path));\n  propPatches.sort((a, b) => a.path.localeCompare(b.path));\n\n  let newTree = { ...tree, elements: { ...tree.elements } };\n\n  for (const patch of rootPatches) {\n    newTree = applyPatch(newTree, patch, turnId);\n  }\n  for (const patch of elementPatches) {\n    newTree = applyPatch(newTree, patch, turnId);\n  }\n  for (const patch of propPatches) {\n    newTree = applyPatch(newTree, patch, turnId);\n  }\n  for (const patch of otherPatches) {\n    newTree = applyPatch(newTree, patch, turnId);\n  }\n\n  return newTree;\n}\n","import type { UITree } from \"@onegenui/core\";\nimport { removeNodeFromTree } from \"../patch-utils\";\n\n/**\n * Array prop names commonly used for sub-items\n */\nconst ARRAY_PROP_NAMES = [\n  \"items\",\n  \"rows\",\n  \"entries\",\n  \"cards\",\n  \"events\",\n  \"steps\",\n  \"tasks\",\n  \"options\",\n  \"data\",\n  \"children\",\n  \"nodes\",\n  \"sections\",\n  \"flights\",\n  \"exercises\",\n  \"meals\",\n  \"messages\",\n  \"emails\",\n  \"columns\",\n];\n\n/**\n * Remove an element from the tree by key\n */\nexport function removeElementFromTree(tree: UITree, key: string): UITree {\n  const newTree = JSON.parse(JSON.stringify(tree));\n  removeNodeFromTree(newTree, key);\n  return newTree;\n}\n\n/**\n * Find array indices from mixed identifiers (numbers or string IDs)\n */\nfunction findIndicesFromIdentifiers(\n  prop: unknown[],\n  identifiers: (number | string)[],\n): number[] {\n  const indices: number[] = [];\n\n  for (const id of identifiers) {\n    if (typeof id === \"number\") {\n      if (id >= 0 && id < prop.length) {\n        indices.push(id);\n      }\n    } else {\n      // String ID - try exact match on id/key\n      let idx = prop.findIndex(\n        (item: unknown) =>\n          (item as Record<string, unknown>)?.id === id ||\n          (item as Record<string, unknown>)?.key === id,\n      );\n\n      // Try item-{depth}-{index} format\n      if (idx === -1) {\n        const depthMatch = id.match(/^item-(\\d+)-(\\d+)$/);\n        if (depthMatch?.[2]) {\n          const parsedIndex = parseInt(depthMatch[2], 10);\n          if (parsedIndex >= 0 && parsedIndex < prop.length) {\n            idx = parsedIndex;\n          }\n        }\n      }\n\n      // Try simpler {prefix}-{index} format\n      if (idx === -1) {\n        const simpleMatch = id.match(/^[a-z]+-(\\d+)$/i);\n        if (simpleMatch?.[1]) {\n          const parsedIndex = parseInt(simpleMatch[1], 10);\n          if (parsedIndex >= 0 && parsedIndex < prop.length) {\n            idx = parsedIndex;\n          }\n        }\n      }\n\n      if (idx !== -1) {\n        indices.push(idx);\n      }\n    }\n  }\n\n  return indices;\n}\n\n/**\n * Remove sub-items from an element's array prop\n */\nexport function removeSubItemsFromTree(\n  tree: UITree,\n  elementKey: string,\n  identifiers: (number | string)[],\n): UITree {\n  if (identifiers.length === 0) return tree;\n\n  const element = tree.elements[elementKey];\n  if (!element) return tree;\n\n  const newTree = JSON.parse(JSON.stringify(tree));\n  const newElement = newTree.elements[elementKey];\n\n  for (const propName of ARRAY_PROP_NAMES) {\n    const prop = newElement.props?.[propName];\n    if (Array.isArray(prop) && prop.length > 0) {\n      const indicesToRemove = findIndicesFromIdentifiers(prop, identifiers);\n\n      // Sort descending to remove from end first\n      const uniqueSorted = [...new Set(indicesToRemove)].sort((a, b) => b - a);\n\n      for (const idx of uniqueSorted) {\n        if (idx >= 0 && idx < prop.length) {\n          prop.splice(idx, 1);\n        }\n      }\n      break;\n    }\n  }\n\n  return newTree;\n}\n\n/**\n * Update element props in the tree\n */\nexport function updateElementInTree(\n  tree: UITree,\n  elementKey: string,\n  updates: Record<string, unknown>,\n): UITree {\n  const newTree = JSON.parse(JSON.stringify(tree));\n  const element = newTree.elements[elementKey];\n  if (element) {\n    element.props = { ...element.props, ...updates };\n  }\n  return newTree;\n}\n\n/**\n * Layout update options\n */\nexport interface LayoutUpdates {\n  width?: number;\n  height?: number;\n  column?: number;\n  row?: number;\n  columnSpan?: number;\n  rowSpan?: number;\n  resizable?: boolean;\n}\n\n/**\n * Update element layout in the tree\n */\nexport function updateElementLayoutInTree(\n  tree: UITree,\n  elementKey: string,\n  layoutUpdates: LayoutUpdates,\n): UITree {\n  const element = tree.elements[elementKey];\n  if (!element) return tree;\n\n  const newTree = JSON.parse(JSON.stringify(tree));\n  const newElement = newTree.elements[elementKey];\n\n  if (!newElement.layout) {\n    newElement.layout = {};\n  }\n\n  // Update size\n  if (layoutUpdates.width !== undefined || layoutUpdates.height !== undefined) {\n    if (!newElement.layout.size) {\n      newElement.layout.size = {};\n    }\n    if (layoutUpdates.width !== undefined) {\n      newElement.layout.size.width = layoutUpdates.width;\n    }\n    if (layoutUpdates.height !== undefined) {\n      newElement.layout.size.height = layoutUpdates.height;\n    }\n  }\n\n  // Update grid\n  if (\n    layoutUpdates.column !== undefined ||\n    layoutUpdates.row !== undefined ||\n    layoutUpdates.columnSpan !== undefined ||\n    layoutUpdates.rowSpan !== undefined\n  ) {\n    if (!newElement.layout.grid) {\n      newElement.layout.grid = {};\n    }\n    if (layoutUpdates.column !== undefined) {\n      newElement.layout.grid.column = layoutUpdates.column;\n    }\n    if (layoutUpdates.row !== undefined) {\n      newElement.layout.grid.row = layoutUpdates.row;\n    }\n    if (layoutUpdates.columnSpan !== undefined) {\n      newElement.layout.grid.columnSpan = layoutUpdates.columnSpan;\n    }\n    if (layoutUpdates.rowSpan !== undefined) {\n      newElement.layout.grid.rowSpan = layoutUpdates.rowSpan;\n    }\n  }\n\n  // Update resizable\n  if (layoutUpdates.resizable !== undefined) {\n    newElement.layout.resizable = layoutUpdates.resizable;\n  }\n\n  return newTree;\n}\n","import { useState, useCallback, useRef } from \"react\";\nimport type { UITree } from \"@onegenui/core\";\nimport type { ConversationTurn } from \"../types\";\n\nexport interface HistorySnapshot {\n  tree: UITree | null;\n  conversation: ConversationTurn[];\n}\n\nexport interface UseHistoryReturn {\n  history: HistorySnapshot[];\n  historyIndex: number;\n  pushHistory: () => void;\n  undo: () => void;\n  redo: () => void;\n  canUndo: boolean;\n  canRedo: boolean;\n  setHistory: React.Dispatch<React.SetStateAction<HistorySnapshot[]>>;\n  setHistoryIndex: React.Dispatch<React.SetStateAction<number>>;\n}\n\n/**\n * Hook for managing undo/redo history\n */\nexport function useHistory(\n  tree: UITree | null,\n  conversation: ConversationTurn[],\n  setTree: (tree: UITree | null) => void,\n  setConversation: React.Dispatch<React.SetStateAction<ConversationTurn[]>>,\n  treeRef: React.MutableRefObject<UITree | null>,\n): UseHistoryReturn {\n  const [history, setHistory] = useState<HistorySnapshot[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  const pushHistory = useCallback(() => {\n    const snapshot = {\n      tree: tree ? JSON.parse(JSON.stringify(tree)) : null,\n      conversation: JSON.parse(JSON.stringify(conversation)),\n    };\n    setHistory((prev) => {\n      const newHistory = prev.slice(0, historyIndex + 1);\n      return [...newHistory, snapshot];\n    });\n    setHistoryIndex((prev) => prev + 1);\n  }, [tree, conversation, historyIndex]);\n\n  const undo = useCallback(() => {\n    if (historyIndex < 0) return;\n    const snapshot = history[historyIndex];\n    if (snapshot) {\n      setTree(snapshot.tree);\n      treeRef.current = snapshot.tree;\n      setConversation(snapshot.conversation);\n      setHistoryIndex((prev) => prev - 1);\n    }\n  }, [history, historyIndex, setTree, setConversation, treeRef]);\n\n  const redo = useCallback(() => {\n    if (historyIndex >= history.length - 1) return;\n    const nextIndex = historyIndex + 1;\n    const snapshot = history[nextIndex];\n    if (!snapshot) return;\n    setTree(snapshot.tree);\n    treeRef.current = snapshot.tree;\n    setConversation(snapshot.conversation);\n    setHistoryIndex(nextIndex);\n  }, [history, historyIndex, setTree, setConversation, treeRef]);\n\n  const canUndo = historyIndex >= 0;\n  const canRedo = historyIndex < history.length - 1;\n\n  return {\n    history,\n    historyIndex,\n    pushHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    setHistory,\n    setHistoryIndex,\n  };\n}\n","\"use client\";\n\nimport { useCallback } from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Information about user's native text selection\n */\nexport interface TextSelectionInfo {\n  /** The selected text content */\n  text: string;\n  /** The JSON-UI element key containing the selection (if within a component) */\n  elementKey?: string;\n  /** The component type (e.g., \"List\", \"Email\", \"Document\") */\n  elementType?: string;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to capture native browser text selection.\n *\n * This allows users to:\n * 1. Select text with click+drag (or long-press on mobile)\n * 2. Copy the text normally\n * 3. Have the selection passed to AI as context when sending a message\n *\n * @example\n * ```tsx\n * const { getTextSelection, clearTextSelection, hasTextSelection } = useTextSelection();\n *\n * const handleSend = () => {\n *   const selection = getTextSelection();\n *   if (selection) {\n *     // Include in AI context\n *     context.textSelection = selection;\n *   }\n *   // ... send message\n *   clearTextSelection();\n * };\n * ```\n */\nexport function useTextSelection() {\n  /**\n   * Get the current native text selection, if any.\n   * Returns null if no text is selected or selection is collapsed.\n   */\n  const getTextSelection = useCallback((): TextSelectionInfo | null => {\n    if (typeof window === \"undefined\") return null;\n\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return null;\n\n    const text = selection.toString().trim();\n    if (!text) return null;\n\n    // Find the JSON-UI component containing the selection\n    const anchorNode = selection.anchorNode;\n    const parentElement = anchorNode?.parentElement;\n    const componentWrapper = parentElement?.closest(\n      \"[data-jsonui-element-key]\",\n    ) as HTMLElement | null;\n\n    const elementKey =\n      componentWrapper?.getAttribute(\"data-jsonui-element-key\") ?? undefined;\n    const elementType =\n      componentWrapper?.getAttribute(\"data-jsonui-element-type\") ?? undefined;\n\n    return {\n      text,\n      elementKey,\n      elementType,\n    };\n  }, []);\n\n  const restoreTextSelection = useCallback((range: Range) => {\n    if (typeof window === \"undefined\") return;\n    const selection = window.getSelection();\n    if (!selection) return;\n    selection.removeAllRanges();\n    selection.addRange(range);\n  }, []);\n\n  /**\n   * Clear the native text selection.\n   * Call this after processing the selection (e.g., after sending a message).\n   */\n  const clearTextSelection = useCallback(() => {\n    if (typeof window === \"undefined\") return;\n    window.getSelection()?.removeAllRanges();\n    document.dispatchEvent(new CustomEvent(\"jsonui-text-selection-cleared\"));\n  }, []);\n\n  /**\n   * Check if there's an active text selection.\n   */\n  const hasTextSelection = useCallback((): boolean => {\n    if (typeof window === \"undefined\") return false;\n    const selection = window.getSelection();\n    return !!(\n      selection &&\n      !selection.isCollapsed &&\n      selection.toString().trim()\n    );\n  }, []);\n\n  return {\n    getTextSelection,\n    restoreTextSelection,\n    clearTextSelection,\n    hasTextSelection,\n  };\n}\n","\"use client\";\n\nimport { useState, useEffect } from \"react\";\n\n/**\n * Hook to detect mobile viewport\n */\nexport function useIsMobile(breakpoint = 768) {\n  const [isMobile, setIsMobile] = useState(false);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const media = window.matchMedia(`(max-width: ${breakpoint}px)`);\n    const update = () => setIsMobile(media.matches);\n    update();\n    media.addEventListener(\"change\", update);\n    return () => media.removeEventListener(\"change\", update);\n  }, [breakpoint]);\n\n  return isMobile;\n}\n","\"use client\";\n\nimport { useState, useCallback, useRef, useEffect } from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Information about a preserved text selection\n */\nexport interface PreservedTextSelection {\n  /** The selected text content */\n  text: string;\n  /** The saved Range object for potential restoration */\n  range: Range | null;\n  /** The JSON-UI element key containing the selection (if within a component) */\n  elementKey?: string;\n  /** The component type (e.g., \"List\", \"Email\", \"Document\") */\n  elementType?: string;\n  /** Timestamp when the selection was preserved */\n  timestamp: number;\n  /** Whether the text was auto-copied to clipboard */\n  copiedToClipboard: boolean;\n}\n\nexport interface UsePreservedSelectionReturn {\n  /** Currently preserved selection (if any) */\n  preserved: PreservedTextSelection | null;\n  /** Preserve the current browser text selection before it's lost */\n  preserve: () => Promise<void>;\n  /** Attempt to restore the preserved selection in the DOM */\n  restore: () => boolean;\n  /** Clear the preserved selection */\n  clear: () => void;\n  /** Copy preserved text to clipboard (returns success status) */\n  copyToClipboard: () => Promise<boolean>;\n  /** Whether there is a preserved selection */\n  hasPreserved: boolean;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to preserve text selection when focus moves to another element.\n *\n * This solves the problem where clicking on an input/textarea clears\n * the user's text selection. The hook:\n * 1. Saves the selection text and Range before it's lost\n * 2. Optionally auto-copies to clipboard for convenience\n * 3. Allows restoring the selection if the DOM structure hasn't changed\n *\n * @example\n * ```tsx\n * function ChatInput() {\n *   const { preserved, preserve, clear } = usePreservedSelection();\n *\n *   const handleFocus = useCallback(() => {\n *     preserve(); // Save any current text selection\n *   }, [preserve]);\n *\n *   return (\n *     <>\n *       <input onFocus={handleFocus} ... />\n *       {preserved && (\n *         <TextSelectionBadge\n *           text={preserved.text}\n *           onClear={clear}\n *         />\n *       )}\n *     </>\n *   );\n * }\n * ```\n */\nexport function usePreservedSelection(): UsePreservedSelectionReturn {\n  const [preserved, setPreserved] = useState<PreservedTextSelection | null>(\n    null,\n  );\n  const rangeRef = useRef<Range | null>(null);\n\n  /**\n   * Preserve the current browser text selection.\n   * Saves both the text and the Range for potential restoration.\n   * Also auto-copies to clipboard for convenience.\n   */\n  const preserve = useCallback(async () => {\n    if (typeof window === \"undefined\") return;\n\n    const selection = window.getSelection();\n    if (!selection || selection.isCollapsed) return;\n\n    const text = selection.toString().trim();\n    if (!text) return;\n\n    // Clone the range before it's lost\n    let clonedRange: Range | null = null;\n    try {\n      clonedRange = selection.getRangeAt(0).cloneRange();\n      rangeRef.current = clonedRange;\n    } catch {\n      // Range might not be available in some cases\n      rangeRef.current = null;\n    }\n\n    // Find the containing JSON-UI component\n    const anchorNode = selection.anchorNode;\n    const parentElement = anchorNode?.parentElement;\n    const componentWrapper = parentElement?.closest(\n      \"[data-jsonui-element-key]\",\n    ) as HTMLElement | null;\n\n    const elementKey =\n      componentWrapper?.getAttribute(\"data-jsonui-element-key\") ?? undefined;\n    const elementType =\n      componentWrapper?.getAttribute(\"data-jsonui-element-type\") ?? undefined;\n\n    // Try to copy to clipboard\n    let copiedToClipboard = false;\n    try {\n      await navigator.clipboard.writeText(text);\n      copiedToClipboard = true;\n    } catch {\n      // Clipboard write might fail (permissions, etc.)\n      copiedToClipboard = false;\n    }\n\n    setPreserved({\n      text,\n      range: clonedRange,\n      elementKey,\n      elementType,\n      timestamp: Date.now(),\n      copiedToClipboard,\n    });\n  }, []);\n\n  /**\n   * Attempt to restore the preserved selection in the DOM.\n   * Returns true if successful, false if the Range is no longer valid.\n   */\n  const restore = useCallback((): boolean => {\n    if (typeof window === \"undefined\") return false;\n    if (!rangeRef.current) return false;\n\n    const selection = window.getSelection();\n    if (!selection) return false;\n\n    try {\n      selection.removeAllRanges();\n      selection.addRange(rangeRef.current);\n      return true;\n    } catch {\n      // Range might be invalid if DOM changed\n      return false;\n    }\n  }, []);\n\n  /**\n   * Clear the preserved selection.\n   */\n  const clear = useCallback(() => {\n    setPreserved(null);\n    rangeRef.current = null;\n  }, []);\n\n  /**\n   * Copy the preserved text to clipboard.\n   */\n  const copyToClipboard = useCallback(async (): Promise<boolean> => {\n    if (!preserved?.text) return false;\n\n    try {\n      await navigator.clipboard.writeText(preserved.text);\n      setPreserved((prev) =>\n        prev ? { ...prev, copiedToClipboard: true } : null,\n      );\n      return true;\n    } catch {\n      return false;\n    }\n  }, [preserved]);\n\n  // Auto-clear after 5 minutes to prevent stale data\n  useEffect(() => {\n    if (!preserved) return;\n\n    const timeout = setTimeout(\n      () => {\n        clear();\n      },\n      5 * 60 * 1000,\n    );\n\n    return () => clearTimeout(timeout);\n  }, [preserved, clear]);\n\n  return {\n    preserved,\n    preserve,\n    restore,\n    clear,\n    copyToClipboard,\n    hasPreserved: preserved !== null,\n  };\n}\n","\"use client\";\n\nimport { useCallback, useMemo } from \"react\";\nimport type { UITree, UIElement, ElementLayout } from \"@onegenui/core\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface UseLayoutManagerOptions {\n  /** Current UI tree */\n  tree: UITree | null;\n  /** Callback to update the tree */\n  onTreeUpdate?: (updater: (tree: UITree) => UITree) => void;\n  /** Callback when layout changes (for AI context) */\n  onLayoutChange?: (elementKey: string, layout: ElementLayout) => void;\n}\n\nexport interface UseLayoutManagerReturn {\n  /** Update layout for an element */\n  updateLayout: (elementKey: string, layout: Partial<ElementLayout>) => void;\n  /** Update size for an element */\n  updateSize: (elementKey: string, width: number, height: number) => void;\n  /** Update grid position for an element */\n  updateGridPosition: (\n    elementKey: string,\n    position: {\n      column?: number;\n      row?: number;\n      columnSpan?: number;\n      rowSpan?: number;\n    },\n  ) => void;\n  /** Enable/disable resize for an element */\n  setResizable: (elementKey: string, resizable: boolean) => void;\n  /** Get layout for an element */\n  getLayout: (elementKey: string) => ElementLayout | undefined;\n  /** Get all elements with layout */\n  getLayoutElements: () => Array<{ key: string; layout: ElementLayout }>;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Hook\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Hook to manage element layouts within a UI tree.\n *\n * Provides functions to update element sizes, grid positions, and resize configs.\n * Changes are persisted back to the tree and optionally notified to the AI.\n *\n * @example\n * ```tsx\n * function Dashboard() {\n *   const { tree, setTree } = useUIStream(...);\n *   const { updateSize, updateGridPosition } = useLayoutManager({\n *     tree,\n *     onTreeUpdate: (updater) => setTree(updater(tree!)),\n *     onLayoutChange: (key, layout) => console.log(`${key} layout changed`, layout),\n *   });\n *\n *   return (\n *     <FreeGridCanvas>\n *       <ResizableWrapper\n *         element={element}\n *         onResize={(key, size) => updateSize(key, size.width, size.height)}\n *       >\n *         <Card>Content</Card>\n *       </ResizableWrapper>\n *     </FreeGridCanvas>\n *   );\n * }\n * ```\n */\nexport function useLayoutManager({\n  tree,\n  onTreeUpdate,\n  onLayoutChange,\n}: UseLayoutManagerOptions): UseLayoutManagerReturn {\n  /**\n   * Update layout for an element\n   */\n  const updateLayout = useCallback(\n    (elementKey: string, layoutUpdate: Partial<ElementLayout>) => {\n      if (!tree || !onTreeUpdate) return;\n\n      onTreeUpdate((currentTree) => {\n        const element = currentTree.elements[elementKey];\n        if (!element) return currentTree;\n\n        const currentLayout = element.layout ?? {};\n        const newLayout: ElementLayout = {\n          ...currentLayout,\n          ...layoutUpdate,\n          // Deep merge size and grid\n          size: layoutUpdate.size\n            ? { ...currentLayout.size, ...layoutUpdate.size }\n            : currentLayout.size,\n          grid: layoutUpdate.grid\n            ? { ...currentLayout.grid, ...layoutUpdate.grid }\n            : currentLayout.grid,\n        };\n\n        const updatedElement: UIElement = {\n          ...element,\n          layout: newLayout,\n        };\n\n        onLayoutChange?.(elementKey, newLayout);\n\n        return {\n          ...currentTree,\n          elements: {\n            ...currentTree.elements,\n            [elementKey]: updatedElement,\n          },\n        };\n      });\n    },\n    [tree, onTreeUpdate, onLayoutChange],\n  );\n\n  /**\n   * Update size for an element\n   */\n  const updateSize = useCallback(\n    (elementKey: string, width: number, height: number) => {\n      updateLayout(elementKey, {\n        size: { width, height },\n      });\n    },\n    [updateLayout],\n  );\n\n  /**\n   * Update grid position for an element\n   */\n  const updateGridPosition = useCallback(\n    (\n      elementKey: string,\n      position: {\n        column?: number;\n        row?: number;\n        columnSpan?: number;\n        rowSpan?: number;\n      },\n    ) => {\n      updateLayout(elementKey, {\n        grid: position,\n      });\n    },\n    [updateLayout],\n  );\n\n  /**\n   * Enable/disable resize for an element\n   */\n  const setResizable = useCallback(\n    (elementKey: string, resizable: boolean) => {\n      updateLayout(elementKey, { resizable });\n    },\n    [updateLayout],\n  );\n\n  /**\n   * Get layout for an element\n   */\n  const getLayout = useCallback(\n    (elementKey: string): ElementLayout | undefined => {\n      if (!tree) return undefined;\n      return tree.elements[elementKey]?.layout;\n    },\n    [tree],\n  );\n\n  /**\n   * Get all elements with layout\n   */\n  const getLayoutElements = useMemo(() => {\n    return (): Array<{ key: string; layout: ElementLayout }> => {\n      if (!tree) return [];\n\n      return Object.entries(tree.elements)\n        .filter(([, element]) => element.layout !== undefined)\n        .map(([key, element]) => ({\n          key,\n          layout: element.layout!,\n        }));\n    };\n  }, [tree]);\n\n  return {\n    updateLayout,\n    updateSize,\n    updateGridPosition,\n    setResizable,\n    getLayout,\n    getLayoutElements,\n  };\n}\n","\"use client\";\n\nimport { useState, useCallback } from \"react\";\nimport type { UITree } from \"@onegenui/core\";\nimport type { ConversationTurn } from \"./types\";\n\n/**\n * State snapshot for history\n */\nexport interface HistorySnapshot {\n  tree: UITree | null;\n  conversation: ConversationTurn[];\n}\n\n/**\n * Return type for useHistory hook\n */\nexport interface UseHistoryReturn {\n  history: HistorySnapshot[];\n  historyIndex: number;\n  pushHistory: () => void;\n  undo: () => HistorySnapshot | null;\n  redo: () => HistorySnapshot | null;\n  canUndo: boolean;\n  canRedo: boolean;\n  clearHistory: () => void;\n}\n\n/**\n * Hook for managing undo/redo history\n * Follows Single Responsibility Principle - only manages history state\n */\nexport function useHistory(\n  getCurrentState: () => {\n    tree: UITree | null;\n    conversation: ConversationTurn[];\n  },\n): UseHistoryReturn {\n  const [history, setHistory] = useState<HistorySnapshot[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n\n  const pushHistory = useCallback(() => {\n    const { tree, conversation } = getCurrentState();\n    const snapshot: HistorySnapshot = {\n      tree: tree ? JSON.parse(JSON.stringify(tree)) : null,\n      conversation: JSON.parse(JSON.stringify(conversation)),\n    };\n    setHistory((prev) => {\n      // Truncate any redo history\n      const newHistory = prev.slice(0, historyIndex + 1);\n      return [...newHistory, snapshot];\n    });\n    setHistoryIndex((prev) => prev + 1);\n  }, [getCurrentState, historyIndex]);\n\n  const undo = useCallback((): HistorySnapshot | null => {\n    if (historyIndex < 0) return null;\n    const snapshot = history[historyIndex];\n    if (snapshot) {\n      setHistoryIndex((prev) => prev - 1);\n      return snapshot;\n    }\n    return null;\n  }, [history, historyIndex]);\n\n  const redo = useCallback((): HistorySnapshot | null => {\n    if (historyIndex >= history.length - 1) return null;\n    const nextIndex = historyIndex + 1;\n    const snapshot = history[nextIndex];\n    if (snapshot) {\n      setHistoryIndex(nextIndex);\n      return snapshot;\n    }\n    return null;\n  }, [history, historyIndex]);\n\n  const clearHistory = useCallback(() => {\n    setHistory([]);\n    setHistoryIndex(-1);\n  }, []);\n\n  const canUndo = historyIndex >= 0;\n  const canRedo = historyIndex < history.length - 1;\n\n  return {\n    history,\n    historyIndex,\n    pushHistory,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    clearHistory,\n  };\n}\n","\"use client\";\n\nimport { useCallback, useRef } from \"react\";\nimport { useStore } from \"../store\";\nimport type { DeepResearchEffortLevel } from \"../store/slices/deep-research\";\n\n// =============================================================================\n// Types\n// =============================================================================\n\nexport interface DeepResearchCallbacks {\n  onProgress?: (progress: number, phase: string) => void;\n  onSourceFound?: (source: {\n    url: string;\n    title: string;\n    domain: string;\n  }) => void;\n  onComplete?: (result: DeepResearchResult) => void;\n  onError?: (error: Error) => void;\n}\n\nexport interface DeepResearchResult {\n  qualityScore: number;\n  sourcesUsed: number;\n  report?: unknown;\n}\n\nexport interface DeepResearchPhase {\n  id: string;\n  label: string;\n  weight: number;\n}\n\n// =============================================================================\n// Configuration (aligned with @onegenui/deep-research)\n// =============================================================================\n\nconst EFFORT_DISPLAY: Record<DeepResearchEffortLevel, string> = {\n  standard: \"~3 min\",\n  deep: \"~10 min\",\n  max: \"~30 min\",\n};\n\nconst RESEARCH_PHASES: DeepResearchPhase[] = [\n  { id: \"query-decomposition\", label: \"Query Decomposition\", weight: 5 },\n  { id: \"source-discovery\", label: \"Source Discovery\", weight: 25 },\n  { id: \"content-extraction\", label: \"Content Extraction\", weight: 30 },\n  { id: \"analysis\", label: \"Analysis\", weight: 20 },\n  { id: \"synthesis\", label: \"Synthesis\", weight: 15 },\n  { id: \"visualization\", label: \"Visualization\", weight: 5 },\n];\n\n// =============================================================================\n// Event Handler for Streaming API\n// =============================================================================\n\nexport interface DeepResearchEvent {\n  type:\n    | \"phase-start\"\n    | \"phase-progress\"\n    | \"phase-complete\"\n    | \"source-found\"\n    | \"complete\"\n    | \"error\";\n  phaseId?: string;\n  progress?: number;\n  message?: string;\n  source?: { url: string; title: string; domain: string };\n  result?: DeepResearchResult;\n  error?: string;\n}\n\n/**\n * Hook for executing deep research from React components\n *\n * Integrates with:\n * - DeepResearchSlice for research-specific state\n * - ToolProgressSlice for unified progress display\n *\n * Designed to work with streaming API responses via handleEvent()\n */\nexport function useDeepResearch(callbacks: DeepResearchCallbacks = {}) {\n  const abortControllerRef = useRef<AbortController | null>(null);\n  const toolCallIdRef = useRef<string>(\"\");\n  const callbacksRef = useRef(callbacks);\n  callbacksRef.current = callbacks;\n\n  // Deep Research store actions\n  const startResearchAction = useStore((s) => s.startResearch);\n  const updateResearchProgress = useStore((s) => s.updateResearchProgress);\n  const updateResearchPhase = useStore((s) => s.updateResearchPhase);\n  const addResearchSource = useStore((s) => s.addResearchSource);\n  const completeResearch = useStore((s) => s.completeResearch);\n  const failResearch = useStore((s) => s.failResearch);\n  const stopResearchAction = useStore((s) => s.stopResearch);\n  const clearActiveResearch = useStore((s) => s.clearActiveResearch);\n\n  // Tool Progress store actions\n  const addProgress = useStore((s) => s.addProgress);\n  const updateProgress = useStore((s) => s.updateProgress);\n  const removeProgress = useStore((s) => s.removeProgress);\n\n  // Settings & state\n  const settings = useStore((s) => s.deepResearchSettings);\n  const activeResearch = useStore((s) => s.activeResearch);\n\n  /**\n   * Handle streaming events from the deep research API\n   */\n  const handleEvent = useCallback(\n    (event: DeepResearchEvent) => {\n      const toolCallId = toolCallIdRef.current;\n      if (!toolCallId) return;\n\n      switch (event.type) {\n        case \"phase-start\": {\n          if (event.phaseId) {\n            const phase = RESEARCH_PHASES.find((p) => p.id === event.phaseId);\n            if (phase) {\n              updateResearchProgress({ currentPhase: phase.label });\n              updateResearchPhase(event.phaseId, {\n                status: \"running\",\n                progress: 0,\n                startTime: Date.now(),\n              });\n              updateProgress(toolCallId, {\n                status: \"progress\",\n                message: phase.label,\n                progress: event.progress ?? 0,\n              });\n            }\n          }\n          break;\n        }\n\n        case \"phase-progress\": {\n          if (event.phaseId && event.progress !== undefined) {\n            updateResearchPhase(event.phaseId, { progress: event.progress });\n            updateResearchProgress({ progress: event.progress });\n            updateProgress(toolCallId, {\n              status: \"progress\",\n              progress: event.progress,\n              message: event.message,\n            });\n            callbacksRef.current.onProgress?.(\n              event.progress,\n              event.message ?? \"\",\n            );\n          }\n          break;\n        }\n\n        case \"phase-complete\": {\n          if (event.phaseId) {\n            updateResearchPhase(event.phaseId, {\n              status: \"complete\",\n              progress: 100,\n              endTime: Date.now(),\n            });\n          }\n          break;\n        }\n\n        case \"source-found\": {\n          if (event.source) {\n            addResearchSource({\n              id: `src-${Date.now()}`,\n              url: event.source.url,\n              title: event.source.title,\n              domain: event.source.domain,\n              credibility: 0.5,\n              status: \"fetching\",\n            });\n            callbacksRef.current.onSourceFound?.(event.source);\n          }\n          break;\n        }\n\n        case \"complete\": {\n          const result = event.result ?? { qualityScore: 0.8, sourcesUsed: 0 };\n          completeResearch(result.qualityScore);\n          updateProgress(toolCallId, {\n            status: \"complete\",\n            message: \"Research complete\",\n            progress: 100,\n            data: result,\n          });\n          callbacksRef.current.onComplete?.(result);\n\n          // Auto-remove from tool progress after delay\n          setTimeout(() => removeProgress(toolCallId), 5000);\n          break;\n        }\n\n        case \"error\": {\n          const errorMessage = event.error ?? \"Research failed\";\n          failResearch(errorMessage);\n          updateProgress(toolCallId, {\n            status: \"error\",\n            message: errorMessage,\n          });\n          callbacksRef.current.onError?.(new Error(errorMessage));\n          break;\n        }\n      }\n    },\n    [\n      updateResearchProgress,\n      updateResearchPhase,\n      addResearchSource,\n      completeResearch,\n      failResearch,\n      updateProgress,\n      removeProgress,\n    ],\n  );\n\n  /**\n   * Start deep research on a query\n   *\n   * Returns an abort function to cancel the research\n   */\n  const startResearch = useCallback(\n    (\n      query: string,\n      effortOverride?: DeepResearchEffortLevel,\n    ): { abort: () => void; toolCallId: string } => {\n      if (!settings.enabled) {\n        console.warn(\"Deep Research is not enabled\");\n        return { abort: () => {}, toolCallId: \"\" };\n      }\n\n      // Abort any existing research\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n\n      abortControllerRef.current = new AbortController();\n      const effort = effortOverride ?? settings.effortLevel;\n      const toolCallId = `deep-research-${Date.now()}`;\n      toolCallIdRef.current = toolCallId;\n\n      // Initialize deep research state\n      startResearchAction(query);\n\n      // Add to tool progress for unified display\n      addProgress({\n        toolCallId,\n        toolName: \"deep-research\",\n        status: \"starting\",\n        message: `Starting ${effort} research...`,\n        data: {\n          query,\n          effort,\n          estimatedTime: EFFORT_DISPLAY[effort],\n        },\n      });\n\n      return {\n        abort: () => abortControllerRef.current?.abort(),\n        toolCallId,\n      };\n    },\n    [settings, startResearchAction, addProgress],\n  );\n\n  /**\n   * Stop ongoing research\n   */\n  const stopResearch = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    stopResearchAction();\n\n    const toolCallId = toolCallIdRef.current;\n    if (toolCallId) {\n      updateProgress(toolCallId, {\n        status: \"complete\",\n        message: \"Research stopped\",\n      });\n      setTimeout(() => removeProgress(toolCallId), 2000);\n    }\n  }, [stopResearchAction, updateProgress, removeProgress]);\n\n  /**\n   * Clear research state\n   */\n  const clearResearch = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort();\n      abortControllerRef.current = null;\n    }\n    clearActiveResearch();\n\n    const toolCallId = toolCallIdRef.current;\n    if (toolCallId) {\n      removeProgress(toolCallId);\n    }\n  }, [clearActiveResearch, removeProgress]);\n\n  /**\n   * Get abort signal for API requests\n   */\n  const getAbortSignal = useCallback(() => {\n    return abortControllerRef.current?.signal;\n  }, []);\n\n  const isResearching =\n    activeResearch?.status === \"initializing\" ||\n    activeResearch?.status === \"searching\" ||\n    activeResearch?.status === \"analyzing\" ||\n    activeResearch?.status === \"synthesizing\";\n\n  return {\n    // State\n    isResearching,\n    progress: activeResearch?.progress ?? 0,\n    currentPhase: activeResearch?.currentPhase ?? \"\",\n    sourcesFound: activeResearch?.sources.length ?? 0,\n    error: activeResearch?.error ?? null,\n    activeResearch,\n\n    // Actions\n    startResearch,\n    stopResearch,\n    clearResearch,\n    handleEvent,\n    getAbortSignal,\n\n    // Settings\n    isEnabled: settings.enabled,\n    effortLevel: settings.effortLevel,\n\n    // Constants\n    phases: RESEARCH_PHASES,\n  };\n}\n","import type { UITree, UIElement } from \"@onegenui/core\";\nimport type { FlatElement } from \"./types\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// flatToTree\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Convert a flat element list to a UITree\n */\nexport function flatToTree(elements: FlatElement[]): UITree {\n  const elementMap: Record<string, UIElement> = {};\n  let root = \"\";\n\n  // First pass: add all elements to map\n  for (const element of elements) {\n    elementMap[element.key] = {\n      key: element.key,\n      type: element.type,\n      props: element.props,\n      children: [],\n      visible: element.visible,\n      parentKey: element.parentKey,\n    };\n  }\n\n  // Second pass: build parent-child relationships\n  for (const element of elements) {\n    if (element.parentKey) {\n      const parent = elementMap[element.parentKey];\n      if (parent) {\n        if (!parent.children) {\n          parent.children = [];\n        }\n        parent.children.push(element.key);\n      }\n    } else {\n      root = element.key;\n    }\n  }\n\n  return { root, elements: elementMap };\n}\n","\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  useCallback,\n  type ReactNode,\n  type CSSProperties,\n} from \"react\";\nimport { cn } from \"./utils\";\n\n/**\n * EditableContext state management for inline editing\n */\ninterface EditableContextValue {\n  /** Currently editing path (e.g., \"elements/card-1/props/title\") */\n  editingPath: string | null;\n  /** Current value being edited */\n  editingValue: unknown;\n  /** Start editing a field */\n  startEdit: (path: string, currentValue: unknown) => void;\n  /** Commit the edit with new value */\n  commitEdit: (path: string, newValue: unknown) => void;\n  /** Cancel editing */\n  cancelEdit: () => void;\n  /** Callback when a value is changed */\n  onValueChange?: (path: string, newValue: unknown) => void;\n}\n\nconst EditableContext = createContext<EditableContextValue | null>(null);\n\n/**\n * Provider for editable content management\n */\nexport function EditableProvider({\n  children,\n  onValueChange,\n}: {\n  children: ReactNode;\n  onValueChange?: (path: string, newValue: unknown) => void;\n}) {\n  const [editingPath, setEditingPath] = useState<string | null>(null);\n  const [editingValue, setEditingValue] = useState<unknown>(null);\n\n  const startEdit = useCallback((path: string, currentValue: unknown) => {\n    setEditingPath(path);\n    setEditingValue(currentValue);\n  }, []);\n\n  const commitEdit = useCallback(\n    (path: string, newValue: unknown) => {\n      onValueChange?.(path, newValue);\n      setEditingPath(null);\n      setEditingValue(null);\n    },\n    [onValueChange],\n  );\n\n  const cancelEdit = useCallback(() => {\n    setEditingPath(null);\n    setEditingValue(null);\n  }, []);\n\n  return (\n    <EditableContext.Provider\n      value={{\n        editingPath,\n        editingValue,\n        startEdit,\n        commitEdit,\n        cancelEdit,\n        onValueChange,\n      }}\n    >\n      {children}\n    </EditableContext.Provider>\n  );\n}\n\n/**\n * Hook to access editable context\n */\nexport function useEditableContext() {\n  return useContext(EditableContext);\n}\n\n/**\n * Props returned by useEditable hook\n */\nexport interface EditableProps {\n  /** Whether this field is currently being edited */\n  isEditing: boolean;\n  /** Current value (editing value if editing, otherwise original) */\n  value: unknown;\n  /** Trigger edit mode */\n  onStartEdit: () => void;\n  /** Commit the current edit */\n  onCommit: (newValue: unknown) => void;\n  /** Cancel the current edit */\n  onCancel: () => void;\n  /** Style hint for editable elements */\n  editableClassName: string;\n}\n\n/**\n * Hook for making content editable\n *\n * @param path - Unique path to this editable value (e.g., \"elements/card-1/props/title\")\n * @param currentValue - Current value to display\n * @param locked - If true, editing is disabled\n * @returns Props and handlers for editable content\n */\nexport function useEditable(\n  path: string,\n  currentValue: unknown,\n  locked = false,\n): EditableProps {\n  const ctx = useEditableContext();\n\n  const isEditing = ctx?.editingPath === path;\n  const value = isEditing ? ctx?.editingValue : currentValue;\n\n  const onStartEdit = useCallback(() => {\n    if (locked || !ctx) return;\n    ctx.startEdit(path, currentValue);\n  }, [ctx, path, currentValue, locked]);\n\n  const onCommit = useCallback(\n    (newValue: unknown) => {\n      if (!ctx) return;\n      ctx.commitEdit(path, newValue);\n    },\n    [ctx, path],\n  );\n\n  const onCancel = useCallback(() => {\n    ctx?.cancelEdit();\n  }, [ctx]);\n\n  const editableClassName = locked\n    ? \"\"\n    : \"cursor-text rounded transition-[background-color,box-shadow] duration-150 hover:bg-black/5\";\n\n  return {\n    isEditing,\n    value,\n    onStartEdit,\n    onCommit,\n    onCancel,\n    editableClassName,\n  };\n}\n\n/**\n * Generic editable text component\n */\nexport function EditableText({\n  path,\n  value,\n  locked = false,\n  as: Component = \"span\",\n  className,\n}: {\n  path: string;\n  value: string;\n  locked?: boolean;\n  as?: \"span\" | \"p\" | \"h1\" | \"h2\" | \"h3\" | \"h4\" | \"div\";\n  className?: string;\n}) {\n  const { isEditing, onStartEdit, onCommit, onCancel, editableClassName } =\n    useEditable(path, value, locked);\n  const [localValue, setLocalValue] = useState(value);\n\n  // Sync local value when not editing\n  React.useEffect(() => {\n    if (!isEditing) {\n      setLocalValue(value);\n    }\n  }, [value, isEditing]);\n\n  if (isEditing) {\n    return (\n      <input\n        type=\"text\"\n        value={localValue}\n        onChange={(e) => setLocalValue(e.target.value)}\n        onBlur={() => onCommit(localValue)}\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\") {\n            e.preventDefault();\n            onCommit(localValue);\n          }\n          if (e.key === \"Escape\") {\n            onCancel();\n          }\n        }}\n        autoFocus\n        className={cn(\n          \"w-full box-border -m-0.5 rounded px-1.5 py-0.5 font-inherit text-inherit outline-none\",\n          \"bg-background text-foreground border border-border\",\n          className,\n        )}\n      />\n    );\n  }\n\n  return (\n    <Component\n      className={cn(editableClassName, className)}\n      onDoubleClick={onStartEdit}\n      title={locked ? undefined : \"Double-click to edit\"}\n    >\n      {value}\n    </Component>\n  );\n}\n\n/**\n * Editable number component\n */\nexport function EditableNumber({\n  path,\n  value,\n  locked = false,\n  className,\n}: {\n  path: string;\n  value: number;\n  locked?: boolean;\n  className?: string;\n}) {\n  const { isEditing, onStartEdit, onCommit, onCancel, editableClassName } =\n    useEditable(path, value, locked);\n  const [localValue, setLocalValue] = useState(String(value));\n\n  // Sync local value when not editing\n  React.useEffect(() => {\n    if (!isEditing) {\n      setLocalValue(String(value));\n    }\n  }, [value, isEditing]);\n\n  if (isEditing) {\n    return (\n      <input\n        type=\"number\"\n        value={localValue}\n        onChange={(e) => setLocalValue(e.target.value)}\n        onBlur={() => onCommit(parseFloat(localValue) || 0)}\n        onKeyDown={(e) => {\n          if (e.key === \"Enter\") {\n            e.preventDefault();\n            onCommit(parseFloat(localValue) || 0);\n          }\n          if (e.key === \"Escape\") {\n            onCancel();\n          }\n        }}\n        autoFocus\n        className={cn(\n          \"w-20 box-border -m-0.5 rounded px-1.5 py-0.5 font-inherit text-inherit outline-none\",\n          \"bg-background text-foreground border border-border\",\n          className,\n        )}\n      />\n    );\n  }\n\n  return (\n    <span\n      className={cn(editableClassName, className)}\n      onDoubleClick={onStartEdit}\n      title={locked ? undefined : \"Double-click to edit\"}\n    >\n      {value}\n    </span>\n  );\n}\n","\"use client\";\n\nimport { memo, type CSSProperties, type ReactNode } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkMath from \"remark-math\";\nimport rehypeKatex from \"rehype-katex\";\nimport { cn } from \"../utils\";\n\nexport interface MarkdownTextProps {\n  content: string;\n  className?: string;\n  style?: CSSProperties;\n  inline?: boolean;\n  theme?: Partial<MarkdownTheme>;\n  enableMath?: boolean;\n}\n\nexport interface MarkdownTheme {\n  codeBlockBg: string;\n  codeBlockBorder: string;\n  inlineCodeBg: string;\n  linkColor: string;\n  blockquoteBorder: string;\n  hrColor: string;\n}\n\nconst defaultTheme: MarkdownTheme = {\n  codeBlockBg: \"rgba(0, 0, 0, 0.3)\",\n  codeBlockBorder: \"rgba(255, 255, 255, 0.08)\",\n  inlineCodeBg: \"rgba(0, 0, 0, 0.25)\",\n  linkColor: \"var(--primary, #3b82f6)\",\n  blockquoteBorder: \"var(--primary, #3b82f6)\",\n  hrColor: \"rgba(255, 255, 255, 0.1)\",\n};\n\nexport const MarkdownText = memo(function MarkdownText({\n  content,\n  className,\n  style,\n  inline = false,\n  theme: themeOverrides,\n  enableMath = true,\n}: MarkdownTextProps) {\n  const theme = { ...defaultTheme, ...themeOverrides };\n\n  const wrapperStyle = {\n    \"--markdown-code-bg\": theme.codeBlockBg,\n    \"--markdown-code-border\": theme.codeBlockBorder,\n    \"--markdown-inline-code-bg\": theme.inlineCodeBg,\n    \"--markdown-link-color\": theme.linkColor,\n    \"--markdown-quote-border\": theme.blockquoteBorder,\n    \"--markdown-hr-color\": theme.hrColor,\n    ...style,\n  } as CSSProperties;\n\n  const components = {\n    pre: ({ children }: { children?: ReactNode }) => (\n      <pre className=\"bg-[var(--markdown-code-bg)] rounded-lg p-3 overflow-x-auto text-[13px] font-mono border border-[var(--markdown-code-border)] my-2\">\n        {children}\n      </pre>\n    ),\n    code: ({\n      children,\n      className: codeClassName,\n    }: {\n      children?: ReactNode;\n      className?: string;\n    }) => {\n      const isInline = !codeClassName;\n      if (isInline) {\n        return (\n          <code className=\"bg-[var(--markdown-inline-code-bg)] rounded px-1.5 py-0.5 text-[0.9em] font-mono\">\n            {children}\n          </code>\n        );\n      }\n      return <code>{children}</code>;\n    },\n    a: ({ href, children }: { href?: string; children?: ReactNode }) => (\n      <a\n        href={href}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"text-[var(--markdown-link-color)] underline underline-offset-2 hover:opacity-80 transition-opacity\"\n      >\n        {children}\n      </a>\n    ),\n    ul: ({ children }: { children?: ReactNode }) => (\n      <ul className=\"my-2 pl-5 list-disc\">{children}</ul>\n    ),\n    ol: ({ children }: { children?: ReactNode }) => (\n      <ol className=\"my-2 pl-5 list-decimal\">{children}</ol>\n    ),\n    li: ({ children }: { children?: ReactNode }) => (\n      <li className=\"mb-1\">{children}</li>\n    ),\n    h1: ({ children }: { children?: ReactNode }) => (\n      <h1 className=\"font-semibold mt-3 mb-2 text-lg\">{children}</h1>\n    ),\n    h2: ({ children }: { children?: ReactNode }) => (\n      <h2 className=\"font-semibold mt-3 mb-2 text-base\">{children}</h2>\n    ),\n    h3: ({ children }: { children?: ReactNode }) => (\n      <h3 className=\"font-semibold mt-3 mb-2 text-[15px]\">{children}</h3>\n    ),\n    h4: ({ children }: { children?: ReactNode }) => (\n      <h4 className=\"font-semibold mt-3 mb-2 text-sm\">{children}</h4>\n    ),\n    h5: ({ children }: { children?: ReactNode }) => (\n      <h5 className=\"font-semibold mt-3 mb-2 text-[13px]\">{children}</h5>\n    ),\n    h6: ({ children }: { children?: ReactNode }) => (\n      <h6 className=\"font-semibold mt-3 mb-2 text-xs\">{children}</h6>\n    ),\n    p: ({ children }: { children?: ReactNode }) =>\n      inline ? (\n        <span>{children}</span>\n      ) : (\n        <p className=\"my-1.5 leading-relaxed\">{children}</p>\n      ),\n    blockquote: ({ children }: { children?: ReactNode }) => (\n      <blockquote className=\"border-l-[3px] border-[var(--markdown-quote-border)] pl-3 my-2 opacity-90 italic\">\n        {children}\n      </blockquote>\n    ),\n    hr: () => (\n      <hr className=\"border-none border-t border-[var(--markdown-hr-color)] my-3\" />\n    ),\n    strong: ({ children }: { children?: ReactNode }) => (\n      <strong className=\"font-semibold\">{children}</strong>\n    ),\n    em: ({ children }: { children?: ReactNode }) => (\n      <em className=\"italic\">{children}</em>\n    ),\n  };\n\n  const Wrapper = inline ? \"span\" : \"div\";\n\n  const remarkPlugins = enableMath ? [remarkMath] : [];\n  const rehypePlugins = enableMath ? [rehypeKatex] : [];\n\n  return (\n    <Wrapper className={cn(\"markdown-content\", className)} style={wrapperStyle}>\n      <ReactMarkdown\n        components={components}\n        remarkPlugins={remarkPlugins}\n        rehypePlugins={rehypePlugins}\n      >\n        {content}\n      </ReactMarkdown>\n    </Wrapper>\n  );\n});\n\nexport default MarkdownText;\n","\"use client\";\n\nimport React from \"react\";\nimport type { PreservedTextSelection } from \"../hooks/usePreservedSelection\";\nimport { cn } from \"../utils\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface TextSelectionBadgeProps {\n  /** The preserved selection to display */\n  selection: PreservedTextSelection;\n  /** Callback when user clears the selection */\n  onClear: () => void;\n  /** Callback to restore the selection in the DOM */\n  onRestore?: () => void;\n  /** Maximum characters to show before truncating */\n  maxLength?: number;\n  /** Custom className for styling */\n  className?: string;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Component\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Badge component that displays a preserved text selection.\n *\n * Shows:\n * - Truncated preview of the selected text\n * - \"Copied\" indicator if auto-copied to clipboard\n * - Button to restore selection in DOM (if possible)\n * - Button to clear/dismiss\n *\n * @example\n * ```tsx\n * {preserved && (\n *   <TextSelectionBadge\n *     selection={preserved}\n *     onClear={clear}\n *     onRestore={restore}\n *   />\n * )}\n * ```\n */\nexport function TextSelectionBadge({\n  selection,\n  onClear,\n  onRestore,\n  maxLength = 50,\n  className,\n}: TextSelectionBadgeProps) {\n  const truncatedText =\n    selection.text.length > maxLength\n      ? `${selection.text.substring(0, maxLength)}...`\n      : selection.text;\n\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-2 px-3 py-2 rounded-lg text-[13px] text-foreground\",\n        \"bg-primary/10 border border-primary/20\",\n        className,\n      )}\n    >\n      {/* Text indicator icon */}\n      <svg\n        width=\"14\"\n        height=\"14\"\n        viewBox=\"0 0 24 24\"\n        fill=\"none\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n        className=\"shrink-0 text-primary\"\n      >\n        <path d=\"M17 6.1H3\" />\n        <path d=\"M21 12.1H3\" />\n        <path d=\"M15.1 18H3\" />\n      </svg>\n\n      {/* Text preview */}\n      <span\n        className=\"flex-1 overflow-hidden text-ellipsis whitespace-nowrap italic text-muted-foreground\"\n        title={selection.text}\n      >\n        \"{truncatedText}\"\n      </span>\n\n      {/* Copied indicator */}\n      {selection.copiedToClipboard && (\n        <span className=\"text-[10px] px-1.5 py-0.5 bg-green-500/20 text-green-500 rounded font-medium\">\n          Copied\n        </span>\n      )}\n\n      {/* Element info if available */}\n      {selection.elementType && (\n        <span className=\"text-[10px] px-1.5 py-0.5 bg-violet-500/20 text-violet-500 rounded\">\n          {selection.elementType}\n        </span>\n      )}\n\n      {/* Restore button */}\n      {onRestore && (\n        <button\n          type=\"button\"\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            onRestore();\n          }}\n          title=\"Restore selection\"\n          className=\"flex items-center justify-center p-1 border-none rounded bg-transparent text-muted-foreground cursor-pointer transition-all hover:bg-primary/20 hover:text-primary\"\n        >\n          <svg\n            width=\"12\"\n            height=\"12\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"2\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n          >\n            <path d=\"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8\" />\n            <path d=\"M3 3v5h5\" />\n          </svg>\n        </button>\n      )}\n\n      {/* Clear button */}\n      <button\n        type=\"button\"\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          onClear();\n        }}\n        title=\"Clear\"\n        className=\"flex items-center justify-center p-1 border-none rounded bg-transparent text-muted-foreground cursor-pointer transition-all hover:bg-destructive/20 hover:text-destructive\"\n      >\n        <svg\n          width=\"12\"\n          height=\"12\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n        >\n          <path d=\"M18 6 6 18\" />\n          <path d=\"m6 6 12 12\" />\n        </svg>\n      </button>\n    </div>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// FreeGrid Canvas Component\n// =============================================================================\n\nimport { useMemo } from \"react\";\nimport type { FreeGridCanvasProps } from \"./types\";\nimport { gridContainerBaseStyle } from \"./styles\";\nimport { GridLines } from \"./grid-lines\";\n\n/**\n * A CSS Grid-based canvas for free-form layout of UI elements.\n */\nexport function FreeGridCanvas({\n  columns = 12,\n  rows,\n  cellSize,\n  gap = 16,\n  minRowHeight = 100,\n  showGrid = false,\n  gridLineColor = \"rgba(255, 255, 255, 0.03)\",\n  backgroundColor,\n  children,\n  onLayoutChange: _onLayoutChange,\n  className,\n  style,\n}: FreeGridCanvasProps) {\n  const gridTemplateColumns = useMemo(() => {\n    if (cellSize) {\n      return `repeat(${columns}, ${cellSize}px)`;\n    }\n    return `repeat(${columns}, 1fr)`;\n  }, [columns, cellSize]);\n\n  const gridTemplateRows = useMemo(() => {\n    if (rows) {\n      if (cellSize) {\n        return `repeat(${rows}, ${cellSize}px)`;\n      }\n      return `repeat(${rows}, minmax(${minRowHeight}px, auto))`;\n    }\n    return `repeat(auto-fill, minmax(${minRowHeight}px, auto))`;\n  }, [rows, cellSize, minRowHeight]);\n\n  const containerStyle: React.CSSProperties = {\n    ...gridContainerBaseStyle,\n    gridTemplateColumns,\n    gridTemplateRows,\n    gap,\n    backgroundColor,\n    ...style,\n  };\n\n  return (\n    <div\n      style={containerStyle}\n      className={className}\n      data-free-grid-canvas\n      data-columns={columns}\n      data-rows={rows}\n    >\n      {showGrid && (\n        <GridLines columns={columns} rows={rows ?? 4} color={gridLineColor} />\n      )}\n      {children}\n    </div>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// FreeGrid Styles\n// =============================================================================\n\nimport type React from \"react\";\n\nexport const gridContainerBaseStyle: React.CSSProperties = {\n  display: \"grid\",\n  position: \"relative\",\n  width: \"100%\",\n  minHeight: \"100%\",\n  boxSizing: \"border-box\",\n};\n\nexport const gridLinesOverlayStyle: React.CSSProperties = {\n  position: \"absolute\",\n  inset: 0,\n  pointerEvents: \"none\",\n  zIndex: 0,\n};\n\nexport const gridCellBaseStyle: React.CSSProperties = {\n  position: \"relative\",\n  zIndex: 1,\n  minWidth: 0,\n  minHeight: 0,\n};\n","\"use client\";\n\n// =============================================================================\n// Grid Lines Component\n// =============================================================================\n\nimport { useMemo } from \"react\";\nimport { gridLinesOverlayStyle } from \"./styles\";\n\ninterface GridLinesProps {\n  columns: number;\n  rows: number;\n  color: string;\n}\n\nexport function GridLines({ columns, rows, color }: GridLinesProps) {\n  const patternId = useMemo(\n    () => `grid-pattern-${Math.random().toString(36).substr(2, 9)}`,\n    [],\n  );\n\n  return (\n    <svg style={gridLinesOverlayStyle} aria-hidden=\"true\">\n      <defs>\n        <pattern\n          id={patternId}\n          width={`${100 / columns}%`}\n          height={`${100 / Math.max(rows, 1)}%`}\n          patternUnits=\"objectBoundingBox\"\n        >\n          <rect\n            width=\"100%\"\n            height=\"100%\"\n            fill=\"none\"\n            stroke={color}\n            strokeWidth=\"1\"\n            strokeDasharray=\"4 2\"\n          />\n        </pattern>\n      </defs>\n      <rect width=\"100%\" height=\"100%\" fill={`url(#${patternId})`} />\n    </svg>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// Grid Cell Component\n// =============================================================================\n\nimport type { GridCellProps } from \"./types\";\nimport { gridCellBaseStyle } from \"./styles\";\n\n/**\n * A cell within the FreeGridCanvas that can span multiple columns/rows.\n */\nexport function GridCell({\n  column,\n  row,\n  columnSpan = 1,\n  rowSpan = 1,\n  children,\n  className,\n  style,\n}: GridCellProps) {\n  const cellStyle: React.CSSProperties = {\n    ...gridCellBaseStyle,\n    ...(column && { gridColumnStart: column }),\n    ...(row && { gridRowStart: row }),\n    gridColumnEnd: columnSpan > 1 ? `span ${columnSpan}` : undefined,\n    gridRowEnd: rowSpan > 1 ? `span ${rowSpan}` : undefined,\n    ...style,\n  };\n\n  return (\n    <div style={cellStyle} className={className} data-grid-cell>\n      {children}\n    </div>\n  );\n}\n","\"use client\";\n\n// =============================================================================\n// Layout Utilities\n// =============================================================================\n\nimport type React from \"react\";\nimport type { ElementLayout } from \"@onegenui/core\";\n\n/**\n * Generate CSS styles from an element's layout configuration.\n */\nexport function getLayoutStyles(\n  layout: ElementLayout | undefined,\n): React.CSSProperties {\n  if (!layout) return {};\n\n  const styles: React.CSSProperties = {};\n\n  // Apply sizing\n  if (layout.size) {\n    if (layout.size.width !== undefined) styles.width = layout.size.width;\n    if (layout.size.height !== undefined) styles.height = layout.size.height;\n    if (layout.size.minWidth !== undefined)\n      styles.minWidth = layout.size.minWidth;\n    if (layout.size.maxWidth !== undefined)\n      styles.maxWidth = layout.size.maxWidth;\n    if (layout.size.minHeight !== undefined)\n      styles.minHeight = layout.size.minHeight;\n    if (layout.size.maxHeight !== undefined)\n      styles.maxHeight = layout.size.maxHeight;\n  }\n\n  // Apply grid positioning\n  if (layout.grid) {\n    if (layout.grid.column !== undefined) {\n      styles.gridColumnStart = layout.grid.column;\n    }\n    if (layout.grid.row !== undefined) {\n      styles.gridRowStart = layout.grid.row;\n    }\n    if (layout.grid.columnSpan !== undefined && layout.grid.columnSpan > 1) {\n      styles.gridColumnEnd = `span ${layout.grid.columnSpan}`;\n    }\n    if (layout.grid.rowSpan !== undefined && layout.grid.rowSpan > 1) {\n      styles.gridRowEnd = `span ${layout.grid.rowSpan}`;\n    }\n  }\n\n  return styles;\n}\n\n/**\n * Create a layout configuration from grid position and size.\n */\nexport function createLayout(\n  options: {\n    column?: number;\n    row?: number;\n    columnSpan?: number;\n    rowSpan?: number;\n    width?: number | string;\n    height?: number | string;\n    resizable?: boolean;\n  } = {},\n): ElementLayout {\n  return {\n    grid: {\n      column: options.column,\n      row: options.row,\n      columnSpan: options.columnSpan,\n      rowSpan: options.rowSpan,\n    },\n    size: {\n      width: options.width,\n      height: options.height,\n    },\n    resizable: options.resizable,\n  };\n}\n","\"use client\";\n\nimport React, { memo, useEffect, useState } from \"react\";\nimport {\n  useActiveToolProgress,\n  useIsToolRunning,\n} from \"../contexts/tool-progress\";\nimport type { ToolProgressEvent } from \"../contexts/tool-progress\";\nimport {\n  positionStyles,\n  progressAnimations,\n  DefaultProgressItem,\n} from \"./tool-progress\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Types\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport interface ToolProgressOverlayProps {\n  /** Position of the overlay */\n  position?:\n    | \"top-right\"\n    | \"top-left\"\n    | \"bottom-right\"\n    | \"bottom-left\"\n    | \"top-center\";\n  /** Custom class name */\n  className?: string;\n  /** Whether to show the overlay (default: auto based on isToolRunning) */\n  show?: boolean;\n  /** Maximum number of items to show */\n  maxItems?: number;\n  /** Custom render function for each progress item */\n  renderItem?: (progress: ToolProgressEvent) => React.ReactNode;\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Main Component\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * ToolProgressOverlay - Automatically shows tool execution progress\n *\n * This component renders as a floating overlay that automatically appears\n * when tools are running and hides when complete. Place it once at the root\n * of your app for global tool progress visibility.\n *\n * @example\n * ```tsx\n * <ToolProgressProvider>\n *   <App />\n *   <ToolProgressOverlay position=\"top-right\" />\n * </ToolProgressProvider>\n * ```\n */\nexport const ToolProgressOverlay = memo(function ToolProgressOverlay({\n  position = \"top-right\",\n  className,\n  show,\n  maxItems = 5,\n  renderItem,\n}: ToolProgressOverlayProps) {\n  const activeProgress = useActiveToolProgress();\n  const isRunning = useIsToolRunning();\n  const [mounted, setMounted] = useState(false);\n\n  // Handle client-side mounting\n  useEffect(() => {\n    setMounted(true);\n  }, []);\n\n  // Determine visibility\n  const shouldShow = show ?? isRunning;\n\n  // Don't render on server or if not showing\n  if (!mounted || !shouldShow || activeProgress.length === 0) {\n    return null;\n  }\n\n  const visibleProgress = activeProgress.slice(0, maxItems);\n\n  return (\n    <>\n      {/* CSS Animations */}\n      <style>{progressAnimations}</style>\n\n      {/* Overlay Container */}\n      <div\n        className={className}\n        style={{\n          position: \"fixed\",\n          zIndex: 9999,\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: 8,\n          pointerEvents: \"none\",\n          ...positionStyles[position],\n        }}\n      >\n        {visibleProgress.map((progress) =>\n          renderItem ? (\n            <div key={progress.toolCallId} style={{ pointerEvents: \"auto\" }}>\n              {renderItem(progress)}\n            </div>\n          ) : (\n            <DefaultProgressItem\n              key={progress.toolCallId}\n              progress={progress}\n            />\n          ),\n        )}\n      </div>\n    </>\n  );\n});\n","/**\n * Tool icons and labels for progress display\n */\n\nimport React from \"react\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Tool Icons (inline SVG for zero dependencies)\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const toolIcons: Record<string, React.ReactNode> = {\n  \"web-search\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <circle cx=\"11\" cy=\"11\" r=\"8\" />\n      <path d=\"m21 21-4.3-4.3\" />\n    </svg>\n  ),\n  \"web-scrape\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\" />\n      <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\" />\n    </svg>\n  ),\n  \"search-flight\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z\" />\n    </svg>\n  ),\n  \"search-hotel\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z\" />\n      <path d=\"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2\" />\n      <path d=\"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2\" />\n      <path d=\"M10 6h4\" />\n      <path d=\"M10 10h4\" />\n      <path d=\"M10 14h4\" />\n      <path d=\"M10 18h4\" />\n    </svg>\n  ),\n  \"document-index\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <path d=\"M12 18v-6\" />\n      <path d=\"M9 15l3 3 3-3\" />\n    </svg>\n  ),\n  \"document-index-cache\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <path d=\"M9 15l2 2 4-4\" />\n    </svg>\n  ),\n  \"document-search\": (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <path d=\"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\" />\n      <polyline points=\"14,2 14,8 20,8\" />\n      <circle cx=\"11.5\" cy=\"14.5\" r=\"2.5\" />\n      <path d=\"M13.3 16.3 15 18\" />\n    </svg>\n  ),\n  default: (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth=\"2\"\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n    >\n      <polygon points=\"13,2 3,14 12,14 11,22 21,10 12,10 13,2\" />\n    </svg>\n  ),\n};\n\nexport const toolLabels: Record<string, string> = {\n  \"web-search\": \"Web Search\",\n  \"web-scrape\": \"Reading Page\",\n  \"search-flight\": \"Flight Search\",\n  \"search-hotel\": \"Hotel Search\",\n  search_custom: \"Custom Search\",\n  gmail_list_messages: \"Gmail\",\n  gmail_get_message: \"Gmail\",\n  gmail_get_thread: \"Gmail\",\n  calendar_list_events: \"Calendar\",\n  drive_list_files: \"Drive\",\n  \"document-index\": \"Indexing Document\",\n  \"document-index-cache\": \"Document Cached\",\n  \"document-search\": \"Searching Document\",\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Position Styles\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const positionStyles: Record<string, React.CSSProperties> = {\n  \"top-right\": { top: 16, right: 16 },\n  \"top-left\": { top: 16, left: 16 },\n  \"bottom-right\": { bottom: 16, right: 16 },\n  \"bottom-left\": { bottom: 16, left: 16 },\n  \"top-center\": { top: 16, left: \"50%\", transform: \"translateX(-50%)\" },\n};\n\n// ─────────────────────────────────────────────────────────────────────────────\n// CSS Animations\n// ─────────────────────────────────────────────────────────────────────────────\n\nexport const progressAnimations = `\n  @keyframes slideIn {\n    from {\n      opacity: 0;\n      transform: translateY(-10px);\n    }\n    to {\n      opacity: 1;\n      transform: translateY(0);\n    }\n  }\n  @keyframes pulse {\n    0%, 100% {\n      opacity: 1;\n      transform: scale(1);\n    }\n    50% {\n      opacity: 0.5;\n      transform: scale(1.2);\n    }\n  }\n  @keyframes bounce {\n    0%, 100% {\n      transform: translateY(0);\n    }\n    50% {\n      transform: translateY(-3px);\n    }\n  }\n`;\n","\"use client\";\n\nimport React, { memo } from \"react\";\nimport type { ToolProgressEvent } from \"../../contexts/tool-progress\";\nimport { toolIcons, toolLabels } from \"./icons\";\n\ninterface DefaultProgressItemProps {\n  progress: ToolProgressEvent;\n}\n\nexport const DefaultProgressItem = memo(function DefaultProgressItem({\n  progress,\n}: DefaultProgressItemProps) {\n  const label = toolLabels[progress.toolName] || progress.toolName;\n  const icon = toolIcons[progress.toolName] || toolIcons.default;\n  const isActive =\n    progress.status === \"starting\" || progress.status === \"progress\";\n\n  return (\n    <div\n      style={{\n        display: \"flex\",\n        alignItems: \"center\",\n        gap: 12,\n        padding: \"10px 14px\",\n        borderRadius: 12,\n        background: \"rgba(24, 24, 27, 0.95)\",\n        border: \"1px solid rgba(255, 255, 255, 0.1)\",\n        backdropFilter: \"blur(12px)\",\n        boxShadow: \"0 4px 24px rgba(0, 0, 0, 0.3)\",\n        minWidth: 200,\n        animation: \"slideIn 0.3s ease-out\",\n      }}\n    >\n      {/* Icon with pulse indicator */}\n      <div style={{ position: \"relative\" }}>\n        <div\n          style={{\n            width: 32,\n            height: 32,\n            borderRadius: 8,\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            background: \"rgba(59, 130, 246, 0.2)\",\n            color: \"#60a5fa\",\n          }}\n        >\n          {icon}\n        </div>\n        {isActive && (\n          <span\n            style={{\n              position: \"absolute\",\n              top: -2,\n              right: -2,\n              width: 8,\n              height: 8,\n              borderRadius: \"50%\",\n              background: \"#3b82f6\",\n              animation: \"pulse 1.5s ease-in-out infinite\",\n            }}\n          />\n        )}\n      </div>\n\n      {/* Content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            display: \"flex\",\n            alignItems: \"center\",\n            gap: 6,\n          }}\n        >\n          <span\n            style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: \"#fafafa\",\n            }}\n          >\n            {label}\n          </span>\n          {isActive && (\n            <span style={{ display: \"flex\", gap: 2 }}>\n              {[0, 1, 2].map((i) => (\n                <span\n                  key={i}\n                  style={{\n                    width: 3,\n                    height: 3,\n                    borderRadius: \"50%\",\n                    background: \"rgba(96, 165, 250, 0.6)\",\n                    animation: `bounce 1s ease-in-out ${i * 0.15}s infinite`,\n                  }}\n                />\n              ))}\n            </span>\n          )}\n        </div>\n        {progress.message && (\n          <p\n            style={{\n              margin: 0,\n              marginTop: 2,\n              fontSize: 11,\n              color: \"#a1a1aa\",\n              overflow: \"hidden\",\n              textOverflow: \"ellipsis\",\n              whiteSpace: \"nowrap\",\n            }}\n          >\n            {progress.message}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n});\n","/**\n * Selection Use Cases - Pure Business Logic\n * Extracted from provider.tsx for testability and reusability\n */\n\nimport type {\n  SelectedItem,\n  SelectableItemData,\n  DeepSelectionInfo,\n} from \"../contexts/selection/types\";\nimport type { DeepSelectionData } from \"../ports/selection.port\";\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Item Selection\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Determine if an item should be added to or removed from selection\n */\nexport function computeToggleSelection(\n  currentSelection: SelectedItem[],\n  item: SelectedItem,\n): SelectedItem[] {\n  const isCurrentlySelected = currentSelection.some(\n    (s) => s.itemId === item.itemId && s.elementKey === item.elementKey,\n  );\n\n  if (isCurrentlySelected) {\n    return currentSelection.filter(\n      (s) => !(s.itemId === item.itemId && s.elementKey === item.elementKey),\n    );\n  }\n\n  return [...currentSelection, item];\n}\n\n/**\n * Add item to selection (no-op if already selected)\n */\nexport function computeAddSelection(\n  currentSelection: SelectedItem[],\n  item: SelectedItem,\n): SelectedItem[] {\n  const isCurrentlySelected = currentSelection.some(\n    (s) => s.itemId === item.itemId && s.elementKey === item.elementKey,\n  );\n\n  if (isCurrentlySelected) {\n    return currentSelection;\n  }\n\n  return [...currentSelection, item];\n}\n\n/**\n * Remove item from selection\n */\nexport function computeRemoveSelection(\n  currentSelection: SelectedItem[],\n  itemId: string,\n  elementKey?: string,\n): SelectedItem[] {\n  return currentSelection.filter((s) => {\n    if (elementKey) {\n      return !(s.itemId === itemId && s.elementKey === elementKey);\n    }\n    return s.itemId !== itemId;\n  });\n}\n\n/**\n * Replace entire selection with new items\n */\nexport function computeReplaceSelection(\n  _currentSelection: SelectedItem[],\n  newItems: SelectedItem[],\n): SelectedItem[] {\n  return [...newItems];\n}\n\n/**\n * Check if an item is in selection\n */\nexport function isItemSelected(\n  selection: SelectedItem[],\n  itemId: string,\n  elementKey?: string,\n): boolean {\n  return selection.some((s) => {\n    if (elementKey) {\n      return s.itemId === itemId && s.elementKey === elementKey;\n    }\n    return s.itemId === itemId;\n  });\n}\n\n/**\n * Get selection count by element key\n */\nexport function getSelectionCountByElement(\n  selection: SelectedItem[],\n  elementKey: string,\n): number {\n  return selection.filter((s) => s.elementKey === elementKey).length;\n}\n\n/**\n * Get all items for a specific element\n */\nexport function getSelectionForElement(\n  selection: SelectedItem[],\n  elementKey: string,\n): SelectedItem[] {\n  return selection.filter((s) => s.elementKey === elementKey);\n}\n\n/**\n * Compute multi-select with shift key\n * Returns items between last selected and current\n */\nexport function computeRangeSelection(\n  allItems: SelectableItemData[],\n  currentSelection: SelectedItem[],\n  newItem: SelectableItemData,\n  elementKey: string,\n): SelectedItem[] {\n  const itemsForElement = allItems.filter((i) => i.elementKey === elementKey);\n  const lastSelected = currentSelection\n    .filter((s) => s.elementKey === elementKey)\n    .pop();\n\n  if (!lastSelected) {\n    return computeAddSelection(currentSelection, {\n      itemId: newItem.itemId,\n      elementKey: newItem.elementKey,\n      data: newItem.data,\n    });\n  }\n\n  const lastIndex = itemsForElement.findIndex(\n    (i) => i.itemId === lastSelected.itemId,\n  );\n  const newIndex = itemsForElement.findIndex(\n    (i) => i.itemId === newItem.itemId,\n  );\n\n  if (lastIndex === -1 || newIndex === -1) {\n    return computeAddSelection(currentSelection, {\n      itemId: newItem.itemId,\n      elementKey: newItem.elementKey,\n      data: newItem.data,\n    });\n  }\n\n  const start = Math.min(lastIndex, newIndex);\n  const end = Math.max(lastIndex, newIndex);\n\n  const rangeItems = itemsForElement.slice(start, end + 1).map((item) => ({\n    itemId: item.itemId,\n    elementKey: item.elementKey,\n    data: item.data,\n  }));\n\n  // Merge with existing selection, avoiding duplicates\n  const merged = [...currentSelection];\n  for (const item of rangeItems) {\n    if (!isItemSelected(merged, item.itemId, item.elementKey)) {\n      merged.push(item);\n    }\n  }\n\n  return merged;\n}\n\n/**\n * Generate summary text for selected items\n */\nexport function generateSelectionSummary(selection: SelectedItem[]): string {\n  if (selection.length === 0) {\n    return \"No items selected\";\n  }\n\n  if (selection.length === 1) {\n    const item = selection[0]!;\n    return `1 item selected (${item.elementKey})`;\n  }\n\n  // Group by element key\n  const groups = new Map<string, number>();\n  for (const item of selection) {\n    groups.set(item.elementKey, (groups.get(item.elementKey) || 0) + 1);\n  }\n\n  const parts = Array.from(groups.entries()).map(\n    ([key, count]) => `${count} from ${key}`,\n  );\n\n  return `${selection.length} items selected: ${parts.join(\", \")}`;\n}\n\n/**\n * Export selection as AI-friendly format\n */\nexport function exportSelectionForAI(selection: SelectedItem[]): {\n  summary: string;\n  items: Array<{\n    type: string;\n    id: string;\n    elementKey: string;\n    data?: unknown;\n  }>;\n} {\n  return {\n    summary: generateSelectionSummary(selection),\n    items: selection.map((item) => ({\n      type: \"selected-item\",\n      id: item.itemId,\n      elementKey: item.elementKey,\n      data: item.data,\n    })),\n  };\n}\n\n// ─────────────────────────────────────────────────────────────────────────────\n// Deep Selection Use Cases\n// ─────────────────────────────────────────────────────────────────────────────\n\n/**\n * Generate summary text for deep selections\n */\nexport function generateDeepSelectionSummary(\n  selections: DeepSelectionData[],\n): string {\n  if (selections.length === 0) {\n    return \"No elements selected\";\n  }\n\n  if (selections.length === 1) {\n    const sel = selections[0]!;\n    const preview =\n      sel.textContent.length > 30\n        ? sel.textContent.slice(0, 30) + \"...\"\n        : sel.textContent;\n    return `1 ${sel.tagName} selected: \"${preview}\"`;\n  }\n\n  // Group by element key\n  const groups = new Map<string, number>();\n  for (const sel of selections) {\n    groups.set(sel.elementKey, (groups.get(sel.elementKey) || 0) + 1);\n  }\n\n  const parts = Array.from(groups.entries()).map(\n    ([key, count]) => `${count} from ${key}`,\n  );\n\n  return `${selections.length} elements selected: ${parts.join(\", \")}`;\n}\n\n/**\n * Export deep selections for AI context\n */\nexport function exportDeepSelectionForAI(selections: DeepSelectionData[]): {\n  summary: string;\n  selections: Array<{\n    type: string;\n    elementKey: string;\n    cssPath: string;\n    tagName: string;\n    textContent: string;\n    itemId?: string;\n  }>;\n} {\n  return {\n    summary: generateDeepSelectionSummary(selections),\n    selections: selections.map((sel) => ({\n      type: sel.selectionType,\n      elementKey: sel.elementKey,\n      cssPath: sel.cssPath,\n      tagName: sel.tagName,\n      textContent: sel.textContent,\n      itemId: sel.itemId,\n    })),\n  };\n}\n\n/**\n * Export deep selections as plain text (for clipboard)\n */\nexport function exportDeepSelectionAsText(\n  selections: DeepSelectionData[],\n): string {\n  if (selections.length === 0) return \"\";\n\n  return selections.map((sel) => sel.textContent).join(\"\\n\");\n}\n\n/**\n * Export deep selections as JSON\n */\nexport function exportDeepSelectionAsJSON(\n  selections: DeepSelectionData[],\n): string {\n  return JSON.stringify(\n    selections.map((sel) => ({\n      elementKey: sel.elementKey,\n      cssPath: sel.cssPath,\n      tagName: sel.tagName,\n      textContent: sel.textContent,\n      itemId: sel.itemId,\n      selectionType: sel.selectionType,\n    })),\n    null,\n    2,\n  );\n}\n\n/**\n * Check if a CSS path is selected for an element\n */\nexport function isDeepSelectionSelected(\n  selections: DeepSelectionData[],\n  elementKey: string,\n  cssPath: string,\n): boolean {\n  return selections.some(\n    (s) => s.elementKey === elementKey && s.cssPath === cssPath,\n  );\n}\n\n/**\n * Get deep selections grouped by element key\n */\nexport function groupDeepSelectionsByElement(\n  selections: DeepSelectionData[],\n): Map<string, DeepSelectionData[]> {\n  const groups = new Map<string, DeepSelectionData[]>();\n\n  for (const sel of selections) {\n    const existing = groups.get(sel.elementKey) || [];\n    existing.push(sel);\n    groups.set(sel.elementKey, existing);\n  }\n\n  return groups;\n}\n"],"mappings":"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","names":["ActionProvider","elementRendererPropsAreEqual","useActiveToolProgress","import_immer","confirmationIdCounter","value","import_react","import_core","import_jsx_runtime","import_react","import_core","import_jsx_runtime","React","executeAction","import_react","import_core","import_jsx_runtime","React","value","import_react","import_react","import_react","import_react","import_jsx_runtime","componentWrapper","import_react","isItemSelected","import_react","import_jsx_runtime","import_react","import_react","import_react","import_jsx_runtime","InlineCitation","handleClick","import_jsx_runtime","React","ReactMarkdown","import_react","import_jsx_runtime","import_react","import_jsx_runtime","import_react","import_jsx_runtime","ActionContext","ActionProvider","scheduleFlush","import_react","ActionContext","import_react","import_jsx_runtime","React","import_react","import_shallow","import_jsx_runtime","useActiveToolProgress","import_react","import_shallow","import_jsx_runtime","import_react","import_jsx_runtime","import_react","import_react","import_react","import_jsx_runtime","React","state","import_react","import_react","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","React","ElementRenderer","import_jsx_runtime","import_jsx_runtime","elementRendererPropsAreEqual","import_jsx_runtime","import_react","createPlaceholder","import_react","value","attachments","error","import_react","import_react","import_react","import_react","import_react","import_react","import_react","import_jsx_runtime","React","import_react","import_react_markdown","import_jsx_runtime","defaultTheme","MarkdownText","remarkMath","rehypeKatex","ReactMarkdown","import_jsx_runtime","import_react","import_react","import_jsx_runtime","import_jsx_runtime","import_jsx_runtime","import_react","import_jsx_runtime","import_react","import_jsx_runtime","DefaultProgressItem","import_jsx_runtime","ToolProgressOverlay","useActiveToolProgress"]}